!function(e){function t(t){for(var s,n,o=t[0],c=t[1],d=t[2],l=0,u=[];l<o.length;l++)n=o[l],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&u.push(r[n][0]),r[n]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);for(h&&h(t);u.length;)u.shift()();return i.push.apply(i,d||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],s=!0,o=1;o<a.length;o++){var c=a[o];0!==r[c]&&(s=!1)}s&&(i.splice(t--,1),e=n(n.s=a[0]))}return e}var s={},r={0:0},i=[];function n(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=s,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(a,s,function(t){return e[t]}.bind(null,s));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var o=window.webpackJsonp=window.webpackJsonp||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var d=0;d<o.length;d++)t(o[d]);var h=c;i.push([449,1]),a()}({449:function(e,t,a){e.exports=a(501)},457:function(e,t,a){var s={"./af":142,"./af.js":142,"./ar":143,"./ar-dz":144,"./ar-dz.js":144,"./ar-kw":145,"./ar-kw.js":145,"./ar-ly":146,"./ar-ly.js":146,"./ar-ma":147,"./ar-ma.js":147,"./ar-sa":148,"./ar-sa.js":148,"./ar-tn":149,"./ar-tn.js":149,"./ar.js":143,"./az":150,"./az.js":150,"./be":151,"./be.js":151,"./bg":152,"./bg.js":152,"./bm":153,"./bm.js":153,"./bn":154,"./bn-bd":155,"./bn-bd.js":155,"./bn.js":154,"./bo":156,"./bo.js":156,"./br":157,"./br.js":157,"./bs":158,"./bs.js":158,"./ca":159,"./ca.js":159,"./cs":160,"./cs.js":160,"./cv":161,"./cv.js":161,"./cy":162,"./cy.js":162,"./da":163,"./da.js":163,"./de":164,"./de-at":165,"./de-at.js":165,"./de-ch":166,"./de-ch.js":166,"./de.js":164,"./dv":167,"./dv.js":167,"./el":168,"./el.js":168,"./en-au":169,"./en-au.js":169,"./en-ca":170,"./en-ca.js":170,"./en-gb":171,"./en-gb.js":171,"./en-ie":172,"./en-ie.js":172,"./en-il":173,"./en-il.js":173,"./en-in":174,"./en-in.js":174,"./en-nz":175,"./en-nz.js":175,"./en-sg":176,"./en-sg.js":176,"./eo":177,"./eo.js":177,"./es":178,"./es-do":179,"./es-do.js":179,"./es-mx":180,"./es-mx.js":180,"./es-us":181,"./es-us.js":181,"./es.js":178,"./et":182,"./et.js":182,"./eu":183,"./eu.js":183,"./fa":184,"./fa.js":184,"./fi":185,"./fi.js":185,"./fil":186,"./fil.js":186,"./fo":187,"./fo.js":187,"./fr":188,"./fr-ca":189,"./fr-ca.js":189,"./fr-ch":190,"./fr-ch.js":190,"./fr.js":188,"./fy":191,"./fy.js":191,"./ga":192,"./ga.js":192,"./gd":193,"./gd.js":193,"./gl":194,"./gl.js":194,"./gom-deva":195,"./gom-deva.js":195,"./gom-latn":196,"./gom-latn.js":196,"./gu":197,"./gu.js":197,"./he":198,"./he.js":198,"./hi":199,"./hi.js":199,"./hr":200,"./hr.js":200,"./hu":201,"./hu.js":201,"./hy-am":202,"./hy-am.js":202,"./id":203,"./id.js":203,"./is":204,"./is.js":204,"./it":205,"./it-ch":206,"./it-ch.js":206,"./it.js":205,"./ja":207,"./ja.js":207,"./jv":208,"./jv.js":208,"./ka":209,"./ka.js":209,"./kk":210,"./kk.js":210,"./km":211,"./km.js":211,"./kn":212,"./kn.js":212,"./ko":213,"./ko.js":213,"./ku":214,"./ku.js":214,"./ky":215,"./ky.js":215,"./lb":216,"./lb.js":216,"./lo":217,"./lo.js":217,"./lt":218,"./lt.js":218,"./lv":219,"./lv.js":219,"./me":220,"./me.js":220,"./mi":221,"./mi.js":221,"./mk":222,"./mk.js":222,"./ml":223,"./ml.js":223,"./mn":224,"./mn.js":224,"./mr":225,"./mr.js":225,"./ms":226,"./ms-my":227,"./ms-my.js":227,"./ms.js":226,"./mt":228,"./mt.js":228,"./my":229,"./my.js":229,"./nb":230,"./nb.js":230,"./ne":231,"./ne.js":231,"./nl":232,"./nl-be":233,"./nl-be.js":233,"./nl.js":232,"./nn":234,"./nn.js":234,"./oc-lnc":235,"./oc-lnc.js":235,"./pa-in":236,"./pa-in.js":236,"./pl":237,"./pl.js":237,"./pt":238,"./pt-br":239,"./pt-br.js":239,"./pt.js":238,"./ro":240,"./ro.js":240,"./ru":241,"./ru.js":241,"./sd":242,"./sd.js":242,"./se":243,"./se.js":243,"./si":244,"./si.js":244,"./sk":245,"./sk.js":245,"./sl":246,"./sl.js":246,"./sq":247,"./sq.js":247,"./sr":248,"./sr-cyrl":249,"./sr-cyrl.js":249,"./sr.js":248,"./ss":250,"./ss.js":250,"./sv":251,"./sv.js":251,"./sw":252,"./sw.js":252,"./ta":253,"./ta.js":253,"./te":254,"./te.js":254,"./tet":255,"./tet.js":255,"./tg":256,"./tg.js":256,"./th":257,"./th.js":257,"./tk":258,"./tk.js":258,"./tl-ph":259,"./tl-ph.js":259,"./tlh":260,"./tlh.js":260,"./tr":261,"./tr.js":261,"./tzl":262,"./tzl.js":262,"./tzm":263,"./tzm-latn":264,"./tzm-latn.js":264,"./tzm.js":263,"./ug-cn":265,"./ug-cn.js":265,"./uk":266,"./uk.js":266,"./ur":267,"./ur.js":267,"./uz":268,"./uz-latn":269,"./uz-latn.js":269,"./uz.js":268,"./vi":270,"./vi.js":270,"./x-pseudo":271,"./x-pseudo.js":271,"./yo":272,"./yo.js":272,"./zh-cn":273,"./zh-cn.js":273,"./zh-hk":274,"./zh-hk.js":274,"./zh-mo":275,"./zh-mo.js":275,"./zh-tw":276,"./zh-tw.js":276};function r(e){var t=i(e);return a(t)}function i(e){if(!a.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=i,e.exports=r,r.id=457},475:function(e,t,a){var s={"./af":306,"./af.js":306,"./ar":307,"./ar-dz":308,"./ar-dz.js":308,"./ar-kw":309,"./ar-kw.js":309,"./ar-ly":310,"./ar-ly.js":310,"./ar-ma":311,"./ar-ma.js":311,"./ar-sa":312,"./ar-sa.js":312,"./ar-tn":313,"./ar-tn.js":313,"./ar.js":307,"./az":314,"./az.js":314,"./be":315,"./be.js":315,"./bg":316,"./bg.js":316,"./bm":317,"./bm.js":317,"./bn":318,"./bn.js":318,"./bo":319,"./bo.js":319,"./br":320,"./br.js":320,"./bs":321,"./bs.js":321,"./ca":322,"./ca.js":322,"./cs":323,"./cs.js":323,"./cv":324,"./cv.js":324,"./cy":325,"./cy.js":325,"./da":326,"./da.js":326,"./de":327,"./de-at":328,"./de-at.js":328,"./de-ch":329,"./de-ch.js":329,"./de.js":327,"./dv":330,"./dv.js":330,"./el":331,"./el.js":331,"./en-SG":332,"./en-SG.js":332,"./en-au":333,"./en-au.js":333,"./en-ca":334,"./en-ca.js":334,"./en-gb":335,"./en-gb.js":335,"./en-ie":336,"./en-ie.js":336,"./en-il":337,"./en-il.js":337,"./en-nz":338,"./en-nz.js":338,"./eo":339,"./eo.js":339,"./es":340,"./es-do":341,"./es-do.js":341,"./es-us":342,"./es-us.js":342,"./es.js":340,"./et":343,"./et.js":343,"./eu":344,"./eu.js":344,"./fa":345,"./fa.js":345,"./fi":346,"./fi.js":346,"./fo":347,"./fo.js":347,"./fr":348,"./fr-ca":349,"./fr-ca.js":349,"./fr-ch":350,"./fr-ch.js":350,"./fr.js":348,"./fy":351,"./fy.js":351,"./ga":352,"./ga.js":352,"./gd":353,"./gd.js":353,"./gl":354,"./gl.js":354,"./gom-latn":355,"./gom-latn.js":355,"./gu":356,"./gu.js":356,"./he":357,"./he.js":357,"./hi":358,"./hi.js":358,"./hr":359,"./hr.js":359,"./hu":360,"./hu.js":360,"./hy-am":361,"./hy-am.js":361,"./id":362,"./id.js":362,"./is":363,"./is.js":363,"./it":364,"./it-ch":365,"./it-ch.js":365,"./it.js":364,"./ja":366,"./ja.js":366,"./jv":367,"./jv.js":367,"./ka":368,"./ka.js":368,"./kk":369,"./kk.js":369,"./km":370,"./km.js":370,"./kn":371,"./kn.js":371,"./ko":372,"./ko.js":372,"./ku":373,"./ku.js":373,"./ky":374,"./ky.js":374,"./lb":375,"./lb.js":375,"./lo":376,"./lo.js":376,"./lt":377,"./lt.js":377,"./lv":378,"./lv.js":378,"./me":379,"./me.js":379,"./mi":380,"./mi.js":380,"./mk":381,"./mk.js":381,"./ml":382,"./ml.js":382,"./mn":383,"./mn.js":383,"./mr":384,"./mr.js":384,"./ms":385,"./ms-my":386,"./ms-my.js":386,"./ms.js":385,"./mt":387,"./mt.js":387,"./my":388,"./my.js":388,"./nb":389,"./nb.js":389,"./ne":390,"./ne.js":390,"./nl":391,"./nl-be":392,"./nl-be.js":392,"./nl.js":391,"./nn":393,"./nn.js":393,"./pa-in":394,"./pa-in.js":394,"./pl":395,"./pl.js":395,"./pt":396,"./pt-br":397,"./pt-br.js":397,"./pt.js":396,"./ro":398,"./ro.js":398,"./ru":399,"./ru.js":399,"./sd":400,"./sd.js":400,"./se":401,"./se.js":401,"./si":402,"./si.js":402,"./sk":403,"./sk.js":403,"./sl":404,"./sl.js":404,"./sq":405,"./sq.js":405,"./sr":406,"./sr-cyrl":407,"./sr-cyrl.js":407,"./sr.js":406,"./ss":408,"./ss.js":408,"./sv":409,"./sv.js":409,"./sw":410,"./sw.js":410,"./ta":411,"./ta.js":411,"./te":412,"./te.js":412,"./tet":413,"./tet.js":413,"./tg":414,"./tg.js":414,"./th":415,"./th.js":415,"./tl-ph":416,"./tl-ph.js":416,"./tlh":417,"./tlh.js":417,"./tr":418,"./tr.js":418,"./tzl":419,"./tzl.js":419,"./tzm":420,"./tzm-latn":421,"./tzm-latn.js":421,"./tzm.js":420,"./ug-cn":422,"./ug-cn.js":422,"./uk":423,"./uk.js":423,"./ur":424,"./ur.js":424,"./uz":425,"./uz-latn":426,"./uz-latn.js":426,"./uz.js":425,"./vi":427,"./vi.js":427,"./x-pseudo":428,"./x-pseudo.js":428,"./yo":429,"./yo.js":429,"./zh-cn":430,"./zh-cn.js":430,"./zh-hk":431,"./zh-hk.js":431,"./zh-tw":432,"./zh-tw.js":432};function r(e){var t=i(e);return a(t)}function i(e){if(!a.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=i,e.exports=r,r.id=475},501:function(e,t,a){"use strict";a.r(t);var s,r=a(21),i=a.n(r),n=a(438),o=a.n(n),c=a(17),d=a.n(c);!function(e){e[e.ItemAdded=0]="ItemAdded",e[e.ItemUpdated=1]="ItemUpdated",e[e.ItemDeleted=2]="ItemDeleted",e[e.StateChanged=3]="StateChanged"}(s||(s={}));var h=d()("state-manager-delegate"),l=function(){function e(e){this.suppressEventEmits=!1,this.managerName=e,this.stateChangeListeners=[]}var t=e.prototype;return t.suppressEvents=function(){this.suppressEventEmits=!0},t.emitEvents=function(){this.suppressEventEmits=!1},t.informChangeListenersForStateWithName=function(e,t,a,r){if(void 0===a&&(a=s.StateChanged),void 0===r&&(r=null),h("State Manager: Informing state listeners of "+e),this.suppressEventEmits)h("State Manager: Events suppressed");else{var i=this.stateChangeListeners.findIndex((function(t){return t.name===e}));if(i>=0){h("State Manager: Found state listeners of "+e+" with event type "+a);for(var n=this.stateChangeListeners[i],o=0;o<n.listeners.length;o++){h("State Manager: Found state listener of "+e+" - informing");var c=n.listeners[o];switch(a){case s.StateChanged:c.stateChanged(this.managerName,e,t);break;case s.ItemAdded:c.stateChangedItemAdded(this.managerName,e,t);break;case s.ItemUpdated:c.stateChangedItemUpdated(this.managerName,e,r,t);break;case s.ItemDeleted:c.stateChangedItemRemoved(this.managerName,e,t)}}}}},t.addChangeListenerForName=function(e,t){this.ensureListenerSetupForName(e),h("State Manager: Adding state listener for "+e);var a=this.stateChangeListeners.findIndex((function(t){return t.name===e}));a>=0&&this.stateChangeListeners[a].listeners.push(t)},t.ensureListenerSetupForName=function(e){if(this.stateChangeListeners.findIndex((function(t){return t.name===e}))<0){var t={name:e,listeners:[]};this.stateChangeListeners.push(t)}},e}(),u=d()("state-manager-ts"),m=function(){function e(e){this.forceSaves=!0,this.managerName="",this.delegate=new l(e),this.managerName=e,this.emitEvents(),this.forceSaves=!0}var t=e.prototype;return t.suppressEvents=function(){this.delegate.suppressEvents()},t.emitEvents=function(){this.delegate.emitEvents()},t.dontForceSavesOnAddRemoveUpdate=function(){this.forceSaves=!1},t.forceSavesOnAddRemoveUpdate=function(){this.forceSaves=!0},t.informChangeListenersForStateWithName=function(e,t,a,r){void 0===a&&(a=s.StateChanged),void 0===r&&(r=null),this.delegate.informChangeListenersForStateWithName(e,t,a,r)},t.addChangeListenerForName=function(e,t){this.delegate.addChangeListenerForName(e,t)},t.addStateByName=function(e,t){this._ensureStatePresent(e);var a={name:e,value:t};return this._replaceNamedStateInStorage(a),this.informChangeListenersForStateWithName(e,t,s.StateChanged),t},t.getStateByName=function(e){this._ensureStatePresent(e),u("State Manager: Getting state for "+e);var t;return t=this._getState(e).value,u("State Manager: Found previous state for "+e),u(t),t},t.setStateByName=function(e,t,a){return void 0===a&&(a=!0),this._ensureStatePresent(e),u("State Manager: Setting state for "+e),u(t),this._getState(e).value=t,this.forceSaves&&this._saveState(e,t),a&&this.informChangeListenersForStateWithName(e,t),t},t.addNewItemToState=function(e,t,a){void 0===a&&(a=!1),this._ensureStatePresent(e),u("State Manager: Adding item to state "+e),this._addItemToState(e,t,a),this.informChangeListenersForStateWithName(e,t,s.ItemAdded)},t.findItemInState=function(e,t,a){this._ensureStatePresent(e);var s={},r=this.getStateByName(e),i=r.findIndex((function(e){return a(e,t)}));return u("Finding item in state "+e+" - found index "+i),u(t),i>=0&&(s=r[i]),s},t.isItemInState=function(e,t,a){this._ensureStatePresent(e);var s=!1;return this.getStateByName(e).findIndex((function(e){return a(e,t)}))>=0&&(s=!0),s},t.removeItemFromState=function(e,t,a,r){this._ensureStatePresent(e);var i=this.findItemInState(e,t,a);return u("State Manager: Found item - removing "),this._removeItemFromState(e,t,a,r),this.informChangeListenersForStateWithName(e,i,s.ItemDeleted),!0},t.updateItemInState=function(e,t,a,r){this._ensureStatePresent(e);var i=this.findItemInState(e,t,a);return u("State Manager: Found item - replacing "),this._updateItemInState(e,t,a,r),this.informChangeListenersForStateWithName(e,t,s.ItemUpdated,i),!0},e}();function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f,v,p=d()("state-manager-ms"),S=function(e){var t,a;function s(){var t;return(t=e.call(this,"memory")||this).applicationState=[],t.forceSaves=!0,t}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,g(t,a),s.getInstance=function(){return s._instance||(s._instance=new s),s._instance};var r=s.prototype;return r._ensureStatePresent=function(e){if(this.applicationState.findIndex((function(t){return t.name===e}))<0){var t={name:e,value:[]};this.applicationState.push(t)}},r._addNewNamedStateToStorage=function(e){p("Adding new complete state "+name),p(e.value),this.applicationState.push(e)},r._replaceNamedStateInStorage=function(e){var t=this.applicationState.findIndex((function(t){return t.name===e.name}));t>=0&&(p("replacing complete state "+name),p(e.value),this.applicationState.splice(t,1,e))},r._getState=function(e){var t=this.applicationState.find((function(t){return t.name===e}));return p("getting complete state "+e),p(t.value),t},r._saveState=function(e,t){var a=this.applicationState.findIndex((function(t){return t.name===e}));if(a>=0){var s=this.applicationState[a];p("SAVING complete state "+e),p(s.value),s.value=t}},r._addItemToState=function(e,t,a){if(void 0===a&&(a=!1),a){var s=this.applicationState.findIndex((function(t){return t.name===e}));if(s>=0){var r=this.applicationState[s];p("adding item to state "+e),p(t),r.value.push(t)}}},r._removeItemFromState=function(e,t,a,s){var r=this.applicationState.findIndex((function(t){return t.name===e}));if(r>=0){var i=this.applicationState[r],n=i.value.findIndex((function(e){return a(e,t)}));n>=0&&(p("removing item from state "+e),p(t),i.value.splice(n,1))}},r._updateItemInState=function(e,t,a,s){var r=this.applicationState.findIndex((function(t){return t.name===e}));if(r>=0){var i=this.applicationState[r],n=i.value.findIndex((function(e){return a(e,t)}));n>=0&&(i.value.splice(n,1,t),p("updating item in state "+e),p(t))}else this._addItemToState(e,t,!0)},s}(m);function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}function I(e,t,a,s,r,i,n){try{var o=e[i](n),c=o.value}catch(e){return void a(e)}o.done?t(c):Promise.resolve(c).then(s,r)}!function(e){e[e.POST=0]="POST",e[e.GET=1]="GET",e[e.PUT=2]="PUT",e[e.DELETE=3]="DELETE"}(f||(f={})),function(e){e[e.PRIORITY=0]="PRIORITY",e[e.BACKGROUND=1]="BACKGROUND"}(v||(v={}));var C=d()("api-ts"),y=new(function(){function e(){}var t=e.prototype;return t.postFetchJSON=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,a){var s,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:a})},e.next=3,fetch(t,s);case 3:return r=e.sent,e.abrupt("return",r.json());case 5:case"end":return e.stop()}}),e)})),function(){var t=this,a=arguments;return new Promise((function(s,r){var i=e.apply(t,a);function n(e){I(i,s,r,n,o,"next",e)}function o(e){I(i,s,r,n,o,"throw",e)}n(void 0)}))});return function(e,a){return t.apply(this,arguments)}}(),t.apiFetchJSONWithPost=function(e){C("Executing fetch with URL "+e.originalRequest.url+" with body "+e.originalRequest.params);try{JSON.stringify(e.originalRequest.params)}catch(t){C("Unable to convert parameters to JSON"),C(e.originalRequest.params,100),e.callback(null,404,e.queueType,e.requestId)}var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b({},e.originalRequest.params))};this.fetchJSON(e.originalRequest.url,t,e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithGet=function(e){C("Executing GET fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id);e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,{method:"GET",headers:{"Content-Type":"application/json"}},e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithDelete=function(e){C("Executing DELETE fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id);e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,{method:"DELETE",headers:{"Content-Type":"application/json"}},e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithPut=function(e){C("Executing PUT fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id);var t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b({},e.originalRequest.params))};e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,t,e.callback,e.queueType,e.requestId)},t.fetchJSON=function(e,t,a,s,r){fetch(e,t).then((function(e){if(C("Response code was "+e.status),e.status>=200&&e.status<=299)return e.json();400===e.status&&C(e.json())})).then((function(e){C(e),a(e,200,s,r)})).catch((function(e){C(e),a(null,500,s,r)}))},e}()),L=new(function(){function e(){}return e.prototype.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},e}());function w(e,t,a,s,r,i,n){try{var o=e[i](n),c=o.value}catch(e){return void a(e)}o.done?t(c):Promise.resolve(c).then(s,r)}function U(e){return function(){var t=this,a=arguments;return new Promise((function(s,r){var i=e.apply(t,a);function n(e){w(i,s,r,n,o,"next",e)}function o(e){w(i,s,r,n,o,"throw",e)}n(void 0)}))}}var N,k,E=d()("api-ts"),R=new(function(){function e(){this.backgroundQueue=[],this.priorityQueue=[],this.inProgress=[],this.backgroundChangeListener=null,this.priorityChangeListener=null,this.callbackForQueueRequest=this.callbackForQueueRequest.bind(this)}var t=e.prototype;return t.setBackgroundChangeListener=function(e){this.backgroundChangeListener=e},t.setPriorityChangeListener=function(e){this.priorityChangeListener=e},t.getPriorityQueueCount=function(){return this.priorityQueue.length},t.getBackgroundQueueCount=function(){return this.backgroundQueue.length},t.addQLApiRequest=function(e,t,a,s,r,i){void 0===i&&(i=!1);var n={url:e,type:f.POST,params:{query:t,variables:a},callback:s,associatedStateName:r};R.addApiRequest(n,i)},t.addQLMutationRequest=function(e,t,a,s,r,i){void 0===i&&(i=!1);var n={url:e,type:f.POST,params:{mutation:t,variables:a},callback:s,associatedStateName:r};R.addApiRequest(n,i)},t.addApiRequest=function(e,t){void 0===t&&(t=!1);var a=L.getUniqueId();if(E("Download Manger: Adding Queue Request "+a),E(e,200),t){var s={originalRequest:e,requestId:a,queueType:v.PRIORITY,callback:this.callbackForQueueRequest};this.priorityQueue.push(s),this.priorityChangeListener&&this.priorityChangeListener.handleEventAddToQueue()}else{var r={originalRequest:e,requestId:a,queueType:v.BACKGROUND,callback:this.callbackForQueueRequest};this.backgroundQueue.push(r),this.backgroundChangeListener&&this.backgroundChangeListener.handleEventAddToQueue()}this.processQueues()},t.processPriorityQueue=function(){var e=U(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==(t=this.priorityQueue.shift())&&this.inProgress.push(t),void 0!==t&&this.initiateFetchForQueueItem(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processBackgroundQueue=function(){var e=U(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==(t=this.backgroundQueue.shift())&&this.inProgress.push(t),void 0!==t&&this.initiateFetchForQueueItem(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processQueues=function(){var e=U(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.priorityQueue.length+this.backgroundQueue.length;case 1:if(!(t>0)){e.next=14;break}if(E("Download Manager: processing queue, items remaining "+t),!(this.priorityQueue.length>0)){e.next=8;break}return e.next=6,this.processPriorityQueue();case 6:e.next=11;break;case 8:if(!(this.backgroundQueue.length>0)){e.next=11;break}return e.next=11,this.processBackgroundQueue();case 11:t=this.priorityQueue.length+this.backgroundQueue.length,e.next=1;break;case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.callbackForQueueRequest=function(e,t,a,s){a===v.PRIORITY?this.priorityChangeListener&&this.priorityChangeListener.handleEventRemoveFromQueue():this.backgroundChangeListener&&this.backgroundChangeListener.handleEventRemoveFromQueue(),E("Download Manager: received callback for queue "+a+" request "+s+" with status "+t);var r=this.inProgress.findIndex((function(e){return e.requestId===s}));if(r>=0){var i=this.inProgress[r];this.inProgress.splice(r,1),E(i),E("Download Manager: finished for queue item "+i.requestId),i.originalRequest.callback(e,t,i.originalRequest.associatedStateName)}},t.initiateFetchForQueueItem=function(e){if(E("Download Manager: initiating fetch for queue item "+e.requestId),E(e),null!==e.originalRequest.url&&null!=e.originalRequest.params&&null!=e.originalRequest.callback)switch(e.originalRequest.type){case f.POST:y.apiFetchJSONWithPost(e);break;case f.GET:y.apiFetchJSONWithGet(e);break;case f.DELETE:y.apiFetchJSONWithDelete(e);break;case f.PUT:y.apiFetchJSONWithPut(e)}},e}()),D=R,B=d()("state-manager-api"),F=function(){function e(){this.configuration=[],this.delegate=new l("restapi"),this.emitEvents(),this.bHasCompletedRun=[],this.callbackForAddItem=this.callbackForAddItem.bind(this),this.callbackForRemoveItem=this.callbackForRemoveItem.bind(this),this.callbackForUpdateItem=this.callbackForUpdateItem.bind(this),this.callbackForGetItems=this.callbackForGetItems.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getConfiguredStateNames=function(){var e=[];return this.configuration.forEach((function(t){e.push(t.stateName)})),e},t.hasCompletedRun=function(e){var t=!1,a=this.configuration.findIndex((function(t){return t.stateName===e}));return a>=0&&(t=this.bHasCompletedRun[a]),t},t.setCompletedRun=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!0)},t.forceResetForGet=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!1)},t.initialise=function(e){this.configuration=e;var t=[];this.configuration.forEach((function(e){t.push(!1)})),this.bHasCompletedRun=t},t._addNewNamedStateToStorage=function(e){},t._getState=function(e){if(B("Getting All "+e),this.hasCompletedRun(e))B("Getting All "+e+" - not done - previously retrieved");else{var t=this.getConfigurationForStateName(e);if(t.isActive){var a={url:t.serverURL+t.api,type:f.GET,params:{},callback:this.callbackForGetItems,associatedStateName:e};D.addApiRequest(a,!0)}else B("No configuration for state "+e)}return{name:e,value:[]}},t._ensureStatePresent=function(e){},t._replaceNamedStateInStorage=function(e){},t._saveState=function(e,t){},t._addItemToState=function(e,t,a){if(void 0===a&&(a=!1),!a){B("Adding item to "+e),B(t);var s=this.getConfigurationForStateName(e);if(s.isActive){var r={url:s.serverURL+s.api,type:f.POST,params:t,callback:this.callbackForAddItem,associatedStateName:e};D.addApiRequest(r,!0)}else B("No configuration for state "+e)}},t._removeItemFromState=function(e,t,a,s){if(!s){B("Removing item to "+e),B(t);var r=this.getConfigurationForStateName(e);if(r.isActive){var i={url:r.serverURL+r.api,type:f.DELETE,params:{id:t.id},callback:this.callbackForRemoveItem,associatedStateName:e};D.addApiRequest(i,!0)}else B("No configuration for state "+e)}},t._updateItemInState=function(e,t,a,s){if(!s){B("Updating item in "+e),B(t);var r=this.getConfigurationForStateName(e);if(r.isActive){var i={url:r.serverURL+r.api,type:f.PUT,params:t,callback:this.callbackForUpdateItem,associatedStateName:e};D.addApiRequest(i,!0)}else B("No configuration for state "+e)}},t.addChangeListenerForName=function(e,t){this.delegate.addChangeListenerForName(e,t)},t.addNewItemToState=function(e,t,a){this._addItemToState(e,t,a)},t.emitEvents=function(){this.delegate.emitEvents()},t.findItemInState=function(e,t,a){throw Error("not implemented")},t.getStateByName=function(e){this._getState(e)},t.informChangeListenersForStateWithName=function(e,t,a,s){this.delegate.informChangeListenersForStateWithName(e,t,a,s)},t.isItemInState=function(e,t,a){return!0},t.removeItemFromState=function(e,t,a,s){return this._removeItemFromState(e,t,a,s),!0},t.setStateByName=function(e,t,a){},t.suppressEvents=function(){this.delegate.suppressEvents()},t.updateItemInState=function(e,t,a,s){return this._updateItemInState(e,t,a,s),!0},t.getConfigurationForStateName=function(e){var t={stateName:e,serverURL:"",api:"",isActive:!1},a=this.configuration.findIndex((function(t){return t.stateName===e}));return a>=0&&(t=this.configuration[a]),t},t.callbackForRemoveItem=function(e,t,a){B("callback for remove item for state "+a+" with status "+t+" - not forwarded"),t>=200&&t<=299&&B(e)},t.callbackForUpdateItem=function(e,t,a){B("callback for update item for state "+a+" with status "+t+" - not forwarded"),t>=200&&t<=299&&B(e)},t.callbackForGetItems=function(e,t,a){B("callback for get items for state "+a+" with status "+t+" - FORWARDING"),t>=200&&t<=299&&(B(e),this.setCompletedRun(a),this.delegate.informChangeListenersForStateWithName(a,e,s.StateChanged,null))},t.callbackForAddItem=function(e,t,a){B("callback for add item for state "+a+" with status "+t+" - FORWARDING"),t>=200&&t<=299&&(B(e),this.delegate.informChangeListenersForStateWithName(a,e,s.ItemAdded,null))},e}();!function(e){e[e.Normal=0]="Normal",e[e.High=1]="High",e[e.Urgent=2]="Urgent"}(N||(N={})),function(e){e[e.ChatRoom=0]="ChatRoom",e[e.ScoreSheet=1]="ScoreSheet"}(k||(k={}));var j=d()("socket-ts"),T=new(function(){function e(){this.chatReceivers=[],this.callbackForMessage=this.callbackForMessage.bind(this),this.callbackForData=this.callbackForData.bind(this),this.listener=null,this.socket=null,this.chatReceivers=[],this.callbackForMessage=this.callbackForMessage.bind(this),this.callbackForLogin=this.callbackForLogin.bind(this),this.callbackForLogout=this.callbackForLogout.bind(this),this.callbackForJoinRoom=this.callbackForJoinRoom.bind(this),this.callbackForExitRoom=this.callbackForExitRoom.bind(this),this.callbackForInvite=this.callbackForInvite.bind(this),this.callbackForChat=this.callbackForChat.bind(this),this.callbackForQueue=this.callbackForQueue.bind(this),this.callbackForUserList=this.callbackForUserList.bind(this),this.callbackForDeclineInvite=this.callbackForDeclineInvite.bind(this)}var t=e.prototype;return t.addChatReceiver=function(e){this.chatReceivers.push(e)},t.setListener=function(e){j("Setting listener"),this.listener=e,j("Creating socket connection"),this.socket=io(),j("Waiting for messages"),this.socket.on("message",this.callbackForMessage),this.socket.on("data",this.callbackForData),this.socket.on("login",this.callbackForLogin),this.socket.on("logout",this.callbackForLogout),this.socket.on("joinroom",this.callbackForJoinRoom),this.socket.on("exitroom",this.callbackForExitRoom),this.socket.on("invite",this.callbackForInvite),this.socket.on("declineinvite",this.callbackForDeclineInvite),this.socket.on("chat",this.callbackForChat),this.socket.on("queue",this.callbackForQueue),this.socket.on("userlist",this.callbackForUserList)},t.login=function(e){this.socket.emit("login",{username:e})},t.logout=function(e){this.socket.emit("logout",{username:e})},t.joinChat=function(e,t,a){this.socket.emit("joinroom",{username:e,room:t,type:a})},t.leaveChat=function(e,t,a){this.socket.emit("exitroom",{username:e,room:t,type:a})},t.sendInvite=function(e,t,a,s,r,i,n){void 0===s&&(s=k.ChatRoom),void 0===r&&(r=!1),void 0===i&&(i=""),void 0===n&&(n={});var o={from:e,to:t,room:a,type:s,requiresAcceptDecline:r,subject:i,attachment:n};j("Sending invite"),j(o),this.socket.emit("invite",o)},t.sendMessage=function(e,t,a,s,r,i,n){void 0===i&&(i=N.Normal),void 0===n&&(n={});var o={from:e,room:t,message:a,created:s,priority:i,type:r,attachment:n};this.socket.emit("chat",o)},t.getUserList=function(){this.socket.emit("userlist")},t.sendDeclineInvite=function(e,t,a){this.socket.emit("declineinvite",{room:e,from:t,type:a})},t.callbackForMessage=function(e){j("Received message : "+e);try{j(e);var t=JSON.parse(e);this.chatReceivers.forEach((function(e){return e.receiveMessage(t)}))}catch(e){j(e),j("Not JSON data")}},t.callbackForLogin=function(e){j("Received login : "+e),this.chatReceivers.forEach((function(t){return t.receiveLogin(e)}))},t.callbackForUserList=function(e){j("Received user list : "+e),this.chatReceivers.forEach((function(t){return t.receiveUserList(e)}))},t.callbackForLogout=function(e){j("Received logout : "+e),this.chatReceivers.forEach((function(t){return t.receiveLogout(e)}))},t.callbackForJoinRoom=function(e){j("Received joined room : "+e);try{var t=JSON.parse(e);j(t),this.chatReceivers.forEach((function(e){return e.receiveJoinedRoom(t)}))}catch(e){j("Not JSON data")}},t.callbackForExitRoom=function(e){j("Received left room : "+e);try{var t=JSON.parse(e);j(t),this.chatReceivers.forEach((function(e){return e.receivedLeftRoom(t)}))}catch(e){j("Not JSON data")}},t.callbackForInvite=function(e){j("Received invite : "+e);try{var t=JSON.parse(e);j(t),this.chatReceivers.forEach((function(e){return e.receiveInvitation(t)}))}catch(e){j("Not JSON data")}},t.callbackForDeclineInvite=function(e){j("Received declined invite : "+e);try{var t=JSON.parse(e);j(t),this.chatReceivers.forEach((function(e){return e.receiveDecline(t.room,t.username,t.type)}))}catch(e){j(e),j("Not JSON data")}},t.callbackForChat=function(e){j("Received chat : "+e);try{var t=JSON.parse(e);j(t),this.chatReceivers.forEach((function(e){return e.receiveMessage(t)}))}catch(e){j("Not JSON data")}},t.callbackForQueue=function(e){j("Received queued items : "+e);try{var t=JSON.parse(e);j(t),t.invites&&t.invites.length>0&&this.chatReceivers.forEach((function(e){return e.receiveQueuedInvites(t.invites)})),t.messages&&t.messages.length>0&&this.chatReceivers.forEach((function(e){return e.receiveQueuedMessages(t.messages)}))}catch(e){j("Not JSON data")}},t.callbackForData=function(e){j("Received data");try{var t=JSON.parse(e);if(j(t),null===this.listener)return;t.user===this.listener.getCurrentUser()?j("change made by this user, ignoring"):(j("change made by another user, passing off to the application"),this.listener.handleDataChangedByAnotherUser(t))}catch(e){j("Not JSON data")}},e}());function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var G=d()("state-manager-async"),x=function(e){var t,a;function s(t,a){var s;(s=e.call(this,"async")||this).topLevelSM=t,s.wrappedSM=a,s.forceSaves=!1,s.wrappedSM.emitEvents();var r=s.wrappedSM.getConfiguredStateNames();return s.stateChanged=s.stateChanged.bind(A(s)),s.stateChangedItemAdded=s.stateChangedItemAdded.bind(A(s)),s.stateChangedItemRemoved=s.stateChangedItemRemoved.bind(A(s)),s.stateChangedItemUpdated=s.stateChangedItemUpdated.bind(A(s)),r.forEach((function(e){s.wrappedSM.addChangeListenerForName(e,A(s))})),s}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,M(t,a);var r=s.prototype;return r._addItemToState=function(e,t,a){void 0===a&&(a=!1),G("adding item to state "+e+" - is persisted "+a),this.wrappedSM.addNewItemToState(e,t,a)},r._getState=function(e){return G("getting state "+e),this.wrappedSM.getStateByName(e),{name:e,value:[]}},r._removeItemFromState=function(e,t,a,s){G("removing item from state "+e),this.wrappedSM.removeItemFromState(e,t,a,s)},r._updateItemInState=function(e,t,a,s){G("updating item in state "+e),this.wrappedSM.updateItemInState(e,t,a,s)},r._ensureStatePresent=function(e){},r._addNewNamedStateToStorage=function(e){},r._replaceNamedStateInStorage=function(e){},r._saveState=function(e,t){},r.stateChangedItemRemoved=function(e,t,a){},r.stateChangedItemUpdated=function(e,t,a,s){},r.stateChanged=function(e,t,a){G("Wrapped SM has supplied new state "+t+" passing to top level SM"),G(a),this.topLevelSM.setStateByName(t,a)},r.stateChangedItemAdded=function(e,t,a){G("Wrapped SM has supplied new completed item for state "+t+" passing to top level SM"),this.topLevelSM.addNewItemToState(t,a,!0)},s}(m);function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=d()("state-manager-aggregate"),_=function(e){var t,a;function s(){var t;return(t=e.call(this,"aggregate")||this).stateManagers=[],t.emitEvents(),t}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,O(t,a),s.getInstance=function(){return s._instance||(s._instance=new s),s._instance};var r=s.prototype;return r.addStateManager=function(e,t,a){void 0===t&&(t=[]);var s={manager:e,filters:t};this.stateManagers.push(s),a||e.suppressEvents(),P("adding state manager with/without filters")},r._addNewNamedStateToStorage=function(e){var t=this;this.stateManagers.forEach((function(a){t.stateNameInFilters(e.name,a.filters)||a.manager._addNewNamedStateToStorage(e)}))},r._getState=function(e){var t=this,a={name:e,value:[]};return this.stateManagers.forEach((function(s){t.stateNameInFilters(a.name,s.filters)||(P("get state from state manager for state "+e),P(s.manager),s.manager._getState(e))})),this.stateManagers.length>0&&(a=this.stateManagers[0].manager._getState(e)),a},r._ensureStatePresent=function(e){var t=this;this.stateManagers.forEach((function(a){t.stateNameInFilters(e,a.filters)||a.manager._ensureStatePresent(e)}))},r._replaceNamedStateInStorage=function(e){var t=this;this.stateManagers.forEach((function(a){t.stateNameInFilters(e.name,a.filters)||a.manager._replaceNamedStateInStorage(e)}))},r._saveState=function(e,t){var a=this;this.stateManagers.forEach((function(s){a.stateNameInFilters(e,s.filters)||(P("saving state in state manager for state "+e),P(s.manager),P(t),s.manager._saveState(e,t))}))},r._addItemToState=function(e,t,a){var s=this;void 0===a&&(a=!1),this.stateManagers.forEach((function(r){s.stateNameInFilters(e,r.filters)||(P("adding item to state in  state manager for state "+e+", is persisted = "+a),P(r.manager),P(t),r.manager._addItemToState(e,t,a))}))},r._removeItemFromState=function(e,t,a,s){var r=this;this.stateManagers.forEach((function(i){r.stateNameInFilters(e,i.filters)||(P("removing item from state in state manager for state "+e),P(i.manager),P(t),i.manager._removeItemFromState(e,t,a,s))}))},r._updateItemInState=function(e,t,a,s){var r=this;this.stateManagers.forEach((function(i){r.stateNameInFilters(e,i.filters)||(P("updating item in state in  state manager for state "+e),P(i.manager),P(t),i.manager._updateItemInState(e,t,a,s))}))},r.stateNameInFilters=function(e,t){return t.findIndex((function(t){return t===e}))>=0},s}(m);function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var H=function(e){var t,a;function s(t){return e.call(this,t)||this}return a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,V(t,a),s.prototype.show=function(e,t,a,s,r){var i=this;void 0===a&&(a=0),void 0===s&&(s="info"),void 0===r&&(r=3e3);var n=this.notificationManager.getContainerId(),o="";switch(s){case"info":o="bg-info";break;case"warning":o="bg-warning";break;case"message":o="bg-primary";break;case"priority":o="bg-danger";break;default:o="bg-info"}var c=document.createElement("div");c.className="notification toast",c.style.top=a+"px",c.setAttribute("role","alert"),c.setAttribute("data-autohide","false");var d=document.createElement("div");d.className="toast-header text-white "+o;var h=document.createElement("strong");h.className="mr-auto",h.textContent=e;var l=document.createElement("button");l.className="ml-2 mb-1 close",l.textContent="x",l.addEventListener("click",(function(){i.notificationManager.remove(c)}));var u=document.createElement("div");u.className="toast-body",u.textContent=t,d.appendChild(h),d.appendChild(l),c.appendChild(d),c.appendChild(u),c.classList.add("is-"+s);var m=document.getElementById(n);return m&&m.appendChild(c),$(".notification").toast("show"),r<=0&&(r=2e3),setTimeout((function(){i.notificationManager.remove(c)}),r),c},s}((function(e){this.show=this.show.bind(this),this.notificationManager=e,this.containerId=this.notificationManager.getContainerId()})),q=new(function(){function e(){}return e.prototype.createNotification=function(e){return new H(e)},e}()),K=new(function(){function e(){this.notifications=[],this.currentCount=0,this.offsetPerNotification=120,this.containerId="notifications",this.show=this.show.bind(this)}var t=e.prototype;return t.getContainerId=function(){return this.containerId},t.show=function(e,t,a,s){void 0===a&&(a="info"),void 0===s&&(s=5e3);var r=q.createNotification(this).show(e,t,this.currentCount*this.offsetPerNotification,a,s);this.currentCount++,this.notifications.push(r)},t.remove=function(e){var t=this,a=this.notifications.findIndex((function(t){return t===e}));a>=0&&(this.notifications.splice(a,1),this.notifications.map((function(e,a){e.style.top=t.offsetPerNotification*a+"px"})));var s=e.parentElement;null!==s&&s.removeChild(e),this.currentCount--,this.currentCount<0&&(this.currentCount=0)},e}());function Q(e,t){return e.id===t.id}function Y(e,t){return e.username===t.username}function J(e,t){return e.gameId===t.gameId}var z=d()("socket-listener"),W=function(){function e(e){this.config=e}var t=e.prototype;return t.handleDataChangedByAnotherUser=function(e){z("Handling data change "+e.type+" on object type "+e.stateName+" made by user "+e.user);var t=Le.getStateManager().findItemInState(this.config.stateNames.users,{id:e.user},Q),a="unknown";t&&(a=t.username),z("Handling data change "+e.type+" on object type "+e.stateName+" made by user "+a);var s=e.data;z(s);try{switch(e.type){case"create":switch(e.stateName){case this.config.stateNames.comments:Le.getStateManager().addNewItemToState(this.config.stateNames.comments,s,!0);var r=Le.getStateManager().findItemInState(this.config.stateNames.entries,{id:s.commentOn},Q);r&&K.show(r.title,a+" added comment "+s.content);break;case this.config.stateNames.entries:Le.getStateManager().addNewItemToState(this.config.stateNames.entries,s,!0),K.show(s.title,a+" added new entry");break;case this.config.stateNames.users:Le.getStateManager().addNewItemToState(this.config.stateNames.users,s,!0),K.show(s.username,s.username+" has just registered.","message")}break;case"update":switch(e.stateName){case this.config.stateNames.entries:Le.getStateManager().updateItemInState(this.config.stateNames.entries,s,Q,!0)}break;case"delete":switch(e.stateName){case this.config.stateNames.comments:Le.getStateManager().removeItemFromState(this.config.stateNames.comments,s,Q,!0);break;case this.config.stateNames.entries:var i=Le.getStateManager().findItemInState(this.config.stateNames.entries,s,Q);Le.getStateManager().removeItemFromState(this.config.stateNames.entries,s,Q,!0),K.show(i.title,a+" has deleted this entry.","priority")}}}catch(e){z(e)}},t.handleMessage=function(e){z("Received message: "+e)},t.getCurrentUser=function(){return Le.getLoggedInUserId()},e}(),Z=a(6),X=a.n(Z);function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var te,ae=d()("local-storage"),se=function(e){var t,a;function s(t){var a;return void 0===t&&(t=!1),(a=e.call(this,"browser")||this).configuration=[],a.storage=window.sessionStorage,t&&(a.storage=window.localStorage),a.forceSaves=!0,a}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,ee(t,a),s.getInstance=function(e){return void 0===e&&(e=!1),s._instance||(s._instance=new s(e)),s._instance};var r=s.prototype;return r._ensureStatePresent=function(e){null===this.storage.getItem(e)&&this._addNewNamedStateToStorage({name:e,value:[]})},r._addNewNamedStateToStorage=function(e){ae("Local Storage: Saving with key "+e.name),ae(e);var t=JSON.stringify(e.value);ae(t),this.storage.setItem(e.name,t)},r._replaceNamedStateInStorage=function(e){this._addNewNamedStateToStorage(e)},r._getState=function(e){var t=[];ae("Local Storage: Loading with key "+e);var a=this.storage.getItem(e);return ae(a),null!==a&&(t=JSON.parse(a)),{name:e,value:t}},r._saveState=function(e,t){this._addNewNamedStateToStorage({name:e,value:t})},r._addItemToState=function(e,t,a){if(void 0===a&&(a=!1),a){var s=this._getState(e);ae("adding item to state "+e),ae(t),s.value.push(t),this._replaceNamedStateInStorage(s)}},r._removeItemFromState=function(e,t,a,s){var r=this._getState(e),i=r.value.findIndex((function(e){return a(e,t)}));i>=0&&(ae("removing item from state "+e),ae(t),r.value.splice(i,1)),this._replaceNamedStateInStorage(r)},r._updateItemInState=function(e,t,a,s){var r=this._getState(e),i=r.value.findIndex((function(e){return a(e,t)}));i>=0&&(r.value.splice(i,1,t),ae("updating item in state "+e),ae(t)),this._replaceNamedStateInStorage(r)},r.forceResetForGet=function(e){},r.getConfiguredStateNames=function(){return this.configuration},r.hasCompletedRun=function(e){return!1},r.initialise=function(e){this.configuration=e},s}(m);!function(e){e[e.LoggedOut=0]="LoggedOut",e[e.LoggedIn=1]="LoggedIn"}(te||(te={}));var re=d()("chat-manager"),ie=function(){function e(){this.blockedList=[],this.favouriteList=[],this.loggedInUsers=[],this.currentUsername="",this.unreadListener=null,re("Setting up chat logs, blocked list, and favourites"),this.chatLogs=[],this.chatListeners=[],this.chatUserListeners=[],this.localStorage=new se(!0),T.addChatReceiver(this),this.receiveLogin=this.receiveLogin.bind(this),this.receiveLogout=this.receiveLogout.bind(this),this.receiveInvitation=this.receiveInvitation.bind(this),this.receiveMessage=this.receiveMessage.bind(this),this.receiveQueuedMessages=this.receiveQueuedMessages.bind(this),this.receiveQueuedInvites=this.receiveQueuedInvites.bind(this),this.receiveJoinedRoom=this.receiveJoinedRoom.bind(this),this.receivedLeftRoom=this.receivedLeftRoom.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.addChatEventHandler=function(e){this.chatListeners.push(e)},t.addChatUserEventHandler=function(e){this.chatUserListeners.push(e)},t.isUserLoggedIn=function(e){return this.loggedInUsers.findIndex((function(t){return t===e}))>=0},t.receiveUserList=function(e){this.loggedInUsers=e,this.chatUserListeners.forEach((function(t){return t.handleLoggedInUsersUpdated(e)}))},t.addUserToBlockedList=function(e){var t=this;this.blockedList.findIndex((function(t){return t===e}))<0&&(this.blockedList.push(e),this.saveBlockedList(),this.chatUserListeners.forEach((function(e){return e.handleBlockedUsersChanged(t.favouriteList)})))},t.removeUserFromBlockedList=function(e){var t=this,a=this.blockedList.findIndex((function(t){return t===e}));a>=0&&(this.blockedList.splice(a,1),this.saveBlockedList(),this.chatUserListeners.forEach((function(e){return e.handleBlockedUsersChanged(t.favouriteList)})))},t.isUserInBlockedList=function(e){return this.blockedList.findIndex((function(t){return t===e}))>=0},t.addUserToFavouriteList=function(e){var t=this;this.favouriteList.findIndex((function(t){return t===e}))<0&&(this.favouriteList.push(e),this.saveFavouriteList(),this.chatUserListeners.forEach((function(e){return e.handleFavouriteUsersChanged(t.favouriteList)})))},t.removeUserFromFavouriteList=function(e){var t=this,a=this.favouriteList.findIndex((function(t){return t===e}));a>=0&&(this.favouriteList.splice(a,1),this.saveFavouriteList(),this.chatUserListeners.forEach((function(e){return e.handleFavouriteUsersChanged(t.favouriteList)})))},t.isUserInFavouriteList=function(e){return this.favouriteList.findIndex((function(t){return t===e}))>=0},t.getFavouriteUserList=function(){return[].concat(this.favouriteList)},t.getBlockedUserList=function(){return[].concat(this.blockedList)},t.setCurrentUser=function(t){re("Setting current user "+t),this.currentUsername=t;var a=this.localStorage.getStateByName(e.chatLogKey+this.currentUsername);re(a),a&&(this.chatLogs=a);var s=this.localStorage.getStateByName(e.blockedListKey+this.currentUsername);re(s),s&&(this.blockedList=s);var r=this.localStorage.getStateByName(e.favouriteListKey+this.currentUsername);re(r),r&&(this.favouriteList=r),this.chatListeners.forEach((function(e){return e.handleChatLogsUpdated()}))},t.getCurrentUser=function(){return this.currentUsername},t.receiveJoinedRoom=function(e){if(e.type===k.ChatRoom){var t=this.ensureChatLogExists(e.room);re("User list for room "+e.room+" - "+e.userList.join(",")),t.users=e.userList;var a=parseInt(X()().format("YYYYMMDDHHmmss")),s=X()().format("DD/MM/YYYY HH:mm"),r={from:"",created:a,room:e.room,priority:0,type:k.ChatRoom,message:e.username+" joined the chat on "+s};t.messages.push(r),this.saveLogs(),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(t,!1)}))}},t.receivedLeftRoom=function(e){if(e.type===k.ChatRoom&&e.username!==this.currentUsername){var t=this.ensureChatLogExists(e.room);re("User list for room "+e.room+" - "+e.userList.join(",")),t.users=e.userList;var a=parseInt(X()().format("YYYYMMDDHHmmss")),s=X()().format("DD/MM/YYYY HH:mm"),r={from:"",created:a,room:e.room,priority:0,type:k.ChatRoom,message:e.username+" left the chat on "+s};t.messages.push(r),this.saveLogs(),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(t,!1)}))}},t.receiveInvitation=function(e){if(e.type===k.ChatRoom)if(this.isUserInBlockedList(e.from))re("User "+e.from+" blocked");else{re("Invited to chat "+e.room);var t=this.doesChatRoomExist(e.room);re(e),re("Letting the listeners know, if they are all happy to accept then we will join the room");var a=!0;if(t||this.chatListeners.forEach((function(t){t.handleNewInviteReceived(e)||(a=!1)})),a){var s=this.ensureChatLogExists(e.room);s.type=e.type,e.userList&&e.userList.forEach((function(t){s.users.findIndex((function(e){return e===t}))<0&&s.users.push(e.from)})),s.users.findIndex((function(t){return t===e.from}))<0&&s.users.push(e.from),this.saveLogs(),re("Joining chat "+e.room),T.joinChat(this.getCurrentUser(),e.room,k.ChatRoom),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(s,!1)}))}}},t.receiveLogin=function(e){var t=this;re("Handle login received for "+e),this.loggedInUsers.findIndex((function(t){return t===e}))<0&&this.loggedInUsers.push(e),re(this.loggedInUsers),this.chatUserListeners.forEach((function(e){return e.handleLoggedInUsersUpdated(t.loggedInUsers)})),!this.isUserInBlockedList(e)&&this.isUserInFavouriteList(e)&&(re("User "+e+" logging in"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedIn(e)})))},t.receiveLogout=function(e){var t=this,a=this.loggedInUsers.findIndex((function(t){return t===e}));a>=0&&this.loggedInUsers.splice(a,1),this.chatUserListeners.forEach((function(e){return e.handleLoggedInUsersUpdated(t.loggedInUsers)})),!this.isUserInBlockedList(e)&&this.isUserInFavouriteList(e)&&(re("User "+e+" logging out"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedOut(e)})))},t.receiveDecline=function(e,t,a){a===k.ChatRoom&&t!==this.currentUsername&&(this.isUserInBlockedList(t)||(re("User "+t+" declined invitation to room"),this.chatListeners.forEach((function(a){return a.handleInvitationDeclined(e,t)}))))},t.setUnreadCountListener=function(e){this.unreadListener=e},t.touchChatLog=function(e){var t=this.ensureChatLogExists(e);t.numOfNewMessages=0,t.lastViewed=parseInt(X()().format("YYYYMMDDHHmmss")),this.emitUnreadMessageCountChanged(),this.saveLogs()},t.getChatLog=function(e){var t=null,a=this.chatLogs.findIndex((function(t){return t.roomName===e}));return a>=0&&(t=this.chatLogs[a]),t},t.receiveMessage=function(e,t){if(void 0===t&&(t=!1),e.type===k.ChatRoom&&e.from!==this.getCurrentUser())if(this.isUserInBlockedList(e.from))re("Message received from user "+e.from+" - is in blocked list, not passed on.");else{var a=this.ensureChatLogExists(e.room);this.addSenderToRoomIfNotAlreadyPresent(a,e.from),this.addMessageToChatLog(a,e),re("Message received"),re(e),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(a,t)}))}},t.receiveQueuedInvites=function(e){var t=this;e.forEach((function(e){t.receiveInvitation(e)}))},t.receiveQueuedMessages=function(e){var t=this;e.forEach((function(e){t.receiveMessage(e,!0)})),this.chatListeners.forEach((function(t){return t.handleOfflineMessagesReceived(e)}))},t.joinChat=function(e){0!==this.getCurrentUser().trim().length&&(this.ensureChatLogExists(e),T.joinChat(this.getCurrentUser(),e,k.ChatRoom))},t.leaveChat=function(e){0!==this.getCurrentUser().trim().length&&(this.removeChatLog(e),T.leaveChat(this.getCurrentUser(),e,k.ChatRoom))},t.login=function(){var e=this;0!==this.getCurrentUser().trim().length&&(T.login(this.getCurrentUser()),T.getUserList(),this.chatLogs.forEach((function(t){t.type===k.ChatRoom&&T.joinChat(e.currentUsername,t.roomName,k.ChatRoom)})))},t.logout=function(){0!==this.getCurrentUser().trim().length&&T.logout(this.getCurrentUser())},t.declineInvite=function(e){0!==this.getCurrentUser().trim().length&&T.sendDeclineInvite(e,this.getCurrentUser(),k.ChatRoom)},t.sendInvite=function(e,t,a,s,r){(void 0===a&&(a=k.ChatRoom),void 0===s&&(s=!1),void 0===r&&(r=""),0!==this.getCurrentUser().trim().length)&&(this.isUserInBlockedList(e)||this.ensureChatLogExists(t).users.findIndex((function(t){return t===e}))<0&&T.sendInvite(this.getCurrentUser(),e,t,a,s,r))},t.sendMessage=function(e,t,a,s){if(void 0===a&&(a=N.Normal),0===this.getCurrentUser().trim().length)return null;var r=this.ensureChatLogExists(e),i=parseInt(X()().format("YYYYMMDDHHmmss"));T.sendMessage(this.getCurrentUser(),e,t,i,k.ChatRoom,N.Normal,{}),s||(s={});var n={from:this.getCurrentUser(),room:e,message:t,created:i,priority:a,type:k.ChatRoom,attachment:s};return this.addMessageToChatLog(r,n),n},t.getChatLogs=function(){return[].concat(this.chatLogs)},t.startChatWithUser=function(e){var t=null;if(e){re("Starting chat with "+e);var a=this.ensureChatLogExistsWithUser(e);this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(a,!1)})),T.sendInvite(this.getCurrentUser(),e,a.roomName,k.ChatRoom,!1,""),T.joinChat(this.getCurrentUser(),a.roomName,k.ChatRoom),t=a.roomName}return t},t.saveLogs=function(){this.localStorage.setStateByName(e.chatLogKey+this.currentUsername,this.chatLogs,!1)},t.saveBlockedList=function(){this.localStorage.setStateByName(e.blockedListKey+this.currentUsername,this.blockedList,!1)},t.saveFavouriteList=function(){this.localStorage.setStateByName(e.favouriteListKey+this.currentUsername,this.favouriteList,!1)},t.ensureChatLogExists=function(e){var t,a=this.chatLogs.findIndex((function(t){return t.roomName===e}));return a<0?(t={roomName:e,users:[this.getCurrentUser()],messages:[],lastViewed:parseInt(X()().format("YYYYMMDDHHmmss")),numOfNewMessages:0,type:k.ChatRoom},this.chatLogs.push(t),this.saveLogs()):t=this.chatLogs[a],t},t.ensureChatLogExistsWithUser=function(e){for(var t=null,a=0;a<this.chatLogs.length;){var s=this.chatLogs[a];2===s.users.length&&s.users.findIndex((function(t){return t===e}))>=0&&(t=s,a=this.chatLogs.length),a++}return t||(t={roomName:L.getUniqueId(),users:[this.getCurrentUser(),e],messages:[],lastViewed:parseInt(X()().format("YYYYMMDDHHmmss")),numOfNewMessages:0,type:k.ChatRoom},this.chatLogs.push(t),this.saveLogs()),t},t.doesChatRoomExist=function(e){return this.chatLogs.findIndex((function(t){return t.roomName===e}))>=0},t.emitUnreadMessageCountChanged=function(){var e,t=0;this.chatLogs.forEach((function(e){t+=e.numOfNewMessages})),null==(e=this.unreadListener)||e.countChanged(t)},t.addMessageToChatLog=function(e,t){e.numOfNewMessages++,e.messages.push(t),this.emitUnreadMessageCountChanged(),t.from===this.getCurrentUser()?this.touchChatLog(e.roomName):this.saveLogs()},t.addSenderToRoomIfNotAlreadyPresent=function(e,t){e.users.findIndex((function(e){return e===t}))<0&&e.users.push(t)},t.removeChatLog=function(e){var t=this.chatLogs.findIndex((function(t){return t.roomName===e}));if(t>=0){re("Removing Chat log for room "+e);var a=this.chatLogs.splice(t,1);re(a.length),this.saveLogs()}},e}();ie.chatLogKey="im-board-chat-logs",ie.blockedListKey="im-board-blocked-list",ie.favouriteListKey="im-board-favourite-list";var ne,oe=d()("notification-controller"),ce=function(){function e(){this.doNotDisturb=!1,this.chatManager=ie.getInstance(),this.doNotDisturb=!1,this.chatListeners=[],this.chatUserListeners=[],this.handleChatLogUpdated=this.handleChatLogUpdated.bind(this),this.handleLoggedInUsersUpdated=this.handleLoggedInUsersUpdated.bind(this),this.handleFavouriteUserLoggedIn=this.handleFavouriteUserLoggedIn.bind(this),this.handleFavouriteUserLoggedOut=this.handleFavouriteUserLoggedOut.bind(this),this.chatManager.addChatEventHandler(this),this.chatManager.addChatUserEventHandler(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.handleInvitationDeclined=function(e,t){this.doNotDisturb||K.show("Room","User "+t+" has declined the invitation to join you.","info",7e3)},t.handleNewInviteReceived=function(e){return e.type===k.ScoreSheet||this.doNotDisturb&&!e.requiresAcceptDecline||e.requiresAcceptDecline||K.show("Chat Room","User "+e.from+" has invited you.","info",7e3),!0},t.addListener=function(e){this.chatListeners.push(e)},t.addUserListener=function(e){this.chatUserListeners.push(e)},t.setDoNotDisturb=function(e){void 0===e&&(e=!0),this.doNotDisturb=e},t.blackListUser=function(e,t){void 0===t&&(t=!0),t?this.chatManager.addUserToBlockedList(e):this.chatManager.removeUserFromBlockedList(e)},t.favouriteUser=function(e,t){void 0===t&&(t=!0),t?this.chatManager.addUserToFavouriteList(e):this.chatManager.removeUserFromFavouriteList(e)},t.isFavouriteUser=function(e){return this.chatManager.isUserInFavouriteList(e)},t.isBlockedUser=function(e){return this.chatManager.isUserInBlockedList(e)},t.handleChatLogsUpdated=function(){this.chatListeners.forEach((function(e){return e.handleChatLogsUpdated()}))},t.handleChatLogUpdated=function(e,t){if(void 0===t&&(t=!1),oe("Handle chat log updated"),oe(e),this.chatListeners.forEach((function(a){return a.handleChatLogUpdated(e,t)})),!this.doNotDisturb&&!t&&e.messages.length>0){var a=e.messages[e.messages.length-1];K.show(a.from,a.message,"message",3e3)}},t.handleLoggedInUsersUpdated=function(e){oe("Handle logged in users updated"),oe(e),this.chatUserListeners.forEach((function(t){return t.handleLoggedInUsersUpdated(e)}))},t.handleFavouriteUserLoggedIn=function(e){oe("Handle favourite user "+e+" logged in"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedIn(e)})),this.doNotDisturb||K.show(e,"User "+e+" has logged in.","warning",5e3)},t.handleFavouriteUserLoggedOut=function(e){oe("Handle favourite user "+e+" logged out"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedOut(e)})),this.doNotDisturb||K.show(e,"User "+e+" has logged out.","priority",4e3)},t.handleBlockedUsersChanged=function(e){oe("Handle blocked users changed to "+e),this.chatUserListeners.forEach((function(t){return t.handleBlockedUsersChanged(e)}))},t.handleFavouriteUsersChanged=function(e){oe("Handle favourite users changed to "+e),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUsersChanged(e)}))},t.startChatWithUser=function(e){return ie.getInstance().startChatWithUser(e)},t.handleChatStarted=function(e){this.chatListeners.forEach((function(t){return t.handleChatStarted(e)}))},t.handleOfflineMessagesReceived=function(e){this.doNotDisturb||0!==e.length&&K.show("Offline messages received","You have received "+e.length+" messages since you last logged out.")},e}(),de=d()("state-manager-graphql"),he=function(){function e(){this.configuration=[],this.delegate=new l("graphql"),this.emitEvents(),this.bHasCompletedRun=[],this.callbackForAddItem=this.callbackForAddItem.bind(this),this.callbackForRemoveItem=this.callbackForRemoveItem.bind(this),this.callbackForUpdateItem=this.callbackForUpdateItem.bind(this),this.callbackForGetItems=this.callbackForGetItems.bind(this)}var t=e.prototype;return t.getConfiguredStateNames=function(){var e=[];return this.configuration.forEach((function(t){e.push(t.stateName)})),e},t.hasCompletedRun=function(e){var t=!1,a=this.configuration.findIndex((function(t){return t.stateName===e}));return a>=0&&(t=this.bHasCompletedRun[a]),t},t.setCompletedRun=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!0)},t.forceResetForGet=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!1)},t.initialise=function(e){this.configuration=e;var t=[];this.configuration.forEach((function(e){t.push(!1)})),this.bHasCompletedRun=t},t._addNewNamedStateToStorage=function(e){},t._getState=function(e){if(de("Getting All "+e),this.hasCompletedRun(e))de("Getting All "+e+" - not done - previously retrieved");else{var t=this.getConfigurationForStateName(e);if(t.isActive){var a=t.apis.findAll,s={url:t.apiURL,type:f.POST,params:{query:a},callback:this.callbackForGetItems,associatedStateName:e};de("Getting All "+e+' with query "'+a+'"'),D.addApiRequest(s,!0)}else de("No configuration for state "+e)}return{name:e,value:[]}},t._ensureStatePresent=function(e){},t._replaceNamedStateInStorage=function(e){},t._saveState=function(e,t){},t._addItemToState=function(e,t,a){if(void 0===a&&(a=!1),!a){de("Adding item to "+e),de(t);var s=this.getConfigurationForStateName(e);if(s.isActive){var r={};r[s.apis.create]={};var i={url:s.apiURL,type:f.POST,params:{mutation:r},callback:this.callbackForAddItem,associatedStateName:e};D.addApiRequest(i,!0)}else de("No configuration for state "+e)}},t._removeItemFromState=function(e,t,a,s){if(!s){de("Removing item to "+e),de(t);var r=this.getConfigurationForStateName(e);if(r.isActive){var i={};i[r.apis.destroy]={};var n={url:r.apiURL,type:f.POST,params:{mutation:i},callback:this.callbackForRemoveItem,associatedStateName:e};D.addApiRequest(n,!0)}else de("No configuration for state "+e)}},t._updateItemInState=function(e,t,a,s){if(!s){de("Updating item in "+e),de(t);var r=this.getConfigurationForStateName(e);if(r.isActive){var i={};i[r.apis.destroy]={};var n={url:r.apiURL,type:f.POST,params:{mutation:i},callback:this.callbackForUpdateItem,associatedStateName:e};D.addApiRequest(n,!0)}else de("No configuration for state "+e)}},t.addChangeListenerForName=function(e,t){this.delegate.addChangeListenerForName(e,t)},t.addNewItemToState=function(e,t,a){this._addItemToState(e,t,a)},t.emitEvents=function(){this.delegate.emitEvents()},t.findItemInState=function(e,t,a){throw Error("not implemented")},t.getStateByName=function(e){this._getState(e)},t.informChangeListenersForStateWithName=function(e,t,a,s){this.delegate.informChangeListenersForStateWithName(e,t,a,s)},t.isItemInState=function(e,t,a){return!0},t.removeItemFromState=function(e,t,a,s){return this._removeItemFromState(e,t,a,s),!0},t.setStateByName=function(e,t,a){},t.suppressEvents=function(){this.delegate.suppressEvents()},t.updateItemInState=function(e,t,a,s){return this._updateItemInState(e,t,a,s),!0},t.getConfigurationForStateName=function(e){var t={stateName:e,apiURL:"/graphql",apis:{findAll:"",create:"",destroy:"",update:"",find:""},data:{findAll:"",create:"",destroy:"",update:"",find:""},isActive:!1},a=this.configuration.findIndex((function(t){return t.stateName===e}));return a>=0&&(t=this.configuration[a]),t},t.callbackForRemoveItem=function(e,t,a){de("callback for remove item for state "+a+" with status "+t+" - not forwarded"),t>=200&&t<=299&&de(e)},t.callbackForUpdateItem=function(e,t,a){de("callback for update item for state "+a+" with status "+t+" - not forwarded"),t>=200&&t<=299&&de(e)},t.callbackForGetItems=function(e,t,a){if(de("callback for get items for state "+a+" with status "+t+" - FORWARDING"),t>=200&&t<=299){de(e);var r=this.getConfigurationForStateName(a).data.findAll;this.setCompletedRun(a),this.delegate.informChangeListenersForStateWithName(a,e.data[r],s.StateChanged,null)}},t.callbackForAddItem=function(e,t,a){de("callback for add item for state "+a+" with status "+t+" - FORWARDING"),t>=200&&t<=299&&(de(e),this.delegate.informChangeListenersForStateWithName(a,e,s.ItemAdded,null))},e}();!function(e){e[e.Incomplete=0]="Incomplete",e[e.Complete=1]="Complete",e[e.Persisted=2]="Persisted",e[e.PersistedLocally=3]="PersistedLocally"}(ne||(ne={}));var le=a(440),ue=new(function(){function e(){}var t=e.prototype;return t.scrollSmoothToId=function(e){var t=document.getElementById(e);null!==t&&t.scrollIntoView({block:"start",behavior:"smooth"})},t.scrollToBottomNow=function(e){e&&(e.scrollTop=e.scrollHeight-e.clientHeight+100)},t.scrollToBottomSmooth=function(e){e&&(e.scrollIntoView({behavior:"smooth"}),e.scrollTop=e.scrollHeight-e.clientHeight+100)},t.scrollSmoothTo=function(e){e.scrollIntoView({block:"start",behavior:"smooth"})},t.scrollTo=function(e){e.scrollIntoView({block:"start"})},t.removeAllChildren=function(e){if(e&&e.firstChild)for(;e.firstChild;){var t=e.lastChild;t&&e.removeChild(t)}},t.addRemoveClasses=function(e,t,a){void 0===a&&(a=!0),t.split(" ").forEach((function(t){t.trim().length>0&&(a?e.classList.add(t):e.classList.remove(t))}))},t.addAttributes=function(e,t){t&&t.forEach((function(t){e.setAttribute(t[0],t[1])}))},e}()),me=d()("template-manager"),ge=function(){function e(){}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getScoreSheetTemplate=function(e){return 270314===e.gameId?this.getOhanamiTemplate():333201===e.gameId?this.getSkullKingTemplate():this.getDefaultScoreSheetTemplate(e)},t.getScoreSheetStartingData=function(e){return 270314===e.gameId?this.getOhanamiStartingData():333201===e.gameId?this.getSkullKingStartingData():this.getDefaultScoreSheetStartingData(e)},t.getSaveData=function(e,t){return 270314===e.gameId?this.getOhanamiSaveData(t):333201===e.gameId?this.getSkullKingSaveData(t):this.getDefaultSaveData(t)},t.transformDataAfterUserChange=function(e,t){var a=!1;return 270314===e.gameId&&(a=!0,this.transformOhanamiData(t)),333201===e.gameId&&(a=!0,this.transformSkullKingData(t)),a},t.getOhanamiTemplate=function(){var e={colHeaders:!1,rowHeaders:!1,licenseKey:"non-commercial-and-evaluation",manualColumnResize:!1,manualRowResize:!1,selectionMode:"single",cells:function(e,t){if(0===t||1===t||8===e)return{readOnly:!0,className:"bg-readonly-heading"};if(t>1){if(1===e||2===e||4===e)return{className:"bg-ohanami-blue",forceNumeric:!0};if(3===e||5===e)return{className:"bg-ohanami-green",forceNumeric:!0};if(6===e)return{className:"bg-ohanami-grey",forceNumeric:!0};if(7===e)return{className:"bg-ohanami-pink",forceNumeric:!0}}}};return me(e),e},t.getSkullKingTemplate=function(){var e={colHeaders:!1,rowHeaders:!1,licenseKey:"non-commercial-and-evaluation",manualColumnResize:!1,manualRowResize:!1,selectionMode:"single",cells:function(e,t){return 0===t||1===t||21===e?{readOnly:!0,className:"bg-readonly-heading"}:t%2==0&&e%2==0?{className:"bg-readonly"}:void 0}};return me(e),e},t.getSkullKingStartingData=function(){return[["Round","","P 1","","P 2","","P 3","","P 4",""],["1","bid","","","","","","","",""],["","bonus","","","","","","","",""],["2","bid","","","","","","","",""],["","bonus","","","","","","","",""],["3","bid","","","","","","","",""],["","bonus","","","","","","","",""],["4","bid","","","","","","","",""],["","bonus","","","","","","","",""],["5","bid","","","","","","","",""],["","bonus","","","","","","","",""],["6","bid","","","","","","","",""],["","bonus","","","","","","","",""],["7","bid","","","","","","","",""],["","bonus","","","","","","","",""],["8","bid","","","","","","","",""],["","bonus","","","","","","","",""],["9","bid","","","","","","","",""],["","bonus","","","","","","","",""],["10","bid","","","","","","","",""],["","bonus","","","","","","","",""],["Total","","","","","","","","",""]]},t.getOhanamiStartingData=function(){return[["Round","Mult.","P 1","P 2","P 3","P 4"],["1","x3","0","0","0","0"],["2","x3","0","0","0","0"],["","x4","0","0","0","0"],["3","x3","0","0","0","0"],["","x4","0","0","0","0"],["","x7","0","0","0","0"],["","var","0","0","0","0"],["Total","","0","0","0","0"]]},t.getDefaultScoreSheetTemplate=function(e){return{colHeaders:!1,rowHeaders:!1,licenseKey:"non-commercial-and-evaluation",manualColumnResize:!1,manualRowResize:!1,selectionMode:"single",columnSummary:[{destinationRow:0,destinationColumn:0,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:1,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:2,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:3,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:4,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:5,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:6,reversedRowCoords:!0,type:"sum",forceNumeric:!0}]}},t.getDefaultScoreSheetStartingData=function(e){return[["P 1","P 2","P 3","P 4","P 5","P 6","P 7"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"]]},t.getDefaultSaveData=function(e){var t={id:e.room,jsonData:JSON.stringify(e),createdOn:X()().format("YYYYMMDDHHmmss"),players:[],scores:[]},a=e.data[0],s=e.data[e.data.length-1];return s.forEach((function(e,t){var a=parseInt(e);isNaN(a)?s[t]=0:s[t]=a})),t.players=a,t.scores=s,t},t.getOhanamiSaveData=function(e){for(var t={id:e.room,jsonData:JSON.stringify(e),createdOn:X()().format("YYYYMMDDHHmmss"),players:[],scores:[]},a=e.data[0],s=e.data[e.data.length-1],r=2;r<a.length;r++){t.players.push(a[r]);var i=parseInt(s[r]);isNaN(i)&&(i=0),t.scores.push(i)}return me("Save data for ohanami is"),me(t),t},t.getSkullKingSaveData=function(e){for(var t={id:e.room,jsonData:JSON.stringify(e),createdOn:X()().format("YYYYMMDDHHmmss"),players:[],scores:[]},a=e.data[0],s=e.data[e.data.length-1],r=3;r<a.length;r+=2){t.players.push(a[r]);var i=parseInt(s[r]);isNaN(i)&&(i=0),t.scores.push(i)}return me("Save data for skull king is"),me(t),t},t.calculateOhanamiPinkScore=function(e){var t=0;if(e>0)for(e>15&&(e=15);e>0;)t+=e,e--;return t},t.transformOhanamiData=function(e){for(var t=0;t<4;t++){var a=0,s=parseInt(e.data[1][t+2]);isNaN(s)||(a+=3*s),s=parseInt(e.data[2][t+2]),isNaN(s)||(a+=3*s),s=parseInt(e.data[4][t+2]),isNaN(s)||(a+=3*s),s=parseInt(e.data[3][t+2]),isNaN(s)||(a+=4*s),s=parseInt(e.data[5][t+2]),isNaN(s)||(a+=4*s),s=parseInt(e.data[6][t+2]),isNaN(s)||(a+=7*s),s=parseInt(e.data[7][t+2]),isNaN(s)||(a+=this.calculateOhanamiPinkScore(s)),e.data[8][t+2]=a}},t.transformSkullKingData=function(e){for(var t=2;t<10;t+=2){for(var a=0,s=1;s<=10;s++){var r=2*s-1,i=parseInt(e.data[r][t]),n=parseInt(e.data[r][t+1]),o=parseInt(e.data[r+1][t+1]);isNaN(i)||isNaN(n)||(0===i&&0===n&&(a+=10*s),i===n&&(a+=20*i),i>0&&i!==n&&(a-=10*Math.abs(i-n)),isNaN(o)||(a+=o))}e.data[21][t+1]=a}},e}(),fe=d()("score-sheet-view"),ve=function(){function e(){this.applicationView=null,this.thisEl=null,this.boardGameTitleEl=null,this.startStopTimer=null,this.timerEl=null,this.endOrLeaveEl=null,this.scoreSheetEl=null,this.table=null,this.controller=Ie.getInstance(),this.stateManager=Le.getStateManager(),this.eventUserSelected=this.eventUserSelected.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.setApplication=function(e){this.config=e.state,this.stateManager.addChangeListenerForName(this.config.stateNames.users,this)},t.onDocumentLoaded=function(e){this.applicationView=e,this.resetDisplay(),this.ssFastSearchUserNames=document.getElementById(this.config.ui.scoreSheet.dom.ssFastSearchUserNames),$("#"+this.config.ui.scoreSheet.dom.ssFastSearchUserNames).on("autocompleteselect",this.eventUserSelected),Ie.getInstance().getStateManager().addChangeListenerForName(this.applicationView.state.stateNames.scoreSheet,this),this.thisEl=document.getElementById(this.applicationView.state.ui.scoreSheet.dom.dropZone),this.boardGameTitleEl=document.getElementById(this.applicationView.state.ui.scoreSheet.dom.boardGame),this.startStopTimer=document.getElementById(this.applicationView.state.ui.scoreSheet.dom.startStopTimer),this.timerEl=document.getElementById(this.applicationView.state.ui.scoreSheet.dom.timer),this.endOrLeaveEl=document.getElementById(this.applicationView.state.ui.scoreSheet.dom.end),this.scoreSheetEl=document.getElementById(this.applicationView.state.ui.scoreSheet.dom.scoreSheet),this.handleStartStopTimer=this.handleStartStopTimer.bind(this),this.handleEndOrLeave=this.handleEndOrLeave.bind(this),this.handleUserDrop=this.handleUserDrop.bind(this),this.startStopTimer&&this.startStopTimer.addEventListener("click",this.handleStartStopTimer),this.endOrLeaveEl&&this.endOrLeaveEl.addEventListener("click",this.handleEndOrLeave),this.thisEl&&(this.thisEl.addEventListener("dragover",(function(e){e.preventDefault()})),this.thisEl.addEventListener("drop",this.handleUserDrop))},t.eventUserSelected=function(e,t){e.preventDefault(),e.stopPropagation(),fe("User "+t.item.label+" with id "+t.item.value+" selected"),e.target.innerText="",Ie.getInstance().isSheetOwner()?Ie.getInstance().inviteUser(t.item.label):alert("Only the score sheet creator can invite users.")},t.handleEndOrLeave=function(e){if(fe("leave or end"),this.controller.hasActiveScoreSheet()&&this.controller.isSheetOwner()){if(!confirm("Are you sure you want to close the score sheet"))return;this.controller.endScoreSheet(),this.resetDisplay()}else{if(!confirm("Are you sure you want to leave the score sheet"))return;this.controller.leave(),this.resetDisplay()}},t.handleStartStopTimer=function(e){fe("start/pause timer"),this.controller.isTimerGoing()?this.controller.pauseTimer():this.controller.startTimer()},t.handleUserDrop=function(e){if(fe("drop event on current score sheet"),this.controller.hasActiveScoreSheet()&&this.controller.isSheetOwner()){var t=e.dataTransfer.getData(this.applicationView.state.ui.draggable.draggableDataKeyId),a=JSON.parse(t);fe(a),a[this.applicationView.state.ui.draggable.draggedType]===this.applicationView.state.ui.draggable.draggedTypeUser&&this.controller.inviteUser(a.username)}},t.resetDisplay=function(){this.table=null,this.boardGameTitleEl&&(this.boardGameTitleEl.innerText=""),this.startStopTimer&&(this.startStopTimer.innerHTML="Start "+this.applicationView.state.ui.scoreSheet.dom.iconStart,this.startStopTimer.setAttribute("disabled","true"),ue.addRemoveClasses(this.startStopTimer,"btn-warning",!1),ue.addRemoveClasses(this.startStopTimer,"btn-success",!0)),this.timerEl&&(this.timerEl.innerText=this.createTimerDisplay(0)),this.endOrLeaveEl&&(this.endOrLeaveEl.innerHTML=this.applicationView.state.ui.scoreSheet.dom.iconLeave),this.scoreSheetEl&&ue.removeAllChildren(this.scoreSheetEl)},t.updateTimer=function(e,t){void 0===t&&(t=!1),fe("Updating timer "+e+" "+t),this.startStopTimer&&(t?(this.startStopTimer.innerHTML="Start   "+this.applicationView.state.ui.scoreSheet.dom.iconStart,ue.addRemoveClasses(this.startStopTimer,"btn-warning",!1),ue.addRemoveClasses(this.startStopTimer,"btn-success",!0)):(this.startStopTimer.innerHTML="Pause   "+this.applicationView.state.ui.scoreSheet.dom.iconInProgress,ue.addRemoveClasses(this.startStopTimer,"btn-warning",!0),ue.addRemoveClasses(this.startStopTimer,"btn-success",!1)),this.startStopTimer.removeAttribute("disabled")),this.timerEl&&(this.timerEl.innerText=this.createTimerDisplay(e))},t.stateChanged=function(e,t,a){if(t===this.config.stateNames.users){var s=$("#"+this.config.ui.scoreSheet.dom.ssFastSearchUserNames),r=Le.getLoggedInUsername(),i=[];a.forEach((function(e){var t={label:e.username,value:e.id};r!==e.username&&i.push(t)})),s.autocomplete({source:i}),s.autocomplete("option",{disabled:!1,minLength:1})}else{var n=a;if(fe("Processing new state"),fe(n),this.startStopTimer&&this.startStopTimer.removeAttribute("disabled"),this.boardGameTitleEl&&(this.boardGameTitleEl.innerText=""+n.boardGameName),this.table){var o=[];n.data.forEach((function(e,t){e.forEach((function(e,a){o.push([t,a,e])}))})),fe("Table data is "),fe(o),this.table.setDataAtCell(o,Ie.SOURCE_View)}else if(this.scoreSheetEl){var c=this.controller.getSelectedBoardGame();c&&(n.sheetLayoutOptions=ge.getInstance().getScoreSheetTemplate(c)),n.sheetLayoutOptions.data=n.data,this.table=new le.a(this.scoreSheetEl,n.sheetLayoutOptions),this.table.addHook("afterChange",this.controller.userChangedValue)}this.timerEl&&(this.timerEl.innerText=this.createTimerDisplay(n.timer))}},t.getTableData=function(){return this.table?this.table.getData():[]},t.stateChangedItemAdded=function(e,t,a){this.stateChanged(e,t,this.stateManager.getStateByName(t))},t.stateChangedItemRemoved=function(e,t,a){},t.stateChangedItemUpdated=function(e,t,a,s){},t.createTimerDisplay=function(e){var t="";if(0===e)t="00:00";else if(e>=60){var a=Math.floor(e/3600),s=Math.floor(e/60),r=e-3600*a-60*s;a>0&&(t+=a+":"),t+=s>0?s<10?"0"+s+":":s+":":"00:",t+=r>0?r<10?"0"+r:""+r:"00"}else t="00:",t+=e>0?e<10?"0"+e:""+e:"00";return t},e}(),pe=d()("call-manager"),Se=function(){function e(){this.peer=null,this.webrtcDiv=null,this.myVideoStream=null,this.myVideo=null,this.callUser=this.callUser.bind(this),this.currentUserList=[]}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.startPeerConnection=function(){Le.isLoggedIn()&&(this.peer=new Peer(Le.getLoggedInUsername(),{path:"/peerjs",host:"/",debug:2,secure:!0}),this.peer.on("open",(function(e){pe("My peer ID is: "+e)})))},t.initialise=function(e){this.startPeerConnection(),this.webrtcDiv=document.getElementById(e.state.ui.scoreSheet.dom.webrtc)},t.startScoreSheet=function(){var e=this;try{Le.isLoggedIn()&&navigator.mediaDevices.getUserMedia&&(pe("Starting scoresheet stream"),navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(t){pe("Scoresheet stream started - adding video element"),e.myVideoStream=t,e.addVideoStream(Le.getLoggedInUsername(),e.myVideoStream,!0)})))}catch(e){pe(e),pe("Non-secure context or no camera capability")}},t.reset=function(){var e=this;pe("Reset"),this.currentUserList&&this.currentUserList.length>0&&(pe("Removing previous users"),this.currentUserList.forEach((function(t){pe("Removing previous user ${user}"),e.removeUser(t)}))),this.webrtcDiv&&ue.removeAllChildren(this.webrtcDiv),this.currentUserList=[],this.peer&&(pe("Stopping video stream"),this.myVideoStream&&this.myVideoStream.getTracks().forEach((function(e){return e.stop()})),this.myVideo&&(this.myVideo.srcObject=null),this.myVideoStream=null)},t.addVideoStream=function(e,t,a){var s=this;if(void 0===a&&(a=!1),!(this.currentUserList.findIndex((function(t){return t===e}))>=0)){this.currentUserList.push(e);var r=document.createElement("div");r.setAttribute("id",e),ue.addRemoveClasses(r,"col-sm-12 col-md-4 col-lg-3");var i=document.createElement("div");ue.addRemoveClasses(i,"card");var n=document.createElement("div");ue.addRemoveClasses(n,"card-header"),n.innerHTML='<h5 class="card-title">'+e+"</h5>";var o=document.createElement("div");ue.addRemoveClasses(o,"card-body p-0 text-center");var c=document.createElement("video");if(ue.addRemoveClasses(c,"video "),i.appendChild(n),i.appendChild(o),o.appendChild(c),a){var d=document.createElement("div");ue.addRemoveClasses(d,"card-footer");var h=document.createElement("div");ue.addRemoveClasses(h,"d-flex w-100 justify-content-between mt-2");var l=document.createElement("button");l.setAttribute("type","button"),ue.addRemoveClasses(l,"btn btn-circle btn-warning"),l.innerHTML='<i class="fas fa-video-slash"></i>';var u=document.createElement("button");u.setAttribute("type","button"),ue.addRemoveClasses(u,"btn btn-circle btn-warning"),u.innerHTML='<i class="fa fa-microphone"></i>',h.appendChild(l),h.appendChild(u),d.appendChild(h),i.appendChild(d),l.addEventListener("click",(function(){c.paused?(c.play(),ue.addRemoveClasses(l,"btn-success",!1),ue.addRemoveClasses(l,"btn-warning",!0)):(c.pause(),ue.addRemoveClasses(l,"btn-success",!0),ue.addRemoveClasses(l,"btn-warning",!1))})),u.addEventListener("click",(function(){c.muted?(c.muted=!1,ue.addRemoveClasses(u,"btn-success",!1),ue.addRemoveClasses(u,"btn-warning",!0)):(c.muted=!0,ue.addRemoveClasses(u,"btn-success",!0),ue.addRemoveClasses(u,"btn-warning",!1))})),this.myVideo=c}r.appendChild(i),c.srcObject=t,c.addEventListener("loadedmetadata",(function(){c.play(),s.webrtcDiv&&s.webrtcDiv.append(r)}))}},t.callUser=function(e){var t=this;if(pe("Asked to call user "+e),e!==Le.getLoggedInUsername()){var a=0;if(!(this.currentUserList.findIndex((function(t){return t===e}))>=0))var s=setInterval((function(){if(pe("Calling user "+e),t.myVideoStream){var r=t.peer.call(e,t.myVideoStream);r?(r.on("stream",(function(a){pe("User "+e+" answered, showing stream"),t.addVideoStream(e,a,!1)})),clearInterval(s)):++a>3&&clearInterval(s)}}),5e3)}},t.removeUser=function(e){pe("Asked to remove user "+e);var t=this.currentUserList.findIndex((function(t){return t===e}));t>=0&&this.currentUserList.splice(t,1);var a=document.getElementById(e);if(a){pe("Asked to remove user "+e+" - removing video element");var s=a.querySelector(".video");s&&(s.srcObject=null),ue.removeAllChildren(a);var r=a.parentNode;r&&r.removeChild(a)}},t.prepareToAnswerCallFrom=function(e){var t=this;try{Le.isLoggedIn()&&(pe("Preparing to answer call from "+e),navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(a){t.myVideoStream=a,t.addVideoStream(Le.getLoggedInUsername(),t.myVideoStream,!0),pe("Awaiting call from "+e),t.peer.on("call",(function(a){pe("Answering call from "+e),a.answer(t.myVideoStream),a.on("stream",(function(a){alert("Answered"),pe("Have answered, showing stream"),t.addVideoStream(e,a,!1)}))}))})))}catch(e){pe(e),pe("Insecure context or no video capability")}},e}(),be=d()("score-sheet-controller"),Ie=function(){function e(){this.applicationView=null,this.currentScoreRoom=null,this.currentlySelectedBoardGame=null,this.currentScoreSheet=null,this.currentUsername="",this.isRoomCreator=!1,this.currentUsersInScoreSheet=[],this.intervalTimer=-1,this.stateManager=new S,T.addChatReceiver(this),this.receiveLogin=this.receiveLogin.bind(this),this.receiveLogout=this.receiveLogout.bind(this),this.receiveInvitation=this.receiveInvitation.bind(this),this.receiveMessage=this.receiveMessage.bind(this),this.receiveQueuedMessages=this.receiveQueuedMessages.bind(this),this.receiveQueuedInvites=this.receiveQueuedInvites.bind(this),this.receiveJoinedRoom=this.receiveJoinedRoom.bind(this),this.receivedLeftRoom=this.receivedLeftRoom.bind(this),this.userChangedValue=this.userChangedValue.bind(this),this.endScoreSheet=this.endScoreSheet.bind(this),this.pauseTimer=this.pauseTimer.bind(this),this.isSheetOwner=this.isSheetOwner.bind(this),this.inviteUser=this.inviteUser.bind(this),this.getCurrentRoom=this.getCurrentRoom.bind(this),this.getSelectedBoardGame=this.getSelectedBoardGame.bind(this),this.startTimer=this.startTimer.bind(this),this.stopTimerStoppedByAnotherUser=this.stopTimerStoppedByAnotherUser.bind(this),this.isTimerGoing=this.isTimerGoing.bind(this),this.reset=this.reset.bind(this),this.reset()}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.isTimerGoing=function(){var e=!1;return this.currentScoreSheet&&(e=this.currentScoreSheet.timerGoing),e},t.getStateManager=function(){return this.stateManager},t.getCurrentRoom=function(){return this.currentScoreRoom},t.receiveLogin=function(e){},t.receiveLogout=function(e){},t.setCurrentUser=function(e){be("Setting current user "+e),this.currentUsername=e},t.getCurrentUser=function(){return this.currentUsername},t.initialise=function(e){this.applicationView=e,Se.getInstance().initialise(e)},t.receiveInvitation=function(e){if(this.isLoggedIn()&&e.type===k.ScoreSheet){if(!ie.getInstance().isUserInBlockedList(e.from))return this.currentScoreSheet&&(be("Received invite - already in score sheet - declining"),this.currentScoreSheet.room!==e.room)?(be("Received invite - already in score sheet - declining"),void T.sendDeclineInvite(e.room,this.getCurrentUser(),k.ScoreSheet)):void(!e.requiresAcceptDecline||confirm("You have been invited by user "+e.from+" to joint a chat room for the board game "+e.subject+" score sheet")?(Se.getInstance().prepareToAnswerCallFrom(e.from),K.show("Score Sheet","Joining score sheet","info",7e3),T.joinChat(this.getCurrentUser(),e.room,k.ScoreSheet),this.currentScoreRoom=e.room,this.currentlySelectedBoardGame=e.attachment.boardGame,this.currentScoreSheet=e.attachment.scoreSheet,Le.addBoardGameToDisplay(e.attachment.boardGame),this.isTimerGoing()&&(this.stopTimerStoppedByAnotherUser(),this.startTimer()),ve.getInstance().stateChanged("","",this.currentScoreSheet),this.applicationView.handleShowScoreSheet(null)):T.sendDeclineInvite(e.room,this.getCurrentUser(),k.ScoreSheet));be("Received invite from blocked user - ignoring")}},t.getSelectedBoardGame=function(){return this.currentlySelectedBoardGame},t.receiveQueuedMessages=function(e){var t=this;this.isLoggedIn()&&this.currentScoreRoom&&e.forEach((function(e){e.type===k.ScoreSheet&&t.currentScoreRoom===e.room&&t.receiveMessage(e)}))},t.receiveQueuedInvites=function(e){var t=this;this.isLoggedIn()&&e.forEach((function(e){e.type===k.ScoreSheet&&t.receiveInvitation(e)}))},t.receiveDecline=function(e,t,a){a===k.ScoreSheet&&(be("Receive decline for room "+e+" from "+t),this.currentScoreRoom&&this.currentScoreRoom===e&&K.show("Score Sheet","User "+t+" declined the invitation.","warning"))},t.receiveJoinedRoom=function(e){e.type===k.ScoreSheet&&(this.isLoggedIn()&&e.username!==this.getCurrentUser()&&this.currentScoreRoom===e.room&&(be("Handling user joined "+e.username),this.currentUsersInScoreSheet.findIndex((function(t){return t===e.username}))<0&&(this.currentUsersInScoreSheet.push(e.username),this.currentScoreSheet&&this.saveCurrentScoreSheet(this.currentScoreSheet)),this.isRoomCreator&&this.currentScoreSheet&&(be("Handling user joined "+e.username+" - sending"),this.addUserToScoreSheet(e.username),this.sendScoreSheetState(this.currentScoreSheet,!1)),K.show(this.currentlySelectedBoardGame.name,"User "+e.username+" joined the scoresheet.","message",12e4)))},t.receivedLeftRoom=function(e){if(e.type===k.ScoreSheet&&this.isLoggedIn()&&e.username!==this.getCurrentUser()&&this.currentScoreRoom===e.room){be("Handling user left "+e.username);var t=this.currentUsersInScoreSheet.findIndex((function(t){return t===e.username}));t>=0&&(this.currentUsersInScoreSheet.splice(t,1),this.removeUserFromScoreSheet(e.username),this.currentScoreSheet&&this.saveCurrentScoreSheet(this.currentScoreSheet)),this.isRoomCreator&&this.currentScoreSheet&&(be("Handling user left "+e.username+" - sending"),this.sendScoreSheetState(this.currentScoreSheet,!1)),K.show(this.currentlySelectedBoardGame.name,"User "+e.username+" left the scoresheet.","warning",1e5)}},t.receiveUserList=function(e){},t.endScoreSheet=function(){be("Handling end of score sheet"),this.isRoomCreator&&this.currentScoreSheet&&this.saveScoreSheetToBoardGame(this.currentScoreSheet),this.isLoggedIn()&&(this.currentScoreRoom&&this.currentScoreSheet&&(be("Handling end of score sheet - sending"),this.sendScoreSheetState(this.currentScoreSheet,!0)),this.leave()),this.reset(),this.applicationView.switchBetweenCollectionAndScoreSheet(!0)},t.startScoreSheet=function(e){e&&(be("Starting score sheet for "+e.name),this.currentlySelectedBoardGame=e,this.isLoggedIn()&&(this.currentUsersInScoreSheet=[this.getCurrentUser()]),this.isRoomCreator=!0,this.currentScoreRoom=L.getUniqueId(),this.currentScoreSheet={room:this.currentScoreRoom,boardGameName:e.name,sheetLayoutOptions:ge.getInstance().getScoreSheetTemplate(e),timer:0,timerGoing:!1,data:ge.getInstance().getScoreSheetStartingData(e),isFinished:!1},be(this.currentScoreSheet),Se.getInstance().startScoreSheet(),this.stateManager.setStateByName(this.applicationView.state.stateNames.scoreSheet,this.currentScoreSheet,!0),this.isLoggedIn()&&T.joinChat(this.getCurrentUser(),this.currentScoreRoom,k.ScoreSheet))},t.hasActiveScoreSheet=function(){var e=!1;return this.currentScoreRoom&&null!==this.currentScoreRoom&&(be(this.currentScoreRoom),e=!0),e},t.inviteUser=function(e){this.isLoggedIn()&&this.currentScoreRoom&&this.currentlySelectedBoardGame&&(be("Inviting user "+e+" to score sheet"),this.isRoomCreator?(K.show(this.currentlySelectedBoardGame.name,"You have invited user "+e+" to the scoresheet","message"),T.sendInvite(this.getCurrentUser(),e,this.currentScoreRoom,k.ScoreSheet,!0,this.currentlySelectedBoardGame.name,{scoreSheet:this.currentScoreSheet,boardGame:this.currentlySelectedBoardGame})):alert("Only the score sheet creator can invite other users."))},t.receiveMessage=function(e){if(be("'Handling receive message"),be(e),this.isLoggedIn()&&e.type===k.ScoreSheet&&e.from!==this.getCurrentUser()&&this.currentScoreRoom&&this.currentScoreRoom===e.room){if(ie.getInstance().isUserInBlockedList(e.from))return void be("Received message from blocked user - ignoring");if(be("Received message for score sheet "+e.room),be(e),e.attachment){var t=e.attachment;if(be(t),this.currentScoreSheet){var a=this.currentScoreSheet.timerGoing;this.currentScoreSheet.room=e.room,this.currentScoreSheet.boardGameName=t.boardGameName,this.currentScoreSheet.data=t.data,this.currentScoreSheet.timer=t.timer>this.currentScoreSheet.timer?t.timer:this.currentScoreSheet.timer,this.currentScoreSheet.timerGoing=t.timerGoing,this.currentScoreSheet.sheetLayoutOptions=t.sheetLayoutOptions,this.currentScoreSheet.isFinished=t.isFinished,t.timerGoing?a||(this.stopTimerStoppedByAnotherUser(),this.startTimer()):a&&this.stopTimerStoppedByAnotherUser()}be("Updated score sheet"),be(this.currentScoreSheet),this.currentScoreSheet&&this.saveCurrentScoreSheet(this.currentScoreSheet,!0),t.isFinished&&(alert("Score sheet has been finished - closing"),this.reset(),this.leave(),ve.getInstance().resetDisplay(),this.applicationView.switchBetweenCollectionAndScoreSheet(!0))}}},t.isSheetOwner=function(){return this.isRoomCreator},t.createScoreSheetFromTable=function(){var e=null,t=ve.getInstance().getTableData();return this.currentScoreSheet&&this.currentScoreRoom&&(e={room:this.currentScoreRoom,data:t,boardGameName:this.currentlySelectedBoardGame.name,timer:this.currentScoreSheet.timer,sheetLayoutOptions:this.currentlySelectedBoardGame?ge.getInstance().getScoreSheetTemplate(this.currentlySelectedBoardGame):null,timerGoing:this.currentScoreSheet.timerGoing,isFinished:!1}),e},t.sendScoreSheetState=function(e,t){if(void 0===t&&(t=!1),this.currentScoreRoom&&this.isLoggedIn()){var a=parseInt(X()().format("YYYYMMDDHHmmss"));T.sendMessage(this.getCurrentUser(),this.currentScoreRoom,"data",a,k.ScoreSheet,N.Normal,e)}},t.startTimer=function(){var e=this;be("Handling pause timer"),this.currentScoreSheet&&(this.currentScoreSheet.timerGoing=!0,this.intervalTimer=setInterval((function(){e.currentScoreSheet&&e.currentScoreSheet.timerGoing?(e.currentScoreSheet.timer++,ve.getInstance().updateTimer(e.currentScoreSheet.timer,!e.currentScoreSheet.timerGoing)):e.currentScoreSheet&&(e.currentScoreSheet.timerGoing=!1,ve.getInstance().updateTimer(e.currentScoreSheet.timer,!e.currentScoreSheet.timerGoing))}),1e3),this.currentScoreSheet&&this.saveCurrentScoreSheet(this.currentScoreSheet),this.isLoggedIn()&&this.currentScoreSheet&&(be("Handling pause timer - sending score sheet"),this.sendScoreSheetState(this.currentScoreSheet,!1)))},t.pauseTimer=function(){be("Handling pause timer"),this.intervalTimer>0&&(clearInterval(this.intervalTimer),this.intervalTimer=-1,this.currentScoreSheet&&(this.currentScoreSheet.timerGoing=!1,this.saveCurrentScoreSheet(this.currentScoreSheet),ve.getInstance().updateTimer(this.currentScoreSheet.timer,!this.currentScoreSheet.timerGoing)),this.isLoggedIn()&&this.currentScoreSheet&&(be("Handling pause timer - updating all users"),this.sendScoreSheetState(this.currentScoreSheet,!1)))},t.userChangedValue=function(t,a){if(be("Handling user changed value "+a),a!==e.SOURCE_View&&"edit"===a){var s=this.createScoreSheetFromTable();if(be("Handling user changed Value"),be(t),be(s),s){be("Letting the template manager change any values");var r=ge.getInstance().transformDataAfterUserChange(this.currentlySelectedBoardGame,s);r&&be(s),this.saveCurrentScoreSheet(s,r),this.isLoggedIn()&&(be("Handling user change - updating all users"),this.sendScoreSheetState(s,!1))}}},t.leave=function(){be("Handling user leaving"),this.currentScoreSheet&&this.currentScoreRoom&&(this.isLoggedIn()&&T.leaveChat(this.getCurrentUser(),this.currentScoreRoom,k.ScoreSheet),this.reset(),this.applicationView.switchBetweenCollectionAndScoreSheet(!0))},t.addUserToScoreSheet=function(e){Le.isLoggedIn()&&(be("Calling user "+e),Se.getInstance().callUser(e))},t.removeUserFromScoreSheet=function(e){be("Removing user "+e),Se.getInstance().removeUser(e)},t.reset=function(){this.currentScoreRoom=null,this.currentScoreSheet=null,this.currentlySelectedBoardGame=null,this.isRoomCreator=!1,this.currentUsersInScoreSheet=[],this.stopTimerStoppedByAnotherUser(),Se.getInstance().reset()},t.isLoggedIn=function(){return this.getCurrentUser().trim().length>0},t.saveScoreSheetToBoardGame=function(e){if(be("Handling save"),this.currentlySelectedBoardGame){var t=ge.getInstance().getSaveData(this.currentlySelectedBoardGame,e);be(t),this.currentlySelectedBoardGame.scoresheets||(this.currentlySelectedBoardGame.scoresheets=[]),this.currentlySelectedBoardGame.scoresheets.push(t),Le.scoreSheetAddedToBoardGame(this.currentlySelectedBoardGame,t)}},t.saveCurrentScoreSheet=function(e,t){void 0===t&&(t=!0),this.currentScoreSheet=e,this.stateManager.setStateByName(this.applicationView.state.stateNames.scoreSheet,this.currentScoreSheet,t)},t.stopTimerStoppedByAnotherUser=function(){be("Handling timer stopped by another user"),this.intervalTimer>0&&(clearInterval(this.intervalTimer),this.currentScoreSheet&&ve.getInstance().updateTimer(this.currentScoreSheet.timer,!0)),this.intervalTimer=-1},e}();Ie.SOURCE_View="ssv";var Ce=d()("controller-ts"),ye=d()("controller-ts-detail"),Le=new(function(){function e(){}var t=e.prototype;return t.connectToApplication=function(e,t){this.applicationView=e,this.clientSideStorage=t,this.config=this.applicationView.state;var a=F.getInstance();a.initialise([{stateName:this.config.stateNames.boardGames,serverURL:this.getServerAPIURL(),api:this.config.apis.entries,isActive:!0},{stateName:this.config.stateNames.scores,serverURL:this.getServerAPIURL(),api:this.config.apis.comments,isActive:!0}]);var s=new he;s.initialise([{stateName:this.config.stateNames.users,apiURL:this.getServerAPIURL()+this.config.apis.graphQL,apis:{find:"",create:"",destroy:"",update:"",findAll:this.config.apis.findUsers.queryString},data:{find:"",create:"",destroy:"",update:"",findAll:this.config.apis.findUsers.resultName},isActive:!0}]);var r=_.getInstance(),i=S.getInstance(),n=new x(r,a),o=new x(r,s);return r.addStateManager(i,[],!1),r.addStateManager(o,[this.config.stateNames.selectedEntry,this.config.stateNames.recentUserSearches,this.config.stateNames.boardGames,this.config.stateNames.scores],!1),r.addStateManager(n,[this.config.stateNames.users,this.config.stateNames.boardGames,this.config.stateNames.scores,this.config.stateNames.selectedEntry,this.config.stateNames.recentUserSearches],!1),this.stateManager=r,this.stateChanged=this.stateChanged.bind(this),this.stateChangedItemAdded=this.stateChangedItemAdded.bind(this),this.stateChangedItemRemoved=this.stateChangedItemRemoved.bind(this),this.stateChangedItemUpdated=this.stateChangedItemUpdated.bind(this),this.callbackBoardGameDetails=this.callbackBoardGameDetails.bind(this),this.callbackAddToCollection=this.callbackAddToCollection.bind(this),this.callbackRemoveFromCollection=this.callbackRemoveFromCollection.bind(this),this.callbackGetCollection=this.callbackGetCollection.bind(this),this.addBoardGameToCollection=this.addBoardGameToCollection.bind(this),this.removeBoardGameFromCollection=this.removeBoardGameFromCollection.bind(this),this.removeBoardGameFromDisplay=this.removeBoardGameFromDisplay.bind(this),this.displayedBoardGamesStateManager=new se(!0),this},t.initialise=function(){Ce("Initialising data state");var e=new W(this.config);if(T.setListener(e),Ce("Setting up chat system for user "+this.getLoggedInUserId()+": "+this.getLoggedInUsername()),this.getLoggedInUserId()>0){var t=ie.getInstance();ce.getInstance(),t.setCurrentUser(this.getLoggedInUsername()),Ie.getInstance().setCurrentUser(this.getLoggedInUsername()),t.setUnreadCountListener(this.applicationView),t.login(),this.getStateManager().getStateByName(this.config.stateNames.users)}var a=this.displayedBoardGamesStateManager.getStateByName(this.config.stateNames.boardGames);a=this.cleanupBoardGameState(a),this.applicationView.setState({boardGames:a}),this.downloadAndSyncSavedBoardGameCollection()},t.getStateManager=function(){return this.stateManager},t.isLoggedIn=function(){var e=!1;try{loggedInUserId&&(e=!0)}catch(e){}return e},t.getLoggedInUserId=function(){var e=-1;try{loggedInUserId&&(e=loggedInUserId)}catch(e){}return ye("Logged in user id is "+e),e},t.getLoggedInUsername=function(){var e="";try{loggedInUsername&&(e=loggedInUsername)}catch(e){}return ye("Logged in user is "+e),e},t.handleMessage=function(e){Ce(e)},t.getCurrentUser=function(){return this.getLoggedInUserId()},t.stateChangedItemAdded=function(e,t,a){switch(Ce("State changed "+t+" from "+e+" - item Added"),Ce(a),e){case"aggregate":case"memory":switch(Ce("received state from "+e+" for state "+t+" - updating application view"),t){case this.config.stateNames.entries:}}},t.stateChangedItemRemoved=function(e,t,a){switch(Ce("State changed "+t+" from "+e+"  - item Removed"),Ce(a),e){case"aggregate":case"memory":switch(Ce("received state from "+e+" for state "+t+" - updating application view"),t){case this.config.stateNames.comments:}}},t.stateChangedItemUpdated=function(e,t,a,s){switch(Ce("State changed "+t+" from "+e+" - item updated"),Ce(a),e){case"aggregate":case"memory":switch(Ce("received state from "+e+" for state "+t+" - updating application view"),t){case this.config.stateNames.entries:}}},t.stateChanged=function(e,t,a){switch(Ce("State changed "+t+" from "+e+" "),Ce(a),e){case"aggregate":case"memory":switch(Ce("received state from "+e+" for state "+t+" - sending to application view"),t){case this.config.stateNames.entries:case this.config.stateNames.comments:case this.config.stateNames.users:}}},t.addBoardGameToDisplay=function(e){Ce("Handling addition of board game"),Ce(e);var t=this.applicationView.state.boardGames;t.findIndex((function(t){return t.gameId===e.gameId}))>=0?Ce("Board game in display already"):(e.decorator=ne.Incomplete,t.push(e),Ce("Adding received board game to application"),Ce(e),this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,t,!1),this.applicationView.setState({boardGames:t}),D.addQLApiRequest(this.config.apis.graphQL,this.config.apis.bggSearchCallById.queryString,{gameId:e.gameId},this.callbackBoardGameDetails,this.config.stateNames.boardGames,!1))},t.callbackBoardGameDetails=function(e,t,a){if(Ce("callback for bgg search for single board game "+a+" with status "+t),t>=200&&t<=299){Ce(e);var s=e.data[this.config.apis.bggSearchCallById.resultName];Ce(s);var r=/&#10;/g;s.description=s.description.replace(r,"\r\n"),r=/&ldquo;/g,s.description=s.description.replace(r,'"'),r=/&rdquo;/g,s.description=s.description.replace(r,'"'),r=/&quot;/g,s.description=s.description.replace(r,'"'),r=/&mdash;/g,s.description=s.description.replace(r,'"');var i=this.applicationView.state.boardGames,n=i.findIndex((function(e){return e.gameId===s.gameId}));n>=0?(Ce("Updating application state"),i.splice(n,1,s),Ce(i),s.decorator=ne.PersistedLocally,this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,i,!1),this.applicationView.setState({boardGames:i})):Ce("Board game "+s.id+" not found in current state")}},t.callbackAddToCollection=function(e,t,a){var s=this;if(Ce("callback for add single board game "+a+" to my collection with status "+t),t>=200&&t<=299){Ce(e);var r=e.data[this.config.apis.addToMyCollection.resultName];Ce(r);var i=this.applicationView.state.boardGames,n=i.findIndex((function(e){return e.gameId===r.gameId}));if(n>=0){var o=i[n];if(Ce("Updating board game "+o.gameId+" with database id "+r.id+" and new Persisted state"),o.decorator=ne.Persisted,o.id=r.id,o.scoresheets){var c=function(e,t,a){};o.scoresheets.forEach((function(e){s.convertScoreSheetToApiCallFormat(e),D.addQLApiRequest(s.config.apis.graphQL,s.config.apis.addScoreSheetToBoardGame.queryString,{userId:s.getCurrentUser(),boardGameId:o.id,sheet:e},c,s.config.stateNames.scoreSheet,!1),s.convertScoreSheetToDatabaseFormat(e),e.decorator=ne.Persisted}))}this.applicationView.setState({boardGames:i}),this.displayedBoardGamesStateManager.updateItemInState(this.config.stateNames.boardGames,o,J,!1)}}},t.callbackRemoveFromCollection=function(e,t,a){if(Ce("callback for remove single board game "+a+" from my collection with status "+t),t>=200&&t<=299){Ce(e);var s=e.data[this.config.apis.removeFromMyCollection.resultName];Ce(s)}},t.callbackGetCollection=function(e,t,a){var s=this;if(Ce("callback for getting my collection of board games "+a+" to my collection with status "+t),t>=200&&t<=299){Ce(e);var r=e.data[this.config.apis.getMyBoardGameCollection.resultName],i=this.applicationView.state.boardGames;ye("Starting with local state of "+i.length),r.forEach((function(e){e.decorator=ne.Persisted,ye("Loading board game from collection "),ye(e),s.decorateScoreSheets(e);var t=i.findIndex((function(t){return t.gameId===e.gameId}));if(ye("have found the board game locally? "+(t>=0)),t>=0){var a=i[t];ye("in current state, replacing"),s.copyLocallySavedScoreSheetsToBoardGame(e,a),i.splice(t,1,e)}else ye("not in current state, adding"),i.push(e)})),i=this.cleanupBoardGameState(i),ye("Ending with local state of "+i.length),this.applicationView.setState({boardGames:i}),this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,i,!1)}},t.scoreSheetAddedToBoardGame=function(e,t){this.isLoggedIn()&&e.decorator&&e.decorator===ne.Persisted?(D.addQLApiRequest(this.config.apis.graphQL,this.config.apis.addScoreSheetToBoardGame.queryString,{userId:this.getCurrentUser(),boardGameId:e.id,sheet:t},(function(e,t,a){}),this.config.stateNames.scoreSheet,!1),t.decorator=ne.Persisted):t.decorator=ne.PersistedLocally,this.convertScoreSheetToDatabaseFormat(t);var a=this.applicationView.state.boardGames,s=a.findIndex((function(t){return t.gameId===e.gameId}));if(s>=0){var r=a[s];e.decorator=r.decorator,Ce("Updating application state"),a.splice(s,1,e),Ce(a),this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,a,!1),this.applicationView.setState({boardGames:a})}else Ce("Board game "+e.id+" not found in current state")},t.scoreSheetRemovedFromBoardGame=function(e,t){this.isLoggedIn()&&e.decorator&&e.decorator===ne.Persisted&&D.addQLApiRequest(this.config.apis.graphQL,this.config.apis.removeScoreSheet.queryString,{sheetId:t},(function(e,t,a){}),this.config.stateNames.scoreSheet,!1);var a=this.applicationView.state.boardGames,s=a.findIndex((function(t){return t.gameId===e.gameId}));if(s>=0){var r=a[s];e.decorator=r.decorator,Ce("Updating application state"),a.splice(s,1,e),Ce(a),this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,a,!1),this.applicationView.setState({boardGames:a})}else Ce("Board game "+e.id+" not found in current state")},t.addBoardGameToCollection=function(e){Ce("Handling Add Board Game to collection");var t=this.findBoardGameInStateFromEvent(e);if(t&&t.decorator)switch(t.decorator){case ne.Persisted:case ne.Incomplete:break;case ne.PersistedLocally:case ne.Complete:if(this.displayedBoardGamesStateManager.addNewItemToState(this.config.stateNames.boardGames,t,!0),delete t.decorator,delete t.id,this.isLoggedIn()){var a=t.scoresheets;delete t.scoresheets,D.addQLApiRequest(this.config.apis.graphQL,this.config.apis.addToMyCollection.queryString,{userId:this.getCurrentUser(),boardGame:t},this.callbackAddToCollection,this.config.stateNames.boardGames,!0),t.decorator=ne.Complete,t.scoresheets=a}else t.decorator=ne.PersistedLocally}},t.removeBoardGameFromCollection=function(e){if(Ce("Handling Remove Board Game from collection with id "+e.gameId),e&&e.decorator)switch(e.decorator){case ne.PersistedLocally:case ne.Persisted:this.removeBoardGameFromState(e),this.isLoggedIn()&&D.addQLApiRequest(this.config.apis.graphQL,this.config.apis.removeFromMyCollection.queryString,{userId:this.getCurrentUser(),boardGameId:e.gameId},this.callbackRemoveFromCollection,this.config.stateNames.boardGames,!1);break;case ne.Incomplete:case ne.Complete:}},t.removeBoardGameFromDisplay=function(e){if(Ce("Handling Remove Board Game from display "+e.gameId),e&&e.decorator)switch(e.decorator){case ne.Incomplete:break;case ne.Persisted:case ne.PersistedLocally:case ne.Complete:this.removeBoardGameFromState(e)}},t.cleanupBoardGameState=function(e){var t=[];return e.forEach((function(e){var a=t.findIndex((function(t){return t.gameId===e.gameId}));if(a>=0){var s=t[a];s.decorator&&s.decorator===ne.Persisted||e.decorator&&e.decorator===ne.Persisted&&t.splice(a,1,e)}else t.push(e)})),t},t.downloadAndSyncSavedBoardGameCollection=function(){this.isLoggedIn()&&D.addQLApiRequest(this.config.apis.graphQL,this.config.apis.getMyBoardGameCollection.queryString,{userId:this.getLoggedInUserId()},this.callbackGetCollection,this.config.stateNames.boardGames,!1)},t.getServerAPIURL=function(){var e="";return window.ENV&&window.ENV.serverURL&&(e=window.ENV.serverURL),e},t.removeBoardGameFromState=function(e){var t=this.applicationView.state.boardGames,a=t.findIndex((function(t){return t.gameId===e.gameId}));a>=0&&(t.splice(a,1),this.applicationView.setState({boardGames:t})),this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,t,!1)},t.findBoardGameInStateFromEvent=function(e){var t=null;ye("Finding board game id in event");var a=e.target.getAttribute(this.config.controller.events.boardGames.eventDataKeyId);if(ye(a),a){a=parseInt(a);var s=this.applicationView.state.boardGames,r=s.findIndex((function(e){return e.gameId===a}));ye(r),r>=0&&(t=s[r])}return ye(t),t},t.decorateScoreSheets=function(e){e&&(e.scoresheets?e.scoresheets.forEach((function(e){e.decorator=ne.Persisted})):e.scoresheets=[])},t.copyLocallySavedScoreSheetsToBoardGame=function(e,t){var a=this;if(t.scoresheets){var s=[];if(t.scoresheets.forEach((function(t){e.scoresheets.findIndex((function(e){return e.id===t.id}))<0&&(t.decorator=ne.PersistedLocally,e.scoresheets.push(t),s.push(t))})),s.length>0){var r=function(e,t,a){};s.forEach((function(t){a.convertScoreSheetToApiCallFormat(t),D.addQLApiRequest(a.config.apis.graphQL,a.config.apis.addScoreSheetToBoardGame.queryString,{userId:a.getCurrentUser(),boardGameId:e.id,sheet:t},r,a.config.stateNames.scoreSheet,!1),a.convertScoreSheetToDatabaseFormat(t),t.decorator=ne.Persisted}))}}},t.convertScoreSheetToDatabaseFormat=function(e){e.players&&(e.players.length>=1&&(e.player1=e.players[0],e.score1=e.scores[0]),e.players.length>=2&&(e.player2=e.players[1],e.score2=e.scores[1]),e.players.length>=3&&(e.player3=e.players[2],e.score3=e.scores[2]),e.players.length>=4&&(e.player4=e.players[3],e.score4=e.scores[3]),e.players.length>=5&&(e.player5=e.players[4],e.score5=e.scores[4]),e.players.length>=6&&(e.player6=e.players[5],e.score6=e.scores[5]),e.players.length>=7&&(e.player7=e.players[6],e.score7=e.scores[6]))},t.convertScoreSheetToApiCallFormat=function(e){delete e.decorator,delete e.player1,delete e.score1,delete e.player2,delete e.score2,delete e.player3,delete e.score3,delete e.player4,delete e.score4,delete e.player5,delete e.score5,delete e.player6,delete e.score6,delete e.player7,delete e.score7},e}()),we=d()("view-ts");function Ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ne(e,t){return(Ne=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ke=function(e){var t,a;function s(t,a,s,r,i){var n;return(n=e.call(this,t,a,s,r,i)||this).eventHide=n.eventHide.bind(Ue(n)),n.eventShow=n.eventShow.bind(Ue(n)),n}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,Ne(t,a);var r=s.prototype;return r.onDocumentLoaded=function(){this.eventHide(null);var e=this.document.getElementById(this.uiConfig.dom.sideBarId);if(null!==e){var t=e.querySelector(".close");t&&t.addEventListener("click",this.eventHide)}},r.eventHide=function(e){e&&e.preventDefault(),this.showHide("0%")},r.eventShow=function(e){var t=this.uiPrefs.view.expandedSize;window.innerWidth<769&&(t="50%"),window.innerWidth<415&&(t="100%"),this.showHide(t)},r.showHide=function(e){var t=this.document.getElementById(this.uiConfig.dom.sideBarId);if(null!==t)switch(this.uiPrefs.view.location){case"left":case"right":t.style.width=e;break;case"bottom":case"top":t.style.height=e}},s}(function(){function e(e,t,a,s,r){this.applicationView=e,this.document=document,this.uiConfig=a,this.uiPrefs=s,this.config=e.state,this.stateManager=r,this.stateChanged=this.stateChanged.bind(this),this.eventStartDrag=this.eventStartDrag.bind(this),this.eventClickItem=this.eventClickItem.bind(this),this.eventDeleteClickItem=this.eventDeleteClickItem.bind(this),this.eventAction2Clicked=this.eventAction2Clicked.bind(this),this.eventAction1Clicked=this.eventAction1Clicked.bind(this)}var t=e.prototype;return t.stateChanged=function(e,t,a){this.updateView(t,a)},t.stateChangedItemAdded=function(e,t,a){this.updateView(t,this.stateManager.getStateByName(t))},t.stateChangedItemRemoved=function(e,t,a){this.updateView(t,this.stateManager.getStateByName(t))},t.stateChangedItemUpdated=function(e,t,a,s){this.updateView(t,this.stateManager.getStateByName(t))},t.eventAction1Clicked=function(e){e.preventDefault(),e.stopPropagation()},t.eventAction2Clicked=function(e){e.preventDefault(),e.stopPropagation()},t.eventStartDrag=function(e){we("Abstract View : drag start",10);var t=JSON.stringify(this.getDragData(e));we(t,10),e.dataTransfer.setData(this.applicationView.state.ui.draggable.draggableDataKeyId,t)},t.createResultForItem=function(e,t,a){var s=this;void 0===a&&(a=null),we("Abstract View : creating Result"),we(t);var r=this.uiConfig.dom,i=this.getIdForStateItem(e,t),n=this.getLegacyIdForStateItem(e,t);a||(a=r.resultDataSourceValue);var o=this.document.createElement(r.resultsElementType);ue.addRemoveClasses(o,r.resultsClasses),ue.addAttributes(o,r.resultsElementAttributes);var c=o;if(r.resultContentDivClasses){var d=this.document.createElement("div");if(ue.addRemoveClasses(d,r.resultContentDivClasses),d.setAttribute(r.resultDataKeyId,i),d.setAttribute(r.resultLegacyDataKeyId,n),d.setAttribute(r.resultDataSourceId,a),c=this.document.createElement(r.resultContentTextElementType),ue.addRemoveClasses(c,r.resultContentTextClasses),c.setAttribute(r.resultDataKeyId,i),c.setAttribute(r.resultLegacyDataKeyId,n),c.setAttribute(r.resultDataSourceId,a),d.appendChild(c),r.hasBackgroundImage){var h=this.document.createElement(r.imgElementType);ue.addRemoveClasses(h,r.imgClasses),h.setAttribute("src",this.getBackgroundImage(e,t)),o.appendChild(h)}var l=this.document.createElement("div");if(d.appendChild(l),r.hasBadge){var u=this.getBadgeValue(e,t);if(u>0){var m=this.document.createElement(r.badgeElementType);ue.addRemoveClasses(m,r.badgeClasses),m.setAttribute(r.resultDataKeyId,i),m.setAttribute(r.resultLegacyDataKeyId,n),m.setAttribute(r.resultDataSourceId,a),l.appendChild(m),m.innerHTML="&nbsp;&nbsp;&nbsp;"+u+"&nbsp;&nbsp;&nbsp;",ue.addAttributes(m,r.badgeElementAttributes)}}if(r.extraAction1Classes){var g=this.document.createElement("button");if(g.setAttribute("type","button"),ue.addRemoveClasses(g,r.extraAction1Classes),r.extraAction1Text&&r.extraAction1Text.trim().length>0&&(g.innerHTML=r.extraAction1Text),r.extraAction1IconClasses){var f=document.createElement("i");ue.addRemoveClasses(f,r.extraAction1IconClasses),f.setAttribute(r.resultDataKeyId,i),f.setAttribute(r.resultLegacyDataKeyId,n),f.setAttribute(r.resultDataSourceId,a),g.appendChild(f)}g.setAttribute(r.resultDataKeyId,i),g.setAttribute(r.resultLegacyDataKeyId,n),g.setAttribute(r.resultDataSourceId,a),g.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),s.eventAction1Clicked(e)})),l.appendChild(g)}if(r.extraAction2Classes){var v=this.document.createElement("button");if(v.setAttribute("type","button"),ue.addRemoveClasses(v,r.extraAction2Classes),r.extraAction2Text&&r.extraAction2Text.trim().length>0&&(v.innerHTML=r.extraAction1Text),r.extraAction2IconClasses){var p=document.createElement("i");ue.addRemoveClasses(p,r.extraAction2IconClasses),p.setAttribute(r.resultDataKeyId,i),p.setAttribute(r.resultLegacyDataKeyId,n),p.setAttribute(r.resultDataSourceId,a),v.appendChild(p)}v.setAttribute(r.resultDataKeyId,i),v.setAttribute(r.resultLegacyDataKeyId,n),v.setAttribute(r.resultDataSourceId,a),v.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),s.eventAction2Clicked(e)})),l.appendChild(v)}if(r.isDeleteable){var S=this.document.createElement("button");if(S.setAttribute("type","button"),ue.addRemoveClasses(S,r.deleteButtonClasses),r.deleteButtonText&&r.deleteButtonText.trim().length>0&&(S.innerHTML=r.deleteButtonText),r.deleteButtonIconClasses){var b=document.createElement("i");ue.addRemoveClasses(b,r.deleteButtonIconClasses),b.setAttribute(r.resultDataKeyId,i),b.setAttribute(r.resultLegacyDataKeyId,n),b.setAttribute(r.resultDataSourceId,a),S.appendChild(b)}S.setAttribute(r.resultDataKeyId,i),S.setAttribute(r.resultLegacyDataKeyId,n),S.setAttribute(r.resultDataSourceId,a),S.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),s.eventDeleteClickItem(e)})),l.appendChild(S)}o.appendChild(d)}o.setAttribute(r.resultDataKeyId,i),o.setAttribute(r.resultLegacyDataKeyId,n),o.setAttribute(r.resultDataSourceId,a);var I=this.getDisplayValueForStateItem(e,t),C=this.getModifierForStateItem(e,t),y=this.getSecondaryModifierForStateItem(e,t);switch(C){case"normal":switch(we("Abstract View: normal item"),ue.addRemoveClasses(o,r.modifierClassNormal),""!==r.iconNormal?c.innerHTML=I+"  "+r.iconNormal:c.innerText=I,y){case"warning":ue.addRemoveClasses(o,r.modifierClassNormal,!1),ue.addRemoveClasses(o,r.modifierClassWarning,!0),""!==r.iconWarning&&(c.innerHTML+="  "+r.iconWarning);break;case"normal":break;case"active":""!==r.iconActive&&(c.innerHTML+="  "+r.iconActive)}break;case"active":switch(we("Abstract View: active item",10),ue.addRemoveClasses(o,r.modifierClassActive),""!==r.iconActive?c.innerHTML=I+"  "+r.iconActive:c.innerText=I,y){case"warning":ue.addRemoveClasses(o,r.modifierClassActive,!1),ue.addRemoveClasses(o,r.modifierClassWarning,!0),""!==r.iconWarning&&(c.innerHTML+="  "+r.iconWarning)}break;case"inactive":switch(we("Abstract View: inactive item",10),ue.addRemoveClasses(o,r.modifierClassInactive),""!==r.iconInactive?c.innerHTML=I+"  "+r.iconInactive:c.innerText=I,y){case"warning":""!==r.iconWarning&&(ue.addRemoveClasses(o,r.modifierClassInactive,!1),ue.addRemoveClasses(o,r.modifierClassWarning,!0),c.innerHTML+="  "+r.iconWarning);break;case"normal":break;case"active":""!==r.iconActive&&(c.innerHTML+="  "+r.iconActive)}}return o},t.createResultsForState=function(e,t){var a=this;we("Abstract View : creating Results",10),we(t);var s=this.uiConfig.dom,r=document.getElementById(s.resultsId);r&&ue.removeAllChildren(r),t.map((function(t,i){var n=a.createResultForItem(e,t);s.isDraggable&&(n.setAttribute("draggable","true"),n.addEventListener("dragstart",a.eventStartDrag)),s.isClickable&&n.addEventListener("click",a.eventClickItem),we("Abstract View: Adding child "+t.id),r&&r.appendChild(n)}))},e}());function Ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Re(e,t){return(Re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var De=d()("user-search-sidebar"),Be=d()("user-search-sidebar:detail"),Fe=function(e){var t,a;function s(t,a,s){var r;return(r=e.call(this,t,a,t.state.ui.userSearchSideBar,t.state.uiPrefs.userSearchSideBar,s)||this).config=t.state,r.loggedInUsers=[],r.updateView=r.updateView.bind(Ee(r)),r.eventClickItem=r.eventClickItem.bind(Ee(r)),r.eventUserSelected=r.eventUserSelected.bind(Ee(r)),r.handleLoggedInUsersUpdated=r.handleLoggedInUsersUpdated.bind(Ee(r)),r.handleFavouriteUserLoggedIn=r.handleFavouriteUserLoggedIn.bind(Ee(r)),r.handleFavouriteUserLoggedOut=r.handleFavouriteUserLoggedOut.bind(Ee(r)),r.handleFavouriteUsersChanged=r.handleFavouriteUsersChanged.bind(Ee(r)),r.handleBlockedUsersChanged=r.handleBlockedUsersChanged.bind(Ee(r)),r.handleLoggedInUsersUpdated=r.handleLoggedInUsersUpdated.bind(Ee(r)),r.handleFavouriteUserDrop=r.handleFavouriteUserDrop.bind(Ee(r)),r.handleBlockedUserDrop=r.handleBlockedUserDrop.bind(Ee(r)),s.addChangeListenerForName(r.config.stateNames.users,Ee(r)),r.localisedSM=new se(!0),r.localisedSM.addChangeListenerForName(r.config.stateNames.recentUserSearches,Ee(r)),ce.getInstance().addUserListener(Ee(r)),De(r.localisedSM.getStateByName(r.config.stateNames.recentUserSearches)),r}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,Re(t,a);var r=s.prototype;return r.handleFavouriteUserDrop=function(e){De("drop event on favourites");var t=e.dataTransfer.getData(this.config.ui.draggable.draggableDataKeyId),a=JSON.parse(t);if(De(a),a[this.config.ui.draggable.draggedType]===this.config.ui.draggable.draggedTypeUser)switch(a[this.config.ui.draggable.draggedFrom]){case this.config.ui.draggable.draggedFromUserSearch:if(ie.getInstance().isUserInFavouriteList(a.username))return void De(a.username+" already in favourite list, ignoring");ie.getInstance().addUserToFavouriteList(a.username)}},r.handleBlockedUserDrop=function(e){De("drop event on blocked users");var t=e.dataTransfer.getData(this.config.ui.draggable.draggableDataKeyId),a=JSON.parse(t);if(De(a),a[this.config.ui.draggable.draggedType]===this.config.ui.draggable.draggedTypeUser)switch(a[this.config.ui.draggable.draggedFrom]){case this.config.ui.draggable.draggedFromUserSearch:if(ie.getInstance().isUserInBlockedList(a.username))return void De(a.username+" already in blocked list, ignoring");ie.getInstance().addUserToBlockedList(a.username)}},r.handleLoggedInUsersUpdated=function(e){De("Received new list of users who are logged in "),De(e),this.loggedInUsers=e,this.reRenderView()},r.handleFavouriteUserLoggedIn=function(e){De("Handle Favourite User "+e+" logged in"),this.reRenderView()},r.handleFavouriteUserLoggedOut=function(e){De("Handle Favourite User "+e+" logged in"),this.reRenderView()},r.handleFavouriteUsersChanged=function(e){De("Handle Favourite Users changed to "+e),this.reRenderView()},r.handleBlockedUsersChanged=function(e){De("Handle Blocked Users changed to "+e),this.reRenderView()},r.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),$("#"+this.uiConfig.dom.extra.fastSearchInputId).on("autocompleteselect",this.eventUserSelected),this.favUsersDropZone=document.getElementById(this.uiConfig.dom.favouriteUsersDropZone),this.favUsersDropZone.addEventListener("dragover",(function(e){De("Dragged over"),e.preventDefault()})),this.favUsersDropZone.addEventListener("drop",this.handleFavouriteUserDrop),this.favUsersDiv=document.getElementById(this.uiConfig.dom.favouriteUsersId),this.blockedUsersDropZone=document.getElementById(this.uiConfig.dom.blockedUsersDropZone),this.blockedUsersDropZone.addEventListener("dragover",(function(e){De("Dragged over"),e.preventDefault()})),this.blockedUsersDropZone.addEventListener("drop",this.handleBlockedUserDrop),this.blockedUsersDiv=document.getElementById(this.uiConfig.dom.blockedUsersId),this.renderFavouriteUsers(),this.renderBlockedUsers()},r.getIdForStateItem=function(e,t){return t.id},r.getLegacyIdForStateItem=function(e,t){return t.id},r.getDisplayValueForStateItem=function(e,t){return t.username},r.getModifierForStateItem=function(e,t){var a="normal";return Be("Checking for item modifiers"),Be(t),ie.getInstance().isUserLoggedIn(t.username)||(a="inactive"),a},r.getSecondaryModifierForStateItem=function(e,t){var a="normal";return Be("Checking for item secondary modifiers "+t.username),ce.getInstance().isFavouriteUser(t.username)&&(Be("is favourite"),a="active"),ce.getInstance().isBlockedUser(t.username)&&(Be("is blocked"),a="warning"),a},r.eventClickItem=function(e){e.preventDefault(),e.stopPropagation(),console.log(e.target);var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);if(a!==this.uiConfig.dom.resultDataSourceBlockedUsers){Be("User "+e.target+" with id "+t+" clicked from "+a);var s=this.stateManager.findItemInState(this.config.stateNames.users,{id:parseInt(t)},Q);De(s);var r=ce.getInstance().startChatWithUser(s.username);this.applicationView.handleShowChat(e,r)}else Be("Blocked user clicked - not activating")},r.eventUserSelected=function(e,t){if(e.preventDefault(),e.stopPropagation(),De("User "+t.item.label+" with id "+t.item.value+" selected"),e.target.innerText="",!this.localisedSM.isItemInState(this.config.stateNames.recentUserSearches,{id:t.item.value},Q)){var a=this.localisedSM.getStateByName(this.config.stateNames.recentUserSearches);if(De("saved searches too long? "+this.config.controller.dataLimit.recentUserSearches),a.length>=this.config.controller.dataLimit.recentUserSearches){De("saved searches too long - removing first");var s=a.shift();this.localisedSM.removeItemFromState(this.config.stateNames.recentUserSearches,s,Q,!0)}this.localisedSM.addNewItemToState(this.config.stateNames.recentUserSearches,{id:t.item.value,username:t.item.label},!0)}},r.reRenderView=function(){this.updateView(this.config.stateNames.recentUserSearches,this.localisedSM.getStateByName(this.config.stateNames.recentUserSearches)),this.renderFavouriteUsers(),this.renderBlockedUsers()},r.updateView=function(e,t){if(e===this.config.stateNames.recentUserSearches&&(De("Updating for recent searches"),t=this.localisedSM.getStateByName(this.config.stateNames.recentUserSearches),De(t),this.createResultsForState(e,t)),e===this.config.stateNames.users){var a=Le.getLoggedInUsername(),s=$("#"+this.uiConfig.dom.extra.fastSearchInputId),r=[];t.forEach((function(e){var t={label:e.username,value:e.id};a!==e.username&&r.push(t)})),s.autocomplete({source:r}),s.autocomplete("option",{disabled:!1,minLength:1})}},r.getDragData=function(e){var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId);Be("User "+e.target.innerText+" with id "+t+" dragging");var a=this.stateManager.findItemInState(this.config.stateNames.users,{id:parseInt(t)},Q);return Be(a),a[this.config.ui.draggable.draggedType]=this.config.ui.draggable.draggedTypeUser,a[this.config.ui.draggable.draggedFrom]=this.config.ui.draggable.draggedFromUserSearch,a},r.deleteFavouriteUser=function(e){De("Favourite user "+e.username+" with id "+e.id+" deleted - removing"),ie.getInstance().removeUserFromFavouriteList(e.username)},r.deleteBlockedUser=function(e){De("Blocked user "+e.username+" with id "+e.id+" deleted - removing"),ie.getInstance().removeUserFromBlockedList(e.username)},r.deleteRecentSearchUser=function(e){De("Recent search user "+e.username+" with id "+e.id+" deleted - removing"),this.localisedSM.removeItemFromState(this.config.stateNames.recentUserSearches,e,Q,!0)},r.eventDeleteClickItem=function(e){e.preventDefault(),e.stopPropagation();var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);Be("User "+e.target+" with id "+t+" delete clicked from "+a);var s=this.stateManager.findItemInState(this.config.stateNames.users,{id:parseInt(t)},Q);if(De(s),s)switch(a){case this.uiConfig.dom.resultDataSourceFavUsers:this.deleteFavouriteUser(s);break;case this.uiConfig.dom.resultDataSourceBlockedUsers:this.deleteBlockedUser(s);break;case this.uiConfig.dom.resultDataSourceValue:this.deleteRecentSearchUser(s)}},r.getBadgeValue=function(e,t){return 0},r.getBackgroundImage=function(e,t){return""},r.eventAction1Clicked=function(t){e.prototype.eventAction1Clicked.call(this,t);var a=t.target.getAttribute(this.uiConfig.dom.resultDataKeyId),s=this.stateManager.findItemInState(this.config.stateNames.users,{id:parseInt(a)},Q);if(s){if(ie.getInstance().isUserInFavouriteList(s.username))return void De(s.username+" already in favourite list, ignoring");ie.getInstance().addUserToFavouriteList(s.username)}},r.eventAction2Clicked=function(t){e.prototype.eventAction2Clicked.call(this,t);var a=t.target.getAttribute(this.uiConfig.dom.resultDataKeyId),s=this.stateManager.findItemInState(this.config.stateNames.users,{id:parseInt(a)},Q);if(s){if(ie.getInstance().isUserInBlockedList(s.username))return void De(s.username+" already in blocked list, ignoring");ie.getInstance().addUserToBlockedList(s.username)}},r.renderFavouriteUsers=function(){var e=this,t=ie.getInstance().getFavouriteUserList();this.favUsersDiv&&ue.removeAllChildren(this.favUsersDiv),t.forEach((function(t){var a=e.stateManager.findItemInState(e.config.stateNames.users,{username:t},Y);if(a){var s=e.createResultForItem(e.config.stateNames.users,a,e.uiConfig.dom.resultDataSourceFavUsers);s.addEventListener("click",e.eventClickItem),s.setAttribute("draggable","true"),s.addEventListener("dragstart",e.eventStartDrag),e.favUsersDiv.appendChild(s)}}))},r.renderBlockedUsers=function(){var e=this,t=ie.getInstance().getBlockedUserList();this.blockedUsersDiv&&ue.removeAllChildren(this.blockedUsersDiv),t.forEach((function(t){var a=e.stateManager.findItemInState(e.config.stateNames.users,{username:t},Y);if(a){var s=e.createResultForItem(e.config.stateNames.users,a,e.uiConfig.dom.resultDataSourceBlockedUsers);s.setAttribute("draggable","false"),s.addEventListener("dragstart",(function(e){e.preventDefault()})),e.blockedUsersDiv.appendChild(s)}}))},s}(ke);function je(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Te(e,t){return(Te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ae=d()("chat-sidebar"),Me=d()("chat-sidebar:detail"),Ge=function(e){var t,a;function s(t,a,s){var r;return(r=e.call(this,t,a,t.state.ui.chatSideBar,t.state.uiPrefs.chatSideBar,s)||this).selectedChatLog=null,r.config=t.state,r.updateView=r.updateView.bind(je(r)),r.eventClickItem=r.eventClickItem.bind(je(r)),r.handleAddMessage=r.handleAddMessage.bind(je(r)),r.handleChatLogsUpdated=r.handleChatLogsUpdated.bind(je(r)),r.handleChatLogUpdated=r.handleChatLogUpdated.bind(je(r)),r.handleChatStarted=r.handleChatStarted.bind(je(r)),r.handleUserDrop=r.handleUserDrop.bind(je(r)),r.leaveChat=r.leaveChat.bind(je(r)),r.eventUserSelected=r.eventUserSelected.bind(je(r)),r.eventHide=r.eventHide.bind(je(r)),ce.getInstance().addListener(je(r)),s.addChangeListenerForName(r.config.stateNames.users,je(r)),r}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,Te(t,a);var r=s.prototype;return r.handleNewInviteReceived=function(e){throw new Error("Method not implemented.")},r.handleUserDrop=function(e){if(Ae("drop event on current chat room"),this.selectedChatLog){var t=e.dataTransfer.getData(this.config.ui.draggable.draggableDataKeyId),a=JSON.parse(t);Ae(a),a[this.config.ui.draggable.draggedType]===this.config.ui.draggable.draggedTypeUser&&(ie.getInstance().sendInvite(a.username,this.selectedChatLog.roomName),K.show("Chat","Invited "+a.username+" to the chat."))}},r.handleChatLogUpdated=function(e){Ae("Handling chat log updates"),this.checkCanComment(),this.renderChatLog(e),this.updateView("",{})},r.handleAddMessage=function(e){if(e.preventDefault(),e.stopPropagation(),Ae("Handling message event"),this.selectedChatLog){if(this.commentEl&&0===this.commentEl.value.trim().length)return;var t=this.commentEl.value.trim();this.commentEl.value="";var a=ie.getInstance().sendMessage(this.selectedChatLog.roomName,t,N.Normal,{});if(a){var s=this.addChatMessage(a);ue.scrollSmoothTo(s)}}},r.onDocumentLoaded=function(){var t=this;e.prototype.onDocumentLoaded.call(this),this.chatLogDiv=document.getElementById(this.uiConfig.dom.chatLogId),this.commentEl=document.getElementById(this.uiConfig.dom.commentId),this.chatForm=document.getElementById(this.uiConfig.dom.newFormId),this.sendMessageButton=document.getElementById(this.uiConfig.dom.submitCommentId),this.leaveChatButton=document.getElementById(this.uiConfig.dom.leaveChatId),this.chatRoomDiv=document.getElementById(this.uiConfig.dom.chatLogRoomId),this.fastUserSearch=document.getElementById(this.uiConfig.dom.chatFastSearchUserNames),this.chatRoomDiv.addEventListener("dragover",(function(e){Me("Dragged over"),t.selectedChatLog&&e.preventDefault()})),this.chatRoomDiv.addEventListener("drop",this.handleUserDrop),this.chatForm.addEventListener("submit",this.handleAddMessage),this.leaveChatButton.addEventListener("click",this.leaveChat),this.checkCanComment(),$("#"+this.uiConfig.dom.chatFastSearchUserNames).on("autocompleteselect",this.eventUserSelected),this.updateView("",{})},r.eventUserSelected=function(e,t){e.preventDefault(),e.stopPropagation(),Ae("User "+t.item.label+" with id "+t.item.value+" selected"),e.target.innerText="",this.selectedChatLog&&ie.getInstance().sendInvite(t.item.label,this.selectedChatLog.roomName),K.show("Chat","Invited "+t.item.label+" to the chat.")},r.getIdForStateItem=function(e,t){return t.roomName},r.getLegacyIdForStateItem=function(e,t){return t.roomName},r.getDisplayValueForStateItem=function(e,t){return t.users.join(",")},r.getModifierForStateItem=function(e,t){var a="inactive";return this.selectedChatLog&&this.selectedChatLog.roomName===t.roomName&&(a="active"),a},r.getSecondaryModifierForStateItem=function(e,t){return this.getModifierForStateItem(e,t)},r.addChatMessage=function(e){var t=document.createElement("div");if(ue.addRemoveClasses(t,"message"),0===e.from.trim().length){var a=document.createElement("div");ue.addRemoveClasses(a,"message-sender"),a.innerText=e.message,t.appendChild(a)}else{if(e.from===ie.getInstance().getCurrentUser())ue.addRemoveClasses(t,"my-message");else{var s=document.createElement("div");ue.addRemoveClasses(s,"message-sender"),s.innerText=e.from+"   "+X()(e.created,"YYYYMMDDHHmmss").format("DD/MM/YYYY "),t.appendChild(s)}var r=document.createElement("div");e.from===ie.getInstance().getCurrentUser()?ue.addRemoveClasses(r,"my-message-content"):ue.addRemoveClasses(r,"message-content"),r.innerText=e.message,t.appendChild(r)}return this.chatLogDiv.appendChild(t),t},r.reRenderChatMessages=function(e){var t=this;ue.removeAllChildren(this.chatLogDiv);var a=null;e.messages.forEach((function(e){a=t.addChatMessage(e)})),a&&ue.scrollTo(a)},r.renderChatLog=function(e){Me("Chat Log "+e.roomName+" rendering"),this.selectedChatLog&&this.selectedChatLog.roomName===e.roomName&&(this.selectedChatLog=e,ie.getInstance().touchChatLog(e.roomName),this.reRenderChatMessages(e)),this.updateView("",{})},r.eventClickItem=function(e){e.preventDefault(),e.stopPropagation(),console.log(e.target);var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);Me("Chat Log "+e.target+" with id "+t+" clicked from "+a),this.selectedChatLog=ie.getInstance().getChatLog(t),this.selectedChatLog&&(this.checkCanComment(),this.renderChatLog(this.selectedChatLog))},r.selectChatRoom=function(e){Me("Chat Log with id "+e+" selected"),this.selectedChatLog=ie.getInstance().getChatLog(e),this.selectedChatLog&&(this.checkCanComment(),this.renderChatLog(this.selectedChatLog))},r.updateView=function(e,t){if(e===this.config.stateNames.users){Me("Updating the fast user search"),Me(t);var a=Le.getLoggedInUsername(),s=$("#"+this.uiConfig.dom.chatFastSearchUserNames),r=[];t&&(t.forEach((function(e){var t={label:e.username,value:e.id};a!==e.username&&r.push(t)})),s.autocomplete({source:r}),s.autocomplete("option",{disabled:!1,minLength:1}))}else Me("Updating state with chat manager"),t=ie.getInstance().getChatLogs(),Me(t),this.createResultsForState(e,t),this.checkCanComment()},r.getDragData=function(e){},r.handleChatLogsUpdated=function(){this.selectedChatLog&&(ie.getInstance().touchChatLog(this.selectedChatLog.roomName),this.reRenderChatMessages(this.selectedChatLog)),this.updateView("",{}),this.checkCanComment()},r.handleChatStarted=function(e){this.selectedChatLog=e,this.renderChatLog(e),this.updateView("",{})},r.eventHide=function(t){e.prototype.eventHide.call(this,t),this.selectedChatLog&&(this.selectedChatLog=null,this.checkCanComment(),this.clearChatLog())},r.handleOfflineMessagesReceived=function(e){},r.handleInvitationDeclined=function(e,t){},r.getBadgeValue=function(e,t){return t.numOfNewMessages},r.eventDeleteClickItem=function(e){e.preventDefault(),e.stopPropagation(),console.log(e.target);var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);(Me("Chat Log "+e.target+" with id "+t+" deleted from "+a),t)&&(ie.getInstance().getChatLog(t)&&(ie.getInstance().leaveChat(t),this.selectedChatLog&&this.selectedChatLog.roomName===t&&(this.selectedChatLog=null,this.clearChatLog(),this.checkCanComment()),this.updateView("",{})))},r.getBackgroundImage=function(e,t){return""},r.leaveChat=function(e){e.preventDefault(),e.stopPropagation(),this.selectedChatLog&&(ie.getInstance().leaveChat(this.selectedChatLog.roomName),this.selectedChatLog=null,this.clearChatLog(),this.checkCanComment()),this.updateView("",{})},r.checkCanComment=function(){this.selectedChatLog?(this.commentEl&&this.commentEl.removeAttribute("readonly"),this.commentEl&&this.commentEl.removeAttribute("disabled"),this.sendMessageButton&&this.sendMessageButton.removeAttribute("disabled"),this.leaveChatButton&&this.leaveChatButton.removeAttribute("disabled"),this.fastUserSearch&&this.fastUserSearch.removeAttribute("disabled")):(this.commentEl&&this.commentEl.setAttribute("readonly","true"),this.commentEl&&this.commentEl.setAttribute("disabled","true"),this.sendMessageButton&&this.sendMessageButton.setAttribute("disabled","true"),this.leaveChatButton&&this.leaveChatButton.setAttribute("disabled","true"),this.fastUserSearch&&this.fastUserSearch.setAttribute("disabled","true"))},r.clearChatLog=function(){ue.removeAllChildren(this.chatLogDiv)},s}(ke);function xe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pe=d()("board-game-search-sidebar"),_e=d()("board-game-search-sidebar:detail"),Ve=function(e){var t,a;function s(t,a,s){var r;return(r=e.call(this,t,a,t.state.ui.boardGameSearchSideBar,t.state.uiPrefs.boardGameSearchSideBar,s)||this).config=t.state,r.updateView=r.updateView.bind(xe(r)),r.eventClickItem=r.eventClickItem.bind(xe(r)),r.handleSearch=r.handleSearch.bind(xe(r)),r.handleSearchResultsCB=r.handleSearchResultsCB.bind(xe(r)),r.localisedSM=new S,r.localisedSM.addChangeListenerForName(r.config.stateNames.bggSearchResults,xe(r)),Pe(r.localisedSM.getStateByName(r.config.stateNames.bggSearchResults)),r}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,Oe(t,a);var r=s.prototype;return r.handleSearchResultsCB=function(e,t,a){this.changeSearchButton(!0),Pe("callback for bgg search "+a+" with status "+t+" - "),t>=200&&t<=299&&(_e(e),_e(e.data.findBoardGames),this.localisedSM.setStateByName(this.config.stateNames.bggSearchResults,e.data.findBoardGames,!0))},r.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.formEl=this.document.getElementById(this.uiConfig.dom.formId),this.buttonEl=this.document.getElementById(this.uiConfig.dom.buttonId),this.queryEl=this.document.getElementById(this.uiConfig.dom.queryId),this.formEl.addEventListener("submit",this.handleSearch)},r.getIdForStateItem=function(e,t){return t.gameId},r.getLegacyIdForStateItem=function(e,t){return t.gameId},r.getDisplayValueForStateItem=function(e,t){return t.name+" ("+t.year+")     "},r.getModifierForStateItem=function(e,t){return"normal"},r.getSecondaryModifierForStateItem=function(e,t){return"normal"},r.eventClickItem=function(e){e.preventDefault(),e.stopPropagation(),console.log(e.target);var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);_e("Board Game "+e.target+" with id "+t+" clicked from "+a);var s=this.localisedSM.findItemInState(this.config.stateNames.bggSearchResults,{gameId:parseInt(t)},J);s&&this.applicationView.addBoardGameToDisplay(s),this.eventHide(null)},r.updateView=function(e,t){e===this.config.stateNames.bggSearchResults&&(Pe("Updating for recent searches"),t=this.localisedSM.getStateByName(this.config.stateNames.bggSearchResults),Pe(t),this.createResultsForState(e,t))},r.getDragData=function(e){var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId);_e("Board Game "+e.target.innerText+" with id "+t+" dragging");var a=this.localisedSM.findItemInState(this.config.stateNames.bggSearchResults,{gameId:parseInt(t)},J);return _e(a),a[this.config.ui.draggable.draggedType]=this.config.ui.draggable.draggedTypeBoardGame,a[this.config.ui.draggable.draggedFrom]=this.config.ui.draggable.draggedFromBoardGameSearch,a},r.eventDeleteClickItem=function(e){var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);_e("Board Game "+e.target+" with id "+t+" delete clicked from "+a);var s=this.localisedSM.findItemInState(this.config.stateNames.bggSearchResults,{id:parseInt(t)},J);Pe(t),s&&this.localisedSM.removeItemFromState(this.config.stateNames.bggSearchResults,s,J,!0)},r.getBadgeValue=function(e,t){return 0},r.getBackgroundImage=function(e,t){return""},r.changeSearchButton=function(e){void 0===e&&(e=!1),ue.removeAllChildren(this.buttonEl),e?(this.buttonEl&&this.buttonEl.removeAttribute("disabled"),this.buttonEl&&(this.buttonEl.innerHTML="Search")):(this.buttonEl&&this.buttonEl.setAttribute("disabled","true"),this.buttonEl&&(this.buttonEl.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>  Loading...'))},r.handleSearch=function(e){Pe("Handling search"),e.preventDefault(),e.stopPropagation();var t=this.queryEl.value.trim();if(0!=t.length){this.changeSearchButton(!1);var a=this.config.apis.bggSearchCall;D.addQLApiRequest(this.config.apis.graphQL,a,{queryString:t},this.handleSearchResultsCB,this.config.stateNames.bggSearchResults)}},s}(ke),He=d()("view-ts:boardgameview");function qe(e){var t=e.boardGame,a=e.showScoresHandler,s=e.addToCollectionHandler,r=e.removeFromCollectionHandler,n=e.startScoreSheetHandler;if(t){He("Board Game "+t.gameId);var o=i.a.createElement("div",null,i.a.createElement("button",{type:"button",className:"btn-primary btn-sm rounded p-1 mt-1 w-100","board-game-id":t.gameId,onClick:s},"  Add to ",Le.isLoggedIn()?"":"Browser"," Collection  ",i.a.createElement("i",{className:"fas fa-star"}),"  "),i.a.createElement("button",{type:"button",className:"btn-primary btn-sm rounded p-1 mt-1 w-100","board-game-id":t.gameId,onClick:r},"  Remove from Display ",i.a.createElement("i",{className:"fas fa-trash-alt"}))),c=i.a.createElement("button",{type:"button",className:"btn-warning btn-sm rounded p-1 mt-1 w-100","board-game-id":t.gameId,onClick:r},"  Remove from ",Le.isLoggedIn()?"":"Browser"," Collection  ",i.a.createElement("i",{className:"far fa-star"}),"  "),d=i.a.createElement("button",{type:"button",className:"btn-secondary btn-sm rounded p-1 mr-2 mt-2 w-100","board-game-id":t.gameId,onClick:n},"  Start Score Sheet  ",i.a.createElement("i",{className:"fas fa-list-alt"}),"  "),h=0;t.scoresheets&&(h=t.scoresheets.length);var l=i.a.createElement("i",{className:"fas fa-star text-black"}),u=i.a.createElement("span",{"board-game-id":t.gameId,className:"badge badge-pill badge-info ml-1",onClick:a},"Scores: ",h);if(t.decorator&&t.decorator!==ne.Incomplete){var m="https://boardgamegeek.com/boardgame/"+t.gameId;return i.a.createElement("div",{className:"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2"},i.a.createElement("div",{className:"card"},i.a.createElement("a",{href:m,target:"_blank"},i.a.createElement("img",{className:"card-img-top",src:t.image,alt:"Card image cap"})),i.a.createElement("div",{className:"card-body scroll"},i.a.createElement("h5",{className:"card-title"},t.name," (",t.year,") ",t.decorator===ne.Persisted||t.decorator===ne.PersistedLocally?l:""," ",t.decorator===ne.Persisted||t.decorator===ne.PersistedLocally?u:"",i.a.createElement("br",null)," ",Le.isLoggedIn()?t.decorator===ne.Persisted?c:o:c),i.a.createElement("p",{className:"card-text"},t.description),i.a.createElement("p",{className:"card-text"},i.a.createElement("small",{className:"text-muted"},"Play Time: ",t.minPlayTime," - ",t.maxPlayTime," min",i.a.createElement("br",null),"Players: ",t.minPlayers," - ",t.maxPlayers," Min Age:",t.minAge,i.a.createElement("br",null),"Categories: ",t.categories))),i.a.createElement("div",{className:"card-footer text-right text-muted"},"Rank: ",t.rank," Score: ",t.averageScore," from ",t.numOfRaters," raters",i.a.createElement("br",null),d)))}return i.a.createElement("div",{className:"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2"},i.a.createElement("div",{className:"card"},i.a.createElement("img",{className:"card-img-top",src:"/img/spinner.gif",alt:"Card image cap"}),i.a.createElement("div",{className:"card-body"},i.a.createElement("h5",{className:"card-title"},t.name," (",t.year,") "),i.a.createElement("p",{className:"card-text"},"Loading..."),i.a.createElement("p",{className:"card-text"},i.a.createElement("small",{className:"text-muted"},"Loading..."))),i.a.createElement("div",{className:"card-footer text-right text-muted"},"Loading...")))}return i.a.createElement("div",{className:"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2"},i.a.createElement("div",{className:"card"}))}function Ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qe(e,t){return(Qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ye=d()("score-sheet-sidebar"),Je=d()("score-sheet-sidebar:detail"),ze=function(e){var t,a;function s(t,a,s){var r;return(r=e.call(this,t,a,t.state.ui.scoreSheetSideBar,t.state.uiPrefs.scoreSheetSideBar,s)||this).selectedBoardGame=null,r.config=t.state,r.updateView=r.updateView.bind(Ke(r)),r.eventClickItem=r.eventClickItem.bind(Ke(r)),r}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,Qe(t,a);var r=s.prototype;return r.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.updateView("",{})},r.setSelectedBoardGame=function(e){Ye("setting selected board game to"),Je(e),e&&(this.selectedBoardGame=e,this.updateView("",e))},r.getIdForStateItem=function(e,t){return t.id},r.getLegacyIdForStateItem=function(e,t){return t.id},r.getDisplayValueForStateItem=function(e,t){var a="";if(a+='<h5 class="card-title">'+this.selectedBoardGame.name+" ("+this.selectedBoardGame.year+")</h5>",a+='<p class="card-text">Played On: '+X()(t.createdOn,"YYYYMMDDHHmmss").format("ddd, DD/MM/YYYY HH:mm")+"</p>",a+='<p class="card-text">Scores: ',t.player1&&t.score1>0&&(a+=t.player1+":"+t.score1+" "),t.player2&&t.score2>0&&(a+=t.player2+":"+t.score2+" "),t.player3&&t.score3>0&&(a+=t.player3+":"+t.score3+" "),t.player4&&t.score4>0&&(a+=t.player4+":"+t.score4+" "),t.player5&&t.score5>0&&(a+=t.player5+":"+t.score5+" "),t.player6&&t.score6>0&&(a+=t.player6+":"+t.score6+" "),t.player7&&t.score7>0&&(a+=t.player7+":"+t.score7+" "),t.players)for(var s=0;s<t.players.length;s++);return a+="</p>"},r.getModifierForStateItem=function(e,t){return"normal"},r.getSecondaryModifierForStateItem=function(e,t){return this.getModifierForStateItem(e,t)},r.eventClickItem=function(e){},r.updateView=function(e,t){Je("Updating state with selected board game"),t&&t.scoresheets&&this.createResultsForState(e,t.scoresheets)},r.getDragData=function(e){},r.getBadgeValue=function(e,t){return 0},r.getBackgroundImage=function(e,t){return"./img/scorecard-vertical.jpg"},r.eventDeleteClickItem=function(e){var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);if(Ye("Score Sheet "+e.target+" with id "+t+" delete clicked from "+a),this.selectedBoardGame&&confirm("Are you sure you want to delete this Score Sheet?")){if(this.selectedBoardGame.scoresheets){var s=this.selectedBoardGame.scoresheets.findIndex((function(e){return e.id===t}));s>=0&&(this.selectedBoardGame.scoresheets.splice(s,1),Le.scoreSheetRemovedFromBoardGame(this.selectedBoardGame,t))}this.updateView("",this.selectedBoardGame)}},s}(ke);function We(e,t,a,s,r,i,n){try{var o=e[i](n),c=o.value}catch(e){return void a(e)}o.done?t(c):Promise.resolve(c).then(s,r)}function $e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ze(e,t){return(Ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xe=d()("app"),et=function(e){var t,a;function s(){var t;return(t=e.call(this)||this).state={isLoggedIn:!1,loggedInUserId:-1,boardGames:[],scoreSheet:{room:"",boardGameName:"",sheetLayoutOptions:{},timer:0,sheetData:{}},stateNames:{users:"users",boardGames:"boardGames",scores:"scores",selectedEntry:"selectedEntry",recentUserSearches:"recentUserSearches",bggSearchResults:"bggSearchResults",scoreSheet:"scoreSheet"},apis:{login:"/login",graphQL:"/graphql",bggSearchCall:"query search($queryString: String!) {findBoardGames(query: $queryString) {gameId, name, year}}",bggSearchCallById:{queryString:"query getDetails($gameId:Int!) {getBoardGameDetails(gameId:$gameId) {gameId,thumb,image,name,description,year, minPlayers, maxPlayers, minPlayTime, maxPlayTime, minAge, designers, artists, publisher, numOfRaters, averageScore, rank, categories}}",resultName:"getBoardGameDetails"},findUsers:{queryString:"query {findUsers {id, username}}",resultName:"findUsers"},addToMyCollection:{queryString:"mutation addBoardGame($userId: Int!, $boardGame: BoardGameDetailInput!){addToMyCollection(userId: $userId, boardGame: $boardGame) {id,gameId}}",resultName:"addToMyCollection"},removeFromMyCollection:{queryString:"mutation removeBoardGame($userId: Int!, $boardGameId: Int!) {removeFromMyCollection(userId: $userId, boardGameId: $boardGameId) {result}}",resultName:"removeFromMyCollection"},getMyBoardGameCollection:{queryString:"query myCollection($userId: Int!) {getMyBoardGameCollection(userId: $userId) {id,gameId,thumb,image,name,description,year, minPlayers, maxPlayers, minPlayTime, maxPlayTime, minAge, designers, artists, publisher, numOfRaters, averageScore, rank, categories,scoresheets {id, player1, score1, player2, score2, player3, score3, player4, score4, player5, score5, player6, score6, player7, score7, createdOn}}}",resultName:"getMyBoardGameCollection"},addScoreSheetToBoardGame:{queryString:"mutation addScore($userId: Int!, $boardGameId: Int!, $sheet: ScoreSheetInput) {addScoreSheetToBoardGame(userId: $userId, boardGameId: $boardGameId, sheet: $sheet){id}}",resultName:"addScoreSheetToBoardGame"},removeScoreSheet:{queryString:"mutation removeSheet($sheetId: String!) {removeScoreSheet(sheetId: $sheetId) {result}}",resultName:"removeFromMyCollection"}},ui:{draggable:{draggableDataKeyId:"text/plain",draggedType:"draggedType",draggedFrom:"draggedFrom",draggedTypeUser:"user",draggedTypeBoardGame:"boardGame",draggedFromUserSearch:"userSearch",draggedFromBoardGameSearch:"boardGameSearch"},alert:{modalId:"alert",titleId:"alert-title",contentId:"alert-content",cancelButtonId:"alert-cancel",confirmButtonId:"alert-confirm",closeButtonId:"alert-close",hideClass:"d-none",showClass:"d-block"},navigation:{showMyCollection:"navigationItemMyCollection",boardGameSearchId:"navigationItemBoardGameSearch",userSearchId:"navigationItemUserSearch",chatId:"navigationItemChat",showScoreSheet:"navigationItemScoreSheet"},chatSideBar:{dom:{sideBarId:"chatSideBar",resultsId:"chatLogs",resultsElementType:"a",resultsElementAttributes:[["href","#"]],resultsClasses:"list-group-item my-list-item truncate-comment list-group-item-action",resultDataKeyId:"room",resultLegacyDataKeyId:"room",resultDataSourceId:"chatLogs",modifierClassNormal:"",modifierClassInactive:"list-group-item-dark",modifierClassActive:"list-group-item-primary",modifierClassWarning:"",iconNormal:"",iconInactive:"",iconActive:"",iconWarning:"",isDraggable:!1,isClickable:!0,isDeleteable:!0,deleteButtonClasses:"btn btn-circle bg-warning btn-sm",deleteButtonText:"",deleteButtonIconClasses:"text-black fas fa-sign-out-alt",hasBadge:!0,resultContentDivClasses:"d-flex w-100 justify-content-between",resultContentTextElementType:"span",resultContentTextClasses:"mb-1",badgeElementType:"span",badgeElementAttributes:[["style","font-size:12pt"]],badgeClasses:"badge badge-pill badge-primary mr-1",newFormId:"newMessage",commentId:"message",submitCommentId:"submitMessage",chatLogId:"chatLog",chatLogRoomId:"chatLogRoom",leaveChatId:"leaveChat",chatFastSearchUserNames:"chatFastSearchUserNames"}},userSearchSideBar:{dom:{sideBarId:"userSearchSideBar",resultsId:"recentUserSearches",favouriteUsersId:"favouriteUsers",blockedUsersId:"blockedUsers",favouriteUsersDropZone:"favouriteUsersDropZone",blockedUsersDropZone:"blockedUsersDropZone",resultsElementType:"a",resultsElementAttributes:[["href","#"]],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",resultDataKeyId:"user-id",resultLegacyDataKeyId:"legacy-user-id",resultDataSourceId:"data-source",resultDataSourceValue:"recentUserSearches",resultDataSourceFavUsers:"favouriteUsers",resultDataSourceBlockedUsers:"blockedUsers",modifierClassNormal:"list-group-item-primary",modifierClassInactive:"list-group-item-light",modifierClassActive:"list-group-item-info",modifierClassWarning:"list-group-item-danger",iconNormal:'   <i class="fas fa-comment"></i>',iconInactive:'   <i class="fas fa-comment"></i>',iconActive:'   <i class="fas fa-heart"></i>',iconWarning:'  <i class="fas fa-exclamation-circle"></i>',resultContentDivClasses:"d-flex w-100 justify-content-between",resultContentTextElementType:"span",resultContentTextClasses:"mb-1",isDraggable:!0,isClickable:!0,isDeleteable:!0,deleteButtonClasses:"btn bg-danger text-white btn-circle btn-sm",deleteButtonText:"",deleteButtonIconClasses:"fas fa-trash-alt",extra:{fastSearchInputId:"fastSearchUserNames"},extraAction1Classes:"btn bg-info text-white btn-circle btn-sm mr-1",extraAction1Text:"",extraAction1IconClasses:"fas fa-user-plus",extraAction2Classes:"btn bg-warning text-white btn-circle btn-sm mr-1",extraAction2Text:"",extraAction2IconClasses:"fas fa-user-slash"}},boardGameSearchSideBar:{dom:{sideBarId:"boardGameSearchSidebar",resultsId:"bggSearchResults",resultsElementType:"a",resultsElementAttributes:[["href","#"]],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",resultDataKeyId:"bgg-id",resultLegacyDataKeyId:"bgg-id",resultDataSourceId:"data-source",resultDataSourceValue:"bggSearch",modifierClassNormal:"list-group-item-primary",modifierClassInactive:"list-group-item-light",modifierClassActive:"list-group-item-info",modifierClassWarning:"list-group-item-danger",iconNormal:'   <i class="fas fa-dice"></i>',iconInactive:'   <i class="fas fa-dice"></i>',iconActive:'   <i class="fas fa-dice"></i>',iconWarning:'  <i class="fas fa-dice"></i>',resultContentDivClasses:"d-flex w-100 justify-content-between",resultContentTextElementType:"span",resultContentTextClasses:"mb-1",isDraggable:!0,isClickable:!0,formId:"bggSearch",queryId:"queryText",buttonId:"bggSearchButton"}},scoreSheetSideBar:{dom:{sideBarId:"scoreSheetSidebar",resultsId:"scoreSheets",resultsElementType:"div",resultsElementAttributes:[],resultsClasses:"text-white bg-info col-sm-6 col-md-3 col-lg-2 score-card",resultDataKeyId:"bgg-id",resultLegacyDataKeyId:"bgg-id",resultDataSourceId:"data-source",resultDataSourceValue:"scoreSheet",modifierClassNormal:"",modifierClassInactive:"",modifierClassActive:"",modifierClassWarning:"",iconNormal:" ",iconInactive:" ",iconActive:" ",iconWarning:" ",isDraggable:!1,isClickable:!1,isDeleteable:!0,deleteButtonClasses:"btn btn-rounded btn-warning ml-6 mt-4",deleteButtonText:"Delete&nbsp;",deleteButtonIconClasses:"fas fa-trash-alt",resultContentDivClasses:"card-img-overlay",resultContentTextElementType:"div",resultContentTextClasses:"ml-2",hasBackgroundImage:!0,imgElementType:"img",imgClasses:"score-card-img"}},scoreSheet:{dom:{dropZone:"scoreSheetZone",boardGame:"selectedBoardGame",startStopTimer:"startStopTimer",timer:"timerDisplay",end:"leaveScoreSheet",scoreSheet:"scoreSheet",iconStart:"<i class='fas fa-hourglass-start'></i>",iconInProgress:"<i class='fas fa-hourglass-half'></i>",iconEnd:"<i class='fas fa-hourglass-end'></i>",iconLeave:"<i class='fas fa-sign-out-alt'></i>",ssFastSearchUserNames:"ssFastSearchUserNames",webrtc:"webrtc"}}},uiPrefs:{navigation:{},blogEntry:{},userSearchSideBar:{view:{location:"left",expandedSize:"35%"}},boardGameSearchSideBar:{view:{location:"left",expandedSize:"35%"}},chatSideBar:{view:{location:"right",expandedSize:"50%"}},scoreSheetSideBar:{view:{location:"bottom",expandedSize:"30%"}}},controller:{events:{boardGames:{eventDataKeyId:"board-game-id"}},dataLimit:{recentUserSearches:10}}},t.cancelDelete=t.cancelDelete.bind($e(t)),t.confirmDelete=t.confirmDelete.bind($e(t)),t.handleDeleteBoardGame=t.handleDeleteBoardGame.bind($e(t)),t.handleShowUserSearch=t.handleShowUserSearch.bind($e(t)),t.handleShowChat=t.handleShowChat.bind($e(t)),t.handleShowBGGSearch=t.handleShowBGGSearch.bind($e(t)),t.handleDragOver=t.handleDragOver.bind($e(t)),t.handleDrop=t.handleDrop.bind($e(t)),t.handleShowCollection=t.handleShowCollection.bind($e(t)),t.handleShowScoreSheet=t.handleShowScoreSheet.bind($e(t)),t.handleStartScoreSheet=t.handleStartScoreSheet.bind($e(t)),t.handleShowScores=t.handleShowScores.bind($e(t)),Le.connectToApplication($e(t),window.localStorage),t}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,Ze(t,a);var r=s.prototype;return r.addBoardGameToDisplay=function(e){Le.addBoardGameToDisplay(e)},r.getCurrentUser=function(){return Le.getLoggedInUserId()},r.alert=function(e,t){this.titleEl.textContent=e,this.contentEl.textContent=t,this.modalEl.classList.remove(this.state.ui.alert.hideClass),this.modalEl.classList.add(this.state.ui.alert.showClass)},r.render=function(){var e=this;Xe("Rendering App");var t=this.state.boardGames;Xe(t);var a=t.map((function(t,a){return i.a.createElement(qe,{key:a,boardGame:t,showScoresHandler:e.handleShowScores,addToCollectionHandler:Le.addBoardGameToCollection,removeFromCollectionHandler:e.handleDeleteBoardGame,startScoreSheetHandler:e.handleStartScoreSheet})}));return i.a.createElement("div",{className:"root container-fluid"},i.a.createElement("div",{className:"card-group"},a))},r.cancelDelete=function(e){this.modalEl.classList.remove(this.state.ui.alert.showClass),this.modalEl.classList.add(this.state.ui.alert.hideClass),e.preventDefault()},r.confirmDelete=function(e){this.modalEl.classList.remove(this.state.ui.alert.showClass),this.modalEl.classList.add(this.state.ui.alert.hideClass),e.preventDefault();var t=this.modalEl.getAttribute(this.state.controller.events.boardGames.eventDataKeyId);t=parseInt(t),Xe("Handling Delete with id "+t);var a=this.state.boardGames,s=a.findIndex((function(e){return e.gameId===t}));if(s>=0){var r=a[s];Le.removeBoardGameFromCollection(r)}},r.handleStartScoreSheet=function(e){if(e.preventDefault(),Ie.getInstance().hasActiveScoreSheet()){if(!confirm("You already have an active score sheet, do you want to finish that one and start a new one?"))return;Ie.getInstance().endScoreSheet()}this.hideAllSideBars();var t=e.target.getAttribute(this.state.controller.events.boardGames.eventDataKeyId);if(Xe("Handling starting score sheet for "+t),t){t=parseInt(t);var a=this.state.boardGames,s=a.findIndex((function(e){return e.gameId===t}));if(s>=0){var r=a[s];Xe(r),Ie.getInstance().startScoreSheet(r),this.switchBetweenCollectionAndScoreSheet(!1)}}},r.handleDeleteBoardGame=function(e){e.preventDefault();var t=e.target.getAttribute(this.state.controller.events.boardGames.eventDataKeyId);if(Xe("Handling Delete Board Game "+t),t){t=parseInt(t);var a=this.state.boardGames,s=a.findIndex((function(e){return e.gameId===t}));if(s>=0){var r=a[s];r.decorator&&r.decorator===ne.Persisted?(Xe("Handling Delete Board Game "+t+" - persisted, confirming with user, but only if logged in"),Le.isLoggedIn()?(this.modalEl.setAttribute(this.state.controller.events.boardGames.eventDataKeyId,t),this.alert(r.name+" ("+r.year+")","Are you sure you want to delete this board game from your collection?")):(Xe("Handling Delete Board Game "+t+" - IS persisted but not logged in, just deleting from local storage  asking controller to remove"),Le.removeBoardGameFromDisplay(r))):(Xe("Handling Delete Board Game "+t+" - NOT persisted, asking controller to remove"),Le.removeBoardGameFromDisplay(r))}}},r.componentDidMount=function(){var e,t=(e=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Xe("component Did Mount"),this.chatView=new Ge(this,document,Le.getStateManager()),this.chatView.onDocumentLoaded(),this.userSearchView=new Fe(this,document,Le.getStateManager()),this.userSearchView.onDocumentLoaded(),this.bggSearchView=new Ve(this,document,Le.getStateManager()),this.bggSearchView.onDocumentLoaded(),this.scoresView=new ze(this,document,Le.getStateManager()),this.scoresView.onDocumentLoaded(),this.scoreSheetView=ve.getInstance(),this.scoreSheetView.setApplication(this),this.scoreSheetView.onDocumentLoaded(this),document&&(document.getElementById(this.state.ui.navigation.boardGameSearchId).addEventListener("click",this.handleShowBGGSearch),document.getElementById(this.state.ui.navigation.userSearchId).addEventListener("click",this.handleShowUserSearch),this.chatNavigationItem=document.getElementById(this.state.ui.navigation.chatId),this.chatNavigationItem.addEventListener("click",this.handleShowChat),document.getElementById(this.state.ui.navigation.showMyCollection).addEventListener("click",this.handleShowCollection),document.getElementById(this.state.ui.navigation.showScoreSheet).addEventListener("click",this.handleShowScoreSheet)),this.modalEl=document.getElementById(this.state.ui.alert.modalId),this.titleEl=document.getElementById(this.state.ui.alert.titleId),this.contentEl=document.getElementById(this.state.ui.alert.contentId),this.cancelBtnEl=document.getElementById(this.state.ui.alert.cancelButtonId),this.confirmBtnEl=document.getElementById(this.state.ui.alert.confirmButtonId),this.closeBtnEl=document.getElementById(this.state.ui.alert.closeButtonId),this.cancelBtnEl&&this.cancelBtnEl.addEventListener("click",this.cancelDelete),this.confirmBtnEl&&this.confirmBtnEl.addEventListener("click",this.confirmDelete),this.closeBtnEl&&this.closeBtnEl.addEventListener("click",this.cancelDelete),this.thisEl=document.getElementById("root"),this.scoreSheetEl=document.getElementById("scoreSheetZone"),this.thisEl&&(this.thisEl.addEventListener("dragover",this.handleDragOver),this.thisEl.addEventListener("drop",this.handleDrop)),Ie.getInstance().initialise(this),Le.initialise();case 27:case"end":return e.stop()}}),e,this)})),function(){var t=this,a=arguments;return new Promise((function(s,r){var i=e.apply(t,a);function n(e){We(i,s,r,n,o,"next",e)}function o(e){We(i,s,r,n,o,"throw",e)}n(void 0)}))});return function(){return t.apply(this,arguments)}}(),r.hideAllSideBars=function(){this.chatView.eventHide(null),this.userSearchView.eventHide(null),this.bggSearchView.eventHide(null)},r.handleShowCollection=function(e){this.switchBetweenCollectionAndScoreSheet(!0)},r.handleShowScoreSheet=function(e){this.switchBetweenCollectionAndScoreSheet(!1)},r.handleShowUserSearch=function(e){Xe("Handling Show User Search"),e.preventDefault(),Le.isLoggedIn()?this.userSearchView.eventShow(e):window.location.href=this.state.apis.login},r.handleShowScores=function(e){Xe("Handling show board game scores"),e.preventDefault();var t=e.target.getAttribute(this.state.controller.events.boardGames.eventDataKeyId);if(Xe("Handling Show board game scores "+t),t){t=parseInt(t);var a=this.state.boardGames,s=a.findIndex((function(e){return e.gameId===t}));if(s>=0){var r=a[s];this.scoresView.setSelectedBoardGame(r),this.scoresView.eventShow(null)}}},r.handleShowChat=function(e,t){Xe("Handling Show Chat"),e.preventDefault(),Le.isLoggedIn()?(this.chatView.eventShow(e),t&&this.chatView.selectChatRoom(t)):window.location.href=this.state.apis.login},r.handleShowBGGSearch=function(e){Xe("Handling Show BGG Search View"),e.preventDefault(),Le.isLoggedIn()||this.hideAllSideBars(),this.bggSearchView.eventShow(e)},r.countChanged=function(e){var t='Chat <i class="fas fa-inbox"></i>';e>0&&(t+=' <span class="badge badge-pill badge-primary">&nbsp;'+e+"&nbsp;</span>"),this.chatNavigationItem&&(this.chatNavigationItem.innerHTML=""+t)},r.handleDragOver=function(e){e.preventDefault()},r.handleDrop=function(e){var t=e.dataTransfer.getData(this.state.ui.draggable.draggableDataKeyId);Xe(t);var a=JSON.parse(t);Xe(a),a[this.state.ui.draggable.draggedType]===this.state.ui.draggable.draggedTypeBoardGame&&this.addBoardGameToDisplay(a)},r.switchBetweenCollectionAndScoreSheet=function(e){e?(this.thisEl&&ue.addRemoveClasses(this.thisEl,"d-none",!1),this.thisEl&&ue.addRemoveClasses(this.thisEl,"d-block",!0),this.scoreSheetEl&&ue.addRemoveClasses(this.scoreSheetEl,"d-none",!0),this.scoreSheetEl&&ue.addRemoveClasses(this.scoreSheetEl,"d-block",!1)):Ie.getInstance().hasActiveScoreSheet()&&(this.thisEl&&ue.addRemoveClasses(this.thisEl,"d-none",!0),this.thisEl&&ue.addRemoveClasses(this.thisEl,"d-block",!1),this.scoreSheetEl&&ue.addRemoveClasses(this.scoreSheetEl,"d-none",!1),this.scoreSheetEl&&ue.addRemoveClasses(this.scoreSheetEl,"d-block",!0))},s}(i.a.Component);localStorage.debug="score-sheet-controller call-manager peer",d.a.log=console.info.bind(console);var tt=i.a.createElement(et,{className:"container-fluid justify-content-around"});o.a.render(tt,document.getElementById("root"))}});
//# sourceMappingURL=app.bundle.js.map