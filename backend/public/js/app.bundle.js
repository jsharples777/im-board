!function(e){function t(t){for(var s,n,o=t[0],c=t[1],d=t[2],l=0,u=[];l<o.length;l++)n=o[l],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&u.push(i[n][0]),i[n]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);for(h&&h(t);u.length;)u.shift()();return r.push.apply(r,d||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],s=!0,o=1;o<a.length;o++){var c=a[o];0!==i[c]&&(s=!1)}s&&(r.splice(t--,1),e=n(n.s=a[0]))}return e}var s={},i={0:0},r=[];function n(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=s,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(a,s,function(t){return e[t]}.bind(null,s));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var o=window.webpackJsonp=window.webpackJsonp||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var d=0;d<o.length;d++)t(o[d]);var h=c;r.push([449,1]),a()}({449:function(e,t,a){e.exports=a(501)},457:function(e,t,a){var s={"./af":142,"./af.js":142,"./ar":143,"./ar-dz":144,"./ar-dz.js":144,"./ar-kw":145,"./ar-kw.js":145,"./ar-ly":146,"./ar-ly.js":146,"./ar-ma":147,"./ar-ma.js":147,"./ar-sa":148,"./ar-sa.js":148,"./ar-tn":149,"./ar-tn.js":149,"./ar.js":143,"./az":150,"./az.js":150,"./be":151,"./be.js":151,"./bg":152,"./bg.js":152,"./bm":153,"./bm.js":153,"./bn":154,"./bn-bd":155,"./bn-bd.js":155,"./bn.js":154,"./bo":156,"./bo.js":156,"./br":157,"./br.js":157,"./bs":158,"./bs.js":158,"./ca":159,"./ca.js":159,"./cs":160,"./cs.js":160,"./cv":161,"./cv.js":161,"./cy":162,"./cy.js":162,"./da":163,"./da.js":163,"./de":164,"./de-at":165,"./de-at.js":165,"./de-ch":166,"./de-ch.js":166,"./de.js":164,"./dv":167,"./dv.js":167,"./el":168,"./el.js":168,"./en-au":169,"./en-au.js":169,"./en-ca":170,"./en-ca.js":170,"./en-gb":171,"./en-gb.js":171,"./en-ie":172,"./en-ie.js":172,"./en-il":173,"./en-il.js":173,"./en-in":174,"./en-in.js":174,"./en-nz":175,"./en-nz.js":175,"./en-sg":176,"./en-sg.js":176,"./eo":177,"./eo.js":177,"./es":178,"./es-do":179,"./es-do.js":179,"./es-mx":180,"./es-mx.js":180,"./es-us":181,"./es-us.js":181,"./es.js":178,"./et":182,"./et.js":182,"./eu":183,"./eu.js":183,"./fa":184,"./fa.js":184,"./fi":185,"./fi.js":185,"./fil":186,"./fil.js":186,"./fo":187,"./fo.js":187,"./fr":188,"./fr-ca":189,"./fr-ca.js":189,"./fr-ch":190,"./fr-ch.js":190,"./fr.js":188,"./fy":191,"./fy.js":191,"./ga":192,"./ga.js":192,"./gd":193,"./gd.js":193,"./gl":194,"./gl.js":194,"./gom-deva":195,"./gom-deva.js":195,"./gom-latn":196,"./gom-latn.js":196,"./gu":197,"./gu.js":197,"./he":198,"./he.js":198,"./hi":199,"./hi.js":199,"./hr":200,"./hr.js":200,"./hu":201,"./hu.js":201,"./hy-am":202,"./hy-am.js":202,"./id":203,"./id.js":203,"./is":204,"./is.js":204,"./it":205,"./it-ch":206,"./it-ch.js":206,"./it.js":205,"./ja":207,"./ja.js":207,"./jv":208,"./jv.js":208,"./ka":209,"./ka.js":209,"./kk":210,"./kk.js":210,"./km":211,"./km.js":211,"./kn":212,"./kn.js":212,"./ko":213,"./ko.js":213,"./ku":214,"./ku.js":214,"./ky":215,"./ky.js":215,"./lb":216,"./lb.js":216,"./lo":217,"./lo.js":217,"./lt":218,"./lt.js":218,"./lv":219,"./lv.js":219,"./me":220,"./me.js":220,"./mi":221,"./mi.js":221,"./mk":222,"./mk.js":222,"./ml":223,"./ml.js":223,"./mn":224,"./mn.js":224,"./mr":225,"./mr.js":225,"./ms":226,"./ms-my":227,"./ms-my.js":227,"./ms.js":226,"./mt":228,"./mt.js":228,"./my":229,"./my.js":229,"./nb":230,"./nb.js":230,"./ne":231,"./ne.js":231,"./nl":232,"./nl-be":233,"./nl-be.js":233,"./nl.js":232,"./nn":234,"./nn.js":234,"./oc-lnc":235,"./oc-lnc.js":235,"./pa-in":236,"./pa-in.js":236,"./pl":237,"./pl.js":237,"./pt":238,"./pt-br":239,"./pt-br.js":239,"./pt.js":238,"./ro":240,"./ro.js":240,"./ru":241,"./ru.js":241,"./sd":242,"./sd.js":242,"./se":243,"./se.js":243,"./si":244,"./si.js":244,"./sk":245,"./sk.js":245,"./sl":246,"./sl.js":246,"./sq":247,"./sq.js":247,"./sr":248,"./sr-cyrl":249,"./sr-cyrl.js":249,"./sr.js":248,"./ss":250,"./ss.js":250,"./sv":251,"./sv.js":251,"./sw":252,"./sw.js":252,"./ta":253,"./ta.js":253,"./te":254,"./te.js":254,"./tet":255,"./tet.js":255,"./tg":256,"./tg.js":256,"./th":257,"./th.js":257,"./tk":258,"./tk.js":258,"./tl-ph":259,"./tl-ph.js":259,"./tlh":260,"./tlh.js":260,"./tr":261,"./tr.js":261,"./tzl":262,"./tzl.js":262,"./tzm":263,"./tzm-latn":264,"./tzm-latn.js":264,"./tzm.js":263,"./ug-cn":265,"./ug-cn.js":265,"./uk":266,"./uk.js":266,"./ur":267,"./ur.js":267,"./uz":268,"./uz-latn":269,"./uz-latn.js":269,"./uz.js":268,"./vi":270,"./vi.js":270,"./x-pseudo":271,"./x-pseudo.js":271,"./yo":272,"./yo.js":272,"./zh-cn":273,"./zh-cn.js":273,"./zh-hk":274,"./zh-hk.js":274,"./zh-mo":275,"./zh-mo.js":275,"./zh-tw":276,"./zh-tw.js":276};function i(e){var t=r(e);return a(t)}function r(e){if(!a.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}i.keys=function(){return Object.keys(s)},i.resolve=r,e.exports=i,i.id=457},475:function(e,t,a){var s={"./af":306,"./af.js":306,"./ar":307,"./ar-dz":308,"./ar-dz.js":308,"./ar-kw":309,"./ar-kw.js":309,"./ar-ly":310,"./ar-ly.js":310,"./ar-ma":311,"./ar-ma.js":311,"./ar-sa":312,"./ar-sa.js":312,"./ar-tn":313,"./ar-tn.js":313,"./ar.js":307,"./az":314,"./az.js":314,"./be":315,"./be.js":315,"./bg":316,"./bg.js":316,"./bm":317,"./bm.js":317,"./bn":318,"./bn.js":318,"./bo":319,"./bo.js":319,"./br":320,"./br.js":320,"./bs":321,"./bs.js":321,"./ca":322,"./ca.js":322,"./cs":323,"./cs.js":323,"./cv":324,"./cv.js":324,"./cy":325,"./cy.js":325,"./da":326,"./da.js":326,"./de":327,"./de-at":328,"./de-at.js":328,"./de-ch":329,"./de-ch.js":329,"./de.js":327,"./dv":330,"./dv.js":330,"./el":331,"./el.js":331,"./en-SG":332,"./en-SG.js":332,"./en-au":333,"./en-au.js":333,"./en-ca":334,"./en-ca.js":334,"./en-gb":335,"./en-gb.js":335,"./en-ie":336,"./en-ie.js":336,"./en-il":337,"./en-il.js":337,"./en-nz":338,"./en-nz.js":338,"./eo":339,"./eo.js":339,"./es":340,"./es-do":341,"./es-do.js":341,"./es-us":342,"./es-us.js":342,"./es.js":340,"./et":343,"./et.js":343,"./eu":344,"./eu.js":344,"./fa":345,"./fa.js":345,"./fi":346,"./fi.js":346,"./fo":347,"./fo.js":347,"./fr":348,"./fr-ca":349,"./fr-ca.js":349,"./fr-ch":350,"./fr-ch.js":350,"./fr.js":348,"./fy":351,"./fy.js":351,"./ga":352,"./ga.js":352,"./gd":353,"./gd.js":353,"./gl":354,"./gl.js":354,"./gom-latn":355,"./gom-latn.js":355,"./gu":356,"./gu.js":356,"./he":357,"./he.js":357,"./hi":358,"./hi.js":358,"./hr":359,"./hr.js":359,"./hu":360,"./hu.js":360,"./hy-am":361,"./hy-am.js":361,"./id":362,"./id.js":362,"./is":363,"./is.js":363,"./it":364,"./it-ch":365,"./it-ch.js":365,"./it.js":364,"./ja":366,"./ja.js":366,"./jv":367,"./jv.js":367,"./ka":368,"./ka.js":368,"./kk":369,"./kk.js":369,"./km":370,"./km.js":370,"./kn":371,"./kn.js":371,"./ko":372,"./ko.js":372,"./ku":373,"./ku.js":373,"./ky":374,"./ky.js":374,"./lb":375,"./lb.js":375,"./lo":376,"./lo.js":376,"./lt":377,"./lt.js":377,"./lv":378,"./lv.js":378,"./me":379,"./me.js":379,"./mi":380,"./mi.js":380,"./mk":381,"./mk.js":381,"./ml":382,"./ml.js":382,"./mn":383,"./mn.js":383,"./mr":384,"./mr.js":384,"./ms":385,"./ms-my":386,"./ms-my.js":386,"./ms.js":385,"./mt":387,"./mt.js":387,"./my":388,"./my.js":388,"./nb":389,"./nb.js":389,"./ne":390,"./ne.js":390,"./nl":391,"./nl-be":392,"./nl-be.js":392,"./nl.js":391,"./nn":393,"./nn.js":393,"./pa-in":394,"./pa-in.js":394,"./pl":395,"./pl.js":395,"./pt":396,"./pt-br":397,"./pt-br.js":397,"./pt.js":396,"./ro":398,"./ro.js":398,"./ru":399,"./ru.js":399,"./sd":400,"./sd.js":400,"./se":401,"./se.js":401,"./si":402,"./si.js":402,"./sk":403,"./sk.js":403,"./sl":404,"./sl.js":404,"./sq":405,"./sq.js":405,"./sr":406,"./sr-cyrl":407,"./sr-cyrl.js":407,"./sr.js":406,"./ss":408,"./ss.js":408,"./sv":409,"./sv.js":409,"./sw":410,"./sw.js":410,"./ta":411,"./ta.js":411,"./te":412,"./te.js":412,"./tet":413,"./tet.js":413,"./tg":414,"./tg.js":414,"./th":415,"./th.js":415,"./tl-ph":416,"./tl-ph.js":416,"./tlh":417,"./tlh.js":417,"./tr":418,"./tr.js":418,"./tzl":419,"./tzl.js":419,"./tzm":420,"./tzm-latn":421,"./tzm-latn.js":421,"./tzm.js":420,"./ug-cn":422,"./ug-cn.js":422,"./uk":423,"./uk.js":423,"./ur":424,"./ur.js":424,"./uz":425,"./uz-latn":426,"./uz-latn.js":426,"./uz.js":425,"./vi":427,"./vi.js":427,"./x-pseudo":428,"./x-pseudo.js":428,"./yo":429,"./yo.js":429,"./zh-cn":430,"./zh-cn.js":430,"./zh-hk":431,"./zh-hk.js":431,"./zh-tw":432,"./zh-tw.js":432};function i(e){var t=r(e);return a(t)}function r(e){if(!a.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}i.keys=function(){return Object.keys(s)},i.resolve=r,e.exports=i,i.id=475},501:function(e,t,a){"use strict";a.r(t);var s,i=a(21),r=a.n(i),n=a(438),o=a.n(n),c=a(18),d=a.n(c);!function(e){e[e.ItemAdded=0]="ItemAdded",e[e.ItemUpdated=1]="ItemUpdated",e[e.ItemDeleted=2]="ItemDeleted",e[e.StateChanged=3]="StateChanged"}(s||(s={}));var h=d()("state-manager-delegate"),l=function(){function e(e){this.suppressEventEmits=!1,this.managerName=e,this.stateChangeListeners=[]}var t=e.prototype;return t.suppressEvents=function(){this.suppressEventEmits=!0},t.emitEvents=function(){this.suppressEventEmits=!1},t.informChangeListenersForStateWithName=function(e,t,a,i){if(void 0===a&&(a=s.StateChanged),void 0===i&&(i=null),h("State Manager: Informing state listeners of "+e),this.suppressEventEmits)h("State Manager: Events suppressed");else{var r=this.stateChangeListeners.findIndex((function(t){return t.name===e}));if(r>=0){h("State Manager: Found state listeners of "+e+" with event type "+a);for(var n=this.stateChangeListeners[r],o=0;o<n.listeners.length;o++){h("State Manager: Found state listener of "+e+" - informing");var c=n.listeners[o];switch(a){case s.StateChanged:c.stateChanged(this.managerName,e,t);break;case s.ItemAdded:c.stateChangedItemAdded(this.managerName,e,t);break;case s.ItemUpdated:c.stateChangedItemUpdated(this.managerName,e,i,t);break;case s.ItemDeleted:c.stateChangedItemRemoved(this.managerName,e,t)}}}}},t.ensureListenerSetupForName=function(e){if(this.stateChangeListeners.findIndex((function(t){return t.name===e}))<0){var t={name:e,listeners:[]};this.stateChangeListeners.push(t)}},t.addChangeListenerForName=function(e,t){this.ensureListenerSetupForName(e),h("State Manager: Adding state listener for "+e);var a=this.stateChangeListeners.findIndex((function(t){return t.name===e}));a>=0&&this.stateChangeListeners[a].listeners.push(t)},e}(),u=d()("state-manager-ts"),m=function(){function e(e){this.forceSaves=!0,this.managerName="",this.delegate=new l(e),this.managerName=e,this.emitEvents(),this.forceSaves=!0}var t=e.prototype;return t.suppressEvents=function(){this.delegate.suppressEvents()},t.emitEvents=function(){this.delegate.emitEvents()},t.dontForceSavesOnAddRemoveUpdate=function(){this.forceSaves=!1},t.forceSavesOnAddRemoveUpdate=function(){this.forceSaves=!0},t.informChangeListenersForStateWithName=function(e,t,a,i){void 0===a&&(a=s.StateChanged),void 0===i&&(i=null),this.delegate.informChangeListenersForStateWithName(e,t,a,i)},t.addChangeListenerForName=function(e,t){this.delegate.addChangeListenerForName(e,t)},t.addStateByName=function(e,t){this._ensureStatePresent(e);var a={name:e,value:t};return this._replaceNamedStateInStorage(a),this.informChangeListenersForStateWithName(e,t,s.StateChanged),t},t.getStateByName=function(e){this._ensureStatePresent(e),u("State Manager: Getting state for "+e);var t;return t=this._getState(e).value,u("State Manager: Found previous state for "+e),u(t),t},t.setStateByName=function(e,t,a){return void 0===a&&(a=!0),this._ensureStatePresent(e),u("State Manager: Setting state for "+e),u(t),this._getState(e).value=t,this.forceSaves&&this._saveState(e,t),a&&this.informChangeListenersForStateWithName(e,t),t},t.addNewItemToState=function(e,t,a){void 0===a&&(a=!1),this._ensureStatePresent(e),u("State Manager: Adding item to state "+e),this._addItemToState(e,t,a),this.informChangeListenersForStateWithName(e,t,s.ItemAdded)},t.findItemInState=function(e,t,a){this._ensureStatePresent(e);var s={},i=this.getStateByName(e),r=i.findIndex((function(e){return a(e,t)}));return u("Finding item in state "+e+" - found index "+r),u(t),r>=0&&(s=i[r]),s},t.isItemInState=function(e,t,a){this._ensureStatePresent(e);var s=!1;return this.getStateByName(e).findIndex((function(e){return a(e,t)}))>=0&&(s=!0),s},t.removeItemFromState=function(e,t,a,i){this._ensureStatePresent(e);var r=this.findItemInState(e,t,a);return u("State Manager: Found item - removing "),this._removeItemFromState(e,t,a,i),this.informChangeListenersForStateWithName(e,r,s.ItemDeleted),!0},t.updateItemInState=function(e,t,a,i){this._ensureStatePresent(e);var r=this.findItemInState(e,t,a);return u("State Manager: Found item - replacing "),this._updateItemInState(e,t,a,i),this.informChangeListenersForStateWithName(e,t,s.ItemUpdated,r),!0},e}();function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f,v,p=d()("state-manager-ms"),S=function(e){var t,a;function s(){var t;return(t=e.call(this,"memory")||this).applicationState=[],t.forceSaves=!0,t}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,g(t,a),s.getInstance=function(){return s._instance||(s._instance=new s),s._instance};var i=s.prototype;return i._ensureStatePresent=function(e){if(this.applicationState.findIndex((function(t){return t.name===e}))<0){var t={name:e,value:[]};this.applicationState.push(t)}},i._addNewNamedStateToStorage=function(e){p("Adding new complete state "+name),p(e.value),this.applicationState.push(e)},i._replaceNamedStateInStorage=function(e){var t=this.applicationState.findIndex((function(t){return t.name===e.name}));t>=0&&(p("replacing complete state "+name),p(e.value),this.applicationState.splice(t,1,e))},i._getState=function(e){var t=this.applicationState.find((function(t){return t.name===e}));return p("getting complete state "+e),p(t.value),t},i._saveState=function(e,t){var a=this.applicationState.findIndex((function(t){return t.name===e}));if(a>=0){var s=this.applicationState[a];p("SAVING complete state "+e),p(s.value),s.value=t}},i._addItemToState=function(e,t,a){if(void 0===a&&(a=!1),a){var s=this.applicationState.findIndex((function(t){return t.name===e}));if(s>=0){var i=this.applicationState[s];p("adding item to state "+e),p(t),i.value.push(t)}}},i._removeItemFromState=function(e,t,a,s){var i=this.applicationState.findIndex((function(t){return t.name===e}));if(i>=0){var r=this.applicationState[i],n=r.value.findIndex((function(e){return a(e,t)}));n>=0&&(p("removing item from state "+e),p(t),r.value.splice(n,1))}},i._updateItemInState=function(e,t,a,s){var i=this.applicationState.findIndex((function(t){return t.name===e}));if(i>=0){var r=this.applicationState[i],n=r.value.findIndex((function(e){return a(e,t)}));n>=0&&(r.value.splice(n,1,t),p("updating item in state "+e),p(t))}else this._addItemToState(e,t,!0)},s}(m);function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}function I(e,t,a,s,i,r,n){try{var o=e[r](n),c=o.value}catch(e){return void a(e)}o.done?t(c):Promise.resolve(c).then(s,i)}!function(e){e[e.POST=0]="POST",e[e.GET=1]="GET",e[e.PUT=2]="PUT",e[e.DELETE=3]="DELETE"}(f||(f={})),function(e){e[e.PRIORITY=0]="PRIORITY",e[e.BACKGROUND=1]="BACKGROUND"}(v||(v={}));var C=d()("api-ts"),y=new(function(){function e(){}var t=e.prototype;return t.postFetchJSON=function(){var e,t=(e=regeneratorRuntime.mark((function e(t,a){var s,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:a})},e.next=3,fetch(t,s);case 3:return i=e.sent,e.abrupt("return",i.json());case 5:case"end":return e.stop()}}),e)})),function(){var t=this,a=arguments;return new Promise((function(s,i){var r=e.apply(t,a);function n(e){I(r,s,i,n,o,"next",e)}function o(e){I(r,s,i,n,o,"throw",e)}n(void 0)}))});return function(e,a){return t.apply(this,arguments)}}(),t.fetchJSON=function(e,t,a,s,i){fetch(e,t).then((function(e){if(C("Response code was "+e.status),e.status>=200&&e.status<=299)return e.json();400===e.status&&C(e.json())})).then((function(e){C(e),a(e,200,s,i)})).catch((function(e){C(e),a(null,500,s,i)}))},t.apiFetchJSONWithPost=function(e){C("Executing fetch with URL "+e.originalRequest.url+" with body "+e.originalRequest.params);try{JSON.stringify(e.originalRequest.params)}catch(t){C("Unable to convert parameters to JSON"),C(e.originalRequest.params,100),e.callback(null,404,e.queueType,e.requestId)}var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b({},e.originalRequest.params))};this.fetchJSON(e.originalRequest.url,t,e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithGet=function(e){C("Executing GET fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id);e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,{method:"GET",headers:{"Content-Type":"application/json"}},e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithDelete=function(e){C("Executing DELETE fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id);e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,{method:"DELETE",headers:{"Content-Type":"application/json"}},e.callback,e.queueType,e.requestId)},t.apiFetchJSONWithPut=function(e){C("Executing PUT fetch with URL "+e.originalRequest.url+" with id "+e.originalRequest.params.id);var t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b({},e.originalRequest.params))};e.originalRequest.params.id&&(e.originalRequest.url+="/"+e.originalRequest.params.id),this.fetchJSON(e.originalRequest.url,t,e.callback,e.queueType,e.requestId)},e}()),L=new(function(){function e(){}return e.prototype.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},e}());function w(e,t,a,s,i,r,n){try{var o=e[r](n),c=o.value}catch(e){return void a(e)}o.done?t(c):Promise.resolve(c).then(s,i)}function U(e){return function(){var t=this,a=arguments;return new Promise((function(s,i){var r=e.apply(t,a);function n(e){w(r,s,i,n,o,"next",e)}function o(e){w(r,s,i,n,o,"throw",e)}n(void 0)}))}}var N,k,E=d()("api-ts"),R=new(function(){function e(){this.backgroundQueue=[],this.priorityQueue=[],this.inProgress=[],this.backgroundChangeListener=null,this.priorityChangeListener=null,this.callbackForQueueRequest=this.callbackForQueueRequest.bind(this)}var t=e.prototype;return t.setBackgroundChangeListener=function(e){this.backgroundChangeListener=e},t.setPriorityChangeListener=function(e){this.priorityChangeListener=e},t.getPriorityQueueCount=function(){return this.priorityQueue.length},t.getBackgroundQueueCount=function(){return this.backgroundQueue.length},t.addQLApiRequest=function(e,t,a,s,i,r){void 0===r&&(r=!1);var n={url:e,type:f.POST,params:{query:t,variables:a},callback:s,associatedStateName:i};R.addApiRequest(n,r)},t.addQLMutationRequest=function(e,t,a,s,i,r){void 0===r&&(r=!1);var n={url:e,type:f.POST,params:{mutation:t,variables:a},callback:s,associatedStateName:i};R.addApiRequest(n,r)},t.addApiRequest=function(e,t){void 0===t&&(t=!1);var a=L.getUniqueId();if(E("Download Manger: Adding Queue Request "+a),E(e,200),t){var s={originalRequest:e,requestId:a,queueType:v.PRIORITY,callback:this.callbackForQueueRequest};this.priorityQueue.push(s),this.priorityChangeListener&&this.priorityChangeListener.handleEventAddToQueue()}else{var i={originalRequest:e,requestId:a,queueType:v.BACKGROUND,callback:this.callbackForQueueRequest};this.backgroundQueue.push(i),this.backgroundChangeListener&&this.backgroundChangeListener.handleEventAddToQueue()}this.processQueues()},t.processPriorityQueue=function(){var e=U(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==(t=this.priorityQueue.shift())&&this.inProgress.push(t),void 0!==t&&this.initiateFetchForQueueItem(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processBackgroundQueue=function(){var e=U(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==(t=this.backgroundQueue.shift())&&this.inProgress.push(t),void 0!==t&&this.initiateFetchForQueueItem(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processQueues=function(){var e=U(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.priorityQueue.length+this.backgroundQueue.length;case 1:if(!(t>0)){e.next=14;break}if(E("Download Manager: processing queue, items remaining "+t),!(this.priorityQueue.length>0)){e.next=8;break}return e.next=6,this.processPriorityQueue();case 6:e.next=11;break;case 8:if(!(this.backgroundQueue.length>0)){e.next=11;break}return e.next=11,this.processBackgroundQueue();case 11:t=this.priorityQueue.length+this.backgroundQueue.length,e.next=1;break;case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.callbackForQueueRequest=function(e,t,a,s){a===v.PRIORITY?this.priorityChangeListener&&this.priorityChangeListener.handleEventRemoveFromQueue():this.backgroundChangeListener&&this.backgroundChangeListener.handleEventRemoveFromQueue(),E("Download Manager: received callback for queue "+a+" request "+s+" with status "+t);var i=this.inProgress.findIndex((function(e){return e.requestId===s}));if(i>=0){var r=this.inProgress[i];this.inProgress.splice(i,1),E(r),E("Download Manager: finished for queue item "+r.requestId),r.originalRequest.callback(e,t,r.originalRequest.associatedStateName)}},t.initiateFetchForQueueItem=function(e){if(E("Download Manager: initiating fetch for queue item "+e.requestId),E(e),null!==e.originalRequest.url&&null!=e.originalRequest.params&&null!=e.originalRequest.callback)switch(e.originalRequest.type){case f.POST:y.apiFetchJSONWithPost(e);break;case f.GET:y.apiFetchJSONWithGet(e);break;case f.DELETE:y.apiFetchJSONWithDelete(e);break;case f.PUT:y.apiFetchJSONWithPut(e)}},e}()),D=R,B=d()("state-manager-api"),j=function(){function e(){this.configuration=[],this.delegate=new l("restapi"),this.emitEvents(),this.bHasCompletedRun=[],this.callbackForAddItem=this.callbackForAddItem.bind(this),this.callbackForRemoveItem=this.callbackForRemoveItem.bind(this),this.callbackForUpdateItem=this.callbackForUpdateItem.bind(this),this.callbackForGetItems=this.callbackForGetItems.bind(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.getConfiguredStateNames=function(){var e=[];return this.configuration.forEach((function(t){e.push(t.stateName)})),e},t.hasCompletedRun=function(e){var t=!1,a=this.configuration.findIndex((function(t){return t.stateName===e}));return a>=0&&(t=this.bHasCompletedRun[a]),t},t.setCompletedRun=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!0)},t.forceResetForGet=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!1)},t.initialise=function(e){this.configuration=e;var t=[];this.configuration.forEach((function(e){t.push(!1)})),this.bHasCompletedRun=t},t.getConfigurationForStateName=function(e){var t={stateName:e,serverURL:"",api:"",isActive:!1},a=this.configuration.findIndex((function(t){return t.stateName===e}));return a>=0&&(t=this.configuration[a]),t},t.callbackForRemoveItem=function(e,t,a){B("callback for remove item for state "+a+" with status "+t+" - not forwarded"),t>=200&&t<=299&&B(e)},t.callbackForUpdateItem=function(e,t,a){B("callback for update item for state "+a+" with status "+t+" - not forwarded"),t>=200&&t<=299&&B(e)},t.callbackForGetItems=function(e,t,a){B("callback for get items for state "+a+" with status "+t+" - FORWARDING"),t>=200&&t<=299&&(B(e),this.setCompletedRun(a),this.delegate.informChangeListenersForStateWithName(a,e,s.StateChanged,null))},t.callbackForAddItem=function(e,t,a){B("callback for add item for state "+a+" with status "+t+" - FORWARDING"),t>=200&&t<=299&&(B(e),this.delegate.informChangeListenersForStateWithName(a,e,s.ItemAdded,null))},t._addNewNamedStateToStorage=function(e){},t._getState=function(e){if(B("Getting All "+e),this.hasCompletedRun(e))B("Getting All "+e+" - not done - previously retrieved");else{var t=this.getConfigurationForStateName(e);if(t.isActive){var a={url:t.serverURL+t.api,type:f.GET,params:{},callback:this.callbackForGetItems,associatedStateName:e};D.addApiRequest(a,!0)}else B("No configuration for state "+e)}return{name:e,value:[]}},t._ensureStatePresent=function(e){},t._replaceNamedStateInStorage=function(e){},t._saveState=function(e,t){},t._addItemToState=function(e,t,a){if(void 0===a&&(a=!1),!a){B("Adding item to "+e),B(t);var s=this.getConfigurationForStateName(e);if(s.isActive){var i={url:s.serverURL+s.api,type:f.POST,params:t,callback:this.callbackForAddItem,associatedStateName:e};D.addApiRequest(i,!0)}else B("No configuration for state "+e)}},t._removeItemFromState=function(e,t,a,s){if(!s){B("Removing item to "+e),B(t);var i=this.getConfigurationForStateName(e);if(i.isActive){var r={url:i.serverURL+i.api,type:f.DELETE,params:{id:t.id},callback:this.callbackForRemoveItem,associatedStateName:e};D.addApiRequest(r,!0)}else B("No configuration for state "+e)}},t._updateItemInState=function(e,t,a,s){if(!s){B("Updating item in "+e),B(t);var i=this.getConfigurationForStateName(e);if(i.isActive){var r={url:i.serverURL+i.api,type:f.PUT,params:t,callback:this.callbackForUpdateItem,associatedStateName:e};D.addApiRequest(r,!0)}else B("No configuration for state "+e)}},t.addChangeListenerForName=function(e,t){this.delegate.addChangeListenerForName(e,t)},t.addNewItemToState=function(e,t,a){this._addItemToState(e,t,a)},t.emitEvents=function(){this.delegate.emitEvents()},t.findItemInState=function(e,t,a){throw Error("not implemented")},t.getStateByName=function(e){this._getState(e)},t.informChangeListenersForStateWithName=function(e,t,a,s){this.delegate.informChangeListenersForStateWithName(e,t,a,s)},t.isItemInState=function(e,t,a){return!0},t.removeItemFromState=function(e,t,a,s){return this._removeItemFromState(e,t,a,s),!0},t.setStateByName=function(e,t,a){},t.suppressEvents=function(){this.delegate.suppressEvents()},t.updateItemInState=function(e,t,a,s){return this._updateItemInState(e,t,a,s),!0},e}();!function(e){e[e.Normal=0]="Normal",e[e.High=1]="High",e[e.Urgent=2]="Urgent"}(N||(N={})),function(e){e[e.ChatRoom=0]="ChatRoom",e[e.ScoreSheet=1]="ScoreSheet"}(k||(k={}));var F=d()("socket-ts"),T=new(function(){var e=t.prototype;function t(){this.chatReceivers=[],this.callbackForMessage=this.callbackForMessage.bind(this),this.callbackForData=this.callbackForData.bind(this),this.listener=null,this.socket=null,this.chatReceivers=[],this.callbackForMessage=this.callbackForMessage.bind(this),this.callbackForLogin=this.callbackForLogin.bind(this),this.callbackForLogout=this.callbackForLogout.bind(this),this.callbackForJoinRoom=this.callbackForJoinRoom.bind(this),this.callbackForExitRoom=this.callbackForExitRoom.bind(this),this.callbackForInvite=this.callbackForInvite.bind(this),this.callbackForChat=this.callbackForChat.bind(this),this.callbackForQueue=this.callbackForQueue.bind(this),this.callbackForUserList=this.callbackForUserList.bind(this)}return e.addChatReceiver=function(e){this.chatReceivers.push(e)},e.callbackForMessage=function(e){F("Received message : "+e);try{F(e);var t=JSON.parse(e);this.chatReceivers.forEach((function(e){return e.receiveMessage(t)}))}catch(e){F(e),F("Not JSON data")}},e.callbackForLogin=function(e){F("Received login : "+e),this.chatReceivers.forEach((function(t){return t.receiveLogin(e)}))},e.callbackForUserList=function(e){F("Received user list : "+e),this.chatReceivers.forEach((function(t){return t.receiveUserList(e)}))},e.callbackForLogout=function(e){F("Received logout : "+e),this.chatReceivers.forEach((function(t){return t.receiveLogout(e)}))},e.callbackForJoinRoom=function(e){F("Received joined room : "+e);try{var t=JSON.parse(e);F(t),this.chatReceivers.forEach((function(e){return e.receiveJoinedRoom(t)}))}catch(e){F("Not JSON data")}},e.callbackForExitRoom=function(e){F("Received left room : "+e);try{var t=JSON.parse(e);F(t),this.chatReceivers.forEach((function(e){return e.receivedLeftRoom(t)}))}catch(e){F("Not JSON data")}},e.callbackForInvite=function(e){F("Received invite : "+e);try{var t=JSON.parse(e);F(t),this.chatReceivers.forEach((function(e){return e.receiveInvitation(t)}))}catch(e){F("Not JSON data")}},e.callbackForDeclineInvite=function(e){F("Received declined invite : "+e);try{var t=JSON.parse(e);F(t),this.chatReceivers.forEach((function(e){return e.receiveDecline(t.room,t.username,t.type)}))}catch(e){F(e),F("Not JSON data")}},e.callbackForChat=function(e){F("Received chat : "+e);try{var t=JSON.parse(e);F(t),this.chatReceivers.forEach((function(e){return e.receiveMessage(t)}))}catch(e){F("Not JSON data")}},e.callbackForQueue=function(e){F("Received queued items : "+e);try{var t=JSON.parse(e);F(t),t.invites&&t.invites.length>0&&this.chatReceivers.forEach((function(e){return e.receiveQueuedInvites(t.invites)})),t.messages&&t.messages.length>0&&this.chatReceivers.forEach((function(e){return e.receiveQueuedMessages(t.messages)}))}catch(e){F("Not JSON data")}},e.callbackForData=function(e){F("Received data");try{var t=JSON.parse(e);if(F(t),null===this.listener)return;t.user===this.listener.getCurrentUser()?F("change made by this user, ignoring"):(F("change made by another user, passing off to the application"),this.listener.handleDataChangedByAnotherUser(t))}catch(e){F("Not JSON data")}},e.setListener=function(e){F("Setting listener"),this.listener=e,F("Creating socket connection"),this.socket=io(),F("Waiting for messages"),this.socket.on("message",this.callbackForMessage),this.socket.on("data",this.callbackForData),this.socket.on("login",this.callbackForLogin),this.socket.on("logout",this.callbackForLogout),this.socket.on("joinroom",this.callbackForJoinRoom),this.socket.on("exitroom",this.callbackForExitRoom),this.socket.on("invite",this.callbackForInvite),this.socket.on("declineinvite",this.callbackForDeclineInvite),this.socket.on("chat",this.callbackForChat),this.socket.on("queue",this.callbackForQueue),this.socket.on("userlist",this.callbackForUserList)},e.login=function(e){this.socket.emit("login",{username:e})},e.logout=function(e){this.socket.emit("logout",{username:e})},e.joinChat=function(e,t,a){this.socket.emit("joinroom",{username:e,room:t,type:a})},e.leaveChat=function(e,t,a){this.socket.emit("exitroom",{username:e,room:t,type:a})},e.sendInvite=function(e,t,a,s,i,r,n){void 0===s&&(s=k.ChatRoom),void 0===i&&(i=!1),void 0===r&&(r=""),void 0===n&&(n={});var o={from:e,to:t,room:a,type:s,requiresAcceptDecline:i,subject:r,attachment:n};F("Sending invite"),F(o),this.socket.emit("invite",o)},e.sendMessage=function(e,t,a,s,i,r,n){void 0===r&&(r=N.Normal),void 0===n&&(n={});var o={from:e,room:t,message:a,created:s,priority:r,type:i,attachment:n};this.socket.emit("chat",o)},e.getUserList=function(){this.socket.emit("userlist")},e.sendDeclineInvite=function(e,t,a){this.socket.emit("declineinvite",{room:e,from:t,type:a})},t}());function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var A=d()("state-manager-async"),x=function(e){var t,a;function s(t,a){var s;(s=e.call(this,"async")||this).topLevelSM=t,s.wrappedSM=a,s.forceSaves=!1,s.wrappedSM.emitEvents();var i=s.wrappedSM.getConfiguredStateNames();return s.stateChanged=s.stateChanged.bind(M(s)),s.stateChangedItemAdded=s.stateChangedItemAdded.bind(M(s)),s.stateChangedItemRemoved=s.stateChangedItemRemoved.bind(M(s)),s.stateChangedItemUpdated=s.stateChangedItemUpdated.bind(M(s)),i.forEach((function(e){s.wrappedSM.addChangeListenerForName(e,M(s))})),s}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,G(t,a);var i=s.prototype;return i._addItemToState=function(e,t,a){void 0===a&&(a=!1),A("adding item to state "+e+" - is persisted "+a),this.wrappedSM.addNewItemToState(e,t,a)},i._getState=function(e){return A("getting state "+e),this.wrappedSM.getStateByName(e),{name:e,value:[]}},i._removeItemFromState=function(e,t,a,s){A("removing item from state "+e),this.wrappedSM.removeItemFromState(e,t,a,s)},i._updateItemInState=function(e,t,a,s){A("updating item in state "+e),this.wrappedSM.updateItemInState(e,t,a,s)},i._ensureStatePresent=function(e){},i._addNewNamedStateToStorage=function(e){},i._replaceNamedStateInStorage=function(e){},i._saveState=function(e,t){},i.stateChangedItemRemoved=function(e,t,a){},i.stateChangedItemUpdated=function(e,t,a,s){},i.stateChanged=function(e,t,a){A("Wrapped SM has supplied new state "+t+" passing to top level SM"),A(a),this.topLevelSM.setStateByName(t,a)},i.stateChangedItemAdded=function(e,t,a){A("Wrapped SM has supplied new completed item for state "+t+" passing to top level SM"),this.topLevelSM.addNewItemToState(t,a,!0)},s}(m);function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=d()("state-manager-aggregate"),P=function(e){var t,a;function s(){var t;return(t=e.call(this,"aggregate")||this).stateManagers=[],t.emitEvents(),t}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,O(t,a),s.getInstance=function(){return s._instance||(s._instance=new s),s._instance};var i=s.prototype;return i.addStateManager=function(e,t,a){void 0===t&&(t=[]);var s={manager:e,filters:t};this.stateManagers.push(s),a||e.suppressEvents(),_("adding state manager with/without filters")},i.stateNameInFilters=function(e,t){return t.findIndex((function(t){return t===e}))>=0},i._addNewNamedStateToStorage=function(e){var t=this;this.stateManagers.forEach((function(a){t.stateNameInFilters(e.name,a.filters)||a.manager._addNewNamedStateToStorage(e)}))},i._getState=function(e){var t=this,a={name:e,value:[]};return this.stateManagers.forEach((function(s){t.stateNameInFilters(a.name,s.filters)||(_("get state from state manager for state "+e),_(s.manager),s.manager._getState(e))})),this.stateManagers.length>0&&(a=this.stateManagers[0].manager._getState(e)),a},i._ensureStatePresent=function(e){var t=this;this.stateManagers.forEach((function(a){t.stateNameInFilters(e,a.filters)||a.manager._ensureStatePresent(e)}))},i._replaceNamedStateInStorage=function(e){var t=this;this.stateManagers.forEach((function(a){t.stateNameInFilters(e.name,a.filters)||a.manager._replaceNamedStateInStorage(e)}))},i._saveState=function(e,t){var a=this;this.stateManagers.forEach((function(s){a.stateNameInFilters(e,s.filters)||(_("saving state in state manager for state "+e),_(s.manager),_(t),s.manager._saveState(e,t))}))},i._addItemToState=function(e,t,a){var s=this;void 0===a&&(a=!1),this.stateManagers.forEach((function(i){s.stateNameInFilters(e,i.filters)||(_("adding item to state in  state manager for state "+e+", is persisted = "+a),_(i.manager),_(t),i.manager._addItemToState(e,t,a))}))},i._removeItemFromState=function(e,t,a,s){var i=this;this.stateManagers.forEach((function(r){i.stateNameInFilters(e,r.filters)||(_("removing item from state in state manager for state "+e),_(r.manager),_(t),r.manager._removeItemFromState(e,t,a,s))}))},i._updateItemInState=function(e,t,a,s){var i=this;this.stateManagers.forEach((function(r){i.stateNameInFilters(e,r.filters)||(_("updating item in state in  state manager for state "+e),_(r.manager),_(t),r.manager._updateItemInState(e,t,a,s))}))},s}(m);function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var H=function(e){var t,a;function s(t){return e.call(this,t)||this}return a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,V(t,a),s.prototype.show=function(e,t,a,s,i){var r=this;void 0===a&&(a=0),void 0===s&&(s="info"),void 0===i&&(i=3e3);var n=this.notificationManager.getContainerId(),o="";switch(s){case"info":o="bg-info";break;case"warning":o="bg-warning";break;case"message":o="bg-primary";break;case"priority":o="bg-danger";break;default:o="bg-info"}var c=document.createElement("div");c.className="notification toast",c.style.top=a+"px",c.setAttribute("role","alert"),c.setAttribute("data-autohide","false");var d=document.createElement("div");d.className="toast-header text-white "+o;var h=document.createElement("strong");h.className="mr-auto",h.textContent=e;var l=document.createElement("button");l.className="ml-2 mb-1 close",l.textContent="x",l.addEventListener("click",(function(){r.notificationManager.remove(c)}));var u=document.createElement("div");u.className="toast-body",u.textContent=t,d.appendChild(h),d.appendChild(l),c.appendChild(d),c.appendChild(u),c.classList.add("is-"+s);var m=document.getElementById(n);return m&&m.appendChild(c),$(".notification").toast("show"),i<=0&&(i=2e3),setTimeout((function(){r.notificationManager.remove(c)}),i),c},s}((function(e){this.show=this.show.bind(this),this.notificationManager=e,this.containerId=this.notificationManager.getContainerId()})),q=new(function(){function e(){}return e.prototype.createNotification=function(e){return new H(e)},e}()),Q=new(function(){function e(){this.notifications=[],this.currentCount=0,this.offsetPerNotification=120,this.containerId="notifications",this.show=this.show.bind(this)}var t=e.prototype;return t.getContainerId=function(){return this.containerId},t.show=function(e,t,a,s){void 0===a&&(a="info"),void 0===s&&(s=5e3);var i=q.createNotification(this).show(e,t,this.currentCount*this.offsetPerNotification,a,s);this.currentCount++,this.notifications.push(i)},t.remove=function(e){var t=this,a=this.notifications.findIndex((function(t){return t===e}));a>=0&&(this.notifications.splice(a,1),this.notifications.map((function(e,a){e.style.top=t.offsetPerNotification*a+"px"})));var s=e.parentElement;null!==s&&s.removeChild(e),this.currentCount--,this.currentCount<0&&(this.currentCount=0)},e}());function Y(e,t){return e.id===t.id}function J(e,t){return e.username===t.username}function W(e,t){return e.gameId===t.gameId}var K=d()("socket-listener"),z=function(){function e(e){this.config=e}var t=e.prototype;return t.handleDataChangedByAnotherUser=function(e){K("Handling data change "+e.type+" on object type "+e.stateName+" made by user "+e.user);var t=be.getStateManager().findItemInState(this.config.stateNames.users,{id:e.user},Y),a="unknown";t&&(a=t.username),K("Handling data change "+e.type+" on object type "+e.stateName+" made by user "+a);var s=e.data;K(s);try{switch(e.type){case"create":switch(e.stateName){case this.config.stateNames.comments:be.getStateManager().addNewItemToState(this.config.stateNames.comments,s,!0);var i=be.getStateManager().findItemInState(this.config.stateNames.entries,{id:s.commentOn},Y);i&&Q.show(i.title,a+" added comment "+s.content);break;case this.config.stateNames.entries:be.getStateManager().addNewItemToState(this.config.stateNames.entries,s,!0),Q.show(s.title,a+" added new entry");break;case this.config.stateNames.users:be.getStateManager().addNewItemToState(this.config.stateNames.users,s,!0),Q.show(s.username,s.username+" has just registered.","message")}break;case"update":switch(e.stateName){case this.config.stateNames.entries:be.getStateManager().updateItemInState(this.config.stateNames.entries,s,Y,!0)}break;case"delete":switch(e.stateName){case this.config.stateNames.comments:be.getStateManager().removeItemFromState(this.config.stateNames.comments,s,Y,!0);break;case this.config.stateNames.entries:var r=be.getStateManager().findItemInState(this.config.stateNames.entries,s,Y);be.getStateManager().removeItemFromState(this.config.stateNames.entries,s,Y,!0),Q.show(r.title,a+" has deleted this entry.","priority")}}}catch(e){K(e)}},t.handleMessage=function(e){K("Received message: "+e)},t.getCurrentUser=function(){return be.getLoggedInUserId()},e}(),Z=a(7),X=a.n(Z);function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var te,ae=d()("local-storage"),se=function(e){var t,a;function s(t){var a;return void 0===t&&(t=!1),(a=e.call(this,"browser")||this).configuration=[],a.storage=window.sessionStorage,t&&(a.storage=window.localStorage),a.forceSaves=!0,a}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,ee(t,a),s.getInstance=function(e){return void 0===e&&(e=!1),s._instance||(s._instance=new s(e)),s._instance};var i=s.prototype;return i._ensureStatePresent=function(e){null===this.storage.getItem(e)&&this._addNewNamedStateToStorage({name:e,value:[]})},i._addNewNamedStateToStorage=function(e){ae("Local Storage: Saving with key "+e.name),ae(e);var t=JSON.stringify(e.value);ae(t),this.storage.setItem(e.name,t)},i._replaceNamedStateInStorage=function(e){this._addNewNamedStateToStorage(e)},i._getState=function(e){var t=[];ae("Local Storage: Loading with key "+e);var a=this.storage.getItem(e);return ae(a),null!==a&&(t=JSON.parse(a)),{name:e,value:t}},i._saveState=function(e,t){this._addNewNamedStateToStorage({name:e,value:t})},i._addItemToState=function(e,t,a){if(void 0===a&&(a=!1),a){var s=this._getState(e);ae("adding item to state "+e),ae(t),s.value.push(t),this._replaceNamedStateInStorage(s)}},i._removeItemFromState=function(e,t,a,s){var i=this._getState(e),r=i.value.findIndex((function(e){return a(e,t)}));r>=0&&(ae("removing item from state "+e),ae(t),i.value.splice(r,1)),this._replaceNamedStateInStorage(i)},i._updateItemInState=function(e,t,a,s){var i=this._getState(e),r=i.value.findIndex((function(e){return a(e,t)}));r>=0&&(i.value.splice(r,1,t),ae("updating item in state "+e),ae(t)),this._replaceNamedStateInStorage(i)},i.forceResetForGet=function(e){},i.getConfiguredStateNames=function(){return this.configuration},i.hasCompletedRun=function(e){return!1},i.initialise=function(e){this.configuration=e},s}(m);!function(e){e[e.LoggedOut=0]="LoggedOut",e[e.LoggedIn=1]="LoggedIn"}(te||(te={}));var ie=d()("chat-manager"),re=function(){t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var e=t.prototype;function t(){this.currentUsername="",this.blockedList=[],this.favouriteList=[],this.loggedInUsers=[],ie("Setting up chat logs, blocked list, and favourites"),this.chatLogs=[],this.chatListeners=[],this.chatUserListeners=[],this.localStorage=new se(!0),T.addChatReceiver(this),this.receiveLogin=this.receiveLogin.bind(this),this.receiveLogout=this.receiveLogout.bind(this),this.receiveInvitation=this.receiveInvitation.bind(this),this.receiveMessage=this.receiveMessage.bind(this),this.receiveQueuedMessages=this.receiveQueuedMessages.bind(this),this.receiveQueuedInvites=this.receiveQueuedInvites.bind(this),this.receiveJoinedRoom=this.receiveJoinedRoom.bind(this),this.receivedLeftRoom=this.receivedLeftRoom.bind(this)}return e.addChatEventHandler=function(e){this.chatListeners.push(e)},e.addChatUserEventHandler=function(e){this.chatUserListeners.push(e)},e.isUserLoggedIn=function(e){return this.loggedInUsers.findIndex((function(t){return t===e}))>=0},e.receiveUserList=function(e){this.loggedInUsers=e,this.chatUserListeners.forEach((function(t){return t.handleLoggedInUsersUpdated(e)}))},e.saveLogs=function(){this.localStorage.setStateByName(t.chatLogKey+this.currentUsername,this.chatLogs,!1)},e.saveBlockedList=function(){this.localStorage.setStateByName(t.blockedListKey+this.currentUsername,this.blockedList,!1)},e.saveFavouriteList=function(){this.localStorage.setStateByName(t.favouriteListKey+this.currentUsername,this.favouriteList,!1)},e.addUserToBlockedList=function(e){var t=this;this.blockedList.findIndex((function(t){return t===e}))<0&&(this.blockedList.push(e),this.saveBlockedList(),this.chatUserListeners.forEach((function(e){return e.handleBlockedUsersChanged(t.favouriteList)})))},e.removeUserFromBlockedList=function(e){var t=this,a=this.blockedList.findIndex((function(t){return t===e}));a>=0&&(this.blockedList.splice(a,1),this.saveBlockedList(),this.chatUserListeners.forEach((function(e){return e.handleBlockedUsersChanged(t.favouriteList)})))},e.isUserInBlockedList=function(e){return this.blockedList.findIndex((function(t){return t===e}))>=0},e.addUserToFavouriteList=function(e){var t=this;this.favouriteList.findIndex((function(t){return t===e}))<0&&(this.favouriteList.push(e),this.saveFavouriteList(),this.chatUserListeners.forEach((function(e){return e.handleFavouriteUsersChanged(t.favouriteList)})))},e.removeUserFromFavouriteList=function(e){var t=this,a=this.favouriteList.findIndex((function(t){return t===e}));a>=0&&(this.favouriteList.splice(a,1),this.saveFavouriteList(),this.chatUserListeners.forEach((function(e){return e.handleFavouriteUsersChanged(t.favouriteList)})))},e.isUserInFavouriteList=function(e){return this.favouriteList.findIndex((function(t){return t===e}))>=0},e.getFavouriteUserList=function(){return[].concat(this.favouriteList)},e.getBlockedUserList=function(){return[].concat(this.blockedList)},e.setCurrentUser=function(e){ie("Setting current user "+e),this.currentUsername=e;var a=this.localStorage.getStateByName(t.chatLogKey+this.currentUsername);ie(a),a&&(this.chatLogs=a);var s=this.localStorage.getStateByName(t.blockedListKey+this.currentUsername);ie(s),s&&(this.blockedList=s);var i=this.localStorage.getStateByName(t.favouriteListKey+this.currentUsername);ie(i),i&&(this.favouriteList=i),this.chatListeners.forEach((function(e){return e.handleChatLogsUpdated()}))},e.getCurrentUser=function(){return this.currentUsername},e.ensureChatLogExists=function(e){var t,a=this.chatLogs.findIndex((function(t){return t.roomName===e}));return a<0?(t={roomName:e,users:[this.getCurrentUser()],messages:[],lastViewed:parseInt(X()().format("YYYYMMDDHHmmss")),numOfNewMessages:0,type:k.ChatRoom},this.chatLogs.push(t),this.saveLogs()):t=this.chatLogs[a],t},e.ensureChatLogExistsWithUser=function(e){for(var t=null,a=0;a<this.chatLogs.length;){var s=this.chatLogs[a];2===s.users.length&&s.users.findIndex((function(t){return t===e}))>=0&&(t=s,a=this.chatLogs.length),a++}return t||(t={roomName:L.getUniqueId(),users:[this.getCurrentUser(),e],messages:[],lastViewed:parseInt(X()().format("YYYYMMDDHHmmss")),numOfNewMessages:0,type:k.ChatRoom},this.chatLogs.push(t),this.saveLogs()),t},e.receiveJoinedRoom=function(e){if(e.type===k.ChatRoom){var t=this.ensureChatLogExists(e.room);ie("User list for room "+e.room+" - "+e.userList.join(",")),t.users=e.userList;var a=parseInt(X()().format("YYYYMMDDHHmmss")),s=X()().format("DD/MM/YYYY HH:mm"),i={from:"",created:a,room:e.room,priority:0,type:k.ChatRoom,message:e.username+" joined the chat on "+s};t.messages.push(i),this.saveLogs(),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(t,!1)}))}},e.receivedLeftRoom=function(e){if(e.type===k.ChatRoom&&e.username!==this.currentUsername){var t=this.ensureChatLogExists(e.room);ie("User list for room "+e.room+" - "+e.userList.join(",")),t.users=e.userList;var a=parseInt(X()().format("YYYYMMDDHHmmss")),s=X()().format("DD/MM/YYYY HH:mm"),i={from:"",created:a,room:e.room,priority:0,type:k.ChatRoom,message:e.username+" left the chat on "+s};t.messages.push(i),this.saveLogs(),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(t,!1)}))}},e.doesChatRoomExist=function(e){return this.chatLogs.findIndex((function(t){return t.roomName===e}))>=0},e.receiveInvitation=function(e){if(e.type===k.ChatRoom)if(this.isUserInBlockedList(e.from))ie("User "+e.from+" blocked");else{ie("Invited to chat "+e.room);var t=this.doesChatRoomExist(e.room);ie(e),ie("Letting the listeners know, if they are all happy to accept then we will join the room");var a=!0;if(t||this.chatListeners.forEach((function(t){t.handleNewInviteReceived(e)||(a=!1)})),a){var s=this.ensureChatLogExists(e.room);s.type=e.type,e.userList&&e.userList.forEach((function(t){s.users.findIndex((function(e){return e===t}))<0&&s.users.push(e.from)})),s.users.findIndex((function(t){return t===e.from}))<0&&s.users.push(e.from),this.saveLogs(),ie("Joining chat "+e.room),T.joinChat(this.getCurrentUser(),e.room,k.ChatRoom),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(s,!1)}))}}},e.receiveLogin=function(e){var t=this;ie("Handle login received for "+e),this.loggedInUsers.findIndex((function(t){return t===e}))<0&&this.loggedInUsers.push(e),ie(this.loggedInUsers),this.chatUserListeners.forEach((function(e){return e.handleLoggedInUsersUpdated(t.loggedInUsers)})),!this.isUserInBlockedList(e)&&this.isUserInFavouriteList(e)&&(ie("User "+e+" logging in"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedIn(e)})))},e.receiveLogout=function(e){var t=this,a=this.loggedInUsers.findIndex((function(t){return t===e}));a>=0&&this.loggedInUsers.splice(a,1),this.chatUserListeners.forEach((function(e){return e.handleLoggedInUsersUpdated(t.loggedInUsers)})),!this.isUserInBlockedList(e)&&this.isUserInFavouriteList(e)&&(ie("User "+e+" logging out"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedOut(e)})))},e.receiveDecline=function(e,t,a){a===k.ChatRoom&&t!==this.currentUsername&&(this.isUserInBlockedList(t)||(ie("User "+t+" declined invitation to room"),this.chatListeners.forEach((function(a){return a.handleInvitationDeclined(e,t)}))))},e.addMessageToChatLog=function(e,t){e.numOfNewMessages++,e.messages.push(t),t.from===this.getCurrentUser()?this.touchChatLog(e.roomName):this.saveLogs()},e.touchChatLog=function(e){var t=this.ensureChatLogExists(e);t.numOfNewMessages=0,t.lastViewed=parseInt(X()().format("YYYYMMDDHHmmss")),this.saveLogs()},e.getChatLog=function(e){var t=null,a=this.chatLogs.findIndex((function(t){return t.roomName===e}));return a>=0&&(t=this.chatLogs[a]),t},e.addSenderToRoomIfNotAlreadyPresent=function(e,t){e.users.findIndex((function(e){return e===t}))<0&&e.users.push(t)},e.receiveMessage=function(e,t){if(void 0===t&&(t=!1),e.type===k.ChatRoom&&e.from!==this.getCurrentUser())if(this.isUserInBlockedList(e.from))ie("Message received from user "+e.from+" - is in blocked list, not passed on.");else{var a=this.ensureChatLogExists(e.room);this.addSenderToRoomIfNotAlreadyPresent(a,e.from),this.addMessageToChatLog(a,e),ie("Message received"),ie(e),this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(a,t)}))}},e.receiveQueuedInvites=function(e){var t=this;e.forEach((function(e){t.receiveInvitation(e)}))},e.receiveQueuedMessages=function(e){var t=this;e.forEach((function(e){t.receiveMessage(e,!0)})),this.chatListeners.forEach((function(t){return t.handleOfflineMessagesReceived(e)}))},e.joinChat=function(e){0!==this.getCurrentUser().trim().length&&(this.ensureChatLogExists(e),T.joinChat(this.getCurrentUser(),e,k.ChatRoom))},e.removeChatLog=function(e){var t=this.chatLogs.findIndex((function(t){return t.roomName===e}));if(t>=0){ie("Removing Chat log for room "+e);var a=this.chatLogs.splice(t,1);ie(a.length),this.saveLogs()}},e.leaveChat=function(e){0!==this.getCurrentUser().trim().length&&(this.removeChatLog(e),T.leaveChat(this.getCurrentUser(),e,k.ChatRoom))},e.login=function(){var e=this;0!==this.getCurrentUser().trim().length&&(T.login(this.getCurrentUser()),T.getUserList(),this.chatLogs.forEach((function(t){T.joinChat(e.currentUsername,t.roomName,k.ChatRoom)})))},e.logout=function(){0!==this.getCurrentUser().trim().length&&T.logout(this.getCurrentUser())},e.declineInvite=function(e){0!==this.getCurrentUser().trim().length&&T.sendDeclineInvite(e,this.getCurrentUser(),k.ChatRoom)},e.sendInvite=function(e,t,a,s,i){(void 0===a&&(a=k.ChatRoom),void 0===s&&(s=!1),void 0===i&&(i=""),0!==this.getCurrentUser().trim().length)&&(this.isUserInBlockedList(e)||this.ensureChatLogExists(t).users.findIndex((function(t){return t===e}))<0&&T.sendInvite(this.getCurrentUser(),e,t,a,s,i))},e.sendMessage=function(e,t,a,s){if(void 0===a&&(a=N.Normal),0===this.getCurrentUser().trim().length)return null;var i=this.ensureChatLogExists(e),r=parseInt(X()().format("YYYYMMDDHHmmss"));T.sendMessage(this.getCurrentUser(),e,t,r,k.ChatRoom,N.Normal,{}),s||(s={});var n={from:this.getCurrentUser(),room:e,message:t,created:r,priority:a,type:k.ChatRoom,attachment:s};return this.addMessageToChatLog(i,n),n},e.getChatLogs=function(){return[].concat(this.chatLogs)},e.startChatWithUser=function(e){if(e){ie("Starting chat with "+e);var t=this.ensureChatLogExistsWithUser(e);this.chatListeners.forEach((function(e){return e.handleChatLogUpdated(t,!1)})),T.sendInvite(this.getCurrentUser(),e,t.roomName,k.ChatRoom,!1,""),T.joinChat(this.getCurrentUser(),t.roomName,k.ChatRoom)}},t}();re.chatLogKey="im-board-chat-logs",re.blockedListKey="im-board-blocked-list",re.favouriteListKey="im-board-favourite-list";var ne,oe=d()("notification-controller"),ce=function(){function e(){this.doNotDisturb=!1,this.chatManager=re.getInstance(),this.doNotDisturb=!1,this.chatListeners=[],this.chatUserListeners=[],this.handleChatLogUpdated=this.handleChatLogUpdated.bind(this),this.handleLoggedInUsersUpdated=this.handleLoggedInUsersUpdated.bind(this),this.handleFavouriteUserLoggedIn=this.handleFavouriteUserLoggedIn.bind(this),this.handleFavouriteUserLoggedOut=this.handleFavouriteUserLoggedOut.bind(this),this.chatManager.addChatEventHandler(this),this.chatManager.addChatUserEventHandler(this)}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.handleInvitationDeclined=function(e,t){this.doNotDisturb||Q.show("Room","User "+t+" has declined the invitation to join you.","info",7e3)},t.handleNewInviteReceived=function(e){var t=!0;return e.type===k.ScoreSheet||(this.doNotDisturb&&!e.requiresAcceptDecline||(e.requiresAcceptDecline?t=be.askUserAboutInvitation(e):Q.show("Chat Room","User "+e.from+" has invited you.","info",7e3)),t)},t.addListener=function(e){this.chatListeners.push(e)},t.addUserListener=function(e){this.chatUserListeners.push(e)},t.setDoNotDisturb=function(e){void 0===e&&(e=!0),this.doNotDisturb=e},t.blackListUser=function(e,t){void 0===t&&(t=!0),t?this.chatManager.addUserToBlockedList(e):this.chatManager.removeUserFromBlockedList(e)},t.favouriteUser=function(e,t){void 0===t&&(t=!0),t?this.chatManager.addUserToFavouriteList(e):this.chatManager.removeUserFromFavouriteList(e)},t.isFavouriteUser=function(e){return this.chatManager.isUserInFavouriteList(e)},t.isBlockedUser=function(e){return this.chatManager.isUserInBlockedList(e)},t.handleChatLogsUpdated=function(){this.chatListeners.forEach((function(e){return e.handleChatLogsUpdated()}))},t.handleChatLogUpdated=function(e,t){if(void 0===t&&(t=!1),oe("Handle chat log updated"),oe(e),this.chatListeners.forEach((function(a){return a.handleChatLogUpdated(e,t)})),!this.doNotDisturb&&!t&&e.messages.length>0){var a=e.messages[e.messages.length-1];Q.show(a.from,a.message,"message",3e3)}},t.handleLoggedInUsersUpdated=function(e){oe("Handle logged in users updated"),oe(e),this.chatUserListeners.forEach((function(t){return t.handleLoggedInUsersUpdated(e)}))},t.handleFavouriteUserLoggedIn=function(e){oe("Handle favourite user "+e+" logged in"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedIn(e)})),this.doNotDisturb||Q.show(e,"User "+e+" has logged in.","warning",5e3)},t.handleFavouriteUserLoggedOut=function(e){oe("Handle favourite user "+e+" logged out"),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUserLoggedOut(e)})),this.doNotDisturb||Q.show(e,"User "+e+" has logged out.","priority",4e3)},t.handleBlockedUsersChanged=function(e){oe("Handle blocked users changed to "+e),this.chatUserListeners.forEach((function(t){return t.handleBlockedUsersChanged(e)}))},t.handleFavouriteUsersChanged=function(e){oe("Handle favourite users changed to "+e),this.chatUserListeners.forEach((function(t){return t.handleFavouriteUsersChanged(e)}))},t.startChatWithUser=function(e){re.getInstance().startChatWithUser(e)},t.handleChatStarted=function(e){this.chatListeners.forEach((function(t){return t.handleChatStarted(e)}))},t.handleOfflineMessagesReceived=function(e){this.doNotDisturb||0!==e.length&&Q.show("Offline messages received","You have received "+e.length+" messages since you last logged out.")},e}(),de=d()("state-manager-graphql"),he=function(){function e(){this.configuration=[],this.delegate=new l("graphql"),this.emitEvents(),this.bHasCompletedRun=[],this.callbackForAddItem=this.callbackForAddItem.bind(this),this.callbackForRemoveItem=this.callbackForRemoveItem.bind(this),this.callbackForUpdateItem=this.callbackForUpdateItem.bind(this),this.callbackForGetItems=this.callbackForGetItems.bind(this)}var t=e.prototype;return t.getConfiguredStateNames=function(){var e=[];return this.configuration.forEach((function(t){e.push(t.stateName)})),e},t.hasCompletedRun=function(e){var t=!1,a=this.configuration.findIndex((function(t){return t.stateName===e}));return a>=0&&(t=this.bHasCompletedRun[a]),t},t.setCompletedRun=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!0)},t.forceResetForGet=function(e){var t=this.configuration.findIndex((function(t){return t.stateName===e}));t>=0&&(this.bHasCompletedRun[t]=!1)},t.initialise=function(e){this.configuration=e;var t=[];this.configuration.forEach((function(e){t.push(!1)})),this.bHasCompletedRun=t},t.getConfigurationForStateName=function(e){var t={stateName:e,apiURL:"/graphql",apis:{findAll:"",create:"",destroy:"",update:"",find:""},data:{findAll:"",create:"",destroy:"",update:"",find:""},isActive:!1},a=this.configuration.findIndex((function(t){return t.stateName===e}));return a>=0&&(t=this.configuration[a]),t},t.callbackForRemoveItem=function(e,t,a){de("callback for remove item for state "+a+" with status "+t+" - not forwarded"),t>=200&&t<=299&&de(e)},t.callbackForUpdateItem=function(e,t,a){de("callback for update item for state "+a+" with status "+t+" - not forwarded"),t>=200&&t<=299&&de(e)},t.callbackForGetItems=function(e,t,a){if(de("callback for get items for state "+a+" with status "+t+" - FORWARDING"),t>=200&&t<=299){de(e);var i=this.getConfigurationForStateName(a).data.findAll;this.setCompletedRun(a),this.delegate.informChangeListenersForStateWithName(a,e.data[i],s.StateChanged,null)}},t.callbackForAddItem=function(e,t,a){de("callback for add item for state "+a+" with status "+t+" - FORWARDING"),t>=200&&t<=299&&(de(e),this.delegate.informChangeListenersForStateWithName(a,e,s.ItemAdded,null))},t._addNewNamedStateToStorage=function(e){},t._getState=function(e){if(de("Getting All "+e),this.hasCompletedRun(e))de("Getting All "+e+" - not done - previously retrieved");else{var t=this.getConfigurationForStateName(e);if(t.isActive){var a=t.apis.findAll,s={url:t.apiURL,type:f.POST,params:{query:a},callback:this.callbackForGetItems,associatedStateName:e};de("Getting All "+e+' with query "'+a+'"'),D.addApiRequest(s,!0)}else de("No configuration for state "+e)}return{name:e,value:[]}},t._ensureStatePresent=function(e){},t._replaceNamedStateInStorage=function(e){},t._saveState=function(e,t){},t._addItemToState=function(e,t,a){if(void 0===a&&(a=!1),!a){de("Adding item to "+e),de(t);var s=this.getConfigurationForStateName(e);if(s.isActive){var i={};i[s.apis.create]={};var r={url:s.apiURL,type:f.POST,params:{mutation:i},callback:this.callbackForAddItem,associatedStateName:e};D.addApiRequest(r,!0)}else de("No configuration for state "+e)}},t._removeItemFromState=function(e,t,a,s){if(!s){de("Removing item to "+e),de(t);var i=this.getConfigurationForStateName(e);if(i.isActive){var r={};r[i.apis.destroy]={};var n={url:i.apiURL,type:f.POST,params:{mutation:r},callback:this.callbackForRemoveItem,associatedStateName:e};D.addApiRequest(n,!0)}else de("No configuration for state "+e)}},t._updateItemInState=function(e,t,a,s){if(!s){de("Updating item in "+e),de(t);var i=this.getConfigurationForStateName(e);if(i.isActive){var r={};r[i.apis.destroy]={};var n={url:i.apiURL,type:f.POST,params:{mutation:r},callback:this.callbackForUpdateItem,associatedStateName:e};D.addApiRequest(n,!0)}else de("No configuration for state "+e)}},t.addChangeListenerForName=function(e,t){this.delegate.addChangeListenerForName(e,t)},t.addNewItemToState=function(e,t,a){this._addItemToState(e,t,a)},t.emitEvents=function(){this.delegate.emitEvents()},t.findItemInState=function(e,t,a){throw Error("not implemented")},t.getStateByName=function(e){this._getState(e)},t.informChangeListenersForStateWithName=function(e,t,a,s){this.delegate.informChangeListenersForStateWithName(e,t,a,s)},t.isItemInState=function(e,t,a){return!0},t.removeItemFromState=function(e,t,a,s){return this._removeItemFromState(e,t,a,s),!0},t.setStateByName=function(e,t,a){},t.suppressEvents=function(){this.delegate.suppressEvents()},t.updateItemInState=function(e,t,a,s){return this._updateItemInState(e,t,a,s),!0},e}();!function(e){e[e.Incomplete=0]="Incomplete",e[e.Complete=1]="Complete",e[e.Persisted=2]="Persisted",e[e.PersistedLocally=3]="PersistedLocally"}(ne||(ne={}));var le=a(440),ue=new(function(){function e(){}var t=e.prototype;return t.scrollSmoothToId=function(e){var t=document.getElementById(e);null!==t&&t.scrollIntoView({block:"start",behavior:"smooth"})},t.scrollToBottomNow=function(e){e&&(e.scrollTop=e.scrollHeight-e.clientHeight+100)},t.scrollToBottomSmooth=function(e){e&&(e.scrollIntoView({behavior:"smooth"}),e.scrollTop=e.scrollHeight-e.clientHeight+100)},t.scrollSmoothTo=function(e){e.scrollIntoView({block:"start",behavior:"smooth"})},t.scrollTo=function(e){e.scrollIntoView({block:"start"})},t.removeAllChildren=function(e){if(e&&e.firstChild)for(;e.firstChild;){var t=e.lastChild;t&&e.removeChild(t)}},t.addRemoveClasses=function(e,t,a){void 0===a&&(a=!0),t.split(" ").forEach((function(t){t.trim().length>0&&(a?e.classList.add(t):e.classList.remove(t))}))},t.addAttributes=function(e,t){t&&t.forEach((function(t){e.setAttribute(t[0],t[1])}))},e}()),me=d()("score-sheet-view"),ge=function(){function e(){this.applicationView=null,this.thisEl=null,this.boardGameTitleEl=null,this.startStopTimer=null,this.timerEl=null,this.endOrLeaveEl=null,this.scoreSheetEl=null,this.table=null,this.controller=ve.getInstance()}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.onDocumentLoaded=function(e){this.applicationView=e,this.resetDisplay(),ve.getInstance().getStateManager().addChangeListenerForName(this.applicationView.state.stateNames.scoreSheet,this),this.thisEl=document.getElementById(this.applicationView.state.ui.scoreSheet.dom.dropZone),this.boardGameTitleEl=document.getElementById(this.applicationView.state.ui.scoreSheet.dom.boardGame),this.startStopTimer=document.getElementById(this.applicationView.state.ui.scoreSheet.dom.startStopTimer),this.timerEl=document.getElementById(this.applicationView.state.ui.scoreSheet.dom.timer),this.endOrLeaveEl=document.getElementById(this.applicationView.state.ui.scoreSheet.dom.end),this.scoreSheetEl=document.getElementById(this.applicationView.state.ui.scoreSheet.dom.scoreSheet),this.handleStartStopTimer=this.handleStartStopTimer.bind(this),this.handleEndOrLeave=this.handleEndOrLeave.bind(this),this.handleUserDrop=this.handleUserDrop.bind(this),this.startStopTimer&&this.startStopTimer.addEventListener("click",this.handleStartStopTimer),this.endOrLeaveEl&&this.endOrLeaveEl.addEventListener("click",this.handleEndOrLeave),this.thisEl&&(this.thisEl.addEventListener("dragover",(function(e){e.preventDefault()})),this.thisEl.addEventListener("drop",this.handleUserDrop))},t.handleEndOrLeave=function(e){if(me("leave or end"),this.controller.hasActiveScoreSheet()&&this.controller.isSheetOwner()){if(!confirm("Are you sure you want to close the score sheet"))return;this.controller.endScoreSheet(),this.resetDisplay()}else{if(!confirm("Are you sure you want to leave the score sheet"))return;this.controller.leave(),this.resetDisplay()}},t.handleStartStopTimer=function(e){me("start/pause timer"),this.controller.isTimerGoing()?this.controller.pauseTimer():this.controller.startTimer()},t.handleUserDrop=function(e){if(me("drop event on current score sheet"),this.controller.hasActiveScoreSheet()&&this.controller.isSheetOwner()){var t=e.dataTransfer.getData(this.applicationView.state.ui.draggable.draggableDataKeyId),a=JSON.parse(t);me(a),a[this.applicationView.state.ui.draggable.draggedType]===this.applicationView.state.ui.draggable.draggedTypeUser&&this.controller.inviteUser(a.username)}},t.resetDisplay=function(){this.table=null,this.boardGameTitleEl&&(this.boardGameTitleEl.innerText=""),this.startStopTimer&&(this.startStopTimer.innerHTML="Start "+this.applicationView.state.ui.scoreSheet.dom.iconStart,this.startStopTimer.setAttribute("disabled","true"),ue.addRemoveClasses(this.startStopTimer,"btn-warning",!1),ue.addRemoveClasses(this.startStopTimer,"btn-success",!0)),this.timerEl&&(this.timerEl.innerText=this.createTimerDisplay(0)),this.endOrLeaveEl&&(this.endOrLeaveEl.innerHTML=this.applicationView.state.ui.scoreSheet.dom.iconLeave),this.scoreSheetEl&&ue.removeAllChildren(this.scoreSheetEl)},t.createTimerDisplay=function(e){var t="";if(0===e)t="00:00";else if(e>=60){var a=Math.floor(e/3600),s=Math.floor(e/60),i=e-3600*a-60*s;a>0&&(t+=a+":"),t+=s>0?s<10?"0"+s+":":s+":":"00:",t+=i>0?i<10?"0"+i:""+i:"00"}else t="00:",t+=e>0?e<10?"0"+e:""+e:"00";return t},t.updateTimer=function(e,t){void 0===t&&(t=!1),me("Updating timer "+e+" "+t),this.startStopTimer&&(t?(this.startStopTimer.innerHTML="Start   "+this.applicationView.state.ui.scoreSheet.dom.iconStart,ue.addRemoveClasses(this.startStopTimer,"btn-warning",!1),ue.addRemoveClasses(this.startStopTimer,"btn-success",!0)):(this.startStopTimer.innerHTML="Pause   "+this.applicationView.state.ui.scoreSheet.dom.iconInProgress,ue.addRemoveClasses(this.startStopTimer,"btn-warning",!0),ue.addRemoveClasses(this.startStopTimer,"btn-success",!1)),this.startStopTimer.removeAttribute("disabled")),this.timerEl&&(this.timerEl.innerText=this.createTimerDisplay(e))},t.stateChanged=function(e,t,a){var s=a;if(me("Processing new state"),me(s),this.startStopTimer&&this.startStopTimer.removeAttribute("disabled"),this.boardGameTitleEl&&(this.boardGameTitleEl.innerText=""+s.boardGameName),this.table){var i=[];s.data.forEach((function(e,t){e.forEach((function(e,a){i.push([t,a,e])}))})),me("Table data is "),me(i),this.table.setDataAtCell(i,ve.SOURCE_View)}else this.scoreSheetEl&&(s.sheetLayoutOptions.data=s.data,this.table=new le.a(this.scoreSheetEl,s.sheetLayoutOptions),this.table.addHook("afterChange",this.controller.userChangedValue));this.timerEl&&(this.timerEl.innerText=this.createTimerDisplay(s.timer))},t.getTableData=function(){return this.table?this.table.getData():[]},t.stateChangedItemAdded=function(e,t,a){},t.stateChangedItemRemoved=function(e,t,a){},t.stateChangedItemUpdated=function(e,t,a,s){},e}(),fe=d()("score-sheet-controller"),ve=function(){function e(){this.applicationView=null,this.currentScoreRoom=null,this.currentlySelectedBoardGame=null,this.currentScoreSheet=null,this.currentUsername="",this.isRoomCreator=!1,this.currentUsersInScoreSheet=[],this.intervalTimer=-1,this.stateManager=new se(!0),T.addChatReceiver(this),this.receiveLogin=this.receiveLogin.bind(this),this.receiveLogout=this.receiveLogout.bind(this),this.receiveInvitation=this.receiveInvitation.bind(this),this.receiveMessage=this.receiveMessage.bind(this),this.receiveQueuedMessages=this.receiveQueuedMessages.bind(this),this.receiveQueuedInvites=this.receiveQueuedInvites.bind(this),this.receiveJoinedRoom=this.receiveJoinedRoom.bind(this),this.receivedLeftRoom=this.receivedLeftRoom.bind(this),this.userChangedValue=this.userChangedValue.bind(this),this.endScoreSheet=this.endScoreSheet.bind(this),this.pauseTimer=this.pauseTimer.bind(this),this.reset()}e.getInstance=function(){return e._instance||(e._instance=new e),e._instance};var t=e.prototype;return t.reset=function(){this.currentScoreRoom=null,this.currentScoreSheet=null,this.currentlySelectedBoardGame=null,this.isRoomCreator=!1,this.currentUsersInScoreSheet=[],this.stopTimerStoppedByAnotherUser()},t.isTimerGoing=function(){var e=!1;return this.currentScoreSheet&&(e=this.currentScoreSheet.timerGoing),e},t.getStateManager=function(){return this.stateManager},t.receiveLogin=function(e){},t.receiveLogout=function(e){},t.setCurrentUser=function(e){fe("Setting current user "+e),this.currentUsername=e},t.getCurrentUser=function(){return this.currentUsername},t.initialise=function(e){this.applicationView=e},t.isLoggedIn=function(){return this.getCurrentUser().trim().length>0},t.receiveInvitation=function(e){if(this.isLoggedIn()&&e.type===k.ScoreSheet){if(!re.getInstance().isUserInBlockedList(e.from))return this.currentScoreSheet&&(fe("Received invite - already in score sheet - declining"),this.currentScoreSheet.room!==e.room)?(fe("Received invite - already in score sheet - declining"),void T.sendDeclineInvite(e.room,this.getCurrentUser(),k.ScoreSheet)):void(!e.requiresAcceptDecline||confirm("You have been invited by user "+e.from+" to joint a chat room for the board game "+e.subject+" score sheet")?(Q.show("Score Sheet","Joining score sheet","info",7e3),T.joinChat(this.getCurrentUser(),e.room,k.ScoreSheet),this.currentScoreRoom=e.room,this.currentlySelectedBoardGame={name:e.subject},this.currentScoreSheet=e.attachment,ge.getInstance().stateChanged("","",this.currentScoreSheet),this.applicationView.handleShowScoreSheet(null)):T.sendDeclineInvite(e.room,this.getCurrentUser(),k.ScoreSheet));fe("Received invite from blocked user - ignoring")}},t.receiveQueuedMessages=function(e){var t=this;this.isLoggedIn()&&this.currentScoreRoom&&e.forEach((function(e){e.type===k.ScoreSheet&&t.currentScoreRoom===e.room&&t.receiveMessage(e)}))},t.receiveQueuedInvites=function(e){},t.receiveDecline=function(e,t,a){a===k.ScoreSheet&&(fe("Receive decline for room "+e+" from "+t),this.currentScoreRoom&&this.currentScoreRoom===e&&Q.show("Score Sheet","User "+t+" declined the invitation.","warning"))},t.receiveJoinedRoom=function(e){e.type===k.ScoreSheet&&(this.isLoggedIn()&&e.username!==this.getCurrentUser()&&this.currentScoreRoom===e.room&&(fe("Handling user joined "+e.username),this.currentUsersInScoreSheet.findIndex((function(t){return t===e.username}))<0&&(this.currentUsersInScoreSheet.push(e.username),this.addUserToScoreSheet(e.username),this.currentScoreSheet&&this.saveCurrentScoreSheet(this.currentScoreSheet)),this.isRoomCreator&&this.currentScoreSheet&&(fe("Handling user joined "+e.username+" - sending"),this.sendScoreSheetState(this.currentScoreSheet,!1)),Q.show(this.currentlySelectedBoardGame.name,"User "+e.username+" joined.")))},t.receivedLeftRoom=function(e){if(e.type===k.ScoreSheet&&this.isLoggedIn()&&e.username!==this.getCurrentUser()&&this.currentScoreRoom===e.room){fe("Handling user left "+e.username);var t=this.currentUsersInScoreSheet.findIndex((function(t){return t===e.username}));t>=0&&(this.currentUsersInScoreSheet.splice(t,1),this.removeUserFromScoreSheet(e.username),this.currentScoreSheet&&this.saveCurrentScoreSheet(this.currentScoreSheet)),this.isRoomCreator&&this.currentScoreSheet&&(fe("Handling user left "+e.username+" - sending"),this.sendScoreSheetState(this.currentScoreSheet,!1)),Q.show(this.currentlySelectedBoardGame.name,"User "+e.username+" left.")}},t.receiveUserList=function(e){},t.endScoreSheet=function(){fe("Handling end of score sheet"),this.isRoomCreator&&this.currentScoreSheet&&this.saveScoreSheetToBoardGame(this.currentScoreSheet),this.isLoggedIn()&&(this.currentScoreRoom&&this.currentScoreSheet&&(fe("Handling end of score sheet - sending"),this.sendScoreSheetState(this.currentScoreSheet,!0)),this.leave()),this.reset(),this.applicationView.switchBetweenCollectionAndScoreSheet(!0)},t.saveScoreSheetToBoardGame=function(e){fe("Handling save");var t={id:e.room,jsonData:JSON.stringify(e),createdOn:X()().format("YYYYMMDDHHmmss"),players:[],scores:[]};fe(e);var a=e.data[0],s=e.data[e.data.length-1];fe("players and scores"),fe(a),fe(s),t.players=a,t.scores=s,fe(t),this.currentlySelectedBoardGame&&(this.currentlySelectedBoardGame.scores||(this.currentlySelectedBoardGame.scores=[]),this.currentlySelectedBoardGame.scoresheets.push(t),be.scoreSheetAddedToBoardGame(this.currentlySelectedBoardGame,t))},t.getDefaultScoreSheetTemplate=function(e){return{colHeaders:!1,rowHeaders:!1,licenseKey:"non-commercial-and-evaluation",manualColumnResize:!1,manualRowResize:!1,selectionMode:"single",columnSummary:[{destinationRow:0,destinationColumn:0,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:1,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:2,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:3,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:4,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:5,reversedRowCoords:!0,type:"sum",forceNumeric:!0},{destinationRow:0,destinationColumn:6,reversedRowCoords:!0,type:"sum",forceNumeric:!0}]}},t.getDefaultScoreSheetStartingData=function(e){return[["P 1","P 2","P 3","P 4","P 5","P 6","P 7"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"],["0","0","0","0","0","0","0"]]},t.getScoreSheetTemplate=function(e){return this.getDefaultScoreSheetTemplate(e)},t.getScoreSheetStartingData=function(e){return this.getDefaultScoreSheetStartingData(e)},t.startScoreSheet=function(e){e&&(fe("Starting score sheet for "+e.name),this.currentlySelectedBoardGame=e,this.isLoggedIn()&&(this.currentUsersInScoreSheet=[this.getCurrentUser()]),this.isRoomCreator=!0,this.currentScoreRoom=L.getUniqueId(),this.currentScoreSheet={room:this.currentScoreRoom,boardGameName:e.name,sheetLayoutOptions:this.getScoreSheetTemplate(e),timer:0,timerGoing:!1,data:this.getScoreSheetStartingData(e),isFinished:!1},fe(this.currentScoreSheet),this.stateManager.setStateByName(this.applicationView.state.stateNames.scoreSheet,this.currentScoreSheet,!0),this.isLoggedIn()&&T.joinChat(this.getCurrentUser(),this.currentScoreRoom,k.ScoreSheet))},t.hasActiveScoreSheet=function(){var e=!1;return this.currentScoreRoom&&(fe(this.currentScoreRoom),e=!0),e},t.inviteUser=function(e){this.isLoggedIn()&&this.currentScoreRoom&&this.currentlySelectedBoardGame&&(fe("Inviting user "+e+" to score sheet"),this.isRoomCreator?T.sendInvite(this.getCurrentUser(),e,this.currentScoreRoom,k.ScoreSheet,!0,this.currentlySelectedBoardGame.name,this.currentScoreSheet):alert("Only the score sheet creator can invite other users."))},t.receiveMessage=function(e){if(fe("'Handling receive message"),fe(e),this.isLoggedIn()&&e.type===k.ScoreSheet&&e.from!==this.getCurrentUser()&&this.currentScoreRoom&&this.currentScoreRoom===e.room){if(re.getInstance().isUserInBlockedList(e.from))return void fe("Received message from blocked user - ignoring");if(fe("Received message for score sheet "+e.room),fe(e),e.attachment){var t=e.attachment;if(fe(t),this.currentScoreSheet){var a=this.currentScoreSheet.timerGoing;this.currentScoreSheet.room=e.room,this.currentScoreSheet.boardGameName=t.boardGameName,this.currentScoreSheet.data=t.data,this.currentScoreSheet.timer=t.timer>this.currentScoreSheet.timer?t.timer:this.currentScoreSheet.timer,this.currentScoreSheet.timerGoing=t.timerGoing,this.currentScoreSheet.sheetLayoutOptions=t.sheetLayoutOptions,this.currentScoreSheet.isFinished=t.isFinished,t.timerGoing?a||(this.stopTimerStoppedByAnotherUser(),this.startTimer()):a&&this.stopTimerStoppedByAnotherUser()}fe("Updated score sheet"),fe(this.currentScoreSheet),this.currentScoreSheet&&this.saveCurrentScoreSheet(this.currentScoreSheet,!0),t.isFinished&&(alert("Score sheet has been finished - closing"),this.reset(),this.leave(),ge.getInstance().resetDisplay(),this.applicationView.switchBetweenCollectionAndScoreSheet(!0))}}},t.isSheetOwner=function(){return this.isRoomCreator},t.saveCurrentScoreSheet=function(e,t){void 0===t&&(t=!0),this.currentScoreSheet=e,this.stateManager.setStateByName(this.applicationView.state.stateNames.scoreSheet,this.currentScoreSheet,t)},t.createScoreSheetFromTable=function(){var e=null,t=ge.getInstance().getTableData();return this.currentScoreSheet&&this.currentScoreRoom&&(e={room:this.currentScoreRoom,data:t,boardGameName:this.currentlySelectedBoardGame.name,timer:this.currentScoreSheet.timer,sheetLayoutOptions:null,timerGoing:this.currentScoreSheet.timerGoing,isFinished:!1}),e},t.sendScoreSheetState=function(e,t){if(void 0===t&&(t=!1),this.currentScoreRoom&&this.isLoggedIn()){var a=parseInt(X()().format("YYYYMMDDHHmmss"));T.sendMessage(this.getCurrentUser(),this.currentScoreRoom,"data",a,k.ScoreSheet,N.Normal,e)}},t.addUserToScoreSheet=function(e){},t.removeUserFromScoreSheet=function(e){},t.startTimer=function(){var e=this;fe("Handling pause timer"),this.currentScoreSheet&&(this.currentScoreSheet.timerGoing=!0,this.intervalTimer=setInterval((function(){e.currentScoreSheet&&e.currentScoreSheet.timerGoing?(e.currentScoreSheet.timer++,ge.getInstance().updateTimer(e.currentScoreSheet.timer,!e.currentScoreSheet.timerGoing)):e.currentScoreSheet&&(e.currentScoreSheet.timerGoing=!1,ge.getInstance().updateTimer(e.currentScoreSheet.timer,!e.currentScoreSheet.timerGoing))}),1e3),this.currentScoreSheet&&this.saveCurrentScoreSheet(this.currentScoreSheet),this.isLoggedIn()&&this.currentScoreSheet&&(fe("Handling pause timer - sending score sheet"),this.sendScoreSheetState(this.currentScoreSheet,!1)))},t.stopTimerStoppedByAnotherUser=function(){fe("Handling timer stopped by another user"),this.intervalTimer>0&&clearInterval(this.intervalTimer),this.intervalTimer=-1},t.pauseTimer=function(){fe("Handling pause timer"),this.intervalTimer>0&&(clearInterval(this.intervalTimer),this.intervalTimer=-1,this.currentScoreSheet&&(this.currentScoreSheet.timerGoing=!1,this.saveCurrentScoreSheet(this.currentScoreSheet),ge.getInstance().updateTimer(this.currentScoreSheet.timer,!this.currentScoreSheet.timerGoing)),this.isLoggedIn()&&this.currentScoreSheet&&(fe("Handling pause timer - updating all users"),this.sendScoreSheetState(this.currentScoreSheet,!1)))},t.userChangedValue=function(t,a){if(fe("Handling user changed value "+a),a!==e.SOURCE_View&&"edit"===a){var s=this.createScoreSheetFromTable();fe("Handling user changed Value"),fe(t),fe(s),s&&(this.saveCurrentScoreSheet(s,!1),this.isLoggedIn()&&(fe("Handling user change - updating all users"),this.sendScoreSheetState(s,!1)))}},t.leave=function(){fe("Handling user leaving"),this.currentScoreSheet&&this.currentScoreRoom&&(this.isLoggedIn()&&T.leaveChat(this.getCurrentUser(),this.currentScoreRoom,k.ScoreSheet),this.reset(),this.applicationView.switchBetweenCollectionAndScoreSheet(!0))},e}();ve.SOURCE_View="ssv";var pe=d()("controller-ts"),Se=d()("controller-ts-detail"),be=new(function(){function e(){}var t=e.prototype;return t.connectToApplication=function(e,t){this.applicationView=e,this.clientSideStorage=t,this.config=this.applicationView.state;var a=j.getInstance();a.initialise([{stateName:this.config.stateNames.boardGames,serverURL:this.getServerAPIURL(),api:this.config.apis.entries,isActive:!0},{stateName:this.config.stateNames.scores,serverURL:this.getServerAPIURL(),api:this.config.apis.comments,isActive:!0}]);var s=new he;s.initialise([{stateName:this.config.stateNames.users,apiURL:this.getServerAPIURL()+this.config.apis.graphQL,apis:{find:"",create:"",destroy:"",update:"",findAll:this.config.apis.findUsers.queryString},data:{find:"",create:"",destroy:"",update:"",findAll:this.config.apis.findUsers.resultName},isActive:!0}]);var i=P.getInstance(),r=S.getInstance(),n=new x(i,a),o=new x(i,s);return i.addStateManager(r,[],!1),i.addStateManager(o,[this.config.stateNames.selectedEntry,this.config.stateNames.recentUserSearches,this.config.stateNames.boardGames,this.config.stateNames.scores],!1),i.addStateManager(n,[this.config.stateNames.users,this.config.stateNames.boardGames,this.config.stateNames.scores,this.config.stateNames.selectedEntry,this.config.stateNames.recentUserSearches],!1),this.stateManager=i,this.stateChanged=this.stateChanged.bind(this),this.stateChangedItemAdded=this.stateChangedItemAdded.bind(this),this.stateChangedItemRemoved=this.stateChangedItemRemoved.bind(this),this.stateChangedItemUpdated=this.stateChangedItemUpdated.bind(this),this.callbackBoardGameDetails=this.callbackBoardGameDetails.bind(this),this.callbackAddToCollection=this.callbackAddToCollection.bind(this),this.callbackRemoveFromCollection=this.callbackRemoveFromCollection.bind(this),this.callbackGetCollection=this.callbackGetCollection.bind(this),this.addBoardGameToCollection=this.addBoardGameToCollection.bind(this),this.removeBoardGameFromCollection=this.removeBoardGameFromCollection.bind(this),this.removeBoardGameFromDisplay=this.removeBoardGameFromDisplay.bind(this),this.displayedBoardGamesStateManager=new se(!0),this},t.initialise=function(){pe("Initialising data state");var e=new z(this.config);if(T.setListener(e),pe("Setting up chat system for user "+this.getLoggedInUserId()+": "+this.getLoggedInUsername()),this.getLoggedInUserId()>0){var t=re.getInstance();ce.getInstance(),t.setCurrentUser(this.getLoggedInUsername()),ve.getInstance().setCurrentUser(this.getLoggedInUsername()),t.login(),this.getStateManager().getStateByName(this.config.stateNames.users)}this.applicationView.setState({boardGames:this.displayedBoardGamesStateManager.getStateByName(this.config.stateNames.boardGames)}),this.downloadAndSyncSavedBoardGameCollection()},t.downloadAndSyncSavedBoardGameCollection=function(){this.isLoggedIn()&&D.addQLApiRequest(this.config.apis.graphQL,this.config.apis.getMyBoardGameCollection.queryString,{userId:this.getLoggedInUserId()},this.callbackGetCollection,this.config.stateNames.boardGames,!1)},t.getStateManager=function(){return this.stateManager},t.getServerAPIURL=function(){var e="";return window.ENV&&window.ENV.serverURL&&(e=window.ENV.serverURL),e},t.isLoggedIn=function(){var e=!1;try{loggedInUserId&&(e=!0)}catch(e){}return e},t.getLoggedInUserId=function(){var e=-1;try{loggedInUserId&&(e=loggedInUserId)}catch(e){}return Se("Logged in user id is "+e),e},t.getLoggedInUsername=function(){var e="";try{loggedInUsername&&(e=loggedInUsername)}catch(e){}return Se("Logged in user is "+e),e},t.handleMessage=function(e){pe(e)},t.getCurrentUser=function(){return this.getLoggedInUserId()},t.stateChangedItemAdded=function(e,t,a){switch(pe("State changed "+t+" from "+e+" - item Added"),pe(a),e){case"aggregate":case"memory":switch(pe("received state from "+e+" for state "+t+" - updating application view"),t){case this.config.stateNames.entries:}}},t.stateChangedItemRemoved=function(e,t,a){switch(pe("State changed "+t+" from "+e+"  - item Removed"),pe(a),e){case"aggregate":case"memory":switch(pe("received state from "+e+" for state "+t+" - updating application view"),t){case this.config.stateNames.comments:}}},t.stateChangedItemUpdated=function(e,t,a,s){switch(pe("State changed "+t+" from "+e+" - item updated"),pe(a),e){case"aggregate":case"memory":switch(pe("received state from "+e+" for state "+t+" - updating application view"),t){case this.config.stateNames.entries:}}},t.stateChanged=function(e,t,a){switch(pe("State changed "+t+" from "+e+" "),pe(a),e){case"aggregate":case"memory":switch(pe("received state from "+e+" for state "+t+" - sending to application view"),t){case this.config.stateNames.entries:case this.config.stateNames.comments:case this.config.stateNames.users:}}},t.addBoardGameToDisplay=function(e){pe("Handling addition of board game"),pe(e);var t=this.applicationView.state.boardGames;t.findIndex((function(t){return t.gameId===e.gameId}))>=0?pe("Board game in display already"):(e.decorator=ne.Incomplete,t.push(e),pe("Adding received board game to application"),pe(e),this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,t,!1),this.applicationView.setState({boardGames:t}),D.addQLApiRequest(this.config.apis.graphQL,this.config.apis.bggSearchCallById.queryString,{gameId:e.gameId},this.callbackBoardGameDetails,this.config.stateNames.boardGames,!1))},t.callbackBoardGameDetails=function(e,t,a){if(pe("callback for bgg search for single board game "+a+" with status "+t),t>=200&&t<=299){pe(e);var s=e.data[this.config.apis.bggSearchCallById.resultName];pe(s);var i=/&#10;/g;s.description=s.description.replace(i,"\r\n"),i=/&ldquo;/g,s.description=s.description.replace(i,'"'),i=/&rdquo;/g,s.description=s.description.replace(i,'"'),i=/&quot;/g,s.description=s.description.replace(i,'"'),i=/&mdash;/g,s.description=s.description.replace(i,'"');var r=this.applicationView.state.boardGames,n=r.findIndex((function(e){return e.gameId===s.gameId}));n>=0?(pe("Updating application state"),r.splice(n,1,s),pe(r),s.decorator=ne.PersistedLocally,this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,r,!1),this.applicationView.setState({boardGames:r})):pe("Board game "+s.id+" not found in current state")}},t.removeBoardGameFromState=function(e){var t=this.applicationView.state.boardGames,a=t.findIndex((function(t){return t.gameId===e.gameId}));a>=0&&(t.splice(a,1),this.applicationView.setState({boardGames:t})),this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,t,!1)},t.findBoardGameInStateFromEvent=function(e){var t=null;Se("Finding board game id in event");var a=e.target.getAttribute(this.config.controller.events.boardGames.eventDataKeyId);if(Se(a),a){a=parseInt(a);var s=this.applicationView.state.boardGames,i=s.findIndex((function(e){return e.gameId===a}));Se(i),i>=0&&(t=s[i])}return Se(t),t},t.callbackAddToCollection=function(e,t,a){if(pe("callback for add single board game "+a+" to my collection with status "+t),t>=200&&t<=299){pe(e);var s=e.data[this.config.apis.addToMyCollection.resultName];pe(s);var i=this.applicationView.state.boardGames,r=i.findIndex((function(e){return e.gameId===s.gameId}));if(r>=0){var n=i[r];pe("Updating board game "+n.gameId+" with database id "+s.id+" and new Persisted state"),n.decorator=ne.Persisted,n.id=s.id,this.applicationView.setState({boardGames:i}),this.displayedBoardGamesStateManager.updateItemInState(this.config.stateNames.boardGames,n,W,!1)}}},t.callbackRemoveFromCollection=function(e,t,a){if(pe("callback for remove single board game "+a+" from my collection with status "+t),t>=200&&t<=299){pe(e);var s=e.data[this.config.apis.removeFromMyCollection.resultName];pe(s)}},t.callbackGetCollection=function(e,t,a){if(pe("callback for getting my collection of board games "+a+" to my collection with status "+t),t>=200&&t<=299){pe(e);var s=e.data[this.config.apis.getMyBoardGameCollection.resultName],i=this.applicationView.state.boardGames;Se("Starting with local state of "+i.length),s.forEach((function(e){e.decorator=ne.Persisted,Se("Loading board game from collection "),Se(e);var t=i.findIndex((function(t){return t.gameId===e.gameId}));Se("have found the board game locally? "+(t>=0)),t>=0?(Se("in current state, replacing"),i.splice(t,1,e)):(Se("not in current state, adding"),i.push(e))})),Se("Ending with local state of "+i.length),this.applicationView.setState({boardGames:i}),this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,i,!1)}},t.scoreSheetAddedToBoardGame=function(e,t){this.isLoggedIn()&&e.decorator&&e.decorator===ne.Persisted&&D.addQLApiRequest(this.config.apis.graphQL,this.config.apis.addScoreSheetToBoardGame.queryString,{userId:this.getCurrentUser(),boardGameId:e.id,sheet:t},(function(e,t,a){}),this.config.stateNames.scoreSheet,!1);var a=this.applicationView.state.boardGames,s=a.findIndex((function(t){return t.gameId===e.gameId}));if(s>=0){var i=a[s];e.decorator=i.decorator,pe("Updating application state"),a.splice(s,1,e),pe(a),this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,a,!1),this.applicationView.setState({boardGames:a})}else pe("Board game "+e.id+" not found in current state")},t.addBoardGameToCollection=function(e){pe("Handling Add Board Game to collection");var t=this.findBoardGameInStateFromEvent(e);if(t&&t.decorator)switch(t.decorator){case ne.Persisted:case ne.Incomplete:break;case ne.PersistedLocally:case ne.Complete:this.displayedBoardGamesStateManager.addNewItemToState(this.config.stateNames.boardGames,t,!0),delete t.decorator,delete t.id,this.isLoggedIn()?(D.addQLApiRequest(this.config.apis.graphQL,this.config.apis.addToMyCollection.queryString,{userId:this.getCurrentUser(),boardGame:t},this.callbackAddToCollection,this.config.stateNames.boardGames,!0),t.decorator=ne.Complete):t.decorator=ne.PersistedLocally}},t.removeBoardGameFromCollection=function(e){if(pe("Handling Remove Board Game from collection with id "+e.gameId),e&&e.decorator)switch(e.decorator){case ne.PersistedLocally:case ne.Persisted:this.removeBoardGameFromState(e),this.isLoggedIn()&&D.addQLApiRequest(this.config.apis.graphQL,this.config.apis.removeFromMyCollection.queryString,{userId:this.getCurrentUser(),boardGameId:e.gameId},this.callbackRemoveFromCollection,this.config.stateNames.boardGames,!1);break;case ne.Incomplete:case ne.Complete:}},t.removeBoardGameFromDisplay=function(e){if(pe("Handling Remove Board Game from display "+e.gameId),e&&e.decorator)switch(e.decorator){case ne.Incomplete:break;case ne.Persisted:case ne.PersistedLocally:case ne.Complete:this.removeBoardGameFromState(e)}},e}()),Ie=d()("view-ts");function Ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Le=function(e){var t,a;function s(t,a,s,i,r){var n;return(n=e.call(this,t,a,s,i,r)||this).eventHide=n.eventHide.bind(Ce(n)),n.eventShow=n.eventShow.bind(Ce(n)),n}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,ye(t,a);var i=s.prototype;return i.onDocumentLoaded=function(){this.eventHide(null);var e=this.document.getElementById(this.uiConfig.dom.sideBarId);if(null!==e){var t=e.querySelector(".close");t&&t.addEventListener("click",this.eventHide)}},i.showHide=function(e){var t=this.document.getElementById(this.uiConfig.dom.sideBarId);if(null!==t)switch(this.uiPrefs.view.location){case"left":case"right":t.style.width=e;break;case"bottom":case"top":t.style.height=e}},i.eventHide=function(e){e&&e.preventDefault(),this.showHide("0%")},i.eventShow=function(e){var t=this.uiPrefs.view.expandedSize;window.innerWidth<769&&(t="50%"),window.innerWidth<415&&(t="100%"),this.showHide(t)},s}(function(){function e(e,t,a,s,i){this.applicationView=e,this.document=document,this.uiConfig=a,this.uiPrefs=s,this.config=e.state,this.stateManager=i,this.stateChanged=this.stateChanged.bind(this),this.eventStartDrag=this.eventStartDrag.bind(this),this.eventClickItem=this.eventClickItem.bind(this),this.eventDeleteClickItem=this.eventDeleteClickItem.bind(this)}var t=e.prototype;return t.eventStartDrag=function(e){Ie("Abstract View : drag start",10);var t=JSON.stringify(this.getDragData(e));Ie(t,10),e.dataTransfer.setData(this.applicationView.state.ui.draggable.draggableDataKeyId,t)},t.createResultForItem=function(e,t,a){var s=this;void 0===a&&(a=null),Ie("Abstract View : creating Result"),Ie(t);var i=this.uiConfig.dom,r=this.getIdForStateItem(e,t),n=this.getLegacyIdForStateItem(e,t);a||(a=i.resultDataSourceValue);var o=this.document.createElement(i.resultsElementType);ue.addRemoveClasses(o,i.resultsClasses),ue.addAttributes(o,i.resultsElementAttributes);var c=o;if(i.resultContentDivClasses){var d=this.document.createElement("div");if(ue.addRemoveClasses(d,i.resultContentDivClasses),d.setAttribute(i.resultDataKeyId,r),d.setAttribute(i.resultLegacyDataKeyId,n),d.setAttribute(i.resultDataSourceId,a),c=this.document.createElement(i.resultContentTextElementType),ue.addRemoveClasses(c,i.resultContentTextClasses),c.setAttribute(i.resultDataKeyId,r),c.setAttribute(i.resultLegacyDataKeyId,n),c.setAttribute(i.resultDataSourceId,a),d.appendChild(c),i.hasBackgroundImage){var h=this.document.createElement(i.imgElementType);ue.addRemoveClasses(h,i.imgClasses),h.setAttribute("src",this.getBackgroundImage(e,t)),o.appendChild(h)}if(i.hasBadge){var l=this.getBadgeValue(e,t);if(l>0){var u=this.document.createElement(i.badgeElementType);ue.addRemoveClasses(u,i.badgeClasses),u.setAttribute(i.resultDataKeyId,r),u.setAttribute(i.resultLegacyDataKeyId,n),u.setAttribute(i.resultDataSourceId,a),d.appendChild(u),u.innerHTML="&nbsp;&nbsp;&nbsp;"+l+"&nbsp;&nbsp;&nbsp;",ue.addAttributes(u,i.badgeElementAttributes)}}if(i.isDeleteable){var m=this.document.createElement("button");if(m.setAttribute("type","button"),ue.addRemoveClasses(m,i.deleteButtonClasses),i.deleteButtonText&&i.deleteButtonText.trim().length()>0&&(i.innerText=i.deleteButtonText),i.deleteButtonIconClasses){var g=document.createElement("i");ue.addRemoveClasses(g,i.deleteButtonIconClasses),g.setAttribute(i.resultDataKeyId,r),g.setAttribute(i.resultLegacyDataKeyId,n),g.setAttribute(i.resultDataSourceId,a),m.appendChild(g)}m.setAttribute(i.resultDataKeyId,r),m.setAttribute(i.resultLegacyDataKeyId,n),m.setAttribute(i.resultDataSourceId,a),m.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),s.eventDeleteClickItem(e)})),d.appendChild(m)}o.appendChild(d)}o.setAttribute(i.resultDataKeyId,r),o.setAttribute(i.resultLegacyDataKeyId,n),o.setAttribute(i.resultDataSourceId,a);var f=this.getDisplayValueForStateItem(e,t),v=this.getModifierForStateItem(e,t),p=this.getSecondaryModifierForStateItem(e,t);switch(v){case"normal":switch(Ie("Abstract View: normal item"),ue.addRemoveClasses(o,i.modifierClassNormal),""!==i.iconNormal?c.innerHTML=f+"  "+i.iconNormal:c.innerText=f,p){case"warning":ue.addRemoveClasses(o,i.modifierClassNormal,!1),ue.addRemoveClasses(o,i.modifierClassWarning,!0),""!==i.iconWarning&&(c.innerHTML+="  "+i.iconWarning);break;case"normal":break;case"active":""!==i.iconActive&&(c.innerHTML+="  "+i.iconActive)}break;case"active":switch(Ie("Abstract View: active item",10),ue.addRemoveClasses(o,i.modifierClassActive),""!==i.iconActive?c.innerHTML=f+"  "+i.iconActive:c.innerText=f,p){case"warning":ue.addRemoveClasses(o,i.modifierClassActive,!1),ue.addRemoveClasses(o,i.modifierClassWarning,!0),""!==i.iconWarning&&(c.innerHTML+="  "+i.iconWarning)}break;case"inactive":switch(Ie("Abstract View: inactive item",10),ue.addRemoveClasses(o,i.modifierClassInactive),""!==i.iconInactive?c.innerHTML=f+"  "+i.iconInactive:c.innerText=f,p){case"warning":""!==i.iconWarning&&(ue.addRemoveClasses(o,i.modifierClassInactive,!1),ue.addRemoveClasses(o,i.modifierClassWarning,!0),c.innerHTML+="  "+i.iconWarning);break;case"normal":break;case"active":""!==i.iconActive&&(c.innerHTML+="  "+i.iconActive)}}return o},t.createResultsForState=function(e,t){var a=this;Ie("Abstract View : creating Results",10),Ie(t);var s=this.uiConfig.dom,i=document.getElementById(s.resultsId);i&&ue.removeAllChildren(i),t.map((function(t,r){var n=a.createResultForItem(e,t);s.isDraggable&&(n.setAttribute("draggable","true"),n.addEventListener("dragstart",a.eventStartDrag)),s.isClickable&&n.addEventListener("click",a.eventClickItem),Ie("Abstract View: Adding child "+t.id),i&&i.appendChild(n)}))},t.stateChanged=function(e,t,a){this.updateView(t,a)},t.stateChangedItemAdded=function(e,t,a){this.updateView(t,this.stateManager.getStateByName(t))},t.stateChangedItemRemoved=function(e,t,a){this.updateView(t,this.stateManager.getStateByName(t))},t.stateChangedItemUpdated=function(e,t,a,s){this.updateView(t,this.stateManager.getStateByName(t))},e}());function we(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ue(e,t){return(Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ne=d()("user-search-sidebar"),ke=d()("user-search-sidebar:detail"),Ee=function(e){var t,a;function s(t,a,s){var i;return(i=e.call(this,t,a,t.state.ui.userSearchSideBar,t.state.uiPrefs.userSearchSideBar,s)||this).config=t.state,i.loggedInUsers=[],i.updateView=i.updateView.bind(we(i)),i.eventClickItem=i.eventClickItem.bind(we(i)),i.eventUserSelected=i.eventUserSelected.bind(we(i)),i.handleLoggedInUsersUpdated=i.handleLoggedInUsersUpdated.bind(we(i)),i.handleFavouriteUserLoggedIn=i.handleFavouriteUserLoggedIn.bind(we(i)),i.handleFavouriteUserLoggedOut=i.handleFavouriteUserLoggedOut.bind(we(i)),i.handleFavouriteUsersChanged=i.handleFavouriteUsersChanged.bind(we(i)),i.handleBlockedUsersChanged=i.handleBlockedUsersChanged.bind(we(i)),i.handleLoggedInUsersUpdated=i.handleLoggedInUsersUpdated.bind(we(i)),i.handleFavouriteUserDrop=i.handleFavouriteUserDrop.bind(we(i)),i.handleBlockedUserDrop=i.handleBlockedUserDrop.bind(we(i)),s.addChangeListenerForName(i.config.stateNames.users,we(i)),i.localisedSM=new se(!0),i.localisedSM.addChangeListenerForName(i.config.stateNames.recentUserSearches,we(i)),ce.getInstance().addUserListener(we(i)),Ne(i.localisedSM.getStateByName(i.config.stateNames.recentUserSearches)),i}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,Ue(t,a);var i=s.prototype;return i.handleFavouriteUserDrop=function(e){Ne("drop event on favourites");var t=e.dataTransfer.getData(this.config.ui.draggable.draggableDataKeyId),a=JSON.parse(t);if(Ne(a),a[this.config.ui.draggable.draggedType]===this.config.ui.draggable.draggedTypeUser)switch(a[this.config.ui.draggable.draggedFrom]){case this.config.ui.draggable.draggedFromUserSearch:if(re.getInstance().isUserInFavouriteList(a.username))return void Ne(a.username+" already in favourite list, ignoring");re.getInstance().addUserToFavouriteList(a.username)}},i.handleBlockedUserDrop=function(e){Ne("drop event on blocked users");var t=e.dataTransfer.getData(this.config.ui.draggable.draggableDataKeyId),a=JSON.parse(t);if(Ne(a),a[this.config.ui.draggable.draggedType]===this.config.ui.draggable.draggedTypeUser)switch(a[this.config.ui.draggable.draggedFrom]){case this.config.ui.draggable.draggedFromUserSearch:if(re.getInstance().isUserInBlockedList(a.username))return void Ne(a.username+" already in blocked list, ignoring");re.getInstance().addUserToBlockedList(a.username)}},i.handleLoggedInUsersUpdated=function(e){Ne("Received new list of users who are logged in "),Ne(e),this.loggedInUsers=e,this.reRenderView()},i.handleFavouriteUserLoggedIn=function(e){Ne("Handle Favourite User "+e+" logged in"),this.reRenderView()},i.handleFavouriteUserLoggedOut=function(e){Ne("Handle Favourite User "+e+" logged in"),this.reRenderView()},i.handleFavouriteUsersChanged=function(e){Ne("Handle Favourite Users changed to "+e),this.reRenderView()},i.handleBlockedUsersChanged=function(e){Ne("Handle Blocked Users changed to "+e),this.reRenderView()},i.renderFavouriteUsers=function(){var e=this,t=re.getInstance().getFavouriteUserList();this.favUsersDiv&&ue.removeAllChildren(this.favUsersDiv),t.forEach((function(t){var a=e.stateManager.findItemInState(e.config.stateNames.users,{username:t},J);if(a){var s=e.createResultForItem(e.config.stateNames.users,a,e.uiConfig.dom.resultDataSourceFavUsers);s.addEventListener("click",e.eventClickItem),s.setAttribute("draggable","true"),s.addEventListener("dragstart",e.eventStartDrag),e.favUsersDiv.appendChild(s)}}))},i.renderBlockedUsers=function(){var e=this,t=re.getInstance().getBlockedUserList();this.blockedUsersDiv&&ue.removeAllChildren(this.blockedUsersDiv),t.forEach((function(t){var a=e.stateManager.findItemInState(e.config.stateNames.users,{username:t},J);if(a){var s=e.createResultForItem(e.config.stateNames.users,a,e.uiConfig.dom.resultDataSourceBlockedUsers);s.setAttribute("draggable","false"),s.addEventListener("dragstart",(function(e){e.preventDefault()})),e.blockedUsersDiv.appendChild(s)}}))},i.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),$("#"+this.uiConfig.dom.extra.fastSearchInputId).on("autocompleteselect",this.eventUserSelected),this.favUsersDropZone=document.getElementById(this.uiConfig.dom.favouriteUsersDropZone),this.favUsersDropZone.addEventListener("dragover",(function(e){Ne("Dragged over"),e.preventDefault()})),this.favUsersDropZone.addEventListener("drop",this.handleFavouriteUserDrop),this.favUsersDiv=document.getElementById(this.uiConfig.dom.favouriteUsersId),this.blockedUsersDropZone=document.getElementById(this.uiConfig.dom.blockedUsersDropZone),this.blockedUsersDropZone.addEventListener("dragover",(function(e){Ne("Dragged over"),e.preventDefault()})),this.blockedUsersDropZone.addEventListener("drop",this.handleBlockedUserDrop),this.blockedUsersDiv=document.getElementById(this.uiConfig.dom.blockedUsersId),this.renderFavouriteUsers(),this.renderBlockedUsers()},i.getIdForStateItem=function(e,t){return t.id},i.getLegacyIdForStateItem=function(e,t){return t.id},i.getDisplayValueForStateItem=function(e,t){return t.username},i.getModifierForStateItem=function(e,t){var a="normal";return ke("Checking for item modifiers"),ke(t),re.getInstance().isUserLoggedIn(t.username)||(a="inactive"),a},i.getSecondaryModifierForStateItem=function(e,t){var a="normal";return ke("Checking for item secondary modifiers "+t.username),ce.getInstance().isFavouriteUser(t.username)&&(ke("is favourite"),a="active"),ce.getInstance().isBlockedUser(t.username)&&(ke("is blocked"),a="warning"),a},i.eventClickItem=function(e){e.preventDefault(),e.stopPropagation(),console.log(e.target);var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);if(a!==this.uiConfig.dom.resultDataSourceBlockedUsers){ke("User "+e.target+" with id "+t+" clicked from "+a);var s=this.stateManager.findItemInState(this.config.stateNames.users,{id:parseInt(t)},Y);Ne(s),ce.getInstance().startChatWithUser(s.username),this.applicationView.handleShowChat(e)}else ke("Blocked user clicked - not activating")},i.eventUserSelected=function(e,t){if(e.preventDefault(),e.stopPropagation(),Ne("User "+t.item.label+" with id "+t.item.value+" selected"),e.target.innerText="",!this.localisedSM.isItemInState(this.config.stateNames.recentUserSearches,{id:t.item.value},Y)){var a=this.localisedSM.getStateByName(this.config.stateNames.recentUserSearches);if(Ne("saved searches too long? "+this.config.controller.dataLimit.recentUserSearches),a.length>=this.config.controller.dataLimit.recentUserSearches){Ne("saved searches too long - removing first");var s=a.shift();this.localisedSM.removeItemFromState(this.config.stateNames.recentUserSearches,s,Y,!0)}this.localisedSM.addNewItemToState(this.config.stateNames.recentUserSearches,{id:t.item.value,username:t.item.label},!0)}},i.reRenderView=function(){this.updateView(this.config.stateNames.recentUserSearches,this.localisedSM.getStateByName(this.config.stateNames.recentUserSearches)),this.renderFavouriteUsers(),this.renderBlockedUsers()},i.updateView=function(e,t){if(e===this.config.stateNames.recentUserSearches&&(Ne("Updating for recent searches"),t=this.localisedSM.getStateByName(this.config.stateNames.recentUserSearches),Ne(t),this.createResultsForState(e,t)),e===this.config.stateNames.users){var a=be.getLoggedInUsername(),s=$("#"+this.uiConfig.dom.extra.fastSearchInputId),i=[];t.forEach((function(e){var t={label:e.username,value:e.id};a!==e.username&&i.push(t)})),s.autocomplete({source:i}),s.autocomplete("option",{disabled:!1,minLength:1})}},i.getDragData=function(e){var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId);ke("User "+e.target.innerText+" with id "+t+" dragging");var a=this.stateManager.findItemInState(this.config.stateNames.users,{id:parseInt(t)},Y);return ke(a),a[this.config.ui.draggable.draggedType]=this.config.ui.draggable.draggedTypeUser,a[this.config.ui.draggable.draggedFrom]=this.config.ui.draggable.draggedFromUserSearch,a},i.eventDeleteClickItem=function(e){e.preventDefault(),e.stopPropagation();var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);ke("User "+e.target+" with id "+t+" delete clicked from "+a);var s=this.stateManager.findItemInState(this.config.stateNames.users,{id:parseInt(t)},Y);if(Ne(s),s)switch(a){case this.uiConfig.dom.resultDataSourceFavUsers:this.deleteFavouriteUser(s);break;case this.uiConfig.dom.resultDataSourceBlockedUsers:this.deleteBlockedUser(s);break;case this.uiConfig.dom.resultDataSourceValue:this.deleteRecentSearchUser(s)}},i.deleteFavouriteUser=function(e){Ne("Favourite user "+e.username+" with id "+e.id+" deleted - removing"),re.getInstance().removeUserFromFavouriteList(e.username)},i.deleteBlockedUser=function(e){Ne("Blocked user "+e.username+" with id "+e.id+" deleted - removing"),re.getInstance().removeUserFromBlockedList(e.username)},i.deleteRecentSearchUser=function(e){Ne("Recent search user "+e.username+" with id "+e.id+" deleted - removing"),this.localisedSM.removeItemFromState(this.config.stateNames.recentUserSearches,e,Y,!0)},i.getBadgeValue=function(e,t){return 0},i.getBackgroundImage=function(e,t){return""},s}(Le);function Re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function De(e,t){return(De=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Be=d()("chat-sidebar"),je=d()("chat-sidebar:detail"),Fe=function(e){var t,a;function s(t,a,s){var i;return(i=e.call(this,t,a,t.state.ui.chatSideBar,t.state.uiPrefs.chatSideBar,s)||this).selectedChatLog=null,i.config=t.state,i.updateView=i.updateView.bind(Re(i)),i.eventClickItem=i.eventClickItem.bind(Re(i)),i.handleAddMessage=i.handleAddMessage.bind(Re(i)),i.handleChatLogsUpdated=i.handleChatLogsUpdated.bind(Re(i)),i.handleChatLogUpdated=i.handleChatLogUpdated.bind(Re(i)),i.handleChatStarted=i.handleChatStarted.bind(Re(i)),i.handleUserDrop=i.handleUserDrop.bind(Re(i)),i.leaveChat=i.leaveChat.bind(Re(i)),ce.getInstance().addListener(Re(i)),i}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,De(t,a);var i=s.prototype;return i.handleNewInviteReceived=function(e){throw new Error("Method not implemented.")},i.leaveChat=function(e){e.preventDefault(),e.stopPropagation(),this.selectedChatLog&&(re.getInstance().leaveChat(this.selectedChatLog.roomName),this.selectedChatLog=null,this.clearChatLog(),this.checkCanComment()),this.updateView("",{})},i.handleUserDrop=function(e){if(Be("drop event on current chat room"),this.selectedChatLog){var t=e.dataTransfer.getData(this.config.ui.draggable.draggableDataKeyId),a=JSON.parse(t);Be(a),a[this.config.ui.draggable.draggedType]===this.config.ui.draggable.draggedTypeUser&&re.getInstance().sendInvite(a.username,this.selectedChatLog.roomName)}},i.handleChatLogUpdated=function(e){Be("Handling chat log updates"),this.checkCanComment(),this.renderChatLog(e),this.updateView("",{})},i.handleAddMessage=function(e){if(e.preventDefault(),e.stopPropagation(),Be("Handling message event"),this.selectedChatLog){if(this.commentEl&&0===this.commentEl.value.trim().length)return;var t=this.commentEl.value.trim();this.commentEl.value="";var a=re.getInstance().sendMessage(this.selectedChatLog.roomName,t,N.Normal,{});if(a){var s=this.addChatMessage(a);ue.scrollSmoothTo(s)}}},i.checkCanComment=function(){this.selectedChatLog?(this.commentEl&&this.commentEl.removeAttribute("readonly"),this.sendMessageButton&&this.sendMessageButton.removeAttribute("disabled"),this.leaveChatButton&&this.leaveChatButton.removeAttribute("disabled")):(this.commentEl&&this.commentEl.setAttribute("readonly","true"),this.sendMessageButton&&this.sendMessageButton.setAttribute("disabled","true"),this.leaveChatButton&&this.leaveChatButton.setAttribute("disabled","true"))},i.onDocumentLoaded=function(){var t=this;e.prototype.onDocumentLoaded.call(this),this.chatLogDiv=document.getElementById(this.uiConfig.dom.chatLogId),this.commentEl=document.getElementById(this.uiConfig.dom.commentId),this.chatForm=document.getElementById(this.uiConfig.dom.newFormId),this.sendMessageButton=document.getElementById(this.uiConfig.dom.submitCommentId),this.leaveChatButton=document.getElementById(this.uiConfig.dom.leaveChatId),this.chatRoomDiv=document.getElementById(this.uiConfig.dom.chatLogRoomId),this.chatRoomDiv.addEventListener("dragover",(function(e){je("Dragged over"),t.selectedChatLog&&e.preventDefault()})),this.chatRoomDiv.addEventListener("drop",this.handleUserDrop),this.chatForm.addEventListener("submit",this.handleAddMessage),this.leaveChatButton.addEventListener("click",this.leaveChat),this.checkCanComment(),this.updateView("",{})},i.getIdForStateItem=function(e,t){return t.roomName},i.getLegacyIdForStateItem=function(e,t){return t.roomName},i.getDisplayValueForStateItem=function(e,t){return t.users.join(",")},i.getModifierForStateItem=function(e,t){var a="inactive";return this.selectedChatLog&&this.selectedChatLog.roomName===t.roomName&&(a="active"),a},i.getSecondaryModifierForStateItem=function(e,t){return this.getModifierForStateItem(e,t)},i.getBadgeValue=function(e,t){return t.numOfNewMessages},i.addChatMessage=function(e){var t=document.createElement("div");if(ue.addRemoveClasses(t,"message"),0===e.from.trim().length){var a=document.createElement("div");ue.addRemoveClasses(a,"message-sender"),a.innerText=e.message,t.appendChild(a)}else{if(e.from===re.getInstance().getCurrentUser())ue.addRemoveClasses(t,"my-message");else{var s=document.createElement("div");ue.addRemoveClasses(s,"message-sender"),s.innerText=e.from+"   "+X()(e.created,"YYYYMMDDHHmmss").format("DD/MM/YYYY "),t.appendChild(s)}var i=document.createElement("div");e.from===re.getInstance().getCurrentUser()?ue.addRemoveClasses(i,"my-message-content"):ue.addRemoveClasses(i,"message-content"),i.innerText=e.message,t.appendChild(i)}return this.chatLogDiv.appendChild(t),t},i.clearChatLog=function(){ue.removeAllChildren(this.chatLogDiv)},i.reRenderChatMessages=function(e){var t=this;ue.removeAllChildren(this.chatLogDiv);var a=null;e.messages.forEach((function(e){a=t.addChatMessage(e)})),a&&ue.scrollTo(a)},i.renderChatLog=function(e){je("Chat Log "+e.roomName+" rendering"),this.selectedChatLog&&this.selectedChatLog.roomName===e.roomName&&(this.selectedChatLog=e,re.getInstance().touchChatLog(e.roomName),this.reRenderChatMessages(e)),this.updateView("",{})},i.eventClickItem=function(e){e.preventDefault(),e.stopPropagation(),console.log(e.target);var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);je("Chat Log "+e.target+" with id "+t+" clicked from "+a),this.selectedChatLog=re.getInstance().getChatLog(t),this.selectedChatLog&&(this.checkCanComment(),this.renderChatLog(this.selectedChatLog))},i.updateView=function(e,t){je("Updating state with chat manager"),t=re.getInstance().getChatLogs(),je(t),this.createResultsForState(e,t),this.checkCanComment()},i.getDragData=function(e){},i.eventDeleteClickItem=function(e){e.preventDefault(),e.stopPropagation(),console.log(e.target);var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);(je("Chat Log "+e.target+" with id "+t+" deleted from "+a),t)&&(re.getInstance().getChatLog(t)&&(re.getInstance().leaveChat(t),this.selectedChatLog&&this.selectedChatLog.roomName===t&&(this.selectedChatLog=null,this.clearChatLog(),this.checkCanComment()),this.updateView("",{})))},i.handleChatLogsUpdated=function(){this.selectedChatLog&&(re.getInstance().touchChatLog(this.selectedChatLog.roomName),this.reRenderChatMessages(this.selectedChatLog)),this.updateView("",{}),this.checkCanComment()},i.handleChatStarted=function(e){this.selectedChatLog=e,this.renderChatLog(e),this.updateView("",{})},i.handleOfflineMessagesReceived=function(e){},i.getBackgroundImage=function(e,t){return""},i.handleInvitationDeclined=function(e,t){},s}(Le);function Te(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ge=d()("board-game-search-sidebar"),Ae=d()("board-game-search-sidebar:detail"),xe=function(e){var t,a;function s(t,a,s){var i;return(i=e.call(this,t,a,t.state.ui.boardGameSearchSideBar,t.state.uiPrefs.boardGameSearchSideBar,s)||this).config=t.state,i.updateView=i.updateView.bind(Te(i)),i.eventClickItem=i.eventClickItem.bind(Te(i)),i.handleSearch=i.handleSearch.bind(Te(i)),i.handleSearchResultsCB=i.handleSearchResultsCB.bind(Te(i)),i.localisedSM=new S,i.localisedSM.addChangeListenerForName(i.config.stateNames.bggSearchResults,Te(i)),Ge(i.localisedSM.getStateByName(i.config.stateNames.bggSearchResults)),i}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,Me(t,a);var i=s.prototype;return i.changeSearchButton=function(e){void 0===e&&(e=!1),ue.removeAllChildren(this.buttonEl),e?(this.buttonEl&&this.buttonEl.removeAttribute("disabled"),this.buttonEl&&(this.buttonEl.innerHTML="Search")):(this.buttonEl&&this.buttonEl.setAttribute("disabled","true"),this.buttonEl&&(this.buttonEl.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>  Loading...'))},i.handleSearch=function(e){Ge("Handling search"),e.preventDefault(),e.stopPropagation();var t=this.queryEl.value.trim();if(0!=t.length){this.changeSearchButton(!1);var a=this.config.apis.bggSearchCall;D.addQLApiRequest(this.config.apis.graphQL,a,{queryString:t},this.handleSearchResultsCB,this.config.stateNames.bggSearchResults)}},i.handleSearchResultsCB=function(e,t,a){this.changeSearchButton(!0),Ge("callback for bgg search "+a+" with status "+t+" - "),t>=200&&t<=299&&(Ae(e),Ae(e.data.findBoardGames),this.localisedSM.setStateByName(this.config.stateNames.bggSearchResults,e.data.findBoardGames,!0))},i.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.formEl=this.document.getElementById(this.uiConfig.dom.formId),this.buttonEl=this.document.getElementById(this.uiConfig.dom.buttonId),this.queryEl=this.document.getElementById(this.uiConfig.dom.queryId),this.formEl.addEventListener("submit",this.handleSearch)},i.getIdForStateItem=function(e,t){return t.gameId},i.getLegacyIdForStateItem=function(e,t){return t.gameId},i.getDisplayValueForStateItem=function(e,t){return t.name+" ("+t.year+")     "},i.getModifierForStateItem=function(e,t){return"normal"},i.getSecondaryModifierForStateItem=function(e,t){return"normal"},i.eventClickItem=function(e){e.preventDefault(),e.stopPropagation(),console.log(e.target);var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);Ae("Board Game "+e.target+" with id "+t+" clicked from "+a);var s=this.localisedSM.findItemInState(this.config.stateNames.bggSearchResults,{gameId:parseInt(t)},W);s&&this.applicationView.addBoardGameToDisplay(s),this.eventHide(null)},i.updateView=function(e,t){e===this.config.stateNames.bggSearchResults&&(Ge("Updating for recent searches"),t=this.localisedSM.getStateByName(this.config.stateNames.bggSearchResults),Ge(t),this.createResultsForState(e,t))},i.getDragData=function(e){var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId);Ae("Board Game "+e.target.innerText+" with id "+t+" dragging");var a=this.localisedSM.findItemInState(this.config.stateNames.bggSearchResults,{gameId:parseInt(t)},W);return Ae(a),a[this.config.ui.draggable.draggedType]=this.config.ui.draggable.draggedTypeBoardGame,a[this.config.ui.draggable.draggedFrom]=this.config.ui.draggable.draggedFromBoardGameSearch,a},i.eventDeleteClickItem=function(e){var t=e.target.getAttribute(this.uiConfig.dom.resultDataKeyId),a=e.target.getAttribute(this.uiConfig.dom.resultDataSourceId);Ae("Board Game "+e.target+" with id "+t+" delete clicked from "+a);var s=this.localisedSM.findItemInState(this.config.stateNames.bggSearchResults,{id:parseInt(t)},W);Ge(t),s&&this.localisedSM.removeItemFromState(this.config.stateNames.bggSearchResults,s,W,!0)},i.getBadgeValue=function(e,t){return 0},i.getBackgroundImage=function(e,t){return""},s}(Le),Oe=d()("view-ts:boardgameview");function _e(e){var t=e.boardGame,a=e.showScoresHandler,s=e.addToCollectionHandler,i=e.removeFromCollectionHandler,n=e.startScoreSheetHandler;if(t){Oe("Board Game "+t.gameId);var o=r.a.createElement("div",null,r.a.createElement("button",{type:"button",className:"btn-primary btn-sm rounded p-1 mr-2 mt-1","board-game-id":t.gameId,onClick:s},"Add to ",be.isLoggedIn()?"":"Browser"," Collection ",r.a.createElement("i",{className:"fas fa-star"}),""),r.a.createElement("button",{type:"button",className:"btn-primary btn-sm rounded p-1 ml-2 mt-1","board-game-id":t.gameId,onClick:i},"Remove from Display",r.a.createElement("i",{className:"fas fa-trash-alt"}))),c=r.a.createElement("button",{type:"button",className:"btn-warning btn-sm rounded p-1 mr-2 mt-1","board-game-id":t.gameId,onClick:i},"Remove from ",be.isLoggedIn()?"":"Browser"," Collection ",r.a.createElement("i",{className:"far fa-star"}),""),d=r.a.createElement("button",{type:"button",className:"btn-secondary btn-sm rounded p-1 mr-2 mt-2","board-game-id":t.gameId,onClick:n},"Start Score Sheet ",r.a.createElement("i",{className:"fas fa-list-alt"}),""),h=0;t.scoresheets&&(h=t.scoresheets.length);var l=r.a.createElement("i",{className:"fas fa-star text-black"}),u=r.a.createElement("span",{"board-game-id":t.gameId,className:"badge badge-pill badge-primary ml-1",onClick:a},h);return t.decorator&&t.decorator!==ne.Incomplete?r.a.createElement("div",{className:"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2"},r.a.createElement("div",{className:"card"},r.a.createElement("img",{className:"card-img-top",src:t.image,alt:"Card image cap"}),r.a.createElement("div",{className:"card-body scroll"},r.a.createElement("h5",{className:"card-title"},t.name," (",t.year,") ",t.decorator===ne.Persisted||t.decorator===ne.PersistedLocally?l:""," ",t.decorator===ne.Persisted||t.decorator===ne.PersistedLocally?u:"",r.a.createElement("br",null),"  ",be.isLoggedIn()?t.decorator===ne.Persisted?c:o:c),r.a.createElement("p",{className:"card-text"},t.description),r.a.createElement("p",{className:"card-text"},r.a.createElement("small",{className:"text-muted"},"Play Time: ",t.minPlayTime," - ",t.maxPlayTime," min",r.a.createElement("br",null),"Players: ",t.minPlayers," - ",t.maxPlayers," Min Age:",t.minAge,r.a.createElement("br",null),"Categories: ",t.categories))),r.a.createElement("div",{className:"card-footer text-right text-muted"},"Rank: ",t.rank," Score: ",t.averageScore," from ",t.numOfRaters," raters",r.a.createElement("br",null),d))):r.a.createElement("div",{className:"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2"},r.a.createElement("div",{className:"card"},r.a.createElement("img",{className:"card-img-top",src:"/img/spinner.gif",alt:"Card image cap"}),r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title"},t.name," (",t.year,") "),r.a.createElement("p",{className:"card-text"},"Loading..."),r.a.createElement("p",{className:"card-text"},r.a.createElement("small",{className:"text-muted"},"Loading..."))),r.a.createElement("div",{className:"card-footer text-right text-muted"},"Loading...")))}return r.a.createElement("div",{className:"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2"},r.a.createElement("div",{className:"card"}))}function Pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var He=d()("score-sheet-sidebar"),qe=d()("score-sheet-sidebar:detail"),Qe=function(e){var t,a;function s(t,a,s){var i;return(i=e.call(this,t,a,t.state.ui.scoreSheetSideBar,t.state.uiPrefs.scoreSheetSideBar,s)||this).selectedBoardGame=null,i.config=t.state,i.updateView=i.updateView.bind(Pe(i)),i.eventClickItem=i.eventClickItem.bind(Pe(i)),i}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,Ve(t,a);var i=s.prototype;return i.onDocumentLoaded=function(){e.prototype.onDocumentLoaded.call(this),this.updateView("",{})},i.setSelectedBoardGame=function(e){He("setting selected board game to"),qe(e),e&&(this.selectedBoardGame=e,this.updateView("",e))},i.getIdForStateItem=function(e,t){return this.selectedBoardGame.boardGameId},i.getLegacyIdForStateItem=function(e,t){return this.selectedBoardGame.boardGameId},i.getDisplayValueForStateItem=function(e,t){var a="";return a+='<h5 class="card-title">'+this.selectedBoardGame.name+" ("+this.selectedBoardGame.year+")</h5>",a+='<p class="card-text">Played On: '+X()(t.createdOn,"YYYYMMDDHHmmss").format("dd/MM/YYYY HH:mm")+"</p>",a+='<p class="card-text">Scores: ',t.player1&&t.score1>0&&(a+=t.player1+":"+t.score1+" "),t.player2&&t.score2>0&&(a+=t.player2+":"+t.score2+" "),t.player3&&t.score3>0&&(a+=t.player3+":"+t.score3+" "),t.player4&&t.score4>0&&(a+=t.player4+":"+t.score4+" "),t.player5&&t.score5>0&&(a+=t.player5+":"+t.score5+" "),t.player6&&t.score6>0&&(a+=t.player6+":"+t.score6+" "),t.player7&&t.score7>0&&(a+=t.player7+":"+t.score7+" "),a+="</p>"},i.getModifierForStateItem=function(e,t){return"normal"},i.getSecondaryModifierForStateItem=function(e,t){return this.getModifierForStateItem(e,t)},i.getBadgeValue=function(e,t){return 0},i.getBackgroundImage=function(e,t){return this.selectedBoardGame.thumb},i.eventClickItem=function(e){},i.eventDeleteClickItem=function(e){throw new Error("Method not implemented.")},i.updateView=function(e,t){qe("Updating state with selected board game"),t&&t.scoresheets&&this.createResultsForState(e,t.scoresheets)},i.getDragData=function(e){},s}(Le);function Ye(e,t,a,s,i,r,n){try{var o=e[r](n),c=o.value}catch(e){return void a(e)}o.done?t(c):Promise.resolve(c).then(s,i)}function Je(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function We(e,t){return(We=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ke=d()("app"),ze=function(e){var t,a;function s(){var t;return(t=e.call(this)||this).state={isLoggedIn:!1,loggedInUserId:-1,boardGames:[],scoreSheet:{room:"",boardGameName:"",sheetLayoutOptions:{},timer:0,sheetData:{}},stateNames:{users:"users",boardGames:"boardGames",scores:"scores",selectedEntry:"selectedEntry",recentUserSearches:"recentUserSearches",bggSearchResults:"bggSearchResults",scoreSheet:"scoreSheet"},apis:{login:"/login",graphQL:"/graphql",bggSearchCall:"query search($queryString: String!) {findBoardGames(query: $queryString) {gameId, name, year}}",bggSearchCallById:{queryString:"query getDetails($gameId:Int!) {getBoardGameDetails(gameId:$gameId) {gameId,thumb,image,name,description,year, minPlayers, maxPlayers, minPlayTime, maxPlayTime, minAge, designers, artists, publisher, numOfRaters, averageScore, rank, categories}}",resultName:"getBoardGameDetails"},findUsers:{queryString:"query {findUsers {id, username}}",resultName:"findUsers"},addToMyCollection:{queryString:"mutation addBoardGame($userId: Int!, $boardGame: BoardGameDetailInput!){addToMyCollection(userId: $userId, boardGame: $boardGame) {id,gameId}}",resultName:"addToMyCollection"},removeFromMyCollection:{queryString:"mutation removeBoardGame($userId: Int!, $boardGameId: Int!) {removeFromMyCollection(userId: $userId, boardGameId: $boardGameId) {result}}",resultName:"removeFromMyCollection"},getMyBoardGameCollection:{queryString:"query myCollection($userId: Int!) {getMyBoardGameCollection(userId: $userId) {id,gameId,thumb,image,name,description,year, minPlayers, maxPlayers, minPlayTime, maxPlayTime, minAge, designers, artists, publisher, numOfRaters, averageScore, rank, categories,scoresheets {id, player1, score1, player2, score2, player3, score3, player4, score4, player5, score5, player6, score6, player7, score7, createdOn}}}",resultName:"getMyBoardGameCollection"},addScoreSheetToBoardGame:{queryString:"mutation addScore($userId: Int!, $boardGameId: Int!, $sheet: ScoreSheetInput) {addScoreSheetToBoardGame(userId: $userId, boardGameId: $boardGameId, sheet: $sheet){id}}",resultName:"addScoreSheetToBoardGame"}},ui:{draggable:{draggableDataKeyId:"text/plain",draggedType:"draggedType",draggedFrom:"draggedFrom",draggedTypeUser:"user",draggedTypeBoardGame:"boardGame",draggedFromUserSearch:"userSearch",draggedFromBoardGameSearch:"boardGameSearch"},alert:{modalId:"alert",titleId:"alert-title",contentId:"alert-content",cancelButtonId:"alert-cancel",confirmButtonId:"alert-confirm",closeButtonId:"alert-close",hideClass:"d-none",showClass:"d-block"},navigation:{showMyCollection:"navigationItemMyCollection",boardGameSearchId:"navigationItemBoardGameSearch",userSearchId:"navigationItemUserSearch",chatId:"navigationItemChat",showScoreSheet:"navigationItemScoreSheet"},chatSideBar:{dom:{sideBarId:"chatSideBar",resultsId:"chatLogs",resultsElementType:"a",resultsElementAttributes:[["href","#"]],resultsClasses:"list-group-item my-list-item truncate-comment list-group-item-action",resultDataKeyId:"room",resultLegacyDataKeyId:"room",resultDataSourceId:"chatLogs",modifierClassNormal:"",modifierClassInactive:"list-group-item-dark",modifierClassActive:"list-group-item-primary",modifierClassWarning:"",iconNormal:"",iconInactive:"",iconActive:"",iconWarning:"",isDraggable:!1,isClickable:!0,isDeleteable:!0,deleteButtonClasses:"btn btn-circle btn-xsm",deleteButtonText:"",deleteButtonIconClasses:"fas fa-trash-alt",hasBadge:!0,resultContentDivClasses:"d-flex w-100 justify-content-between",resultContentTextElementType:"span",resultContentTextClasses:"mb-1",badgeElementType:"span",badgeElementAttributes:[["style","font-size:12pt"]],badgeClasses:"badge badge-pill badge-primary",newFormId:"newMessage",commentId:"message",submitCommentId:"submitMessage",chatLogId:"chatLog",chatLogRoomId:"chatLogRoom",leaveChatId:"leaveChat"}},userSearchSideBar:{dom:{sideBarId:"userSearchSideBar",resultsId:"recentUserSearches",favouriteUsersId:"favouriteUsers",blockedUsersId:"blockedUsers",favouriteUsersDropZone:"favouriteUsersDropZone",blockedUsersDropZone:"blockedUsersDropZone",resultsElementType:"a",resultsElementAttributes:[["href","#"]],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",resultDataKeyId:"user-id",resultLegacyDataKeyId:"legacy-user-id",resultDataSourceId:"data-source",resultDataSourceValue:"recentUserSearches",resultDataSourceFavUsers:"favouriteUsers",resultDataSourceBlockedUsers:"blockedUsers",modifierClassNormal:"list-group-item-primary",modifierClassInactive:"list-group-item-light",modifierClassActive:"list-group-item-info",modifierClassWarning:"list-group-item-danger",iconNormal:'   <i class="fas fa-comment"></i>',iconInactive:'   <i class="fas fa-comment"></i>',iconActive:'   <i class="fas fa-heart"></i>',iconWarning:'  <i class="fas fa-exclamation-circle"></i>',resultContentDivClasses:"d-flex w-100 justify-content-between",resultContentTextElementType:"span",resultContentTextClasses:"mb-1",isDraggable:!0,isClickable:!0,isDeleteable:!0,deleteButtonClasses:"btn btn-circle btn-xsm",deleteButtonText:"",deleteButtonIconClasses:"fas fa-trash-alt",extra:{fastSearchInputId:"fastSearchUserNames"}}},boardGameSearchSideBar:{dom:{sideBarId:"boardGameSearchSidebar",resultsId:"bggSearchResults",resultsElementType:"a",resultsElementAttributes:[["href","#"]],resultsClasses:"list-group-item my-list-item truncate-notification list-group-item-action",resultDataKeyId:"bgg-id",resultLegacyDataKeyId:"bgg-id",resultDataSourceId:"data-source",resultDataSourceValue:"bggSearch",modifierClassNormal:"list-group-item-primary",modifierClassInactive:"list-group-item-light",modifierClassActive:"list-group-item-info",modifierClassWarning:"list-group-item-danger",iconNormal:'   <i class="fas fa-dice"></i>',iconInactive:'   <i class="fas fa-dice"></i>',iconActive:'   <i class="fas fa-dice"></i>',iconWarning:'  <i class="fas fa-dice"></i>',resultContentDivClasses:"d-flex w-100 justify-content-between",resultContentTextElementType:"span",resultContentTextClasses:"mb-1",isDraggable:!0,isClickable:!0,isDeleteable:!0,deleteButtonClasses:"btn btn-circle btn-xsm",deleteButtonText:"",deleteButtonIconClasses:"fas fa-trash-alt",formId:"bggSearch",queryId:"queryText",buttonId:"bggSearchButton"}},scoreSheetSideBar:{dom:{sideBarId:"scoreSheetSidebar",resultsId:"scoreSheets",resultsElementType:"div",resultsElementAttributes:[["style","height:300px; width:200px"]],resultsClasses:"card text-warning col-sm-3 mr-2",resultDataKeyId:"bgg-id",resultLegacyDataKeyId:"bgg-id",resultDataSourceId:"data-source",resultDataSourceValue:"scoreSheet",modifierClassNormal:"",modifierClassInactive:"",modifierClassActive:"",modifierClassWarning:"",iconNormal:" ",iconInactive:" ",iconActive:" ",iconWarning:" ",isDraggable:!1,isClickable:!1,isDeleteable:!1,resultContentDivClasses:"card-img-overlay",resultContentTextElementType:"div",resultContentTextClasses:"ml-2",hasBackgroundImage:!0,imgElementType:"img",imgClasses:"card-img score-img"}},scoreSheet:{dom:{dropZone:"scoreSheetZone",boardGame:"selectedBoardGame",startStopTimer:"startStopTimer",timer:"timerDisplay",end:"leaveScoreSheet",scoreSheet:"scoreSheet",iconStart:"<i class='fas fa-hourglass-start'></i>",iconInProgress:"<i class='fas fa-hourglass-half'></i>",iconEnd:"<i class='fas fa-hourglass-end'></i>",iconLeave:"<i class='fas fa-sign-out-alt'></i>"}}},uiPrefs:{navigation:{},blogEntry:{},userSearchSideBar:{view:{location:"left",expandedSize:"35%"}},boardGameSearchSideBar:{view:{location:"left",expandedSize:"35%"}},chatSideBar:{view:{location:"right",expandedSize:"50%"}},scoreSheetSideBar:{view:{location:"bottom",expandedSize:"25%"}}},controller:{events:{boardGames:{eventDataKeyId:"board-game-id"}},dataLimit:{recentUserSearches:10}}},t.cancelDelete=t.cancelDelete.bind(Je(t)),t.confirmDelete=t.confirmDelete.bind(Je(t)),t.handleDeleteBoardGame=t.handleDeleteBoardGame.bind(Je(t)),t.handleShowUserSearch=t.handleShowUserSearch.bind(Je(t)),t.handleShowChat=t.handleShowChat.bind(Je(t)),t.handleShowBGGSearch=t.handleShowBGGSearch.bind(Je(t)),t.handleDragOver=t.handleDragOver.bind(Je(t)),t.handleDrop=t.handleDrop.bind(Je(t)),t.handleShowCollection=t.handleShowCollection.bind(Je(t)),t.handleShowScoreSheet=t.handleShowScoreSheet.bind(Je(t)),t.handleStartScoreSheet=t.handleStartScoreSheet.bind(Je(t)),t.handleShowScores=t.handleShowScores.bind(Je(t)),be.connectToApplication(Je(t),window.localStorage),t}a=e,(t=s).prototype=Object.create(a.prototype),t.prototype.constructor=t,We(t,a);var i=s.prototype;return i.handleDragOver=function(e){e.preventDefault()},i.handleDrop=function(e){var t=e.dataTransfer.getData(this.state.ui.draggable.draggableDataKeyId);Ke(t);var a=JSON.parse(t);Ke(a),a[this.state.ui.draggable.draggedType]===this.state.ui.draggable.draggedTypeBoardGame&&this.addBoardGameToDisplay(a)},i.addBoardGameToDisplay=function(e){be.addBoardGameToDisplay(e)},i.getCurrentUser=function(){return be.getLoggedInUserId()},i.alert=function(e,t){this.titleEl.textContent=e,this.contentEl.textContent=t,this.modalEl.classList.remove(this.state.ui.alert.hideClass),this.modalEl.classList.add(this.state.ui.alert.showClass)},i.render=function(){var e=this;Ke("Rendering App");var t=this.state.boardGames;Ke(t);var a=t.map((function(t,a){return r.a.createElement(_e,{key:a,boardGame:t,showScoresHandler:e.handleShowScores,addToCollectionHandler:be.addBoardGameToCollection,removeFromCollectionHandler:e.handleDeleteBoardGame,startScoreSheetHandler:e.handleStartScoreSheet})}));return r.a.createElement("div",{className:"root container-fluid"},r.a.createElement("div",{className:"card-group"},a))},i.cancelDelete=function(e){this.modalEl.classList.remove(this.state.ui.alert.showClass),this.modalEl.classList.add(this.state.ui.alert.hideClass),e.preventDefault()},i.confirmDelete=function(e){this.modalEl.classList.remove(this.state.ui.alert.showClass),this.modalEl.classList.add(this.state.ui.alert.hideClass),e.preventDefault();var t=this.modalEl.getAttribute(this.state.controller.events.boardGames.eventDataKeyId);t=parseInt(t),Ke("Handling Delete with id "+t);var a=this.state.boardGames,s=a.findIndex((function(e){return e.gameId===t}));if(s>=0){var i=a[s];be.removeBoardGameFromCollection(i)}},i.handleStartScoreSheet=function(e){if(e.preventDefault(),ve.getInstance().hasActiveScoreSheet()){if(!confirm("You already have an active score sheet, do you want to finish that one and start a new one?"))return;ve.getInstance().endScoreSheet()}this.hideAllSideBars();var t=e.target.getAttribute(this.state.controller.events.boardGames.eventDataKeyId);if(Ke("Handling starting score sheet for "+t),t){t=parseInt(t);var a=this.state.boardGames,s=a.findIndex((function(e){return e.gameId===t}));if(s>=0){var i=a[s];Ke(i),ve.getInstance().startScoreSheet(i),this.switchBetweenCollectionAndScoreSheet(!1)}}},i.handleDeleteBoardGame=function(e){e.preventDefault();var t=e.target.getAttribute(this.state.controller.events.boardGames.eventDataKeyId);if(Ke("Handling Delete Board Game "+t),t){t=parseInt(t);var a=this.state.boardGames,s=a.findIndex((function(e){return e.gameId===t}));if(s>=0){var i=a[s];i.decorator&&i.decorator===ne.Persisted?(Ke("Handling Delete Board Game "+t+" - persisted, confirming with user, but only if logged in"),be.isLoggedIn()?(this.modalEl.setAttribute(this.state.controller.events.boardGames.eventDataKeyId,t),this.alert(i.name+" ("+i.year+")","Are you sure you want to delete this board game from your collection?")):(Ke("Handling Delete Board Game "+t+" - IS persisted but not logged in, just deleting from local storage  asking controller to remove"),be.removeBoardGameFromDisplay(i))):(Ke("Handling Delete Board Game "+t+" - NOT persisted, asking controller to remove"),be.removeBoardGameFromDisplay(i))}}},i.componentDidMount=function(){var e,t=(e=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ke("component Did Mount"),this.chatView=new Fe(this,document,be.getStateManager()),this.chatView.onDocumentLoaded(),this.userSearchView=new Ee(this,document,be.getStateManager()),this.userSearchView.onDocumentLoaded(),this.bggSearchView=new xe(this,document,be.getStateManager()),this.bggSearchView.onDocumentLoaded(),this.scoresView=new Qe(this,document,be.getStateManager()),this.scoresView.onDocumentLoaded(),this.scoreSheetView=ge.getInstance(),this.scoreSheetView.onDocumentLoaded(this),document&&(document.getElementById(this.state.ui.navigation.boardGameSearchId).addEventListener("click",this.handleShowBGGSearch),document.getElementById(this.state.ui.navigation.userSearchId).addEventListener("click",this.handleShowUserSearch),document.getElementById(this.state.ui.navigation.chatId).addEventListener("click",this.handleShowChat),document.getElementById(this.state.ui.navigation.showMyCollection).addEventListener("click",this.handleShowCollection),document.getElementById(this.state.ui.navigation.showScoreSheet).addEventListener("click",this.handleShowScoreSheet)),this.modalEl=document.getElementById(this.state.ui.alert.modalId),this.titleEl=document.getElementById(this.state.ui.alert.titleId),this.contentEl=document.getElementById(this.state.ui.alert.contentId),this.cancelBtnEl=document.getElementById(this.state.ui.alert.cancelButtonId),this.confirmBtnEl=document.getElementById(this.state.ui.alert.confirmButtonId),this.closeBtnEl=document.getElementById(this.state.ui.alert.closeButtonId),this.cancelBtnEl&&this.cancelBtnEl.addEventListener("click",this.cancelDelete),this.confirmBtnEl&&this.confirmBtnEl.addEventListener("click",this.confirmDelete),this.closeBtnEl&&this.closeBtnEl.addEventListener("click",this.cancelDelete),this.thisEl=document.getElementById("root"),this.scoreSheetEl=document.getElementById("scoreSheetZone"),this.thisEl&&(this.thisEl.addEventListener("dragover",this.handleDragOver),this.thisEl.addEventListener("drop",this.handleDrop)),ve.getInstance().initialise(this),be.initialise();case 26:case"end":return e.stop()}}),e,this)})),function(){var t=this,a=arguments;return new Promise((function(s,i){var r=e.apply(t,a);function n(e){Ye(r,s,i,n,o,"next",e)}function o(e){Ye(r,s,i,n,o,"throw",e)}n(void 0)}))});return function(){return t.apply(this,arguments)}}(),i.hideAllSideBars=function(){this.chatView.eventHide(null),this.userSearchView.eventHide(null),this.bggSearchView.eventHide(null)},i.switchBetweenCollectionAndScoreSheet=function(e){e?(this.thisEl&&ue.addRemoveClasses(this.thisEl,"d-none",!1),this.thisEl&&ue.addRemoveClasses(this.thisEl,"d-block",!0),this.scoreSheetEl&&ue.addRemoveClasses(this.scoreSheetEl,"d-none",!0),this.scoreSheetEl&&ue.addRemoveClasses(this.scoreSheetEl,"d-block",!1)):ve.getInstance().hasActiveScoreSheet()&&(this.thisEl&&ue.addRemoveClasses(this.thisEl,"d-none",!0),this.thisEl&&ue.addRemoveClasses(this.thisEl,"d-block",!1),this.scoreSheetEl&&ue.addRemoveClasses(this.scoreSheetEl,"d-none",!1),this.scoreSheetEl&&ue.addRemoveClasses(this.scoreSheetEl,"d-block",!0))},i.handleShowCollection=function(e){this.switchBetweenCollectionAndScoreSheet(!0)},i.handleShowScoreSheet=function(e){this.switchBetweenCollectionAndScoreSheet(!1)},i.handleShowUserSearch=function(e){Ke("Handling Show User Search"),e.preventDefault(),be.isLoggedIn()?this.userSearchView.eventShow(e):window.location.href=this.state.apis.login},i.handleShowScores=function(e){Ke("Handling show board game scores"),e.preventDefault();var t=e.target.getAttribute(this.state.controller.events.boardGames.eventDataKeyId);if(Ke("Handling Show board game scores "+t),t){t=parseInt(t);var a=this.state.boardGames,s=a.findIndex((function(e){return e.gameId===t}));if(s>=0){var i=a[s];this.scoresView.setSelectedBoardGame(i),this.scoresView.eventShow(null)}}},i.handleShowChat=function(e){Ke("Handling Show Chat"),e.preventDefault(),be.isLoggedIn()?this.chatView.eventShow(e):window.location.href=this.state.apis.login},i.handleShowBGGSearch=function(e){Ke("Handling Show BGG Search View"),e.preventDefault(),be.isLoggedIn()||this.hideAllSideBars(),this.bggSearchView.eventShow(e)},s}(r.a.Component);localStorage.debug="app controller-ts controller-ts-detail api-ts socket-ts socket-listener notification-controller chat-manager board-game-search-sidebar board-game-search-sidebar:detail score-sheet-controller score-sheet-view score-sheet-sidebar score-sheet-sidebar:detail view-ts",d.a.log=console.info.bind(console);var $e=r.a.createElement(ze,{className:"container-fluid justify-content-around"});o.a.render($e,document.getElementById("root"))}});
//# sourceMappingURL=app.bundle.js.map