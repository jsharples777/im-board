{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/moment/locale sync ^\\.\\/.*$","webpack:///./node_modules/handsontable/node_modules/moment/locale sync ^\\.\\/.*$","webpack:///./src/state/StateManager.ts","webpack:///./src/state/StateChangedDelegate.ts","webpack:///./src/state/AbstractStateManager.ts","webpack:///./src/state/MemoryBufferStateManager.ts","webpack:///./src/network/Types.ts","webpack:///./src/network/ApiUtil.ts","webpack:///./src/util/UUID.ts","webpack:///./src/network/DownloadManager.ts","webpack:///./src/socket/Types.ts","webpack:///./src/state/RESTApiStateManager.ts","webpack:///./src/socket/SocketManager.ts","webpack:///./src/state/AsyncStateManagerWrapper.ts","webpack:///./src/state/AggregateStateManager.ts","webpack:///./src/notification/BootstrapNotification.ts","webpack:///./src/notification/Notification.ts","webpack:///./src/notification/NotificationFactory.ts","webpack:///./src/notification/NotificationManager.ts","webpack:///./src/util/EqualityFunctions.ts","webpack:///./src/SocketListenerDelegate.ts","webpack:///./src/state/BrowserStorageStateManager.ts","webpack:///./src/socket/ChatManager.ts","webpack:///./src/socket/NotificationController.ts","webpack:///./src/AppTypes.ts","webpack:///./src/state/GraphQLApiStateManager.ts","webpack:///./src/util/BrowserUtil.ts","webpack:///./src/component/ScoreSheetView.ts","webpack:///./src/component/ScoreSheetController.ts","webpack:///./src/Controller.ts","webpack:///./src/component/AbstractView.ts","webpack:///./src/component/SidebarView.ts","webpack:///./src/component/UserSearchSidebarView.ts","webpack:///./src/component/ChatSidebarView.ts","webpack:///./src/component/BoardGameSearchSidebarView.ts","webpack:///./src/component/BoardGameView.tsx","webpack:///./src/App.tsx"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","map","webpackContext","req","id","webpackContextResolve","e","Error","code","keys","resolve","stateEventType","smLogger","debug","suppressEventEmits","this","suppressEvents","emitEvents","informChangeListenersForStateWithName","eventType","StateChanged","previousObjValue","foundIndex","stateChangeListeners","findIndex","element","changeListenersForName","index","listener","ensureListenerSetupForName","listenersNameArrayPair","listeners","addChangeListenerForName","AbstractStateManager","forceSaves","managerName","state","stateObjForName","getStateByName","stateValueObj","_getState","setStateByName","informListeners","_saveState","stateObjectForName","addNewItemToState","isPersisted","findItemInState","testForEqualityFunction","isItemInState","removeItemFromState","oldItem","updateItemInState","msManager","getInstance","MemoryBufferStateManager","_ensureStatePresent","applicationState","_addNewNamedStateToStorage","_replaceNamedStateInStorage","find","_addItemToState","_removeItemFromState","valueIndex","_updateItemInState","RequestType","queueType","apiLogger","postFetchJSON","postParameters","method","headers","body","JSON","query","fetch","url","response","fetchJSON","callback","apiFetchJSONWithPost","request","error","apiFetchJSONWithGet","apiFetchJSONWithDelete","apiFetchJSONWithPut","putParameters","getUniqueId","replace","Math","v","dlLogger","downloader","callbackForQueueRequest","setBackgroundChangeListener","setPriorityChangeListener","getPriorityQueueCount","priorityQueue","getBackgroundQueueCount","backgroundQueue","addQLApiRequest","isPriority","type","params","variables","associatedStateName","addQLMutationRequest","mutation","addApiRequest","requestId","uuid","jsonRequest","managerRequest","originalRequest","priorityChangeListener","handleEventAddToQueue","backgroundChangeListener","processPriorityQueue","queueItem","inProgress","initiateFetchForQueueItem","processBackgroundQueue","processQueues","totalQueuedItems","queueId","handleEventRemoveFromQueue","item","apiUtil","apiSMLogger","RESTApiStateManager","configuration","callbackForAddItem","callbackForRemoveItem","callbackForUpdateItem","callbackForGetItems","getConfiguredStateNames","results","config","hasCompletedRun","bHasCompletedRun","setCompletedRun","forceResetForGet","runsComplete","stateName","serverURL","api","isActive","status","getConfigurationForStateName","stateObj","Priority","InviteType","sDebug","chatReceivers","callbackForMessage","callbackForData","callbackForLogin","callbackForLogout","callbackForJoinRoom","callbackForExitRoom","callbackForInvite","callbackForChat","callbackForQueue","callbackForUserList","addChatReceiver","dataObj","receiver","err","callbackForDeclineInvite","setListener","io","login","username","logout","joinChat","room","leaveChat","sendInvite","ChatRoom","requiresAcceptDecline","subject","attachment","inviteObj","from","to","sendMessage","priority","Normal","messageObj","message","created","getUserList","sendDeclineInvite","asyncLogger","AsyncStateManagerWrapper","stateNamesToMonitor","stateChangedItemRemoved","stateChangedItemUpdated","stateChanged","stateChangedItemAdded","aggLogger","AggregateStateManager","filters","mWF","manager","stateManager","filter","managerWithFilters","sm","stateManagers","BootstrapNotification","show","topOffset","context","duration","containerId","notificationManager","bgColorClass","containerNode","document","titleNode","titleTextNode","closeButtonNode","messageNode","containerEl","$","setTimeout","createNotification","notificationNode","notificationFactory","notification","currentCount","notifications","parentEl","isSame","item1","item2","isSameUsername","isSameGame","slLogger","SocketListenerDelegate","handleDataChangedByAnotherUser","changeUser","stateNames","user","controller","changedEntry","commentOn","notifier","deletedEntry","handleMessage","getCurrentUser","UserStatus","lsLogger","BrowserStorageStateManager","useLocalStorage","storage","getItem","stringifiedSaveData","savedResults","savedResultsJSON","newValue","initialise","cmLogger","ChatManager","currentUsername","blockedList","favouriteList","loggedInUsers","socketManager","receiveLogin","receiveLogout","receiveInvitation","receiveMessage","receiveQueuedMessages","receiveQueuedInvites","receiveJoinedRoom","receivedLeftRoom","receiveUserList","blocked","favourite","savedLogs","localStorage","chatLogs","log","roomName","users","messages","lastViewed","parseInt","moment","numOfNewMessages","foundLog","ensureChatLogExists","joinDateTime","invite","isUserInBlockedList","didChatAlreadyExist","doesChatRoomExist","happyToProceed","chatLog","isUserInFavouriteList","receiveDecline","wasOffline","invites","trim","declineInvite","sent","ensureChatLogExistsWithUser","chatLogKey","blockedListKey","favouriteListKey","notLogger","NotificationController","doNotDisturb","handleChatLogUpdated","handleLoggedInUsersUpdated","handleFavouriteUserLoggedIn","handleFavouriteUserLoggedOut","handleInvitationDeclined","handleNewInviteReceived","dontDisturbMe","isBlackedListed","isFavourited","chatManager","handleChatLogsUpdated","displayMessage","handleBlockedUsersChanged","handleFavouriteUsersChanged","handleChatStarted","handleOfflineMessagesReceived","graphSMLogger","GraphQLApiStateManager","apiURL","apis","findAll","destroy","update","dataAttribute","Decorator","scrollSmoothToId","block","behavior","scrollToBottomNow","scrollToBottomSmooth","scrollSmoothTo","scrollTo","removeAllChildren","lastChild","addRemoveClasses","isAdding","classesText","classes","classValue","addAttributes","attributes","attribute","ssvLogger","ScoreSheetView","applicationView","thisEl","boardGameTitleEl","startStopTimer","timerEl","endOrLeaveEl","scoreSheetEl","table","ScoreSheetController","ui","scoreSheet","dom","handleStartStopTimer","handleEndOrLeave","handleUserDrop","addEventListener","event","hasActiveScoreSheet","confirm","draggedObjectJSON","draggable","draggedObject","innerText","innerHTML","setAttribute","createTimerDisplay","browserUtil","timer","hours","minutes","seconds","isPaused","removeAttribute","tableData","row","rowIndex","columnIndex","sscLogger","currentScoreRoom","currentlySelectedBoardGame","currentScoreSheet","isRoomCreator","currentUsersInScoreSheet","intervalTimer","userChangedValue","endScoreSheet","pauseTimer","askUserAboutInvitation","saveCurrentScoreSheet","saveScoreSheetToBoardGame","saveData","jsonData","createdOn","players","scores","playerNames","colHeaders","rowHeaders","licenseKey","manualColumnResize","manualRowResize","selectionMode","columnSummary","destinationRow","destinationColumn","reversedRowCoords","forceNumeric","getDefaultScoreSheetTemplate","getDefaultScoreSheetStartingData","boardGame","boardGameName","sheetLayoutOptions","getScoreSheetTemplate","timerGoing","getScoreSheetStartingData","isFinished","alert","timerWasGoing","setInterval","isLoggedIn","clearInterval","source","SOURCE_View","cLogger","cLoggerDetail","connectToApplication","apiStateManager","graphSM","getServerAPIURL","findUsers","queryString","resultName","aggregateSM","memorySM","asyncDBSM","asyncQLSM","callbackBoardGameDetails","callbackAddToCollection","callbackRemoveFromCollection","callbackGetCollection","addBoardGameToCollection","removeBoardGameFromCollection","removeBoardGameFromDisplay","socketListerDelegate","getLoggedInUserId","boardGames","displayedBoardGamesStateManager","downloadAndSyncSavedBoardGameCollection","getMyBoardGameCollection","userId","getStateManager","getLoggedInUsername","addBoardGameToDisplay","currentListOfGames","bggSearchCallById","gameId","boardGameDetails","regex","removeBoardGameFromState","currentBoardGamesOnDisplay","game","findBoardGameInStateFromEvent","events","addToMyCollection","currentGameList","updatingBoardGame","removeFromMyCollection","collectionData","scoreSheetAddedToBoardGame","addScoreSheetToBoardGame","boardGameId","sheet","oldBoardGame","avLogger","onDocumentLoaded","sidePanelEl","getElementById","uiConfig","closeButtonEl","showHide","uiPrefs","view","eventHide","eventShow","size","eventStartDrag","eventClickItem","eventDeleteClickItem","getDragData","createResultForItem","dataSource","domConfig","resultDataKeyId","getIdForStateItem","legacyDataKeyId","getLegacyIdForStateItem","childEl","createElement","textEl","contentEl","imgEl","getBackgroundImage","badgeValue","getBadgeValue","badgeEl","deleteButtonEl","iconEl","displayText","getDisplayValueForStateItem","modifier","getModifierForStateItem","secondModifier","getSecondaryModifierForStateItem","createResultsForState","viewEl","newState","vLogger","vLoggerDetail","handleFavouriteUserDrop","handleBlockedUserDrop","renderFavouriteUsers","usernames","childElement","renderBlockedUsers","extra","fastSearchEl","console","eventUserSelected","localisedSM","recentUserSearches","dataLimit","label","reRenderView","updateView","myUsername","fastSearchValues","searchValue","disabled","minLength","deleteFavouriteUser","deleteBlockedUser","deleteRecentSearchUser","SidebarView","csLogger","csLoggerDetail","selectedChatLog","handleAddMessage","commentEl","messageContent","sentMessage","messageEl","addChatMessage","checkCanComment","sendMessageButton","leaveChatButton","chatMessageEl","messageSenderEl","clearChatLog","reRenderChatMessages","renderChatLog","changeSearchButton","enable","buttonEl","handleSearch","queryText","queryEl","handleSearchResultsCB","beLogger","BoardGameView","showScoresHandler","addToCollectionHandler","removeFromCollectionHandler","startScoreSheetHandler","addButton","className","board-game-id","onClick","deleteButton","startScoreSheetButton","scoreCount","favouriteIcon","scoreBadge","decorator","Incomplete","src","image","alt","year","Persisted","PersistedLocally","description","minPlayTime","maxPlayTime","minPlayers","maxPlayers","minAge","categories","rank","averageScore","numOfRaters","logger","Root","loggedInUserId","sheetData","selectedEntry","bggSearchResults","graphQL","bggSearchCall","draggableDataKeyId","draggedType","draggedFrom","draggedTypeUser","draggedTypeBoardGame","draggedFromUserSearch","draggedFromBoardGameSearch","modalId","titleId","contentId","cancelButtonId","confirmButtonId","closeButtonId","hideClass","showClass","navigation","showMyCollection","boardGameSearchId","userSearchId","chatId","showScoreSheet","chatSideBar","sideBarId","resultsId","resultsElementType","resultsElementAttributes","resultsClasses","resultLegacyDataKeyId","resultDataSourceId","modifierClassNormal","modifierClassInactive","modifierClassActive","modifierClassWarning","iconNormal","iconInactive","iconActive","iconWarning","isDraggable","isClickable","isDeleteable","deleteButtonClasses","deleteButtonText","deleteButtonIconClasses","hasBadge","resultContentDivClasses","resultContentTextElementType","resultContentTextClasses","badgeElementType","badgeElementAttributes","badgeClasses","newFormId","commentId","submitCommentId","chatLogId","chatLogRoomId","leaveChatId","userSearchSideBar","favouriteUsersId","blockedUsersId","favouriteUsersDropZone","blockedUsersDropZone","resultDataSourceValue","resultDataSourceFavUsers","resultDataSourceBlockedUsers","fastSearchInputId","boardGameSearchSideBar","formId","queryId","buttonId","scoreSheetSideBar","hasBackgroundImage","imgElementType","imgClasses","dropZone","end","iconStart","iconInProgress","iconEnd","iconLeave","blogEntry","location","expandedSize","eventDataKeyId","cancelDelete","confirmDelete","handleDeleteBoardGame","handleShowUserSearch","handleShowChat","handleShowBGGSearch","handleDragOver","handleDrop","handleShowCollection","handleShowScoreSheet","handleStartScoreSheet","preventDefault","dataTransfer","getData","parse","title","content","titleEl","textContent","modalEl","classList","remove","add","render","games","entry","getAttribute","hideAllSideBars","target","startScoreSheet","switchBetweenCollectionAndScoreSheet","componentDidMount","chatView","ChatSidebarView","userSearchView","UserSearchSidebarView","bggSearchView","BoardGameSearchSidebarView","scoreSheetView","cancelBtnEl","confirmBtnEl","closeBtnEl","showCollection","href","React","Component","info","ReactDOM"],"mappings":"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d,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,aAAc,IACd,UAAW,IACX,aAAc,IACd,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,aAAc,IACd,gBAAiB,IACjB,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,UAAW,IACX,aAAc,IACd,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,aAAc,IACd,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,aAAc,IACd,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,aAAc,IACd,UAAW,IACX,OAAQ,IACR,UAAW,IACX,UAAW,IACX,aAAc,IACd,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,aAAc,IACd,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,IACR,UAAW,IACX,OAAQ,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","file":"app.bundle.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([449,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","var map = {\n\t\"./af\": 142,\n\t\"./af.js\": 142,\n\t\"./ar\": 143,\n\t\"./ar-dz\": 144,\n\t\"./ar-dz.js\": 144,\n\t\"./ar-kw\": 145,\n\t\"./ar-kw.js\": 145,\n\t\"./ar-ly\": 146,\n\t\"./ar-ly.js\": 146,\n\t\"./ar-ma\": 147,\n\t\"./ar-ma.js\": 147,\n\t\"./ar-sa\": 148,\n\t\"./ar-sa.js\": 148,\n\t\"./ar-tn\": 149,\n\t\"./ar-tn.js\": 149,\n\t\"./ar.js\": 143,\n\t\"./az\": 150,\n\t\"./az.js\": 150,\n\t\"./be\": 151,\n\t\"./be.js\": 151,\n\t\"./bg\": 152,\n\t\"./bg.js\": 152,\n\t\"./bm\": 153,\n\t\"./bm.js\": 153,\n\t\"./bn\": 154,\n\t\"./bn-bd\": 155,\n\t\"./bn-bd.js\": 155,\n\t\"./bn.js\": 154,\n\t\"./bo\": 156,\n\t\"./bo.js\": 156,\n\t\"./br\": 157,\n\t\"./br.js\": 157,\n\t\"./bs\": 158,\n\t\"./bs.js\": 158,\n\t\"./ca\": 159,\n\t\"./ca.js\": 159,\n\t\"./cs\": 160,\n\t\"./cs.js\": 160,\n\t\"./cv\": 161,\n\t\"./cv.js\": 161,\n\t\"./cy\": 162,\n\t\"./cy.js\": 162,\n\t\"./da\": 163,\n\t\"./da.js\": 163,\n\t\"./de\": 164,\n\t\"./de-at\": 165,\n\t\"./de-at.js\": 165,\n\t\"./de-ch\": 166,\n\t\"./de-ch.js\": 166,\n\t\"./de.js\": 164,\n\t\"./dv\": 167,\n\t\"./dv.js\": 167,\n\t\"./el\": 168,\n\t\"./el.js\": 168,\n\t\"./en-au\": 169,\n\t\"./en-au.js\": 169,\n\t\"./en-ca\": 170,\n\t\"./en-ca.js\": 170,\n\t\"./en-gb\": 171,\n\t\"./en-gb.js\": 171,\n\t\"./en-ie\": 172,\n\t\"./en-ie.js\": 172,\n\t\"./en-il\": 173,\n\t\"./en-il.js\": 173,\n\t\"./en-in\": 174,\n\t\"./en-in.js\": 174,\n\t\"./en-nz\": 175,\n\t\"./en-nz.js\": 175,\n\t\"./en-sg\": 176,\n\t\"./en-sg.js\": 176,\n\t\"./eo\": 177,\n\t\"./eo.js\": 177,\n\t\"./es\": 178,\n\t\"./es-do\": 179,\n\t\"./es-do.js\": 179,\n\t\"./es-mx\": 180,\n\t\"./es-mx.js\": 180,\n\t\"./es-us\": 181,\n\t\"./es-us.js\": 181,\n\t\"./es.js\": 178,\n\t\"./et\": 182,\n\t\"./et.js\": 182,\n\t\"./eu\": 183,\n\t\"./eu.js\": 183,\n\t\"./fa\": 184,\n\t\"./fa.js\": 184,\n\t\"./fi\": 185,\n\t\"./fi.js\": 185,\n\t\"./fil\": 186,\n\t\"./fil.js\": 186,\n\t\"./fo\": 187,\n\t\"./fo.js\": 187,\n\t\"./fr\": 188,\n\t\"./fr-ca\": 189,\n\t\"./fr-ca.js\": 189,\n\t\"./fr-ch\": 190,\n\t\"./fr-ch.js\": 190,\n\t\"./fr.js\": 188,\n\t\"./fy\": 191,\n\t\"./fy.js\": 191,\n\t\"./ga\": 192,\n\t\"./ga.js\": 192,\n\t\"./gd\": 193,\n\t\"./gd.js\": 193,\n\t\"./gl\": 194,\n\t\"./gl.js\": 194,\n\t\"./gom-deva\": 195,\n\t\"./gom-deva.js\": 195,\n\t\"./gom-latn\": 196,\n\t\"./gom-latn.js\": 196,\n\t\"./gu\": 197,\n\t\"./gu.js\": 197,\n\t\"./he\": 198,\n\t\"./he.js\": 198,\n\t\"./hi\": 199,\n\t\"./hi.js\": 199,\n\t\"./hr\": 200,\n\t\"./hr.js\": 200,\n\t\"./hu\": 201,\n\t\"./hu.js\": 201,\n\t\"./hy-am\": 202,\n\t\"./hy-am.js\": 202,\n\t\"./id\": 203,\n\t\"./id.js\": 203,\n\t\"./is\": 204,\n\t\"./is.js\": 204,\n\t\"./it\": 205,\n\t\"./it-ch\": 206,\n\t\"./it-ch.js\": 206,\n\t\"./it.js\": 205,\n\t\"./ja\": 207,\n\t\"./ja.js\": 207,\n\t\"./jv\": 208,\n\t\"./jv.js\": 208,\n\t\"./ka\": 209,\n\t\"./ka.js\": 209,\n\t\"./kk\": 210,\n\t\"./kk.js\": 210,\n\t\"./km\": 211,\n\t\"./km.js\": 211,\n\t\"./kn\": 212,\n\t\"./kn.js\": 212,\n\t\"./ko\": 213,\n\t\"./ko.js\": 213,\n\t\"./ku\": 214,\n\t\"./ku.js\": 214,\n\t\"./ky\": 215,\n\t\"./ky.js\": 215,\n\t\"./lb\": 216,\n\t\"./lb.js\": 216,\n\t\"./lo\": 217,\n\t\"./lo.js\": 217,\n\t\"./lt\": 218,\n\t\"./lt.js\": 218,\n\t\"./lv\": 219,\n\t\"./lv.js\": 219,\n\t\"./me\": 220,\n\t\"./me.js\": 220,\n\t\"./mi\": 221,\n\t\"./mi.js\": 221,\n\t\"./mk\": 222,\n\t\"./mk.js\": 222,\n\t\"./ml\": 223,\n\t\"./ml.js\": 223,\n\t\"./mn\": 224,\n\t\"./mn.js\": 224,\n\t\"./mr\": 225,\n\t\"./mr.js\": 225,\n\t\"./ms\": 226,\n\t\"./ms-my\": 227,\n\t\"./ms-my.js\": 227,\n\t\"./ms.js\": 226,\n\t\"./mt\": 228,\n\t\"./mt.js\": 228,\n\t\"./my\": 229,\n\t\"./my.js\": 229,\n\t\"./nb\": 230,\n\t\"./nb.js\": 230,\n\t\"./ne\": 231,\n\t\"./ne.js\": 231,\n\t\"./nl\": 232,\n\t\"./nl-be\": 233,\n\t\"./nl-be.js\": 233,\n\t\"./nl.js\": 232,\n\t\"./nn\": 234,\n\t\"./nn.js\": 234,\n\t\"./oc-lnc\": 235,\n\t\"./oc-lnc.js\": 235,\n\t\"./pa-in\": 236,\n\t\"./pa-in.js\": 236,\n\t\"./pl\": 237,\n\t\"./pl.js\": 237,\n\t\"./pt\": 238,\n\t\"./pt-br\": 239,\n\t\"./pt-br.js\": 239,\n\t\"./pt.js\": 238,\n\t\"./ro\": 240,\n\t\"./ro.js\": 240,\n\t\"./ru\": 241,\n\t\"./ru.js\": 241,\n\t\"./sd\": 242,\n\t\"./sd.js\": 242,\n\t\"./se\": 243,\n\t\"./se.js\": 243,\n\t\"./si\": 244,\n\t\"./si.js\": 244,\n\t\"./sk\": 245,\n\t\"./sk.js\": 245,\n\t\"./sl\": 246,\n\t\"./sl.js\": 246,\n\t\"./sq\": 247,\n\t\"./sq.js\": 247,\n\t\"./sr\": 248,\n\t\"./sr-cyrl\": 249,\n\t\"./sr-cyrl.js\": 249,\n\t\"./sr.js\": 248,\n\t\"./ss\": 250,\n\t\"./ss.js\": 250,\n\t\"./sv\": 251,\n\t\"./sv.js\": 251,\n\t\"./sw\": 252,\n\t\"./sw.js\": 252,\n\t\"./ta\": 253,\n\t\"./ta.js\": 253,\n\t\"./te\": 254,\n\t\"./te.js\": 254,\n\t\"./tet\": 255,\n\t\"./tet.js\": 255,\n\t\"./tg\": 256,\n\t\"./tg.js\": 256,\n\t\"./th\": 257,\n\t\"./th.js\": 257,\n\t\"./tk\": 258,\n\t\"./tk.js\": 258,\n\t\"./tl-ph\": 259,\n\t\"./tl-ph.js\": 259,\n\t\"./tlh\": 260,\n\t\"./tlh.js\": 260,\n\t\"./tr\": 261,\n\t\"./tr.js\": 261,\n\t\"./tzl\": 262,\n\t\"./tzl.js\": 262,\n\t\"./tzm\": 263,\n\t\"./tzm-latn\": 264,\n\t\"./tzm-latn.js\": 264,\n\t\"./tzm.js\": 263,\n\t\"./ug-cn\": 265,\n\t\"./ug-cn.js\": 265,\n\t\"./uk\": 266,\n\t\"./uk.js\": 266,\n\t\"./ur\": 267,\n\t\"./ur.js\": 267,\n\t\"./uz\": 268,\n\t\"./uz-latn\": 269,\n\t\"./uz-latn.js\": 269,\n\t\"./uz.js\": 268,\n\t\"./vi\": 270,\n\t\"./vi.js\": 270,\n\t\"./x-pseudo\": 271,\n\t\"./x-pseudo.js\": 271,\n\t\"./yo\": 272,\n\t\"./yo.js\": 272,\n\t\"./zh-cn\": 273,\n\t\"./zh-cn.js\": 273,\n\t\"./zh-hk\": 274,\n\t\"./zh-hk.js\": 274,\n\t\"./zh-mo\": 275,\n\t\"./zh-mo.js\": 275,\n\t\"./zh-tw\": 276,\n\t\"./zh-tw.js\": 276\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 457;","var map = {\n\t\"./af\": 306,\n\t\"./af.js\": 306,\n\t\"./ar\": 307,\n\t\"./ar-dz\": 308,\n\t\"./ar-dz.js\": 308,\n\t\"./ar-kw\": 309,\n\t\"./ar-kw.js\": 309,\n\t\"./ar-ly\": 310,\n\t\"./ar-ly.js\": 310,\n\t\"./ar-ma\": 311,\n\t\"./ar-ma.js\": 311,\n\t\"./ar-sa\": 312,\n\t\"./ar-sa.js\": 312,\n\t\"./ar-tn\": 313,\n\t\"./ar-tn.js\": 313,\n\t\"./ar.js\": 307,\n\t\"./az\": 314,\n\t\"./az.js\": 314,\n\t\"./be\": 315,\n\t\"./be.js\": 315,\n\t\"./bg\": 316,\n\t\"./bg.js\": 316,\n\t\"./bm\": 317,\n\t\"./bm.js\": 317,\n\t\"./bn\": 318,\n\t\"./bn.js\": 318,\n\t\"./bo\": 319,\n\t\"./bo.js\": 319,\n\t\"./br\": 320,\n\t\"./br.js\": 320,\n\t\"./bs\": 321,\n\t\"./bs.js\": 321,\n\t\"./ca\": 322,\n\t\"./ca.js\": 322,\n\t\"./cs\": 323,\n\t\"./cs.js\": 323,\n\t\"./cv\": 324,\n\t\"./cv.js\": 324,\n\t\"./cy\": 325,\n\t\"./cy.js\": 325,\n\t\"./da\": 326,\n\t\"./da.js\": 326,\n\t\"./de\": 327,\n\t\"./de-at\": 328,\n\t\"./de-at.js\": 328,\n\t\"./de-ch\": 329,\n\t\"./de-ch.js\": 329,\n\t\"./de.js\": 327,\n\t\"./dv\": 330,\n\t\"./dv.js\": 330,\n\t\"./el\": 331,\n\t\"./el.js\": 331,\n\t\"./en-SG\": 332,\n\t\"./en-SG.js\": 332,\n\t\"./en-au\": 333,\n\t\"./en-au.js\": 333,\n\t\"./en-ca\": 334,\n\t\"./en-ca.js\": 334,\n\t\"./en-gb\": 335,\n\t\"./en-gb.js\": 335,\n\t\"./en-ie\": 336,\n\t\"./en-ie.js\": 336,\n\t\"./en-il\": 337,\n\t\"./en-il.js\": 337,\n\t\"./en-nz\": 338,\n\t\"./en-nz.js\": 338,\n\t\"./eo\": 339,\n\t\"./eo.js\": 339,\n\t\"./es\": 340,\n\t\"./es-do\": 341,\n\t\"./es-do.js\": 341,\n\t\"./es-us\": 342,\n\t\"./es-us.js\": 342,\n\t\"./es.js\": 340,\n\t\"./et\": 343,\n\t\"./et.js\": 343,\n\t\"./eu\": 344,\n\t\"./eu.js\": 344,\n\t\"./fa\": 345,\n\t\"./fa.js\": 345,\n\t\"./fi\": 346,\n\t\"./fi.js\": 346,\n\t\"./fo\": 347,\n\t\"./fo.js\": 347,\n\t\"./fr\": 348,\n\t\"./fr-ca\": 349,\n\t\"./fr-ca.js\": 349,\n\t\"./fr-ch\": 350,\n\t\"./fr-ch.js\": 350,\n\t\"./fr.js\": 348,\n\t\"./fy\": 351,\n\t\"./fy.js\": 351,\n\t\"./ga\": 352,\n\t\"./ga.js\": 352,\n\t\"./gd\": 353,\n\t\"./gd.js\": 353,\n\t\"./gl\": 354,\n\t\"./gl.js\": 354,\n\t\"./gom-latn\": 355,\n\t\"./gom-latn.js\": 355,\n\t\"./gu\": 356,\n\t\"./gu.js\": 356,\n\t\"./he\": 357,\n\t\"./he.js\": 357,\n\t\"./hi\": 358,\n\t\"./hi.js\": 358,\n\t\"./hr\": 359,\n\t\"./hr.js\": 359,\n\t\"./hu\": 360,\n\t\"./hu.js\": 360,\n\t\"./hy-am\": 361,\n\t\"./hy-am.js\": 361,\n\t\"./id\": 362,\n\t\"./id.js\": 362,\n\t\"./is\": 363,\n\t\"./is.js\": 363,\n\t\"./it\": 364,\n\t\"./it-ch\": 365,\n\t\"./it-ch.js\": 365,\n\t\"./it.js\": 364,\n\t\"./ja\": 366,\n\t\"./ja.js\": 366,\n\t\"./jv\": 367,\n\t\"./jv.js\": 367,\n\t\"./ka\": 368,\n\t\"./ka.js\": 368,\n\t\"./kk\": 369,\n\t\"./kk.js\": 369,\n\t\"./km\": 370,\n\t\"./km.js\": 370,\n\t\"./kn\": 371,\n\t\"./kn.js\": 371,\n\t\"./ko\": 372,\n\t\"./ko.js\": 372,\n\t\"./ku\": 373,\n\t\"./ku.js\": 373,\n\t\"./ky\": 374,\n\t\"./ky.js\": 374,\n\t\"./lb\": 375,\n\t\"./lb.js\": 375,\n\t\"./lo\": 376,\n\t\"./lo.js\": 376,\n\t\"./lt\": 377,\n\t\"./lt.js\": 377,\n\t\"./lv\": 378,\n\t\"./lv.js\": 378,\n\t\"./me\": 379,\n\t\"./me.js\": 379,\n\t\"./mi\": 380,\n\t\"./mi.js\": 380,\n\t\"./mk\": 381,\n\t\"./mk.js\": 381,\n\t\"./ml\": 382,\n\t\"./ml.js\": 382,\n\t\"./mn\": 383,\n\t\"./mn.js\": 383,\n\t\"./mr\": 384,\n\t\"./mr.js\": 384,\n\t\"./ms\": 385,\n\t\"./ms-my\": 386,\n\t\"./ms-my.js\": 386,\n\t\"./ms.js\": 385,\n\t\"./mt\": 387,\n\t\"./mt.js\": 387,\n\t\"./my\": 388,\n\t\"./my.js\": 388,\n\t\"./nb\": 389,\n\t\"./nb.js\": 389,\n\t\"./ne\": 390,\n\t\"./ne.js\": 390,\n\t\"./nl\": 391,\n\t\"./nl-be\": 392,\n\t\"./nl-be.js\": 392,\n\t\"./nl.js\": 391,\n\t\"./nn\": 393,\n\t\"./nn.js\": 393,\n\t\"./pa-in\": 394,\n\t\"./pa-in.js\": 394,\n\t\"./pl\": 395,\n\t\"./pl.js\": 395,\n\t\"./pt\": 396,\n\t\"./pt-br\": 397,\n\t\"./pt-br.js\": 397,\n\t\"./pt.js\": 396,\n\t\"./ro\": 398,\n\t\"./ro.js\": 398,\n\t\"./ru\": 399,\n\t\"./ru.js\": 399,\n\t\"./sd\": 400,\n\t\"./sd.js\": 400,\n\t\"./se\": 401,\n\t\"./se.js\": 401,\n\t\"./si\": 402,\n\t\"./si.js\": 402,\n\t\"./sk\": 403,\n\t\"./sk.js\": 403,\n\t\"./sl\": 404,\n\t\"./sl.js\": 404,\n\t\"./sq\": 405,\n\t\"./sq.js\": 405,\n\t\"./sr\": 406,\n\t\"./sr-cyrl\": 407,\n\t\"./sr-cyrl.js\": 407,\n\t\"./sr.js\": 406,\n\t\"./ss\": 408,\n\t\"./ss.js\": 408,\n\t\"./sv\": 409,\n\t\"./sv.js\": 409,\n\t\"./sw\": 410,\n\t\"./sw.js\": 410,\n\t\"./ta\": 411,\n\t\"./ta.js\": 411,\n\t\"./te\": 412,\n\t\"./te.js\": 412,\n\t\"./tet\": 413,\n\t\"./tet.js\": 413,\n\t\"./tg\": 414,\n\t\"./tg.js\": 414,\n\t\"./th\": 415,\n\t\"./th.js\": 415,\n\t\"./tl-ph\": 416,\n\t\"./tl-ph.js\": 416,\n\t\"./tlh\": 417,\n\t\"./tlh.js\": 417,\n\t\"./tr\": 418,\n\t\"./tr.js\": 418,\n\t\"./tzl\": 419,\n\t\"./tzl.js\": 419,\n\t\"./tzm\": 420,\n\t\"./tzm-latn\": 421,\n\t\"./tzm-latn.js\": 421,\n\t\"./tzm.js\": 420,\n\t\"./ug-cn\": 422,\n\t\"./ug-cn.js\": 422,\n\t\"./uk\": 423,\n\t\"./uk.js\": 423,\n\t\"./ur\": 424,\n\t\"./ur.js\": 424,\n\t\"./uz\": 425,\n\t\"./uz-latn\": 426,\n\t\"./uz-latn.js\": 426,\n\t\"./uz.js\": 425,\n\t\"./vi\": 427,\n\t\"./vi.js\": 427,\n\t\"./x-pseudo\": 428,\n\t\"./x-pseudo.js\": 428,\n\t\"./yo\": 429,\n\t\"./yo.js\": 429,\n\t\"./zh-cn\": 430,\n\t\"./zh-cn.js\": 430,\n\t\"./zh-hk\": 431,\n\t\"./zh-hk.js\": 431,\n\t\"./zh-tw\": 432,\n\t\"./zh-tw.js\": 432\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 475;","import {equalityFunction} from \"../util/EqualityFunctions\";\nimport {StateChangeInformer} from \"./StateChangeInformer\";\nimport StateChangeListener from \"./StateChangeListener\";\n\nexport type stateValue = { name: string, value: any};\nexport type stateListeners = {name:string, listeners: StateChangeListener[]};\nexport enum stateEventType {\n    ItemAdded,\n    ItemUpdated,\n    ItemDeleted,\n    StateChanged\n}\n\nexport interface StateManager extends StateChangeInformer {\n\n    getStateByName(name: string): any;\n    setStateByName(name: string, stateObjectForName: any, informListeners: boolean): void;\n    addNewItemToState(name: string, item: any, isPersisted: boolean): void;\n    findItemInState(name: string, item: any, testForEqualityFunction: equalityFunction): any;\n    isItemInState(name: string, item: any, testForEqualityFunction: equalityFunction): boolean;\n    removeItemFromState(name: string, item: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): boolean;\n    updateItemInState(name: string, item: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): boolean;\n\n    // internal methods for optimization and aggregate SM (only use if writing a new state manager)\n    _addNewNamedStateToStorage(state:stateValue): void;\n    _getState(name:string):stateValue;\n    _ensureStatePresent(name:string):void;\n    _replaceNamedStateInStorage(state:stateValue):void;\n    _saveState(name:string,stateObj:any):void;\n    _addItemToState(name:string, stateObj:any,isPersisted:boolean):void;\n    _removeItemFromState(name:string, stateObj:any,testForEqualityFunction:equalityFunction, isPersisted: boolean):void;\n    _updateItemInState(name:string, stateObj:any,testForEqualityFunction:equalityFunction, isPersisted: boolean):void;\n\n}","import {StateChangeInformer} from \"./StateChangeInformer\";\nimport {stateEventType, stateListeners} from \"./StateManager\";\nimport StateChangeListener from \"./StateChangeListener\";\nimport debug from \"debug\";\n\nconst smLogger = debug('state-manager-delegate');\n\nclass StateChangedDelegate implements StateChangeInformer {\n    protected stateChangeListeners: stateListeners[];\n    protected suppressEventEmits:boolean = false;\n    protected managerName:string;\n\n    public constructor(managerName:string) {\n        this.managerName = managerName;\n        this.stateChangeListeners = [];\n    }\n\n    public suppressEvents() {\n        this.suppressEventEmits = true;\n    }\n\n    public emitEvents() {\n        this.suppressEventEmits = false;\n    }\n\n    informChangeListenersForStateWithName(name: string, stateObjValue: any, eventType: stateEventType = stateEventType.StateChanged, previousObjValue: any | null = null) {\n        smLogger(`State Manager: Informing state listeners of ${name}`);\n        if (this.suppressEventEmits) {\n            smLogger(`State Manager: Events suppressed`);\n            return;\n        }\n        const foundIndex = this.stateChangeListeners.findIndex(element => element.name === name);\n        if (foundIndex >= 0) {\n            smLogger(`State Manager: Found state listeners of ${name} with event type ${eventType}`);\n            /* let each state change listener know */\n            const changeListenersForName = this.stateChangeListeners[foundIndex];\n            for (let index = 0; index < changeListenersForName.listeners.length; index++) {\n                smLogger(`State Manager: Found state listener of ${name} - informing`);\n                const listener = changeListenersForName.listeners[index];\n                switch (eventType) {\n                    case (stateEventType.StateChanged): {\n                        listener.stateChanged(this.managerName, name, stateObjValue);\n                        break;\n                    }\n                    case (stateEventType.ItemAdded): {\n                        listener.stateChangedItemAdded(this.managerName, name, stateObjValue);\n                        break;\n                    }\n                    case (stateEventType.ItemUpdated): {\n                        listener.stateChangedItemUpdated(this.managerName, name, previousObjValue, stateObjValue);\n                        break;\n                    }\n                    case (stateEventType.ItemDeleted): {\n                        listener.stateChangedItemRemoved(this.managerName, name, stateObjValue);\n                        break;\n                    }\n                }\n\n            }\n        }\n    }\n\n\n    private ensureListenerSetupForName(name:string) {\n        const foundIndex = this.stateChangeListeners.findIndex(element => element.name === name);\n        if (foundIndex < 0) {\n            const listenersNameArrayPair = {\n                name,\n                listeners: [],\n            };\n            this.stateChangeListeners.push(listenersNameArrayPair);\n        }\n    }\n\n    /*\n          Add a state listener for a given state name\n          the listener should be a function with two parameters\n          name - string - the name of the state variable that they want to be informed about\n          stateObjValue - object - the new state value\n         */\n    addChangeListenerForName(name: string, listener: StateChangeListener): void {\n        this.ensureListenerSetupForName(name);\n        smLogger(`State Manager: Adding state listener for ${name}`);\n        const foundIndex = this.stateChangeListeners.findIndex(element => element.name === name);\n        if (foundIndex >= 0) {\n            let changeListenersForName = this.stateChangeListeners[foundIndex];\n            changeListenersForName.listeners.push(listener);\n        }\n    }\n\n}\n\nexport default StateChangedDelegate;","import debug from 'debug';\nimport StateChangeListener from './StateChangeListener';\nimport {equalityFunction} from '../util/EqualityFunctions';\nimport {stateEventType, StateManager, stateValue} from \"./StateManager\";\nimport {StateChangeInformer} from \"./StateChangeInformer\";\nimport StateChangedDelegate from \"./StateChangedDelegate\";\n\nconst smLogger = debug('state-manager-ts');\n\n\n\nexport abstract class AbstractStateManager implements StateManager {\n\n    protected forceSaves:boolean = true;\n    protected managerName:string = '';\n    protected delegate:StateChangeInformer;\n\n    protected constructor(managerName:string) {\n        this.delegate = new StateChangedDelegate(managerName);\n        this.managerName = managerName;\n        this.emitEvents();\n        this.forceSaves = true;\n    }\n\n    suppressEvents(): void {\n        this.delegate.suppressEvents();\n    }\n    emitEvents(): void {\n        this.delegate.emitEvents();\n    }\n\n\n\n    public dontForceSavesOnAddRemoveUpdate() {\n        this.forceSaves = false;\n    }\n\n    public forceSavesOnAddRemoveUpdate() {\n        this.forceSaves = true;\n    }\n\n    informChangeListenersForStateWithName(name: string, stateObjValue: any, eventType: stateEventType = stateEventType.StateChanged, previousObjValue: any | null = null) {\n        this.delegate.informChangeListenersForStateWithName(name,stateObjValue,eventType,previousObjValue);\n    }\n\n\n    addChangeListenerForName(name: string, listener: StateChangeListener): void {\n        this.delegate.addChangeListenerForName(name,listener);\n    }\n\n    public abstract _ensureStatePresent(name:string):void;\n    public abstract _addNewNamedStateToStorage(state:stateValue):void;\n    public abstract _replaceNamedStateInStorage(state:stateValue):void;\n    public abstract _getState(name:string):stateValue;\n    public abstract _saveState(name:string,stateObj:any):void;\n    public abstract _addItemToState(name:string,stateObj:any,isPersisted:boolean):void;\n    public abstract _removeItemFromState(name:string,stateObj:any,testForEqualityFunction:equalityFunction, isPersisted: boolean):void;\n    public abstract _updateItemInState(name:string,stateObj:any,testForEqualityFunction:equalityFunction, isPersisted: boolean):void;\n\n    public addStateByName(name:string, stateObjForName:any):any {\n        this._ensureStatePresent(name);\n        /* create a new state attribute for the application state */\n        const state:stateValue = {\n            name,\n            value: stateObjForName,\n        };\n        /* get the current state value and replace it */\n        this._replaceNamedStateInStorage(state);\n        this.informChangeListenersForStateWithName(name,stateObjForName,stateEventType.StateChanged);\n        return stateObjForName;\n    }\n\n    getStateByName(name: string): any {\n        this._ensureStatePresent(name);\n        smLogger(`State Manager: Getting state for ${name}`);\n        let stateValueObj = {};\n        // get the current state\n        const state: stateValue = this._getState(name);\n        stateValueObj = state.value;\n        smLogger(`State Manager: Found previous state for ${name}`);\n        smLogger(stateValueObj);\n        return stateValueObj;\n    }\n\n    setStateByName(name: string, stateObjectForName: any, informListeners: boolean = true): void {\n        this._ensureStatePresent(name);\n        smLogger(`State Manager: Setting state for ${name}`);\n        smLogger(stateObjectForName);\n        // set the current state\n        const state: stateValue = this._getState(name);\n        state.value = stateObjectForName;\n        if (this.forceSaves) this._saveState(name, stateObjectForName);\n        if (informListeners) this.informChangeListenersForStateWithName(name, stateObjectForName);\n        return stateObjectForName;\n    }\n\n    addNewItemToState(name: string, item: any, isPersisted: boolean = false): void { // assumes state is an array\n        this._ensureStatePresent(name);\n        smLogger(`State Manager: Adding item to state ${name}`);\n        // const state = this.getStateByName(name);\n        // state.push(item);\n        // smLogger(state);\n        this._addItemToState(name, item, isPersisted);\n        this.informChangeListenersForStateWithName(name, item, stateEventType.ItemAdded);\n    }\n\n    findItemInState(name: string, item: any, testForEqualityFunction: equalityFunction): any { // assumes state is an array\n        this._ensureStatePresent(name);\n        let result = {};\n        const state = this.getStateByName(name);\n        const foundIndex = state.findIndex((element: any) => testForEqualityFunction(element, item));\n        smLogger(`Finding item in state ${name} - found index ${foundIndex}`);\n        smLogger(item);\n        if (foundIndex >= 0) {\n            result = state[foundIndex];\n        }\n        return result;\n    }\n\n    isItemInState(name: string, item: any, testForEqualityFunction: equalityFunction): boolean { // assumes state is an array\n        this._ensureStatePresent(name);\n        let result = false;\n        const state = this.getStateByName(name);\n        const foundIndex = state.findIndex((element: any) => testForEqualityFunction(element, item));\n        if (foundIndex >= 0) {\n            result = true;\n        }\n        return result;\n    }\n\n    removeItemFromState(name: string, item: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): boolean {\n        this._ensureStatePresent(name);\n        let result = true;\n        let oldItem = this.findItemInState(name,item,testForEqualityFunction);\n        // remove the item from the state\n        smLogger('State Manager: Found item - removing ');\n        this._removeItemFromState(name, item, testForEqualityFunction, isPersisted);\n        //this.setStateByName(name, state, false);\n        this.informChangeListenersForStateWithName(name, oldItem, stateEventType.ItemDeleted);\n        return result;\n    }\n\n    updateItemInState(name: string, item: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): boolean {\n        this._ensureStatePresent(name);\n        let result = true;\n        let oldItem:any = this.findItemInState(name,item,testForEqualityFunction);\n        smLogger('State Manager: Found item - replacing ');\n        this._updateItemInState(name, item, testForEqualityFunction,isPersisted);\n        //this.setStateByName(name, this.getStateByName(name), false);\n        this.informChangeListenersForStateWithName(name, item, stateEventType.ItemUpdated, oldItem);\n        return result;\n    }\n\n\n}\n","import debug from 'debug';\nimport {AbstractStateManager} from './AbstractStateManager';\nimport {equalityFunction} from \"../util/EqualityFunctions\";\nimport {stateValue} from \"./StateManager\";\n\nconst msManager = debug('state-manager-ms');\n\n/** To Do - make state unchangeable outside of this class (i.e. deep copies) */\nclass MemoryBufferStateManager extends AbstractStateManager {\n  private static _instance:MemoryBufferStateManager;\n\n  public static getInstance() {\n    if (!(MemoryBufferStateManager._instance)) {\n      MemoryBufferStateManager._instance = new MemoryBufferStateManager();\n    }\n    return MemoryBufferStateManager._instance;\n  }\n\n\n\n  protected applicationState:stateValue[];\n\n  public constructor() {\n    super('memory');\n    this.applicationState = [];\n    this.forceSaves = true;\n  }\n\n  public _ensureStatePresent(name:string) {\n    let foundIndex = this.applicationState.findIndex(element => element.name === name);\n    if (foundIndex < 0) {\n      let state:stateValue = {\n        name:name,\n        value:[]\n      };\n      this.applicationState.push(state);\n    }\n  }\n\n  public _addNewNamedStateToStorage(state:stateValue):void {\n    msManager(`Adding new complete state ${name}`);\n    msManager(state.value);\n    this.applicationState.push(state);\n  }\n\n  public _replaceNamedStateInStorage(state:stateValue):void {\n     let foundIndex:number = this.applicationState.findIndex(element => element.name === state.name);\n     if (foundIndex >= 0) {\n       msManager(`replacing complete state ${name}`);\n       msManager(state.value);\n       this.applicationState.splice(foundIndex,1,state);\n     }\n  }\n\n  public _getState(name:string):stateValue {\n    // @ts-ignore\n    let state:stateValue = this.applicationState.find(element => element.name === name);\n    msManager(`getting complete state ${name}`);\n    msManager(state.value);\n    return state;\n  }\n\n  public _saveState(name:string,stateObject:any):void {\n    let foundIndex:number = this.applicationState.findIndex(element => element.name === name);\n    if (foundIndex >= 0) {\n      let state:stateValue = this.applicationState[foundIndex];\n      msManager(`SAVING complete state ${name}`);\n      msManager(state.value);\n      state.value = stateObject;\n    }\n  }\n\n  _addItemToState(name: string, stateObj: any,isPersisted:boolean = false): void {\n    if (!isPersisted) return; // dont add incomplete objects to the state\n    let foundIndex:number = this.applicationState.findIndex(element => element.name === name);\n    if (foundIndex >= 0) {\n      let state:stateValue = this.applicationState[foundIndex];\n      msManager(`adding item to state ${name}`);\n      msManager(stateObj);\n      state.value.push(stateObj);\n    }\n  }\n\n  _removeItemFromState(name: string, stateObj: any,testForEqualityFunction:equalityFunction, isPersisted: boolean): void {\n    let foundIndex:number = this.applicationState.findIndex(element => element.name === name);\n    if (foundIndex >= 0) {\n      let state:stateValue = this.applicationState[foundIndex];\n      const valueIndex = state.value.findIndex((element: any) => testForEqualityFunction(element, stateObj));\n      if (valueIndex >= 0) {\n        msManager(`removing item from state ${name}`);\n        msManager(stateObj);\n        state.value.splice(valueIndex, 1);\n      }\n    }\n  }\n\n  _updateItemInState(name: string, stateObj: any,testForEqualityFunction:equalityFunction, isPersisted: boolean): void {\n    let foundIndex:number = this.applicationState.findIndex(element => element.name === name);\n    if (foundIndex >= 0) {\n      let state:stateValue = this.applicationState[foundIndex];\n      const valueIndex = state.value.findIndex((element: any) => testForEqualityFunction(element, stateObj));\n      if (valueIndex >= 0) {\n        state.value.splice(valueIndex, 1,stateObj);\n        msManager(`updating item in state ${name}`);\n        msManager(stateObj);\n      }\n    }\n    else {\n      this._addItemToState(name,stateObj,true);\n    }\n  }\n\n}\n\nexport default MemoryBufferStateManager;\n","export enum RequestType {\n    POST,\n    GET ,\n    PUT,\n    DELETE\n};\n\nexport enum queueType {\n    PRIORITY,\n    BACKGROUND\n}\n\n\nexport type jsonRequest = {\n    url:string,\n    type: RequestType,\n    params:any,\n    callback: RequestCallBackFunction,\n    associatedStateName:string,\n};\n\nexport type managerRequest = {\n    originalRequest: jsonRequest,\n    callback: ManagerCallbackFunction,\n    requestId: string,\n    queueType: queueType\n}\n\n\nexport type ManagerCallbackFunction = (data:any,status:number,queueId:number,requestId:string) => void;\nexport type RequestCallBackFunction = (data:any,status:number,associatedStateName:string) => void;","import debug from 'debug';\nimport {ManagerCallbackFunction, managerRequest, queueType} from \"./Types\";\n\nconst apiLogger = debug('api-ts');\n\n\n\nclass ApiUtil {\n\n  public async postFetchJSON(url:string,query:any) {\n      const postParameters = {\n        method: \"POST\",\n        headers: {'Content-Type': 'application/json'},\n        body: JSON.stringify({query})\n      };\n\n      const response = await fetch(url, postParameters);\n      return response.json();\n  }\n\n  private fetchJSON(url:string, parameters:any,callback:ManagerCallbackFunction,queueType:queueType,requestId:string) {\n    fetch(url, parameters)\n      .then((response) => {\n        apiLogger(`Response code was ${response.status}`);\n        if (response.status >= 200 && response.status <= 299) {\n          return response.json();\n        }\n        if (response.status === 400) {\n          apiLogger(response.json());\n        }\n      })\n      .then((data) => {\n        apiLogger(data);\n        callback(data, 200, queueType, requestId);\n      })\n      .catch((error) => {\n        apiLogger(error);\n        callback(null, 500, queueType, requestId);\n      });\n  }\n\n  /*\n      Utility function for calling JSON POST requests\n      Parameters:\n      1.  URL to send the POST request too;\n      2.  parameters object whose attribute (name/values) are the request parameters; and\n      3.  A function to receive the results when the fetch has completed\n          The callback function should have the following form\n          callback (jsonDataReturned, httpStatusCode)\n          a)  A successful fetch will return the JSON data in the first parameter and a status code of the server\n          b)  Parameters that cannot be converted to JSON format will give a null data and code 404\n          c)  A server error will give that code and no data\n    */\n  public apiFetchJSONWithPost(request:managerRequest):void {\n    apiLogger(`Executing fetch with URL ${request.originalRequest.url} with body ${request.originalRequest.params}`);\n    try {\n      JSON.stringify(request.originalRequest.params );\n    } catch (error) {\n      apiLogger('Unable to convert parameters to JSON');\n      apiLogger(request.originalRequest.params, 100);\n      request.callback(null, 404, request.queueType, request.requestId);\n    }\n    const postParameters = {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ ...request.originalRequest.params }),\n    };\n\n    this.fetchJSON(request.originalRequest.url, postParameters, request.callback, request.queueType, request.requestId);\n  }\n\n  public apiFetchJSONWithGet(request:managerRequest):void {\n    apiLogger(`Executing GET fetch with URL ${request.originalRequest.url} with id ${request.originalRequest.params.id}`);\n    const getParameters = {\n      method: 'GET',\n      headers: { 'Content-Type': 'application/json' },\n    };\n    if (request.originalRequest.params.id) request.originalRequest.url += `/${request.originalRequest.params.id}`;\n\n    this.fetchJSON(request.originalRequest.url, getParameters, request.callback, request.queueType, request.requestId);\n  }\n\n  public apiFetchJSONWithDelete(request:managerRequest):void {\n    apiLogger(`Executing DELETE fetch with URL ${request.originalRequest.url} with id ${request.originalRequest.params.id}`);\n    const delParameters = {\n      method: 'DELETE',\n      headers: { 'Content-Type': 'application/json' },\n    };\n    if (request.originalRequest.params.id) request.originalRequest.url += `/${request.originalRequest.params.id}`;\n\n    this.fetchJSON(request.originalRequest.url, delParameters, request.callback, request.queueType, request.requestId);\n  }\n\n  public apiFetchJSONWithPut(request:managerRequest) {\n    apiLogger(`Executing PUT fetch with URL ${request.originalRequest.url} with id ${request.originalRequest.params.id}`);\n    const putParameters = {\n      method: 'PUT',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ ...request.originalRequest.params }),\n    };\n    if (request.originalRequest.params.id) request.originalRequest.url += `/${request.originalRequest.params.id}`;\n\n    this.fetchJSON(request.originalRequest.url, putParameters, request.callback, request.queueType, request.requestId);\n  }\n}\n\nconst apiUtil = new ApiUtil();\n\nexport default apiUtil;\n","class UUID {\n  constructor() {\n  }\n\n  getUniqueId():string {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n      const r = Math.random() * 16 | 0;\n      const v = c == 'x' ? r : (r & 0x3 | 0x8);\n      return v.toString(16);\n    });\n  }\n}\n\nconst uuid = new UUID();\n\nexport default uuid;\n","import apiUtil from './ApiUtil';\nimport uuid from '../util/UUID';\nimport QueueListener from \"./QueueListener\";\nimport {managerRequest, jsonRequest, queueType, RequestType, RequestCallBackFunction} from \"./Types\";\n\nimport debug from 'debug';\n\nconst dlLogger = debug('api-ts');\n\nclass DownloadManager {\n  protected backgroundQueue : managerRequest[];\n  protected priorityQueue: managerRequest[];\n  protected inProgress: managerRequest[];\n  protected backgroundChangeListener:QueueListener|null;\n  protected priorityChangeListener:QueueListener|null;\n\n  constructor() {\n    this.backgroundQueue = [];\n    this.priorityQueue = [];\n    this.inProgress = [];\n    this.backgroundChangeListener = null;\n    this.priorityChangeListener= null;\n\n    this.callbackForQueueRequest = this.callbackForQueueRequest.bind(this);\n  }\n\n  public setBackgroundChangeListener(uiChangeListener:QueueListener) {\n    this.backgroundChangeListener = uiChangeListener;\n  }\n\n  public setPriorityChangeListener(uiChangeListener:QueueListener) {\n    this.priorityChangeListener = uiChangeListener;\n  }\n\n  public getPriorityQueueCount() {\n    return this.priorityQueue.length;\n  }\n\n  public getBackgroundQueueCount() {\n    return this.backgroundQueue.length;\n  }\n\n  public addQLApiRequest(url:string, query:string, variables:any, callback: RequestCallBackFunction, state:string, isPriority = false) {\n    let request:jsonRequest = {\n      url: url,\n      type: RequestType.POST,\n      params: {query:query, variables: variables},\n      callback: callback,\n      associatedStateName: state\n    }\n\n    downloader.addApiRequest(request,isPriority);\n  }\n  public addQLMutationRequest(url:string, mutation:string, variables:any, callback: RequestCallBackFunction, state:string, isPriority = false) {\n    let request:jsonRequest = {\n      url: url,\n      type: RequestType.POST,\n      params: {mutation:mutation, variables:variables},\n      callback: callback,\n      associatedStateName: state\n    }\n\n    downloader.addApiRequest(request,isPriority);\n  }\n\n  public addApiRequest(jsonRequest:jsonRequest, isPriority = false) {\n    // add a new requestId to the request for future tracking\n    const requestId = uuid.getUniqueId();\n    dlLogger(`Download Manger: Adding Queue Request ${requestId}`);\n    dlLogger(jsonRequest, 200);\n\n    if (isPriority) {\n      let managerRequest:managerRequest = {\n        originalRequest: jsonRequest,\n        requestId : requestId,\n        queueType : queueType.PRIORITY,\n        callback: this.callbackForQueueRequest,\n      }\n      this.priorityQueue.push(managerRequest);\n      if (this.priorityChangeListener) this.priorityChangeListener.handleEventAddToQueue();\n    } else {\n      let managerRequest:managerRequest = {\n        originalRequest: jsonRequest,\n        requestId : requestId,\n        queueType : queueType.BACKGROUND,\n        callback: this.callbackForQueueRequest,\n      }\n      this.backgroundQueue.push(managerRequest);\n      if (this.backgroundChangeListener) this.backgroundChangeListener.handleEventAddToQueue();\n    }\n    this.processQueues();\n  }\n\n  private async processPriorityQueue() {\n    const queueItem:managerRequest|undefined = this.priorityQueue.shift();\n    if (queueItem !== undefined) this.inProgress.push(queueItem);\n    if (queueItem !== undefined) this.initiateFetchForQueueItem(queueItem);\n  }\n\n  private async processBackgroundQueue() {\n    const queueItem:managerRequest|undefined = this.backgroundQueue.shift();\n    if (queueItem !== undefined) this.inProgress.push(queueItem);\n    if (queueItem !== undefined) this.initiateFetchForQueueItem(queueItem);\n  }\n\n  private async processQueues() {\n    let totalQueuedItems = this.priorityQueue.length + this.backgroundQueue.length;\n    while (totalQueuedItems > 0) {\n      dlLogger(`Download Manager: processing queue, items remaining ${totalQueuedItems}`);\n      // priority queue takes priority\n      if (this.priorityQueue.length > 0) {\n        await this.processPriorityQueue();\n      } else if (this.backgroundQueue.length > 0) {\n        await this.processBackgroundQueue();\n      }\n      totalQueuedItems = this.priorityQueue.length + this.backgroundQueue.length;\n    }\n  }\n\n  private callbackForQueueRequest(jsonData:any, httpStatus:number, queueId:number, requestId:string) {\n    // let the listeners know about the completion\n    if (queueId === queueType.PRIORITY) { // priority\n      if (this.priorityChangeListener) this.priorityChangeListener.handleEventRemoveFromQueue();\n    }\n    else if (this.backgroundChangeListener) this.backgroundChangeListener.handleEventRemoveFromQueue();\n\n    dlLogger(`Download Manager: received callback for queue ${queueId} request ${requestId} with status ${httpStatus}`);\n    // find the item in the in progress\n    const foundIndex = this.inProgress.findIndex(element => element.requestId === requestId);\n    if (foundIndex >= 0) {\n      // remove from in progress\n      const queueItem = this.inProgress[foundIndex];\n      this.inProgress.splice(foundIndex, 1);\n      dlLogger(queueItem);\n      dlLogger(`Download Manager: finished for queue item ${queueItem.requestId}`);\n      // let the callback function know\n      queueItem.originalRequest.callback(jsonData, httpStatus,queueItem.originalRequest.associatedStateName);\n    }\n  }\n\n  private initiateFetchForQueueItem(item:managerRequest) {\n    dlLogger(`Download Manager: initiating fetch for queue item ${item.requestId}`);\n    dlLogger(item);\n    if ((item.originalRequest.url !== null) && (item.originalRequest.params != null) && (item.originalRequest.callback != null)) {\n      switch (item.originalRequest.type) {\n        case RequestType.POST: {\n          apiUtil.apiFetchJSONWithPost(item);\n          break;\n        }\n        case RequestType.GET: {\n          apiUtil.apiFetchJSONWithGet(item);\n          break;\n        }\n        case RequestType.DELETE: {\n          apiUtil.apiFetchJSONWithDelete(item);\n          break;\n        }\n        case RequestType.PUT: {\n          apiUtil.apiFetchJSONWithPut(item);\n          break;\n        }\n      }\n    }\n  }\n}\n\nconst downloader = new DownloadManager();\n\nexport default downloader;\n","export type Invitation = {\n    from:string,\n    room:string,\n    message:string,\n    created:number,\n    userList:string[],\n    type: InviteType,\n    requiresAcceptDecline: boolean,\n    subject:string,\n    attachment:any\n}\n\nexport type Message = {\n    from: string,\n    room: string,\n    message: string,\n    created: number,\n    priority: number,\n    type:InviteType,\n    attachment?: any\n}\n\nexport type JoinLeft = {\n    username: string,\n    room: string,\n    userList: string[],\n    type: InviteType\n}\n\nexport enum Priority {\n    Normal,\n    High,\n    Urgent\n}\n\nexport enum InviteType {\n    ChatRoom,\n    ScoreSheet\n}\n\nexport type ChatLog = {\n    roomName: string,\n    type: InviteType,\n    users: string[],\n    messages: Message[],\n    lastViewed: number,\n    numOfNewMessages: number\n}\n","import {stateEventType, stateValue} from \"./StateManager\";\nimport {equalityFunction} from \"../util/EqualityFunctions\";\nimport {jsonRequest, RequestType} from \"../network/Types\";\nimport downloader from \"../network/DownloadManager\";\nimport debug from 'debug';\nimport AsynchronousStateManager from \"./AsynchronousStateManager\";\nimport StateChangedDelegate from \"./StateChangedDelegate\";\nimport {StateChangeInformer} from \"./StateChangeInformer\";\nimport StateChangeListener from \"./StateChangeListener\";\n\n\nconst apiSMLogger = debug('state-manager-api');\n\ntype ApiConfig = {\n    stateName: string,\n    serverURL: string,\n    api: string\n    isActive: boolean\n}\n\nexport class RESTApiStateManager implements AsynchronousStateManager {\n    private static _instance: RESTApiStateManager;\n\n    public static getInstance() {\n        if (!(RESTApiStateManager._instance)) {\n            RESTApiStateManager._instance = new RESTApiStateManager();\n        }\n        return RESTApiStateManager._instance;\n    }\n\n    protected configuration: ApiConfig[] = [];\n    protected bHasCompletedRun: boolean[];\n    protected delegate:StateChangeInformer;\n\n    protected constructor() {\n        this.delegate = new StateChangedDelegate('restapi');\n        this.emitEvents();\n        this.bHasCompletedRun = [];\n\n\n        this.callbackForAddItem = this.callbackForAddItem.bind(this);\n        this.callbackForRemoveItem = this.callbackForRemoveItem.bind(this);\n        this.callbackForUpdateItem = this.callbackForUpdateItem.bind(this);\n        this.callbackForGetItems = this.callbackForGetItems.bind(this);\n    }\n\n    getConfiguredStateNames(): string[] {\n        let results: string[] = [];\n        this.configuration.forEach((config) => {\n            results.push(config.stateName);\n        });\n        return results;\n    }\n\n    hasCompletedRun(stateName: string): boolean {\n        let result = false;\n        let foundIndex = this.configuration.findIndex((config) => config.stateName === stateName);\n        if (foundIndex >= 0) {\n            result = this.bHasCompletedRun[foundIndex];\n        }\n        return result;\n    }\n\n    setCompletedRun(stateName:string):void {\n        let foundIndex = this.configuration.findIndex((config) => config.stateName === stateName);\n        if (foundIndex >= 0) {\n            this.bHasCompletedRun[foundIndex] = true;\n        }\n    }\n\n    forceResetForGet(stateName: string): void {\n        let foundIndex = this.configuration.findIndex((config) => config.stateName === stateName);\n        if (foundIndex >= 0) {\n            this.bHasCompletedRun[foundIndex] = false;\n        }\n    }\n\n    public initialise(config: ApiConfig[]) {\n        this.configuration = config;\n        let runsComplete: boolean[] = [];\n        this.configuration.forEach((configItem) => {\n            runsComplete.push(false);\n        });\n        this.bHasCompletedRun = runsComplete;\n    }\n\n    protected getConfigurationForStateName(name: string) {\n        let config: ApiConfig = {\n            stateName: name,\n            serverURL: '',\n            api: '',\n            isActive: false\n        }\n        let foundIndex = this.configuration.findIndex((config) => config.stateName === name);\n        if (foundIndex >= 0) {\n            config = this.configuration[foundIndex];\n        }\n        return config;\n    }\n\n    private callbackForRemoveItem(data: any, status: number, associatedStateName: string) {\n        apiSMLogger(`callback for remove item for state ${associatedStateName} with status ${status} - not forwarded`);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            apiSMLogger(data);\n        }\n    }\n\n    private callbackForUpdateItem(data: any, status: number, associatedStateName: string) {\n        apiSMLogger(`callback for update item for state ${associatedStateName} with status ${status} - not forwarded`);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            apiSMLogger(data);\n        }\n    }\n\n    private callbackForGetItems(data: any, status: number, associatedStateName: string) {\n        apiSMLogger(`callback for get items for state ${associatedStateName} with status ${status} - FORWARDING`);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            apiSMLogger(data);\n            this.setCompletedRun(associatedStateName);\n            this.delegate.informChangeListenersForStateWithName(associatedStateName, data, stateEventType.StateChanged,null);\n        }\n    }\n\n    private callbackForAddItem(data: any, status: number, associatedStateName: string) {\n        apiSMLogger(`callback for add item for state ${associatedStateName} with status ${status} - FORWARDING`);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            apiSMLogger(data);\n            this.delegate.informChangeListenersForStateWithName(associatedStateName, data, stateEventType.ItemAdded,null);\n        }\n    }\n\n    _addNewNamedStateToStorage(state: stateValue): void { /* assume model on the other end exists */\n    }\n\n    _getState(name: string): stateValue {\n        apiSMLogger(`Getting All ${name}`);\n        if (this.hasCompletedRun(name)) {\n            apiSMLogger(`Getting All ${name} - not done - previously retrieved`);\n        } else {\n            let config: ApiConfig = this.getConfigurationForStateName(name);\n            if (config.isActive) {\n                const jsonRequest: jsonRequest = {\n                    url: config.serverURL + config.api,\n                    type: RequestType.GET,\n                    params: {},\n                    callback: this.callbackForGetItems,\n                    associatedStateName: name\n                };\n                downloader.addApiRequest(jsonRequest, true);\n\n            } else {\n                apiSMLogger(`No configuration for state ${name}`);\n            }\n        }\n        let state: stateValue = {name: name, value: []};\n        return state;\n    }\n\n    _ensureStatePresent(name: string): void { /* assume state exists */\n    }\n\n    _replaceNamedStateInStorage(state: stateValue): void { /* not going to replace all state */\n    }\n\n    _saveState(name: string, stateObj: any): void { /* not going to replace all state */\n    }\n\n    _addItemToState(name: string, stateObj: any, isPersisted: boolean = false): void {\n        if (isPersisted) return; // dont add complete objects to the state - they are already processed\n        apiSMLogger(`Adding item to ${name}`);\n        apiSMLogger(stateObj);\n        let config: ApiConfig = this.getConfigurationForStateName(name);\n        if (config.isActive) {\n            const jsonRequest: jsonRequest = {\n                url: config.serverURL + config.api,\n                type: RequestType.POST,\n                params: stateObj,\n                callback: this.callbackForAddItem,\n                associatedStateName: name\n            };\n            downloader.addApiRequest(jsonRequest, true);\n\n        } else {\n            apiSMLogger(`No configuration for state ${name}`);\n        }\n    }\n\n\n    _removeItemFromState(name: string, stateObj: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): void {\n        if (isPersisted) return; // dont remove complete objects to the state - they are already processed\n        apiSMLogger(`Removing item to ${name}`);\n        apiSMLogger(stateObj);\n        let config: ApiConfig = this.getConfigurationForStateName(name);\n        if (config.isActive) {\n            const jsonRequest: jsonRequest = {\n                url: config.serverURL + config.api,\n                type: RequestType.DELETE,\n                params: {\n                    id: stateObj.id\n                },\n                callback: this.callbackForRemoveItem,\n                associatedStateName: name\n            };\n            downloader.addApiRequest(jsonRequest, true);\n\n        } else {\n            apiSMLogger(`No configuration for state ${name}`);\n        }\n    }\n\n    _updateItemInState(name: string, stateObj: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): void {\n        if (isPersisted) return; // dont update complete objects to the state - they are already processed\n        apiSMLogger(`Updating item in ${name}`);\n        apiSMLogger(stateObj);\n        let config: ApiConfig = this.getConfigurationForStateName(name);\n        if (config.isActive) {\n            const jsonRequest: jsonRequest = {\n                url: config.serverURL + config.api,\n                type: RequestType.PUT,\n                params: stateObj,\n                callback: this.callbackForUpdateItem,\n                associatedStateName: name\n            };\n            downloader.addApiRequest(jsonRequest, true);\n\n        } else {\n            apiSMLogger(`No configuration for state ${name}`);\n        }\n    }\n\n    addChangeListenerForName(name: string, listener: StateChangeListener): void {\n        this.delegate.addChangeListenerForName(name,listener);\n    }\n\n    addNewItemToState(name: string, item: any, isPersisted: boolean): void {\n        this._addItemToState(name,item,isPersisted);\n    }\n\n    emitEvents(): void {\n        this.delegate.emitEvents();\n    }\n\n    findItemInState(name: string, item: any, testForEqualityFunction: equalityFunction): any {\n        throw Error(\"not implemented\");\n    }\n\n    getStateByName(name: string): any {\n        this._getState(name);\n    }\n\n    informChangeListenersForStateWithName(name: string, stateObjValue: any, eventType: stateEventType, previousObjValue: any): void {\n        this.delegate.informChangeListenersForStateWithName(name,stateObjValue,eventType,previousObjValue);\n    }\n\n    isItemInState(name: string, item: any, testForEqualityFunction: equalityFunction): boolean {\n        return true;\n    }\n\n    removeItemFromState(name: string, item: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): boolean {\n        this._removeItemFromState(name,item,testForEqualityFunction,isPersisted);\n        return true;\n    }\n\n    setStateByName(name: string, stateObjectForName: any, informListeners: boolean): void {}\n\n    suppressEvents(): void {\n        this.delegate.suppressEvents();\n    }\n\n    updateItemInState(name: string, item: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): boolean {\n        this._updateItemInState(name,item,testForEqualityFunction,isPersisted);\n        return true;\n    }\n}","import debug from 'debug';\nimport SocketListener from \"./SocketListener\";\nimport {ChatReceiver} from \"./ChatReceiver\";\nimport {Invitation, InviteType, Message, Priority} from \"./Types\";\n\nconst sDebug = debug('socket-ts');\n\nclass SocketManager {\n    protected listener:SocketListener|null;\n    protected socket:any|null;\n    protected chatReceivers:ChatReceiver[] = [];\n\n    public addChatReceiver(receiver:ChatReceiver):void {\n        this.chatReceivers.push(receiver);\n    }\n\n\n    constructor() {\n        this.callbackForMessage = this.callbackForMessage.bind(this);\n        this.callbackForData = this.callbackForData.bind(this);\n        this.listener = null;\n        this.socket = null;\n        this.chatReceivers = [];\n        this.callbackForMessage = this.callbackForMessage.bind(this);\n        this.callbackForLogin = this.callbackForLogin.bind(this);\n        this.callbackForLogout = this.callbackForLogout.bind(this);\n        this.callbackForJoinRoom = this.callbackForJoinRoom.bind(this);\n        this.callbackForExitRoom = this.callbackForExitRoom.bind(this);\n        this.callbackForInvite = this.callbackForInvite.bind(this);\n        this.callbackForChat = this.callbackForChat.bind(this);\n        this.callbackForQueue = this.callbackForQueue.bind(this);\n        this.callbackForUserList = this.callbackForUserList.bind(this);\n    }\n\n    private callbackForMessage(content:any):void {\n        sDebug(`Received message : ${content}`);\n        try {\n            sDebug(content);\n            // should be a server side ChatMessage {room, message,user}\n            const dataObj = JSON.parse(content);\n            this.chatReceivers.forEach((receiver) => receiver.receiveMessage(dataObj));\n        }\n        catch (err) {\n            sDebug(err);\n            sDebug('Not JSON data');\n        }\n    }\n\n\n    private callbackForLogin(message:any):void {\n        sDebug(`Received login : ${message}`);\n        this.chatReceivers.forEach((receiver) => receiver.receiveLogin(message));\n    }\n\n\n    private callbackForUserList(message:any):void {\n        sDebug(`Received user list : ${message}`);\n        this.chatReceivers.forEach((receiver) => receiver.receiveUserList(message));\n    }\n\n    private callbackForLogout(message:any):void {\n        sDebug(`Received logout : ${message}`);\n        this.chatReceivers.forEach((receiver) => receiver.receiveLogout(message));\n    }\n\n    private callbackForJoinRoom(data:any):void {\n        sDebug(`Received joined room : ${data}`);\n        try {\n            const dataObj = JSON.parse(data);\n            sDebug(dataObj);\n            this.chatReceivers.forEach((receiver) => receiver.receiveJoinedRoom(dataObj));\n        }\n        catch (err) {\n            sDebug('Not JSON data');\n        }\n    }\n\n    private callbackForExitRoom(data:any):void {\n        sDebug(`Received left room : ${data}`);\n        try {\n            const dataObj = JSON.parse(data);\n            sDebug(dataObj);\n            this.chatReceivers.forEach((receiver) => receiver.receivedLeftRoom(dataObj));\n        }\n        catch (err) {\n            sDebug('Not JSON data');\n        }\n    }\n\n    private callbackForInvite(data:any):void {\n        sDebug(`Received invite : ${data}`);\n        try {\n            const dataObj = JSON.parse(data);\n            sDebug(dataObj);\n            this.chatReceivers.forEach((receiver) => receiver.receiveInvitation(dataObj));\n        }\n        catch (err) {\n            sDebug('Not JSON data');\n        }\n    }\n\n    private callbackForDeclineInvite(data:any):void {\n        sDebug(`Received declined invite : ${data}`);\n        try {\n            const dataObj = JSON.parse(data);\n            sDebug(dataObj);\n            this.chatReceivers.forEach((receiver) => receiver.receiveDecline(dataObj.room, dataObj.username, dataObj.type));\n        }\n        catch (err) {\n            sDebug('Not JSON data');\n        }\n    }\n\n    private callbackForChat(content:any):void {\n        sDebug(`Received chat : ${content}`);\n        try {\n            // should be a server side ChatMessage {room, message,user}\n            const dataObj = JSON.parse(content);\n            sDebug(dataObj);\n            this.chatReceivers.forEach((receiver) => receiver.receiveMessage(dataObj));\n        }\n        catch (err) {\n            sDebug('Not JSON data');\n        }\n    }\n\n    private callbackForQueue(data:any):void {\n        sDebug(`Received queued items : ${data}`);\n        try {\n            const dataObj = JSON.parse(data);\n            sDebug(dataObj);\n            // this object should contain two arrays of invites and messages\n            if (dataObj.invites && (dataObj.invites.length > 0)) {\n                this.chatReceivers.forEach((receiver) => receiver.receiveQueuedInvites(dataObj.invites));\n            }\n            if (dataObj.messages && (dataObj.messages.length > 0)) {\n                this.chatReceivers.forEach((receiver) => receiver.receiveQueuedMessages(dataObj.messages));\n            }\n        }\n        catch (err) {\n            sDebug('Not JSON data');\n        }\n    }\n\n\n    /*\n    *\n    *  expecting a JSON data object with the following attributes\n    *  1.  type: \"create\"|\"update\"|\"delete\"\n    *  2.  objectType: string name of the object type changed\n    *  3.  data: the new representation of the object\n    *  4.  user: application specific id for the user who made the change\n    *        - the application view is required to implement getCurrentUser() to compare the user who made the change\n    *\n     */\n    private callbackForData(message:any):void {\n        sDebug(`Received data`);\n        try {\n            const dataObj = JSON.parse(message);\n            sDebug(dataObj);\n            if (this.listener === null) return;\n            if (dataObj.user === this.listener.getCurrentUser()) {\n                sDebug(\"change made by this user, ignoring\");\n            }\n            else {\n                sDebug(\"change made by another user, passing off to the application\");\n                this.listener.handleDataChangedByAnotherUser(dataObj);\n            }\n\n        }\n        catch (err) {\n            sDebug('Not JSON data');\n        }\n    }\n\n    public setListener(listener:SocketListener) {\n        sDebug('Setting listener');\n        this.listener = listener;\n        sDebug('Creating socket connection');\n        // @ts-ignore\n        this.socket = io();\n        sDebug('Waiting for messages');\n        this.socket.on('message',this.callbackForMessage);\n        this.socket.on('data',this.callbackForData);\n        this.socket.on('login',this.callbackForLogin);\n        this.socket.on('logout',this.callbackForLogout);\n        this.socket.on('joinroom',this.callbackForJoinRoom);\n        this.socket.on('exitroom',this.callbackForExitRoom);\n        this.socket.on('invite',this.callbackForInvite);\n        this.socket.on('declineinvite',this.callbackForDeclineInvite);\n        this.socket.on('chat',this.callbackForChat);\n        this.socket.on('queue',this.callbackForQueue);\n        this.socket.on('userlist',this.callbackForUserList);\n    }\n\n    public login(username:string): void {\n        this.socket.emit('login',{username});\n    }\n\n    public logout(username:string):void {\n        this.socket.emit('logout',{username});\n    }\n\n    public joinChat(username:string, room:string, type:number):void {\n        this.socket.emit('joinroom',{username,room,type});\n    }\n\n    public leaveChat(username:string, room:string, type:number):void {\n        this.socket.emit('exitroom', {username,room,type});\n    }\n\n    public sendInvite(from:string, to:string, room:string, type:InviteType = InviteType.ChatRoom, requiresAcceptDecline:boolean = false,subject:string = '',attachment:any = {}) {\n        let inviteObj:any = {\n            from:from,\n            to:to,\n            room: room,\n            type: type,\n            requiresAcceptDecline: requiresAcceptDecline,\n            subject:subject,\n            attachment:attachment\n        }\n        sDebug(`Sending invite`);\n        sDebug(inviteObj);\n        this.socket.emit('invite', inviteObj);\n    }\n\n    public sendMessage(from:string, room:string, message:string,created:number,type:number,priority: Priority = Priority.Normal, attachment:any = {}) {\n        let messageObj:Message = {\n            from: from,\n            room: room,\n            message:message,\n            created:created,\n            priority:priority,\n            type:type,\n            attachment: attachment\n        }\n        this.socket.emit('chat',messageObj);\n    }\n\n    public getUserList() {\n        this.socket.emit('userlist');\n    }\n\n    public sendDeclineInvite(room:string,from:string,type:number) {\n        this.socket.emit('declineinvite',{room,from,type});\n    }\n}\n\nlet socketManager = new SocketManager();\nexport default socketManager;","import {stateEventType, stateValue} from \"./StateManager\";\nimport StateChangeListener from \"./StateChangeListener\";\nimport {equalityFunction} from \"../util/EqualityFunctions\";\n\nimport debug from 'debug';\nimport AsynchronousStateManager from \"./AsynchronousStateManager\";\nimport {AbstractStateManager} from \"./AbstractStateManager\";\n\n\nconst asyncLogger = debug('state-manager-async');\n\nexport default class AsyncStateManagerWrapper extends AbstractStateManager implements StateChangeListener {\n    protected wrappedSM:AsynchronousStateManager;\n    protected topLevelSM:AbstractStateManager;\n\n    public constructor(topLevelSM:AbstractStateManager, wrappedSM:AsynchronousStateManager) {\n        super('async');\n        this.topLevelSM = topLevelSM;\n        this.wrappedSM = wrappedSM;\n        this.forceSaves = false;\n\n        this.wrappedSM.emitEvents();\n        let stateNamesToMonitor = this.wrappedSM.getConfiguredStateNames();\n\n        this.stateChanged = this.stateChanged.bind(this);\n        this.stateChangedItemAdded = this.stateChangedItemAdded.bind(this);\n        this.stateChangedItemRemoved = this.stateChangedItemRemoved.bind(this);\n        this.stateChangedItemUpdated = this.stateChangedItemUpdated.bind(this);\n\n\n        stateNamesToMonitor.forEach((stateName) => {\n           this.wrappedSM.addChangeListenerForName(stateName,this);\n        });\n    }\n\n    _addItemToState(name: string, stateObj: any,isPersisted:boolean = false): void {\n        asyncLogger(`adding item to state ${name} - is persisted ${isPersisted}`);\n        this.wrappedSM.addNewItemToState(name,stateObj,isPersisted);\n    }\n\n\n    _getState(name: string): stateValue {\n        // assume wrapped SM is asynchronous\n        // make the call to get state but supply the caller with an empty state for now\n        asyncLogger(`getting state ${name}`);\n        this.wrappedSM.getStateByName(name);\n        return {name:name, value: []};\n    }\n\n\n    _removeItemFromState(name: string, stateObj: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): void {\n        asyncLogger(`removing item from state ${name}`);\n        this.wrappedSM.removeItemFromState(name,stateObj,testForEqualityFunction,isPersisted);\n    }\n\n    _updateItemInState(name: string, stateObj: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): void {\n        asyncLogger(`updating item in state ${name}`);\n        this.wrappedSM.updateItemInState(name,stateObj,testForEqualityFunction,isPersisted);\n    }\n\n    _ensureStatePresent(name: string): void {}// assume already present\n    _addNewNamedStateToStorage(state: stateValue): void {} // assume already present\n    _replaceNamedStateInStorage(state: stateValue): void {} // not implemented, not replacing state wholesale\n    _saveState(name: string, stateObj: any): void {} // not implemented, not replacing state wholesale\n    stateChangedItemRemoved(managerName:string, name: string, itemRemoved: any): void {} // not implemented, assumes called to wrapped SM worked\n    stateChangedItemUpdated(managerName:string, name: string, itemUpdated: any, itemNewValue: any): void {} // not implemented, assumes called to wrapped SM worked\n\n\n    stateChanged(managerName:string, name: string, newValue: any): void {\n        // received new state from the wrapped SM\n        // pass the received state to the top level SM\n        asyncLogger(`Wrapped SM has supplied new state ${name} passing to top level SM`);\n        asyncLogger(newValue);\n        this.topLevelSM.setStateByName(name,newValue);\n    }\n\n    stateChangedItemAdded(managerName:string, name: string, itemAdded: any): void {\n        asyncLogger(`Wrapped SM has supplied new completed item for state ${name} passing to top level SM`);\n        this.topLevelSM.addNewItemToState(name,itemAdded,true);\n    }\n\n}","import debug from 'debug';\n\nimport {stateValue} from \"./StateManager\";\nimport {equalityFunction} from \"../util/EqualityFunctions\";\nimport {StateManager} from \"./StateManager\";\nimport {AbstractStateManager} from \"./AbstractStateManager\";\n\n\nconst aggLogger = debug('state-manager-aggregate');\n\ntype managerWithFilters = {\n    manager:StateManager,\n    filters:string[]\n}\n\nexport class AggregateStateManager extends AbstractStateManager {\n    private stateManagers: managerWithFilters[];\n    private static _instance: AggregateStateManager;\n\n    public static getInstance() {\n        if (!(AggregateStateManager._instance)) {\n            AggregateStateManager._instance = new AggregateStateManager();\n        }\n        return AggregateStateManager._instance;\n    }\n\n    private constructor() {\n        super('aggregate');\n        this.stateManagers = [];\n        this.emitEvents();\n\n    }\n\n    public addStateManager(stateManager: AbstractStateManager, filters: string[] = [], emitEvents:boolean) {\n        let mWF: managerWithFilters = {\n            manager: stateManager,\n            filters: filters\n        };\n        this.stateManagers.push(mWF);\n        if (!emitEvents) stateManager.suppressEvents();\n        aggLogger('adding state manager with/without filters');\n    }\n\n    private stateNameInFilters(name: string, filters: string[]): boolean {\n        let foundIndex = filters.findIndex((filter) => filter === name);\n        return (foundIndex >= 0);\n    }\n\n    public _addNewNamedStateToStorage(state: stateValue): void {\n        this.stateManagers.forEach((managerWithFilters) => {\n            if (!this.stateNameInFilters(state.name, managerWithFilters.filters)) {\n                managerWithFilters.manager._addNewNamedStateToStorage(state);\n            }\n        });\n    }\n\n    public _getState(name: string): stateValue {\n        let state: stateValue = {\n            name: name,\n            value: []\n        }\n        this.stateManagers.forEach((sm) => {\n            if (!this.stateNameInFilters(state.name, sm.filters)) {\n                aggLogger(`get state from state manager for state ${name}`);\n                aggLogger(sm.manager);\n                sm.manager._getState(name);\n            }\n\n        });\n        // assuming the state manager is holding all the values\n        if (this.stateManagers.length > 0) {\n            state = this.stateManagers[0].manager._getState(name);\n        }\n        return state;\n    }\n\n    public _ensureStatePresent(name: string): void {\n        this.stateManagers.forEach((managerWithFilters) => {\n            if (!this.stateNameInFilters(name, managerWithFilters.filters)) {\n                managerWithFilters.manager._ensureStatePresent(name);\n            }\n        });\n    }\n\n    public _replaceNamedStateInStorage(state: stateValue): void {\n        this.stateManagers.forEach((managerWithFilters) => {\n            if (!this.stateNameInFilters(state.name, managerWithFilters.filters)) {\n                managerWithFilters.manager._replaceNamedStateInStorage(state);\n            }\n        });\n    }\n\n    public _saveState(name: string, stateObj: any): void {\n        this.stateManagers.forEach((managerWithFilters) => {\n            if (!this.stateNameInFilters(name, managerWithFilters.filters)) {\n                aggLogger(`saving state in state manager for state ${name}`);\n                aggLogger(managerWithFilters.manager);\n                aggLogger(stateObj);\n                managerWithFilters.manager._saveState(name, stateObj);\n            }\n        });\n    }\n\n    _addItemToState(name: string, stateObj: any,isPersisted:boolean = false): void {\n        this.stateManagers.forEach((managerWithFilters) => {\n            if (!this.stateNameInFilters(name, managerWithFilters.filters)) {\n                aggLogger(`adding item to state in  state manager for state ${name}, is persisted = ${isPersisted}`);\n                aggLogger(managerWithFilters.manager);\n                aggLogger(stateObj);\n                managerWithFilters.manager._addItemToState(name, stateObj,isPersisted);\n            }\n        });\n    }\n\n    _removeItemFromState(name: string, stateObj: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): void {\n        this.stateManagers.forEach((managerWithFilters) => {\n            if (!this.stateNameInFilters(name, managerWithFilters.filters)) {\n                aggLogger(`removing item from state in state manager for state ${name}`);\n                aggLogger(managerWithFilters.manager);\n                aggLogger(stateObj);\n                managerWithFilters.manager._removeItemFromState(name, stateObj, testForEqualityFunction, isPersisted);\n            }\n        });\n    }\n\n    _updateItemInState(name: string, stateObj: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): void {\n        this.stateManagers.forEach((managerWithFilters) => {\n            if (!this.stateNameInFilters(name, managerWithFilters.filters)) {\n                aggLogger(`updating item in state in  state manager for state ${name}`);\n                aggLogger(managerWithFilters.manager);\n                aggLogger(stateObj);\n                managerWithFilters.manager._updateItemInState(name, stateObj, testForEqualityFunction, isPersisted);\n            }\n        });\n    }\n}","import Notification from './Notification';\nimport {NotificationManager} from \"./NotificationManager\";\n\nexport default class BootstrapNotification extends Notification {\n  constructor(notificationManager:NotificationManager) {\n     super(notificationManager);\n  }\n\n  // Make the notification visible on the screen\n  public show(title:string, message:string, topOffset:number = 0, context:string = 'info', duration:number = 3000):HTMLElement {\n    let containerId = this.notificationManager.getContainerId();\n    // convert the context to a background colour\n    let bgColorClass = '';\n    switch (context) {\n      case 'info': {\n        bgColorClass = 'bg-info';\n        break;\n      }\n      case 'warning': {\n        bgColorClass = 'bg-warning';\n        break;\n      }\n      case 'message': {\n        bgColorClass = 'bg-primary';\n        break;\n      }\n      case 'priority': {\n        bgColorClass = 'bg-danger';\n        break;\n      }\n      default: {\n        bgColorClass = \"bg-info\";\n      }\n\n    }\n    // Creating the notification container div\n    const containerNode = document.createElement('div');\n    containerNode.className = 'notification toast';\n    containerNode.style.top = `${topOffset}px`;\n    containerNode.setAttribute(\"role\",\"alert\");\n    containerNode.setAttribute(\"data-autohide\",\"false\");\n\n    // Adding the notification title node\n    const titleNode = document.createElement('div');\n    titleNode.className = `toast-header text-white ${bgColorClass}`;\n\n    const titleTextNode = document.createElement('strong');\n    titleTextNode.className = \"mr-auto\";\n    titleTextNode.textContent = title;\n\n    // Adding a little button on the notification\n    const closeButtonNode = document.createElement('button');\n    closeButtonNode.className = 'ml-2 mb-1 close';\n    closeButtonNode.textContent = 'x';\n    closeButtonNode.addEventListener('click', () => {\n      this.notificationManager.remove(containerNode);\n    });\n\n\n    // Adding the notification message content node\n    const messageNode:HTMLElement = document.createElement('div');\n    messageNode.className = 'toast-body';\n    messageNode.textContent = message;\n\n\n    // Appending the container with all the elements newly created\n    titleNode.appendChild(titleTextNode);\n    titleNode.appendChild(closeButtonNode);\n    containerNode.appendChild(titleNode);\n    containerNode.appendChild(messageNode);\n    containerNode.classList.add(`is-${context}`);\n\n    // Inserting the notification to the page body\n    const containerEl:HTMLElement|null = document.getElementById(containerId);\n    if (containerEl) containerEl.appendChild(containerNode);\n\n    // activate it\n    // @ts-ignore\n    $(\".notification\").toast('show');\n\n    // Default duration delay\n    if (duration <= 0) {\n      duration = 2000;\n    }\n    setTimeout(() => {\n      this.notificationManager.remove(containerNode);\n    }, duration);\n    return containerNode;\n  }\n}\n","import {NotificationManager} from \"./NotificationManager\";\n\nexport default abstract class Notification {\n\n  protected notificationManager:NotificationManager;\n  protected containerId:string;\n\n  protected constructor(notificationManager:NotificationManager) {\n    this.show = this.show.bind(this);\n\n    this.notificationManager = notificationManager;\n\n    // Create DOM notification structure when instantiated\n    this.containerId = this.notificationManager.getContainerId();\n  }\n\n  // Make the notification visible on the screen\n  public abstract show(title:string, message:string, topOffset:number, context:string, duration:number):HTMLElement;\n}\n","import BootstrapNotification from \"./BootstrapNotification\";\nimport {NotificationManager} from \"./NotificationManager\";\n\nclass NotificationFactory {\n    constructor() {\n    }\n\n    createNotification(manager:NotificationManager) {\n        return new BootstrapNotification(manager);\n    }\n}\n\nconst notificationFactory = new NotificationFactory();\n\nexport default notificationFactory;","import notificationFactory from \"./NotificationFactory\";\n\nexport class NotificationManager {\n  protected notifications:Node[];\n  protected currentCount:number;\n  protected offsetPerNotification:number;\n  protected containerId:string;\n\n  constructor() {\n    this.notifications = [];\n    this.currentCount = 0;\n    this.offsetPerNotification = 120;\n    this.containerId = 'notifications';\n\n    this.show = this.show.bind(this);\n  }\n\n  public getContainerId():string {\n    return this.containerId;\n  }\n\n  public show(title:string, message:string, context:string = 'info', duration:number = 5000) {\n    const notification = notificationFactory.createNotification(this);\n    const notificationNode = notification.show(title, message, this.currentCount * this.offsetPerNotification, context, duration);\n    this.currentCount++;\n    this.notifications.push(notificationNode);\n  }\n\n  public remove(notificationNode:HTMLElement) {\n    const foundIndex = this.notifications.findIndex(element => element === notificationNode);\n    if (foundIndex >= 0) {\n      this.notifications.splice(foundIndex, 1);\n      // re-arrange the remaining notifications\n      this.notifications.map((notificationNode, index) => {\n        // @ts-ignore\n        notificationNode.style.top = `${this.offsetPerNotification * index}px`;\n      });\n    }\n    const parentEl = notificationNode.parentElement;\n    if (parentEl !== null) parentEl.removeChild(notificationNode);\n    this.currentCount--;\n    if (this.currentCount < 0) this.currentCount = 0;\n  }\n}\n\nconst notifier = new NotificationManager();\n\nexport default notifier;\n","export type equalityFunction = (item1:any, item2:any) => boolean;\n\nexport function isSame(item1:any, item2:any):boolean {\n  return (item1.id === item2.id);\n}\n\nexport function isSameUsername(item1:any, item2:any):boolean {\n  return (item1.username === item2.username);\n}\n\nexport function isSameGame(item1:any, item2:any):boolean {\n  return (item1.gameId === item2.gameId);\n}\n","import SocketListener from \"./socket/SocketListener\";\nimport debug from 'debug';\n\nimport notifier from \"./notification/NotificationManager\";\nimport controller from \"./Controller\";\nimport {isSame} from \"./util/EqualityFunctions\";\n\nconst slLogger = debug('socket-listener');\n\nexport default class SocketListenerDelegate implements SocketListener {\n    private config:any;\n\n    public constructor(config:any) {\n        this.config = config;\n    }\n\n    public handleDataChangedByAnotherUser(message:any) {\n        slLogger(`Handling data change ${message.type} on object type ${message.stateName} made by user ${message.user}`);\n        const changeUser = controller.getStateManager().findItemInState(this.config.stateNames.users, {id: message.user}, isSame);\n        let username = \"unknown\";\n        if (changeUser) {\n            username = changeUser.username;\n        }\n        slLogger(`Handling data change ${message.type} on object type ${message.stateName} made by user ${username}`);\n\n        let stateObj = message.data;\n        slLogger(stateObj);\n        // ok lets work out where this change belongs\n        try {\n            switch (message.type) {\n                case \"create\": {\n                    switch (message.stateName) {\n                        case this.config.stateNames.comments: {\n                            controller.getStateManager().addNewItemToState(this.config.stateNames.comments,stateObj,true);\n                            // find the entry in question\n                            const changedEntry = controller.getStateManager().findItemInState(this.config.stateNames.entries, {id: stateObj.commentOn}, isSame);\n                            if (changedEntry) {\n                                notifier.show(changedEntry.title, `${username} added comment ${stateObj.content}`);\n                            }\n                            break;\n                        }\n                        case this.config.stateNames.entries: {\n                            controller.getStateManager().addNewItemToState(this.config.stateNames.entries, stateObj,true);\n                            notifier.show(stateObj.title, `${username} added new entry`);\n                            break;\n                        }\n                        case this.config.stateNames.users: {\n                            controller.getStateManager().addNewItemToState(this.config.stateNames.users, stateObj,true);\n                            notifier.show(stateObj.username, `${stateObj.username} has just registered.`, 'message');\n                            break;\n                        }\n                    }\n                    break;\n                }\n                case \"update\": {\n                    switch (message.stateName) {\n                        case this.config.stateNames.entries: {\n                            controller.getStateManager().updateItemInState(this.config.stateNames.entries, stateObj, isSame, true);\n                            // the entry could be selected by this (different user) but that would only be for comments, which is not what changed, so we are done\n                            break;\n                        }\n                    }\n                    break;\n                }\n                case \"delete\": {\n                    switch (message.stateName) {\n                        case this.config.stateNames.comments: {\n                            controller.getStateManager().removeItemFromState(this.config.stateNames.comments,stateObj,isSame, true);\n                            break;\n                        }\n                        case this.config.stateNames.entries: {\n                            let deletedEntry = controller.getStateManager().findItemInState(this.config.stateNames.entries, stateObj, isSame);\n                            controller.getStateManager().removeItemFromState(this.config.stateNames.entries, stateObj, isSame,true);\n                            notifier.show(deletedEntry.title, `${username} has deleted this entry.`, 'priority');\n                            break;\n                        }\n                    }\n                    break;\n                }\n            }\n        } catch (err) {\n            slLogger(err);\n        }\n\n    }\n\n    handleMessage(message: string): void {\n        slLogger(`Received message: ${message}`);\n    }\n\n    getCurrentUser(): number {\n        return controller.getLoggedInUserId();\n    }\n\n}\n","import debug from 'debug';\n\nimport {AbstractStateManager} from \"./AbstractStateManager\";\nimport {equalityFunction} from '../util/EqualityFunctions';\nimport {stateValue} from \"./StateManager\";\nimport AsynchronousStateManager from \"./AsynchronousStateManager\";\n\nconst lsLogger = debug('local-storage');\n\nexport default class BrowserStorageStateManager extends AbstractStateManager implements AsynchronousStateManager{\n  protected storage:Storage;\n  private static _instance:BrowserStorageStateManager;\n\n  public static getInstance(useLocalStorage:boolean = false) {\n    if (!(BrowserStorageStateManager._instance)) {\n      BrowserStorageStateManager._instance = new BrowserStorageStateManager(useLocalStorage);\n    }\n    return BrowserStorageStateManager._instance;\n  }\n\n\n  public constructor(useLocalStorage:boolean = false) {\n    super('browser');\n    this.storage = window.sessionStorage;\n    if (useLocalStorage) this.storage = window.localStorage;\n    this.forceSaves = true;\n  }\n\n  public  _ensureStatePresent(name:string):void {\n    if (this.storage.getItem(name) === null) {\n      this._addNewNamedStateToStorage({name:name, value:[]});\n    }\n  }\n\n  public  _addNewNamedStateToStorage(state:stateValue):void {\n    lsLogger(`Local Storage: Saving with key ${state.name}`);\n    lsLogger(state);\n    const stringifiedSaveData:string = JSON.stringify(state.value);\n    lsLogger(stringifiedSaveData);\n    this.storage.setItem(state.name, stringifiedSaveData);\n\n  }\n  public  _replaceNamedStateInStorage(state:stateValue):void {\n    this._addNewNamedStateToStorage(state);\n  }\n\n  public  _getState(name:string):stateValue {\n    let savedResults = [];\n    lsLogger(`Local Storage: Loading with key ${name}`);\n    const savedResultsJSON = this.storage.getItem(name);\n    lsLogger(savedResultsJSON);\n    if (savedResultsJSON !== null) {\n      savedResults = JSON.parse(savedResultsJSON);\n    }\n    return {name:name, value:savedResults};\n  }\n\n  public  _saveState(name:string,newValue:any):void {\n    this._addNewNamedStateToStorage({name:name,value:newValue});\n  }\n\n  _addItemToState(name: string, stateObj: any,isPersisted:boolean = false): void {\n     if (!isPersisted) return;\n\n     let state:stateValue = this._getState(name);\n     lsLogger(`adding item to state ${name}`);\n     lsLogger(stateObj);\n     state.value.push(stateObj);\n     this._replaceNamedStateInStorage(state);\n  }\n\n  _removeItemFromState(name: string, stateObj: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): void {\n    let state:stateValue = this._getState(name);\n    const valueIndex = state.value.findIndex((element: any) => testForEqualityFunction(element, stateObj));\n    if (valueIndex >= 0) {\n      lsLogger(`removing item from state ${name}`);\n      lsLogger(stateObj);\n      state.value.splice(valueIndex, 1);\n    }\n    this._replaceNamedStateInStorage(state);\n  }\n\n  _updateItemInState(name: string, stateObj: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): void {\n    let state:stateValue = this._getState(name);\n    const valueIndex = state.value.findIndex((element: any) => testForEqualityFunction(element, stateObj));\n    if (valueIndex >= 0) {\n      state.value.splice(valueIndex, 1,stateObj);\n      lsLogger(`updating item in state ${name}`);\n      lsLogger(stateObj);\n    }\n    this._replaceNamedStateInStorage(state);\n  }\n\n  forceResetForGet(stateName: string): void {\n  }\n\n  getConfiguredStateNames(): string[] {\n    return this.configuration;\n  }\n\n  hasCompletedRun(stateName: string): boolean {\n    return false;\n  }\n\n  // @ts-ignore\n  private configuration:string[] = [];\n\n  public initialise(config:string[]) {\n    this.configuration = config;\n  }\n\n}\n","import debug from 'debug';\nimport moment from \"moment\";\nimport socketManager from \"./SocketManager\";\n\nimport {ChatLog, Invitation, InviteType, JoinLeft, Message, Priority} from \"./Types\";\nimport {ChatEmitter} from \"./ChatEmitter\";\nimport {ChatReceiver} from \"./ChatReceiver\";\nimport {ChatEventListener} from \"./ChatEventListener\";\n\nimport {StateManager} from \"../state/StateManager\";\nimport BrowserStorageStateManager from \"../state/BrowserStorageStateManager\";\nimport uuid from \"../util/UUID\";\nimport {ChatUserEventListener} from \"./ChatUserEventListener\";\n\n\nenum UserStatus {\n    LoggedOut,\n    LoggedIn\n}\n\nconst cmLogger = debug('chat-manager');\n\nexport class ChatManager implements ChatReceiver,ChatEmitter {\n    private static _instance: ChatManager;\n\n    public static getInstance(): ChatManager {\n        if (!(ChatManager._instance)) {\n            ChatManager._instance = new ChatManager();\n        }\n        return ChatManager._instance;\n    }\n\n    // TO DO chat logs, blocked list, favourites per user\n    protected chatLogs: ChatLog[];\n    protected localStorage:StateManager;\n    private static chatLogKey = 'im-board-chat-logs';\n    private currentUsername = '';\n    protected blockedList: string[] = [];\n    private static blockedListKey = 'im-board-blocked-list';\n    protected favouriteList: string[] = [];\n    private static favouriteListKey = 'im-board-favourite-list';\n\n\n    protected loggedInUsers: string[] = [];\n\n\n    protected chatListeners:ChatEventListener[];\n    protected chatUserListeners:ChatUserEventListener[];\n\n    public addChatEventHandler(receiver:ChatEventListener):void {\n        this.chatListeners.push(receiver);\n    }\n\n    public addChatUserEventHandler(receiver:ChatUserEventListener):void {\n        this.chatUserListeners.push(receiver);\n    }\n\n    private constructor() {\n        cmLogger('Setting up chat logs, blocked list, and favourites');\n\n        this.chatLogs = [];\n        this.chatListeners = [];\n        this.chatUserListeners = [];\n        this.localStorage = new BrowserStorageStateManager(true);\n\n        // connect to the socket manager\n        socketManager.addChatReceiver(this);\n\n        // bind the receiver methods\n        this.receiveLogin = this.receiveLogin.bind(this);\n        this.receiveLogout = this.receiveLogout.bind(this);\n        this.receiveInvitation = this.receiveInvitation.bind(this);\n        this.receiveMessage = this.receiveMessage.bind(this);\n        this.receiveQueuedMessages = this.receiveQueuedMessages.bind(this);\n        this.receiveQueuedInvites = this.receiveQueuedInvites.bind(this);\n        this.receiveJoinedRoom = this.receiveJoinedRoom.bind(this);\n        this.receivedLeftRoom = this.receivedLeftRoom.bind(this);\n    }\n\n    public isUserLoggedIn(username:string) {\n        return (this.loggedInUsers.findIndex((name) => name === username) >= 0);\n    }\n\n    receiveUserList(users: string[]): void {\n        this.loggedInUsers = users;\n        this.chatUserListeners.forEach((listener) => listener.handleLoggedInUsersUpdated(users));\n    }\n\n    private saveLogs():void {\n        this.localStorage.setStateByName(ChatManager.chatLogKey+this.currentUsername,this.chatLogs,false);\n    }\n\n    private saveBlockedList():void {\n        this.localStorage.setStateByName(ChatManager.blockedListKey+this.currentUsername,this.blockedList, false);\n    }\n\n    private saveFavouriteList():void {\n        this.localStorage.setStateByName(ChatManager.favouriteListKey+this.currentUsername,this.favouriteList, false);\n    }\n\n    public addUserToBlockedList(username:string):void {\n        let index = this.blockedList.findIndex((blocked) => blocked === username);\n        if (index < 0) {\n            this.blockedList.push(username);\n            this.saveBlockedList();\n            this.chatUserListeners.forEach((listener) => listener.handleBlockedUsersChanged(this.favouriteList));\n        }\n    }\n\n    public removeUserFromBlockedList(username:string):void {\n        let index = this.blockedList.findIndex((blocked) => blocked === username);\n        if (index >= 0) {\n            this.blockedList.splice(index,1);\n            this.saveBlockedList();\n            this.chatUserListeners.forEach((listener) => listener.handleBlockedUsersChanged(this.favouriteList));\n        }\n\n    }\n\n    public isUserInBlockedList(username:string):boolean {\n        return (this.blockedList.findIndex((blocked) => blocked === username) >= 0);\n    }\n\n\n    public addUserToFavouriteList(username:string):void {\n        let index = this.favouriteList.findIndex((favourite) => favourite === username);\n        if (index < 0) {\n            this.favouriteList.push(username);\n            this.saveFavouriteList();\n            this.chatUserListeners.forEach((listener) => listener.handleFavouriteUsersChanged(this.favouriteList));\n        }\n    }\n\n    public removeUserFromFavouriteList(username:string):void {\n        let index = this.favouriteList.findIndex((blocked) => blocked === username);\n        if (index >= 0) {\n            this.favouriteList.splice(index,1);\n            this.saveFavouriteList();\n            this.chatUserListeners.forEach((listener) => listener.handleFavouriteUsersChanged(this.favouriteList));\n        }\n\n    }\n\n    public isUserInFavouriteList(username:string):boolean {\n        return (this.favouriteList.findIndex((user) => user === username) >= 0);\n    }\n\n    public getFavouriteUserList():string[] {\n        return [...this.favouriteList];\n    }\n\n    public getBlockedUserList():string[] {\n        return [...this.blockedList];\n    }\n\n\n    public setCurrentUser(username:string):void {\n        cmLogger(`Setting current user ${username}`);\n        this.currentUsername = username;\n        // load previous logs\n        let savedLogs = this.localStorage.getStateByName(ChatManager.chatLogKey+this.currentUsername);\n        cmLogger(savedLogs);\n        if (savedLogs) {\n            this.chatLogs = savedLogs;\n        }\n\n        // load previous blocked list\n        let blockedList = this.localStorage.getStateByName(ChatManager.blockedListKey+this.currentUsername);\n        cmLogger(blockedList);\n        if (blockedList) {\n            this.blockedList = blockedList;\n        }\n\n        // load previous favourite list\n        let favouriteList = this.localStorage.getStateByName(ChatManager.favouriteListKey+this.currentUsername);\n        cmLogger(favouriteList);\n        if (favouriteList) {\n            this.favouriteList = favouriteList;\n        }\n\n        this.chatListeners.forEach((listener) => listener.handleChatLogsUpdated());\n\n\n    }\n\n    public getCurrentUser():string {\n        return this.currentUsername;\n    }\n\n    private ensureChatLogExists(room:string):ChatLog {\n        let log:ChatLog;\n        let index = this.chatLogs.findIndex((log) => log.roomName === room);\n        if (index < 0) {\n            log = {\n                roomName: room,\n                users: [this.getCurrentUser()],\n                messages: [],\n                lastViewed: parseInt(moment().format('YYYYMMDDHHmmss')),\n                numOfNewMessages: 0,\n                type: InviteType.ChatRoom,\n            }\n            this.chatLogs.push(log);\n            this.saveLogs();\n        }\n        else {\n            log = this.chatLogs[index];\n        }\n        return log;\n    }\n\n    private ensureChatLogExistsWithUser(username:string):ChatLog {\n        let foundLog:ChatLog|null = null;\n        let index = 0;\n        while (index < this.chatLogs.length) {\n            let log = this.chatLogs[index];\n            if (log.users.length === 2) {\n                // is the username in the two of this room?\n                if (log.users.findIndex((value) => value === username) >= 0) {\n                    foundLog = log;\n                    index = this.chatLogs.length;\n                }\n            }\n            index++;\n        }\n        if (!foundLog) {\n            foundLog = {\n                roomName: uuid.getUniqueId(),\n                users: [this.getCurrentUser(),username],\n                messages: [],\n                lastViewed: parseInt(moment().format('YYYYMMDDHHmmss')),\n                numOfNewMessages: 0,\n                type: InviteType.ChatRoom\n            }\n            this.chatLogs.push(foundLog);\n            this.saveLogs();\n        }\n        return foundLog;\n    }\n\n\n    receiveJoinedRoom(users: JoinLeft): void {\n        // we get this for all changes to a room, if the username is us can safely ignore\n        //if (users.username === this.currentUsername) return;\n        if (users.type !== InviteType.ChatRoom) return;\n\n        let log:ChatLog = this.ensureChatLogExists(users.room);\n\n        cmLogger(`User list for room ${users.room} - ${users.userList.join(',')}`);\n        log.users = users.userList;\n        // add a \"message\" for joined user\n        let created = parseInt(moment().format('YYYYMMDDHHmmss'));\n        const joinDateTime = moment().format('DD/MM/YYYY HH:mm');\n        let message:Message = {\n            from:'',\n            created: created,\n            room: users.room,\n            priority: 0,\n            type: InviteType.ChatRoom,\n            message: `${users.username} joined the chat on ${joinDateTime}`\n        }\n        log.messages.push(message);\n        this.saveLogs();\n\n        this.chatListeners.forEach((listener) => listener.handleChatLogUpdated(log,false));\n    }\n\n    receivedLeftRoom(users: JoinLeft): void {\n        // we get this for all changes to a room, if the username is us can safely ignore\n        if (users.type !== InviteType.ChatRoom) return;\n        if (users.username === this.currentUsername) return;\n\n        let log:ChatLog = this.ensureChatLogExists(users.room);\n\n        cmLogger(`User list for room ${users.room} - ${users.userList.join(',')}`);\n        log.users = users.userList;\n        // add a \"message\" for leaving user\n        let created = parseInt(moment().format('YYYYMMDDHHmmss'));\n        const joinDateTime = moment().format('DD/MM/YYYY HH:mm');\n        let message:Message = {\n            from:'',\n            created: created,\n            room: users.room,\n            priority: 0,\n            type: InviteType.ChatRoom,\n            message: `${users.username} left the chat on ${joinDateTime}`\n        }\n        log.messages.push(message);\n        this.saveLogs();\n\n        this.chatListeners.forEach((listener) => listener.handleChatLogUpdated(log,false));\n    }\n\n    private doesChatRoomExist(room:string) {\n        let index = this.chatLogs.findIndex((log:ChatLog) => log.roomName === room);\n        return (index >= 0);\n    }\n\n    receiveInvitation(invite: Invitation): void {\n        if (invite.type !== InviteType.ChatRoom) return;\n\n        //  unless we are receiving an invite from someone in our blocked list, we automatically accept this invite\n        if (!this.isUserInBlockedList(invite.from)) {\n            cmLogger(`Invited to chat ${invite.room}`);\n            const didChatAlreadyExist = this.doesChatRoomExist(invite.room);\n            cmLogger(invite);\n            cmLogger(`Letting the listeners know, if they are all happy to accept then we will join the room`);\n\n            let happyToProceed = true;\n\n            if (!didChatAlreadyExist) {\n                this.chatListeners.forEach((listener) => {\n                    if (!listener.handleNewInviteReceived(invite)) {\n                        happyToProceed = false;\n                    }\n                });\n            }\n            if (happyToProceed) {\n\n                let chatLog: ChatLog = this.ensureChatLogExists(invite.room);\n                // keep a record of the type of invite\n                chatLog.type = invite.type;\n\n                // add the users in the invitation user list for the room, if not already added\n                if (invite.userList) {\n                    invite.userList.forEach((username: string) => {\n                        if ((chatLog.users.findIndex((user) => user === username)) < 0) chatLog.users.push(invite.from);\n                    });\n                }\n\n                if ((chatLog.users.findIndex((user) => user === invite.from)) < 0) chatLog.users.push(invite.from);\n\n                this.saveLogs();\n                cmLogger(`Joining chat ${invite.room}`);\n                socketManager.joinChat(this.getCurrentUser(), invite.room,InviteType.ChatRoom);\n                this.chatListeners.forEach((listener) => listener.handleChatLogUpdated(chatLog, false));\n            }\n\n        }\n        else {\n            cmLogger(`User ${invite.from} blocked`);\n        }\n    }\n\n\n    receiveLogin(username: string): void {\n        cmLogger(`Handle login received for ${username}`);\n        // keep track of the logged in users\n        let index = this.loggedInUsers.findIndex((user) => user === username);\n        if (index < 0) this.loggedInUsers.push(username);\n        cmLogger(this.loggedInUsers);\n\n        this.chatUserListeners.forEach((listener) => listener.handleLoggedInUsersUpdated(this.loggedInUsers));\n\n        // if the user in in favourites and not in blocked list passing this on to the listener\n        if (!this.isUserInBlockedList(username) && this.isUserInFavouriteList(username)) {\n            cmLogger(`User ${username} logging in`);\n            this.chatUserListeners.forEach((listener) => listener.handleFavouriteUserLoggedIn(username));\n        }\n    }\n\n    receiveLogout(username: string): void {\n        let index = this.loggedInUsers.findIndex((user) => user === username);\n        if (index >= 0) this.loggedInUsers.splice(index,1);\n\n        this.chatUserListeners.forEach((listener) => listener.handleLoggedInUsersUpdated(this.loggedInUsers));\n\n        // if the user in in favourites and not in blocked list passing this on to the listener\n        if (!this.isUserInBlockedList(username) && this.isUserInFavouriteList(username)) {\n            cmLogger(`User ${username} logging out`);\n            this.chatUserListeners.forEach((listener) => listener.handleFavouriteUserLoggedOut(username));\n        }\n    }\n\n    receiveDecline(room: string, username: string, type:number): void {\n        if (type !== InviteType.ChatRoom) return;\n        // we get this for all changes to a room, if the username is us can safely ignore\n        if (username === this.currentUsername) return;\n\n\n        if (!this.isUserInBlockedList(username)) {\n            cmLogger(`User ${username} declined invitation to room`);\n            this.chatListeners.forEach((listener) => listener.handleInvitationDeclined(room,username));\n        }\n\n    }\n\n\n    private addMessageToChatLog(log:ChatLog, message:Message) {\n        log.numOfNewMessages ++;\n        log.messages.push(message);\n        if (message.from === this.getCurrentUser()) {\n            this.touchChatLog(log.roomName); // this will also save the logs\n        }\n        else {\n            this.saveLogs();\n        }\n    }\n\n    public touchChatLog(room:string):void {\n        let chatLog = this.ensureChatLogExists(room);\n        chatLog.numOfNewMessages = 0;\n        chatLog.lastViewed = parseInt(moment().format('YYYYMMDDHHmmss'));\n        this.saveLogs();\n    }\n\n    public getChatLog(room:string):ChatLog|null {\n        let log:ChatLog|null = null;\n        let index = this.chatLogs.findIndex((log) => log.roomName === room);\n        if (index >= 0) log = this.chatLogs[index];\n        return log;\n    }\n\n    private addSenderToRoomIfNotAlreadyPresent(chatLog:ChatLog, sender:string) {\n        let index = chatLog.users.findIndex((user) => user === sender);\n        if (index < 0) {\n            chatLog.users.push(sender);\n        }\n    }\n\n    receiveMessage(message: Message,wasOffline:boolean = false): void {\n        if (message.type !== InviteType.ChatRoom) return; // ignore messages that aren't for chat rooms\n        // double check the message is not from us somehow\n        if (message.from === this.getCurrentUser()) return;\n        // don't receive messages from the blocked users\n        if (!this.isUserInBlockedList(message.from)) {\n\n            // ok, so we need to add the message to the chat log, increase the new message count, save the logs and pass it on\n            let chatLog = this.ensureChatLogExists(message.room);\n            this.addSenderToRoomIfNotAlreadyPresent(chatLog, message.from);\n            this.addMessageToChatLog(chatLog, message);\n            cmLogger(`Message received`);\n            cmLogger(message);\n\n            this.chatListeners.forEach((listener) => listener.handleChatLogUpdated(chatLog,wasOffline));\n        }\n        else {\n            cmLogger(`Message received from user ${message.from} - is in blocked list, not passed on.`)\n        }\n\n    }\n\n    receiveQueuedInvites(invites: any): void {\n        // just loop through and process each invite\n        invites.forEach((invite:Invitation) => {\n            this.receiveInvitation(invite);\n        });\n    }\n\n    receiveQueuedMessages(messages: any): void {\n        // just loop through a process each message\n        messages.forEach((message:Message) => {\n           this.receiveMessage(message,true)\n        });\n        this.chatListeners.forEach((listener) => listener.handleOfflineMessagesReceived(messages));\n    }\n\n    joinChat(room: string): void {\n        if (this.getCurrentUser().trim().length === 0) return;  // we are not logged in\n        this.ensureChatLogExists(room);\n        socketManager.joinChat(this.getCurrentUser(),room,InviteType.ChatRoom);\n    }\n\n    private removeChatLog(room:string) {\n        let index = this.chatLogs.findIndex((log) => log.roomName === room);\n        if (index >= 0) {\n            cmLogger(`Removing Chat log for room ${room}`);\n            let result = this.chatLogs.splice(index,1);\n            cmLogger(result.length);\n            this.saveLogs();\n        }\n    }\n\n    leaveChat(room: string): void {\n        if (this.getCurrentUser().trim().length === 0) return;  // we are not logged in\n        this.removeChatLog(room);\n        socketManager.leaveChat(this.getCurrentUser(),room,InviteType.ChatRoom);\n    }\n\n    login(): void {\n        if (this.getCurrentUser().trim().length === 0) return;  // we are not logged in\n        socketManager.login(this.getCurrentUser());\n        // get the current user list\n        socketManager.getUserList();\n        // connect to the chat rooms already in logs\n        this.chatLogs.forEach((log) => {\n            socketManager.joinChat(this.currentUsername,log.roomName,InviteType.ChatRoom);\n        });\n    }\n\n    logout(): void {\n        if (this.getCurrentUser().trim().length === 0) return;  // we are not logged in\n        socketManager.logout(this.getCurrentUser());\n    }\n\n    declineInvite(room:string) {\n        if (this.getCurrentUser().trim().length === 0) return;  // we are not logged in\n        socketManager.sendDeclineInvite(room, this.getCurrentUser(),InviteType.ChatRoom);\n\n    }\n\n    sendInvite(to: string, room: string,type:InviteType = InviteType.ChatRoom,requiresAcceptDecline:boolean = false, subject:string = ''): void {\n        if (this.getCurrentUser().trim().length === 0) return;  // we are not logged in\n        // can't accidentally send an invite to blacklisted\n        if (this.isUserInBlockedList(to)) return;\n        // only send an invite if the user isn't already in the room\n        const log:ChatLog = this.ensureChatLogExists(room);\n        if (log.users.findIndex((user) =>  user === to) < 0) {\n            socketManager.sendInvite(this.getCurrentUser(),to, room,type,requiresAcceptDecline,subject);\n        }\n    }\n\n    sendMessage(room: string, content: string, priority:Priority = Priority.Normal, attachment:any|undefined): Message|null {\n        if (this.getCurrentUser().trim().length === 0) return null;  // we are not logged in\n        let log = this.ensureChatLogExists(room);\n        // send the message\n        let created = parseInt(moment().format('YYYYMMDDHHmmss'));\n        socketManager.sendMessage(this.getCurrentUser(),room, content, created,InviteType.ChatRoom, Priority.Normal,{});\n\n        // add the message to the chat log\n        if (!attachment) attachment = {};\n        let sent:Message = {\n            from:this.getCurrentUser(),\n            room: room,\n            message: content,\n            created: created,\n            priority: priority,\n            type: InviteType.ChatRoom,\n            attachment: attachment\n        }\n        this.addMessageToChatLog(log, sent);\n        return sent;\n    }\n\n    public getChatLogs():ChatLog[] {\n        return [...this.chatLogs];\n    }\n\n\n    public startChatWithUser(username:string) {\n        if (username) {\n            cmLogger(`Starting chat with ${username}`);\n            // first thing, do we have a chat log with this user (and just this user) already?\n            let chatLog: ChatLog = this.ensureChatLogExistsWithUser(username);\n            this.chatListeners.forEach((listener) => listener.handleChatLogUpdated(chatLog,false));\n\n\n            // invite the other user\n            socketManager.sendInvite(this.getCurrentUser(), username, chatLog.roomName,InviteType.ChatRoom,false,'');\n            // ok, lets connect to the server\n            socketManager.joinChat(this.getCurrentUser(), chatLog.roomName, InviteType.ChatRoom);\n        }\n    }\n\n}\n","import {ChatManager} from \"./ChatManager\";\nimport {ChatEventListener} from \"./ChatEventListener\";\nimport notifier from \"../notification/NotificationManager\";\nimport debug from 'debug';\nimport {ChatLog, Invitation, InviteType, Message} from \"./Types\";\nimport {ChatUserEventListener} from \"./ChatUserEventListener\";\nimport controller from \"../Controller\";\n\nconst notLogger = debug('notification-controller');\n\nexport class NotificationController implements ChatEventListener, ChatUserEventListener {\n    private static _instance: NotificationController;\n\n    public static getInstance(): NotificationController {\n        if (!(NotificationController._instance)) {\n            NotificationController._instance = new NotificationController();\n        }\n        return NotificationController._instance;\n    }\n\n    private doNotDisturb: boolean = false;\n    private chatManager: ChatManager;\n    private chatListeners: ChatEventListener[];\n    private chatUserListeners: ChatUserEventListener[];\n\n    private constructor() {\n        this.chatManager = ChatManager.getInstance();\n        this.doNotDisturb = false;\n        this.chatListeners = [];\n        this.chatUserListeners = [];\n\n\n        //bind the methods\n        this.handleChatLogUpdated = this.handleChatLogUpdated.bind(this);\n        this.handleLoggedInUsersUpdated = this.handleLoggedInUsersUpdated.bind(this);\n        this.handleFavouriteUserLoggedIn = this.handleFavouriteUserLoggedIn.bind(this);\n        this.handleFavouriteUserLoggedOut = this.handleFavouriteUserLoggedOut.bind(this);\n\n        this.chatManager.addChatEventHandler(this);\n        this.chatManager.addChatUserEventHandler(this);\n    }\n\n    handleInvitationDeclined(room: string, username: string): void {\n        if ((this.doNotDisturb)) return;\n\n        // notify the user of the new chat\n        notifier.show('Room',`User ${username} has declined the invitation to join you.`,'info',7000);\n    }\n\n\n    handleNewInviteReceived(invite: Invitation): boolean {\n        let result = true;\n\n        // is this a chat room or score sheet?\n        if (invite.type === InviteType.ScoreSheet) return true;\n\n        if ((this.doNotDisturb) && (!invite.requiresAcceptDecline)) return result;\n\n        if (invite.requiresAcceptDecline) {\n            // notify the user of the invitation\n            result = controller.askUserAboutInvitation(invite);\n\n        }\n        else {\n            // notify the user of the new chat\n            notifier.show('Chat Room',`User ${invite.from} has invited you.`,'info',7000);\n        }\n\n        return result;\n    }\n\n    public addListener(listener:ChatEventListener) {\n        this.chatListeners.push(listener);\n    }\n    public addUserListener(listener:ChatUserEventListener) {\n        this.chatUserListeners.push(listener);\n    }\n\n    public setDoNotDisturb(dontDisturbMe = true) {\n        this.doNotDisturb = dontDisturbMe;\n    }\n\n    public blackListUser(username:string, isBlackedListed:boolean = true) {\n        if (isBlackedListed) {\n            this.chatManager.addUserToBlockedList(username);\n        }\n        else {\n            this.chatManager.removeUserFromBlockedList(username);\n        }\n    }\n\n    public favouriteUser(username:string, isFavourited:boolean = true) {\n        if (isFavourited) {\n            this.chatManager.addUserToFavouriteList(username);\n        }\n        else {\n            this.chatManager.removeUserFromFavouriteList(username);\n        }\n    }\n\n    public isFavouriteUser(username:string):boolean {\n        return this.chatManager.isUserInFavouriteList(username);\n    }\n\n    public isBlockedUser(username:string):boolean {\n        return this.chatManager.isUserInBlockedList(username);\n    }\n\n    handleChatLogsUpdated() {\n        this.chatListeners.forEach((listener) => listener.handleChatLogsUpdated());\n    }\n\n    handleChatLogUpdated(log: ChatLog,wasOffline = false): void {\n        notLogger(`Handle chat log updated`);\n        notLogger(log);\n        // pass on the changes\n        this.chatListeners.forEach((listener) => listener.handleChatLogUpdated(log, wasOffline));\n\n        // provide visual notifications if do not disturb is not on\n        if (this.doNotDisturb) return;\n\n        if (!wasOffline) {\n            // get the last message added, it won't be from ourselves (the chat manager takes care of that)\n            if (log.messages.length > 0) {\n                const displayMessage = log.messages[log.messages.length - 1];\n                notifier.show(displayMessage.from,displayMessage.message,'message',3000);\n            }\n        }\n    }\n\n    handleLoggedInUsersUpdated(usernames: string[]): void {\n        notLogger(`Handle logged in users updated`);\n        notLogger(usernames);\n\n        // allow the view to change the user statuses\n        this.chatUserListeners.forEach((listener) => listener.handleLoggedInUsersUpdated(usernames));\n    }\n\n    handleFavouriteUserLoggedIn(username: string): void {\n        notLogger(`Handle favourite user ${username} logged in`);\n        // allow the view to change the user statuses\n        this.chatUserListeners.forEach((listener) => listener.handleFavouriteUserLoggedIn(username));\n\n        // provide visual notifications if do not disturb is not on\n        if (this.doNotDisturb) return;\n        notifier.show(username,`User ${username} has logged in.`,'warning',5000);\n    }\n\n    handleFavouriteUserLoggedOut(username: string): void {\n        notLogger(`Handle favourite user ${username} logged out`);\n        // allow the view to change the user statuses\n        this.chatUserListeners.forEach((listener) => listener.handleFavouriteUserLoggedOut(username));\n\n        // provide visual notifications if do not disturb is not on\n        if (this.doNotDisturb) return;\n        notifier.show(username,`User ${username} has logged out.`,'priority',4000);\n\n    }\n\n    handleBlockedUsersChanged(usernames: string[]): void {\n        notLogger(`Handle blocked users changed to ${usernames}`);\n        this.chatUserListeners.forEach((listener) => listener.handleBlockedUsersChanged(usernames));\n    }\n\n    handleFavouriteUsersChanged(usernames: string[]): void {\n        notLogger(`Handle favourite users changed to ${usernames}`);\n        this.chatUserListeners.forEach((listener) => listener.handleFavouriteUsersChanged(usernames));\n    }\n\n    public startChatWithUser(username:string) {\n        ChatManager.getInstance().startChatWithUser(username);\n    }\n\n    handleChatStarted(log: ChatLog): void {\n        this.chatListeners.forEach((listener) => listener.handleChatStarted(log));\n    }\n\n    handleOfflineMessagesReceived(messages: Message[]): void {\n        // provide visual notifications if do not disturb is not on\n        if (this.doNotDisturb) return;\n        if (messages.length === 0) return;\n\n        notifier.show(\"Offline messages received\",`You have received ${messages.length} messages since you last logged out.`);\n    }\n\n\n}\n","export enum Decorator  {\n    Incomplete,\n    Complete,\n    Persisted,\n    PersistedLocally = 3\n}\n\nexport type ScoreSheet = {\n    room: string,\n    boardGameName: string,\n    sheetLayoutOptions: any|null;\n    timer: number,\n    data: any[]|null,\n    isFinished: boolean,\n    timerGoing: boolean\n}\n\n","import {stateEventType, stateValue} from \"./StateManager\";\nimport {equalityFunction} from \"../util/EqualityFunctions\";\nimport {jsonRequest, RequestType} from \"../network/Types\";\nimport downloader from \"../network/DownloadManager\";\nimport debug from 'debug';\nimport AsynchronousStateManager from \"./AsynchronousStateManager\";\nimport StateChangedDelegate from \"./StateChangedDelegate\";\nimport {StateChangeInformer} from \"./StateChangeInformer\";\nimport StateChangeListener from \"./StateChangeListener\";\n\n\n/*\n*\n*   WORK IN PROGRESS\n*\n */\n\n\nconst graphSMLogger = debug('state-manager-graphql');\n\nexport type QLConfig = {\n    stateName: string,\n    apiURL: string,\n    apis: {\n        findAll: string,\n        create: string,\n        destroy: string,\n        update: string,\n        find: string\n    }\n    data: {\n        findAll: string,\n        create: string,\n        destroy: string,\n        update: string,\n        find: string\n    }\n    isActive: boolean\n}\n\nexport class GraphQLApiStateManager implements AsynchronousStateManager {\n    protected configuration: QLConfig[] = [];\n    protected bHasCompletedRun: boolean[];\n    protected delegate:StateChangeInformer;\n\n    public constructor() {\n        this.delegate = new StateChangedDelegate('graphql');\n        this.emitEvents();\n        this.bHasCompletedRun = [];\n\n\n        this.callbackForAddItem = this.callbackForAddItem.bind(this);\n        this.callbackForRemoveItem = this.callbackForRemoveItem.bind(this);\n        this.callbackForUpdateItem = this.callbackForUpdateItem.bind(this);\n        this.callbackForGetItems = this.callbackForGetItems.bind(this);\n    }\n\n    getConfiguredStateNames(): string[] {\n        let results: string[] = [];\n        this.configuration.forEach((config) => {\n            results.push(config.stateName);\n        });\n        return results;\n    }\n\n    hasCompletedRun(stateName: string): boolean {\n        let result = false;\n        let foundIndex = this.configuration.findIndex((config) => config.stateName === stateName);\n        if (foundIndex >= 0) {\n            result = this.bHasCompletedRun[foundIndex];\n        }\n        return result;\n    }\n\n    setCompletedRun(stateName:string):void {\n        let foundIndex = this.configuration.findIndex((config) => config.stateName === stateName);\n        if (foundIndex >= 0) {\n            this.bHasCompletedRun[foundIndex] = true;\n        }\n    }\n\n    forceResetForGet(stateName: string): void {\n        let foundIndex = this.configuration.findIndex((config) => config.stateName === stateName);\n        if (foundIndex >= 0) {\n            this.bHasCompletedRun[foundIndex] = false;\n        }\n    }\n\n    public initialise(config: QLConfig[]) {\n        this.configuration = config;\n        let runsComplete: boolean[] = [];\n        this.configuration.forEach((configItem) => {\n            runsComplete.push(false);\n        });\n        this.bHasCompletedRun = runsComplete;\n    }\n\n    protected getConfigurationForStateName(name: string) {\n        let config: QLConfig = {\n            stateName: name,\n            apiURL: '/graphql',\n            apis: {\n                findAll: '',\n                create: '',\n                destroy: '',\n                update: '',\n                find: ''\n            },\n            data: {\n                findAll: '',\n                create: '',\n                destroy: '',\n                update: '',\n                find: ''\n            },\n            isActive: false\n        }\n        let foundIndex = this.configuration.findIndex((config) => config.stateName === name);\n        if (foundIndex >= 0) {\n            config = this.configuration[foundIndex];\n        }\n        return config;\n    }\n\n    private callbackForRemoveItem(data: any, status: number, associatedStateName: string) {\n        graphSMLogger(`callback for remove item for state ${associatedStateName} with status ${status} - not forwarded`);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            graphSMLogger(data);\n        }\n    }\n\n    private callbackForUpdateItem(data: any, status: number, associatedStateName: string) {\n        graphSMLogger(`callback for update item for state ${associatedStateName} with status ${status} - not forwarded`);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            graphSMLogger(data);\n        }\n    }\n\n    private callbackForGetItems(data: any, status: number, associatedStateName: string) {\n        graphSMLogger(`callback for get items for state ${associatedStateName} with status ${status} - FORWARDING`);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            graphSMLogger(data);\n            let config:QLConfig = this.getConfigurationForStateName(associatedStateName);\n            let dataAttribute = config.data.findAll;\n            this.setCompletedRun(associatedStateName);\n            this.delegate.informChangeListenersForStateWithName(associatedStateName, data.data[dataAttribute], stateEventType.StateChanged,null);\n        }\n    }\n\n    private callbackForAddItem(data: any, status: number, associatedStateName: string) {\n        graphSMLogger(`callback for add item for state ${associatedStateName} with status ${status} - FORWARDING`);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            graphSMLogger(data);\n            this.delegate.informChangeListenersForStateWithName(associatedStateName, data, stateEventType.ItemAdded,null);\n        }\n    }\n\n    _addNewNamedStateToStorage(state: stateValue): void { /* assume model on the other end exists */\n    }\n\n    _getState(name: string): stateValue {\n        graphSMLogger(`Getting All ${name}`);\n        if (this.hasCompletedRun(name)) {\n            graphSMLogger(`Getting All ${name} - not done - previously retrieved`);\n        } else {\n            let config: QLConfig = this.getConfigurationForStateName(name);\n            if (config.isActive) {\n                let query = config.apis.findAll;\n                const jsonRequest: jsonRequest = {\n                    url: config.apiURL,\n                    type: RequestType.POST,\n                    params: {query},\n                    callback: this.callbackForGetItems,\n                    associatedStateName: name\n                };\n                graphSMLogger(`Getting All ${name} with query \"${query}\"`);\n                downloader.addApiRequest(jsonRequest, true);\n\n            } else {\n                graphSMLogger(`No configuration for state ${name}`);\n            }\n        }\n        let state: stateValue = {name: name, value: []};\n        return state;\n    }\n\n    _ensureStatePresent(name: string): void { /* assume state exists */\n    }\n\n    _replaceNamedStateInStorage(state: stateValue): void { /* not going to replace all state */\n    }\n\n    _saveState(name: string, stateObj: any): void { /* not going to replace all state */\n    }\n\n    _addItemToState(name: string, stateObj: any, isPersisted: boolean = false): void {\n        if (isPersisted) return; // dont add complete objects to the state - they are already processed\n        graphSMLogger(`Adding item to ${name}`);\n        graphSMLogger(stateObj);\n        let config: QLConfig = this.getConfigurationForStateName(name);\n        if (config.isActive) {\n            let mutation:any = {};\n            mutation[config.apis.create] = {}\n\n            const jsonRequest: jsonRequest = {\n                url: config.apiURL,\n                type: RequestType.POST,\n                params: {mutation},\n                callback: this.callbackForAddItem,\n                associatedStateName: name\n            };\n            downloader.addApiRequest(jsonRequest, true);\n\n        } else {\n            graphSMLogger(`No configuration for state ${name}`);\n        }\n    }\n\n\n    _removeItemFromState(name: string, stateObj: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): void {\n        if (isPersisted) return; // dont remove complete objects to the state - they are already processed\n        graphSMLogger(`Removing item to ${name}`);\n        graphSMLogger(stateObj);\n        let config: QLConfig = this.getConfigurationForStateName(name);\n        if (config.isActive) {\n            let mutation:any = {};\n            mutation[config.apis.destroy] = {}\n\n            const jsonRequest: jsonRequest = {\n                url: config.apiURL,\n                type: RequestType.POST,\n                params: {mutation},\n                callback: this.callbackForRemoveItem,\n                associatedStateName: name\n            };\n            downloader.addApiRequest(jsonRequest, true);\n\n        } else {\n            graphSMLogger(`No configuration for state ${name}`);\n        }\n    }\n\n    _updateItemInState(name: string, stateObj: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): void {\n        if (isPersisted) return; // dont update complete objects to the state - they are already processed\n        graphSMLogger(`Updating item in ${name}`);\n        graphSMLogger(stateObj);\n        let config: QLConfig = this.getConfigurationForStateName(name);\n        if (config.isActive) {\n            let mutation:any = {};\n            mutation[config.apis.destroy] = {}\n\n            const jsonRequest: jsonRequest = {\n                url: config.apiURL,\n                type: RequestType.POST,\n                params: {mutation},\n                callback: this.callbackForUpdateItem,\n                associatedStateName: name\n            };\n            downloader.addApiRequest(jsonRequest, true);\n\n        } else {\n            graphSMLogger(`No configuration for state ${name}`);\n        }\n    }\n\n    addChangeListenerForName(name: string, listener: StateChangeListener): void {\n        this.delegate.addChangeListenerForName(name,listener);\n    }\n\n    addNewItemToState(name: string, item: any, isPersisted: boolean): void {\n        this._addItemToState(name,item,isPersisted);\n    }\n\n    emitEvents(): void {\n        this.delegate.emitEvents();\n    }\n\n    findItemInState(name: string, item: any, testForEqualityFunction: equalityFunction): any {\n        throw Error(\"not implemented\");\n    }\n\n    getStateByName(name: string): any {\n        this._getState(name);\n    }\n\n    informChangeListenersForStateWithName(name: string, stateObjValue: any, eventType: stateEventType, previousObjValue: any): void {\n        this.delegate.informChangeListenersForStateWithName(name,stateObjValue,eventType,previousObjValue);\n    }\n\n    isItemInState(name: string, item: any, testForEqualityFunction: equalityFunction): boolean {\n        return true;\n    }\n\n    removeItemFromState(name: string, item: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): boolean {\n        this._removeItemFromState(name,item,testForEqualityFunction,isPersisted);\n        return true;\n    }\n\n    setStateByName(name: string, stateObjectForName: any, informListeners: boolean): void {}\n\n    suppressEvents(): void {\n        this.delegate.suppressEvents();\n    }\n\n    updateItemInState(name: string, item: any, testForEqualityFunction: equalityFunction, isPersisted: boolean): boolean {\n        this._updateItemInState(name,item,testForEqualityFunction,isPersisted);\n        return true;\n    }\n}","class BrowserUtil {\n  constructor() {\n  }\n\n  scrollSmoothToId(elementId:string):void {\n    const element:HTMLElement|null = document.getElementById(elementId);\n    if (element !== null) {\n      element.scrollIntoView({\n        block: 'start',\n        behavior: 'smooth',\n      });\n    }\n  }\n\n  scrollToBottomNow (element:HTMLElement):void {\n    if (element) {\n      element.scrollTop = element.scrollHeight - element.clientHeight + 100;\n    }\n  }\n\n  scrollToBottomSmooth (element:HTMLElement):void {\n    if (element) {\n      element.scrollIntoView({\n        behavior: 'smooth',\n      });\n      element.scrollTop = element.scrollHeight - element.clientHeight + 100;\n    }\n  }\n\n  scrollSmoothTo(element:HTMLElement):void {\n    element.scrollIntoView({\n      block: 'start',\n      behavior: 'smooth',\n    });\n  }\n\n  scrollTo(element:HTMLElement):void {\n    element.scrollIntoView({\n      block: 'start',\n    });\n  }\n\n  removeAllChildren(element:HTMLElement):void {\n    if (element && element.firstChild) {\n      while (element.firstChild) {\n        const lastChild:ChildNode|null = element.lastChild;\n        if (lastChild) element.removeChild(lastChild);\n      }\n    }\n  }\n\n  addRemoveClasses(element:HTMLElement,classesText:string,isAdding:boolean = true):void {\n    const classes = classesText.split(' ');\n    classes.forEach((classValue) => {\n        if (classValue.trim().length > 0) {\n          if (isAdding) {\n            element.classList.add(classValue);\n          } else {\n            element.classList.remove(classValue);\n          }\n        }\n    });\n  }\n\n  addAttributes(element:HTMLElement, attributes:any[]|undefined) {\n     if (attributes) {\n       attributes.forEach((attribute:any) => {\n          element.setAttribute(attribute[0],attribute[1]);\n       });\n     }\n  }\n\n}\n\nconst browserUtil = new BrowserUtil();\n\nexport default browserUtil;\n","import StateChangeListener from \"../state/StateChangeListener\";\nimport {ScoreSheetController} from \"./ScoreSheetController\";\nimport Handsontable from \"handsontable\";\nimport browserUtil from \"../util/BrowserUtil\";\nimport debug from 'debug';\nimport {ScoreSheet} from \"../AppTypes\";\n\nconst ssvLogger = debug('score-sheet-view');\n\nexport class ScoreSheetView implements StateChangeListener{\n    private static _instance: ScoreSheetView;\n\n    public static getInstance(): ScoreSheetView {\n        if (!(ScoreSheetView._instance)) {\n            ScoreSheetView._instance = new ScoreSheetView();\n        }\n        return ScoreSheetView._instance;\n    }\n\n    private applicationView:any|null = null;\n\n    private thisEl:HTMLDivElement|null = null;\n    private boardGameTitleEl:HTMLHeadingElement|null = null;\n    private startStopTimer:HTMLButtonElement|null = null;\n    private timerEl:HTMLDivElement|null = null;\n    private endOrLeaveEl:HTMLButtonElement|null = null;\n    private scoreSheetEl:HTMLDivElement|null = null;\n\n    private table:Handsontable|null = null;\n\n    private controller:ScoreSheetController;\n\n    private constructor() {\n        this.controller = ScoreSheetController.getInstance();\n    }\n\n    public onDocumentLoaded(applicationView:any) {\n        this.applicationView = applicationView;\n        this.resetDisplay();\n\n        ScoreSheetController.getInstance().getStateManager().addChangeListenerForName(this.applicationView.state.stateNames.scoreSheet,this);\n\n        // load references to the key elements on the page\n        // @ts-ignore\n        this.thisEl = document.getElementById(this.applicationView.state.ui.scoreSheet.dom.dropZone);\n        // @ts-ignore\n        this.boardGameTitleEl = document.getElementById(this.applicationView.state.ui.scoreSheet.dom.boardGame);\n        // @ts-ignore\n        this.startStopTimer = document.getElementById(this.applicationView.state.ui.scoreSheet.dom.startStopTimer);\n        // @ts-ignore\n        this.timerEl = document.getElementById(this.applicationView.state.ui.scoreSheet.dom.timer);\n        // @ts-ignore\n        this.endOrLeaveEl = document.getElementById(this.applicationView.state.ui.scoreSheet.dom.end);\n        // @ts-ignore\n        this.scoreSheetEl = document.getElementById(this.applicationView.state.ui.scoreSheet.dom.scoreSheet);\n\n        // bind event handlers\n        this.handleStartStopTimer = this.handleStartStopTimer.bind(this);\n        this.handleEndOrLeave = this.handleEndOrLeave.bind(this);\n        this.handleUserDrop = this.handleUserDrop.bind(this);\n\n        // setup event handlers\n        if (this.startStopTimer) this.startStopTimer.addEventListener('click',this.handleStartStopTimer);\n        if (this.endOrLeaveEl) this.endOrLeaveEl.addEventListener('click',this.handleEndOrLeave);\n        if (this.thisEl) {\n            this.thisEl.addEventListener('dragover',(event) => {event.preventDefault()});\n            this.thisEl.addEventListener('drop',this.handleUserDrop);\n        }\n    }\n\n    handleEndOrLeave(event:MouseEvent) {\n        ssvLogger('leave or end');\n        // are we leaving or ending?\n        if (this.controller.hasActiveScoreSheet() && this.controller.isSheetOwner()) {\n            // finishing the score sheet\n            // double check this is want we want\n            if (!confirm(\"Are you sure you want to close the score sheet\")) return;\n\n            // user wants to finish\n            this.controller.endScoreSheet();\n\n            // reset the display\n            this.resetDisplay();\n        }\n        else {\n            // leaving the score sheet\n            // double check this is want we want\n            if (!confirm(\"Are you sure you want to leave the score sheet\")) return;\n\n            // user wants to finish\n            this.controller.leave();\n\n\n            // reset the display\n            this.resetDisplay();\n        }\n    }\n\n    handleStartStopTimer(event:MouseEvent) {\n        ssvLogger('start/pause timer');\n        if (this.controller.isTimerGoing()) {\n            this.controller.pauseTimer();\n        }\n        else {\n            this.controller.startTimer();\n        }\n    }\n\n    handleUserDrop(event:Event) {\n        ssvLogger('drop event on current score sheet');\n        if (this.controller.hasActiveScoreSheet() && this.controller.isSheetOwner()) {\n            // @ts-ignore\n            const draggedObjectJSON = event.dataTransfer.getData(this.applicationView.state.ui.draggable.draggableDataKeyId);\n            const draggedObject = JSON.parse(draggedObjectJSON);\n            ssvLogger(draggedObject);\n\n            if (draggedObject[this.applicationView.state.ui.draggable.draggedType] === this.applicationView.state.ui.draggable.draggedTypeUser) {\n                //add the user to the current chat if not already there\n                this.controller.inviteUser(draggedObject.username);\n            }\n        }\n    }\n\n\n    public resetDisplay() {\n        this.table = null;\n\n        // reset the display\n        if (this.boardGameTitleEl) this.boardGameTitleEl.innerText = '';\n        if (this.startStopTimer) this.startStopTimer.innerHTML = 'Start ' + this.applicationView.state.ui.scoreSheet.dom.iconStart;\n        if (this.startStopTimer) this.startStopTimer.setAttribute(\"disabled\", \"true\");\n        if (this.timerEl) this.timerEl.innerText = this.createTimerDisplay(0);\n        if (this.endOrLeaveEl) this.endOrLeaveEl.innerHTML = this.applicationView.state.ui.scoreSheet.dom.iconLeave;\n        if (this.scoreSheetEl) browserUtil.removeAllChildren(this.scoreSheetEl);\n    }\n\n    private createTimerDisplay(timer:number):string {\n        let result = '';\n        if (timer === 0) {\n            result = '00:00';\n        }\n        else {\n            if (timer >= 60) {\n                let hours = Math.floor(timer/3600);\n                let minutes = Math.floor(timer/60);\n                let seconds = timer - (hours*3600) - (minutes*60);\n                if (hours > 0) {\n                    result += `${hours}:`;\n                }\n                if (minutes > 0) {\n                    if (minutes < 10) {\n                        result += `0${minutes}:`\n                    }\n                    else {\n                        result += `${minutes}:`\n                    }\n                }\n                else {\n                    result += '00:';\n                }\n                if (seconds > 0) {\n                    if (seconds < 10) {\n                        result += `0${seconds}`;\n                    }\n                    else {\n                        result += `${seconds}`;\n                    }\n                }\n            }\n            else {\n                result = `00:`;\n                if (timer > 0) {\n                    if (timer < 10) {\n                        result += `0${timer}`;\n                    }\n                    else {\n                        result += `${timer}`;\n                    }\n                }\n            }\n        }\n        return result;\n    }\n\n\n    public updateTimer(time:number, isPaused:boolean = false) {\n        // update the view\n        ssvLogger(`Updating timer ${time} ${isPaused}`);\n        if (this.startStopTimer) {\n            if (isPaused) {\n                this.startStopTimer.innerHTML = 'Start   ' + this.applicationView.state.ui.scoreSheet.dom.iconStart;\n            }\n            else {\n                this.startStopTimer.innerHTML = 'Pause   ' + this.applicationView.state.ui.scoreSheet.dom.iconInProgress;\n            }\n            this.startStopTimer.removeAttribute(\"disabled\");\n        }\n        if (this.timerEl) this.timerEl.innerText = this.createTimerDisplay(time);\n    }\n\n    stateChanged(managerName: string, name: string, newValue: any): void {\n        let scoreSheet:ScoreSheet = newValue;\n        ssvLogger(`Processing new state`);\n        ssvLogger(scoreSheet);\n        if (this.startStopTimer) this.startStopTimer.removeAttribute(\"disabled\");\n\n        // update the board game name\n        if (this.boardGameTitleEl) this.boardGameTitleEl.innerText = `${scoreSheet.boardGameName}`;\n\n        // update the table\n        if (this.table) {\n            // process the data in the state change, will be array of array (rows) into what the table wants\n            let tableData:any = [];\n            // @ts-ignore\n            scoreSheet.data.forEach((row:any[],rowIndex:number) => {\n                row.forEach((column:any, columnIndex:number) => {\n                    tableData.push([rowIndex, columnIndex, column]);\n                });\n            });\n            ssvLogger(`Table data is `);\n            ssvLogger(tableData);\n            // @ts-ignore\n            this.table.setDataAtCell(tableData,ScoreSheetController.SOURCE_View);\n\n        }\n        else {\n            // create a new table\n\n            if (this.scoreSheetEl) {\n                scoreSheet.sheetLayoutOptions.data = scoreSheet.data;\n                this.table = new Handsontable(\n                    this.scoreSheetEl,\n                    scoreSheet.sheetLayoutOptions);\n                // @ts-ignore\n                this.table.addHook('afterChange',this.controller.userChangedValue);\n            }\n        }\n\n\n        // update the timer\n        if (this.timerEl) this.timerEl.innerText = this.createTimerDisplay(scoreSheet.timer);\n\n\n    }\n\n    public getTableData():any[] {\n        if (this.table) {\n            return this.table.getData();\n        }\n        else {\n            return [];\n        }\n    }\n\n    stateChangedItemAdded(managerName: string, name: string, itemAdded: any): void {}\n    stateChangedItemRemoved(managerName: string, name: string, itemRemoved: any): void {}\n    stateChangedItemUpdated(managerName: string, name: string, itemUpdated: any, itemNewValue: any): void {}\n}","import debug from 'debug';\n\nimport {Invitation, InviteType, JoinLeft, Message, Priority} from \"../socket/Types\";\nimport {ChatReceiver} from \"../socket/ChatReceiver\";\nimport notifier from \"../notification/NotificationManager\";\nimport {ScoreSheetView} from \"./ScoreSheetView\";\nimport {ScoreSheet} from \"../AppTypes\";\nimport uuid from \"../util/UUID\";\nimport socketManager from \"../socket/SocketManager\";\nimport {ChatManager} from \"../socket/ChatManager\";\nimport {StateManager} from \"../state/StateManager\";\nimport BrowserStorageStateManager from \"../state/BrowserStorageStateManager\";\nimport moment from \"moment\";\nimport controller from \"../Controller\";\n\nconst sscLogger = debug('score-sheet-controller');\n\nexport class ScoreSheetController implements ChatReceiver {\n    public static SOURCE_View:string = 'ssv';\n\n    private static _instance: ScoreSheetController;\n\n    public static getInstance(): ScoreSheetController {\n        if (!(ScoreSheetController._instance)) {\n            ScoreSheetController._instance = new ScoreSheetController();\n        }\n        return ScoreSheetController._instance;\n    }\n\n    private applicationView: any | null = null;\n    private currentScoreRoom: string|null = null;\n    private currentlySelectedBoardGame: any|null = null;\n    private currentScoreSheet: ScoreSheet|null = null;\n    private currentUsername:string = '';\n    private isRoomCreator:boolean = false;\n    private stateManager:StateManager;\n    private currentUsersInScoreSheet:string[] = [];\n    private intervalTimer:number = -1;\n\n\n    private constructor() {\n        this.stateManager = new BrowserStorageStateManager(true);\n        socketManager.addChatReceiver(this);\n\n        // bind events\n        this.receiveLogin = this.receiveLogin.bind(this);\n        this.receiveLogout = this.receiveLogout.bind(this);\n        this.receiveInvitation = this.receiveInvitation.bind(this);\n        this.receiveMessage = this.receiveMessage.bind(this);\n        this.receiveQueuedMessages = this.receiveQueuedMessages.bind(this);\n        this.receiveQueuedInvites = this.receiveQueuedInvites.bind(this);\n        this.receiveJoinedRoom = this.receiveJoinedRoom.bind(this);\n        this.receivedLeftRoom = this.receivedLeftRoom.bind(this);\n        this.userChangedValue = this.userChangedValue.bind(this);\n        this.endScoreSheet = this.endScoreSheet.bind(this);\n        this.pauseTimer = this.pauseTimer.bind(this);\n\n\n        // reset state\n        this.reset();\n\n    }\n\n    private reset():void {\n        this.currentScoreRoom = null;\n        this.currentScoreSheet = null;\n        this.currentlySelectedBoardGame = null;\n        this.isRoomCreator = false;\n        this.currentUsersInScoreSheet = [];\n        this.stopTimerStoppedByAnotherUser();\n    }\n\n    public isTimerGoing(): boolean {\n        let result = false;\n        if (this.currentScoreSheet) {\n            result = this.currentScoreSheet.timerGoing;\n        }\n        return result;\n    }\n\n    public getStateManager() {\n        return this.stateManager;\n    }\n\n\n    receiveLogin(username: string): void {}\n    receiveLogout(username: string): void {}\n\n    public setCurrentUser(username:string):void {\n        sscLogger(`Setting current user ${username}`);\n        this.currentUsername = username;\n    }\n    public getCurrentUser():string {\n        return this.currentUsername;\n    }\n\n    public initialise(applicationView:any) {\n        this.applicationView = applicationView;\n    }\n\n    private isLoggedIn():boolean {\n        return (this.getCurrentUser().trim().length > 0);\n    }\n\n    receiveInvitation(invite: Invitation): void {\n        if (!this.isLoggedIn()) return;  // we are not logged in\n        if (invite.type !== InviteType.ScoreSheet) return; //ignore non-score sheets\n\n        if (ChatManager.getInstance().isUserInBlockedList(invite.from)) {\n            sscLogger(`Received invite from blocked user - ignoring`);\n            return;\n        }\n\n        // are we already in a scoresheet?\n        if (this.currentScoreRoom) {\n            // are we already in this score sheet?\n            if (this.currentScoreRoom !== invite.room) {\n                // decline the invite, only one score sheet at a time\n                sscLogger(`Received invite - already in score sheet - declining`);\n                socketManager.sendDeclineInvite(invite.room,this.getCurrentUser(),InviteType.ScoreSheet);// user declines to join the scoresheet\n            }\n        }\n\n        if (invite.requiresAcceptDecline) {\n            // notify the user of the invitation\n            if (!this.askUserAboutInvitation(invite)) {\n                socketManager.sendDeclineInvite(invite.room,this.getCurrentUser(),InviteType.ScoreSheet);// user declines to join the scoresheet\n            };\n        }\n        // notify the user of the new chat\n        notifier.show('Score Sheet',`Joining score sheet`,'info',7000);\n        socketManager.joinChat(this.getCurrentUser(),invite.room,InviteType.ScoreSheet);\n        this.currentScoreRoom = invite.room;\n        this.currentlySelectedBoardGame = {name:invite.subject};\n        this.currentScoreSheet = invite.attachment;\n        // ask the view to initialise with these values\n        ScoreSheetView.getInstance().stateChanged(\"\",\"\",this.currentScoreSheet);\n\n        // change to the score sheet\n        this.applicationView.handleShowScoreSheet(null);\n    }\n\n    askUserAboutInvitation(invite:Invitation):boolean {\n        return confirm(`You have been invited by user ${invite.from} to joint a chat room for the board game ${invite.subject} score sheet`);\n    }\n\n\n    receiveQueuedMessages(messages: any): void {\n        if (!this.isLoggedIn()) return;  // we are not logged in\n\n        if (!this.currentScoreRoom) return; // we are not in a room\n\n        messages.forEach((message:Message) => {\n            if (message.type === InviteType.ScoreSheet) {  // only process offline messages for scoresheet and our current room\n                if (this.currentScoreRoom === message.room) {\n                    this.receiveMessage(message);\n                }\n            }\n        });\n    }\n\n\n    receiveQueuedInvites(invites: any): void {\n        // not implemented, the user needs to be online for a scoresheet\n    }\n\n    receiveDecline(room: string, username: string, type:number): void {\n        if (type !== InviteType.ScoreSheet) return; //ignore non-score sheets\n        if (this.currentScoreRoom) {\n            if (this.currentScoreRoom === room) {\n                notifier.show('Score Sheet',`User ${username} declined the invitation.`,'warning');\n            }\n        }\n    }\n\n    receiveJoinedRoom(users: JoinLeft): void {\n        if (users.type !== InviteType.ScoreSheet) return; //ignore non-score sheets\n        if (!this.isLoggedIn()) return;  // we are not logged in\n        if (users.username === this.getCurrentUser()) return;\n\n        if (this.currentScoreRoom !== users.room) return;\n\n        sscLogger(`Handling user joined ${users.username}`)\n        // update the sheet to include the user\n        let index = this.currentUsersInScoreSheet.findIndex((username) => username === users.username);\n        if (index < 0) {\n            this.currentUsersInScoreSheet.push(users.username);\n            // update the sheet data\n            this.addUserToScoreSheet(users.username);\n            // the owner of the sheet should send a sync message of the data\n            if (this.currentScoreSheet) this.saveCurrentScoreSheet(this.currentScoreSheet);\n        }\n        if (this.isRoomCreator && this.currentScoreSheet) {\n            sscLogger(`Handling user joined ${users.username} - sending`)\n            this.sendScoreSheetState(this.currentScoreSheet,false);\n        }\n        notifier.show(this.currentlySelectedBoardGame.name,`User ${users.username} joined.`);\n    }\n\n    receivedLeftRoom(users: JoinLeft): void {\n        if (users.type !== InviteType.ScoreSheet) return; //ignore non-score sheets\n        if (!this.isLoggedIn()) return;  // we are not logged in\n        if (users.username === this.getCurrentUser()) return;\n\n        if (this.currentScoreRoom !== users.room) return;\n        // update the sheet to remove the user\n        sscLogger(`Handling user left ${users.username}`)\n\n        let index = this.currentUsersInScoreSheet.findIndex((username) => username === users.username);\n        if (index >= 0) {\n            this.currentUsersInScoreSheet.splice(index,1);\n            // update the sheet data\n            this.removeUserFromScoreSheet(users.username);\n            // the owner of the sheet should send a sync message of the data\n            if (this.currentScoreSheet) this.saveCurrentScoreSheet(this.currentScoreSheet);\n        }\n        if (this.isRoomCreator && this.currentScoreSheet) {\n            sscLogger(`Handling user left ${users.username} - sending`)\n            this.sendScoreSheetState(this.currentScoreSheet,false);\n        }\n        notifier.show(this.currentlySelectedBoardGame.name,`User ${users.username} left.`);\n    }\n\n    receiveUserList(users: string[]): void {} // will be managed in the transfer of sheet data\n\n\n    public endScoreSheet():void { // this can only be done by the room creator\n        // send the final score to everyone\n        sscLogger(`Handling end of score sheet`)\n        if (this.isRoomCreator && this.currentScoreSheet) this.saveScoreSheetToBoardGame(this.currentScoreSheet);\n        if (this.isLoggedIn()) {\n            if (this.currentScoreRoom && this.currentScoreSheet) {\n                sscLogger(`Handling end of score sheet - sending`)\n                this.sendScoreSheetState(this.currentScoreSheet,true);\n                // if we are logged in and the scoresheet creator then we need to save the score sheet to the selected board game\n            }\n            // close the room\n            this.leave();\n        }\n        // reset the controller\n        this.reset();\n        this.applicationView.switchBetweenCollectionAndScoreSheet(true);\n    }\n\n    private saveScoreSheetToBoardGame(scoreSheet:ScoreSheet) {\n        sscLogger('Handling save');\n        let saveData = {\n            id: scoreSheet.room,\n            jsonData: JSON.stringify(scoreSheet),\n            createdOn: parseInt(moment().format('YYYYMMDDHHmm')),\n            players: [],\n            scores: []\n        }\n        sscLogger(scoreSheet);\n        // process the table data for names and scores\n        // the first row is the player names\n        // @ts-ignore\n        const playerNames: string[] = scoreSheet.data[0];\n        // @ts-ignore\n        const scores: any[] = scoreSheet.data[scoreSheet.data.length - 1]\n        sscLogger(`players and scores`);\n        sscLogger(playerNames);\n        sscLogger(scores);\n\n        // @ts-ignore\n        saveData.players = playerNames;\n        // @ts-ignore\n        saveData.scores = scores;\n\n        sscLogger(saveData);\n\n        // add the data to the selected board game\n        if (this.currentlySelectedBoardGame) {\n            if (!this.currentlySelectedBoardGame.scores) {\n                this.currentlySelectedBoardGame.scores = [];\n            }\n            this.currentlySelectedBoardGame.scores.push(saveData);\n            controller.scoreSheetAddedToBoardGame(this.currentlySelectedBoardGame, saveData);\n        }\n    }\n\n\n    private getDefaultScoreSheetTemplate(boardGame:any):any {\n        return {\n            //width:'90%',\n            //height:'90%',\n            colHeaders:false,\n            rowHeaders:true,\n            licenseKey: 'non-commercial-and-evaluation',\n            manualColumnResize:false,\n            manualRowResize:false,\n            selectionMode:'single',\n            columnSummary: [\n                {\n                    destinationRow: 0,\n                    destinationColumn:0,\n                    reversedRowCoords: true,\n                    type: 'sum',\n                    forceNumeric:true\n                },\n                {\n                    destinationRow: 0,\n                    destinationColumn:1,\n                    reversedRowCoords: true,\n                    type: 'sum',\n                    forceNumeric:true\n                },\n                {\n                    destinationRow: 0,\n                    destinationColumn:2,\n                    reversedRowCoords: true,\n                    type: 'sum',\n                    forceNumeric:true\n                },\n                {\n                    destinationRow: 0,\n                    destinationColumn:3,\n                    reversedRowCoords: true,\n                    type: 'sum',\n                    forceNumeric:true\n                },\n                {\n                    destinationRow: 0,\n                    destinationColumn:4,\n                    reversedRowCoords: true,\n                    type: 'sum',\n                    forceNumeric:true\n                },\n                {\n                    destinationRow: 0,\n                    destinationColumn:5,\n                    reversedRowCoords: true,\n                    type: 'sum',\n                    forceNumeric:true\n                },\n                {\n                    destinationRow: 0,\n                    destinationColumn:6,\n                    reversedRowCoords: true,\n                    type: 'sum',\n                    forceNumeric:true\n                },\n            ]\n\n        }\n    }\n\n    private getDefaultScoreSheetStartingData(boardGame:any):any[] {\n        return [\n            ['P 1','P 2','P 3','P 4','P 5','P 6','P 7'],\n            ['0','0','0','0','0','0','0'],\n            ['0','0','0','0','0','0','0'],\n            ['0','0','0','0','0','0','0'],\n            ['0','0','0','0','0','0','0'],\n            ['0','0','0','0','0','0','0'],\n            ['0','0','0','0','0','0','0'],\n        ];\n    }\n\n\n    private getScoreSheetTemplate(boardGame:any):any|null {\n        return this.getDefaultScoreSheetTemplate(boardGame);\n    }\n\n    private getScoreSheetStartingData(boardGame:any):any[]|null {\n        return this.getDefaultScoreSheetStartingData(boardGame);\n    }\n\n    public startScoreSheet(boardGame:any):void {\n        if (boardGame) {\n            sscLogger(`Starting score sheet for ${boardGame.name}`);\n            this.currentlySelectedBoardGame = boardGame;\n            if (this.isLoggedIn()) this.currentUsersInScoreSheet = [this.getCurrentUser()];\n            this.isRoomCreator = true;\n            this.currentScoreRoom = uuid.getUniqueId();\n            this.currentScoreSheet = {\n                room: this.currentScoreRoom,\n                boardGameName: boardGame.name,\n                sheetLayoutOptions: this.getScoreSheetTemplate(boardGame),\n                timer:0,\n                timerGoing:false,\n                data: this.getScoreSheetStartingData(boardGame),\n                isFinished:false\n            }\n            sscLogger(this.currentScoreSheet);\n\n            // store the score sheet locally\n            this.stateManager.setStateByName(this.applicationView.state.stateNames.scoreSheet,this.currentScoreSheet,true);\n\n            // start a new chat room, will automatically manage if logged in or not\n            if (this.isLoggedIn()) socketManager.joinChat(this.getCurrentUser(),this.currentScoreRoom,InviteType.ScoreSheet);\n\n        }\n    }\n\n    public hasActiveScoreSheet():boolean {\n        let result = false;\n        if (this.currentScoreRoom) {\n            sscLogger(this.currentScoreRoom);\n            result = true;\n        }\n        return result;\n    }\n\n    public inviteUser(username:string) {\n        if (!this.isLoggedIn()) return;  // we are not logged in\n        // only the user who created the score sheet can do this as they are the only ones with a selected board game\n        if ((this.currentScoreRoom) && (this.currentlySelectedBoardGame) ) {\n            sscLogger(`Inviting user ${username} to score sheet`);\n            if (this.isRoomCreator) {\n                socketManager.sendInvite(this.getCurrentUser(),username,this.currentScoreRoom,InviteType.ScoreSheet,true,this.currentlySelectedBoardGame.name,this.currentScoreSheet);\n            }\n            else {\n                alert(\"Only the score sheet creator can invite other users.\");\n            }\n        }\n    }\n\n    public receiveMessage(message: Message): void {\n        sscLogger(`'Handling receive message`);\n        sscLogger(message);\n        if (!this.isLoggedIn()) return;  // we are not logged in\n        if (message.type !== InviteType.ScoreSheet) return; //ignore non-score sheets\n        if (message.from === this.getCurrentUser()) return; // my own messages can be ignored\n\n        if (this.currentScoreRoom) { // are we in a room?\n            if (this.currentScoreRoom === message.room) { // are we listening to this score sheet room?\n                if (ChatManager.getInstance().isUserInBlockedList(message.from)) {\n                    sscLogger(`Received message from blocked user - ignoring`);\n                    return;\n                }\n                // are we scoring the right sheet?\n                sscLogger(`Received message for score sheet ${message.room}`);\n                sscLogger(message);\n                if (message.attachment) {\n                    // the attachment should be a ScoreSheet object\n                    let scoreSheet:ScoreSheet = message.attachment;\n                    sscLogger(scoreSheet);\n\n                    // @ts-ignore\n                    if (this.currentScoreSheet) {\n                        let timerWasGoing = this.currentScoreSheet.timerGoing;\n                        this.currentScoreSheet.room = message.room;\n                        this.currentScoreSheet.boardGameName = scoreSheet.boardGameName;\n                        this.currentScoreSheet.data = scoreSheet.data;\n                        this.currentScoreSheet.timer = (scoreSheet.timer > this.currentScoreSheet.timer)?scoreSheet.timer:this.currentScoreSheet.timer;\n                        this.currentScoreSheet.timerGoing = scoreSheet.timerGoing;\n                        this.currentScoreSheet.sheetLayoutOptions = scoreSheet.sheetLayoutOptions;\n                        this.currentScoreSheet.isFinished = scoreSheet.isFinished;\n\n                        // has the timer changed?\n                        if (scoreSheet.timerGoing) {\n                            if (timerWasGoing) {\n                                // both timers going, no need to do anything\n                            }\n                            else {\n                                // timer is going with another user, but we aren't going - start timer\n                                this.stopTimerStoppedByAnotherUser();\n                                this.startTimer();\n                            }\n                        }\n                        else { // timer not going at the other users end\n                            if (timerWasGoing) {\n                                // our timer is active - pause it\n                                this.stopTimerStoppedByAnotherUser();\n                            }\n                            else {\n                                // neither timer going\n                            }\n                        }\n\n\n                    }\n                    sscLogger('Updated score sheet');\n                    sscLogger(this.currentScoreSheet);\n                    // save the new state\n                    if (this.currentScoreSheet) this.saveCurrentScoreSheet(this.currentScoreSheet,true);\n                    if (scoreSheet.isFinished) {\n                        alert('Score sheet has been finished - closing');\n                        // reset the controller\n                        this.reset();\n\n                        // close the room\n                        this.leave();\n\n                        // reset the view\n                        ScoreSheetView.getInstance().resetDisplay();\n\n                        this.applicationView.switchBetweenCollectionAndScoreSheet(true);\n                    }\n                }\n            }\n\n        }\n    }\n\n    public isSheetOwner():boolean {\n        return this.isRoomCreator;\n    }\n\n    private saveCurrentScoreSheet(scoreSheet:ScoreSheet, informListeners:boolean = true) {\n        this.currentScoreSheet = scoreSheet;\n        this.stateManager.setStateByName(this.applicationView.state.stateNames.scoreSheet,this.currentScoreSheet,informListeners);\n    }\n\n    public createScoreSheetFromTable():ScoreSheet|null {\n        let scoreSheet:ScoreSheet|null = null;\n        let tableData = ScoreSheetView.getInstance().getTableData();\n        if (this.currentScoreSheet && this.currentScoreRoom) {\n            scoreSheet = {\n                room: this.currentScoreRoom,\n                data: tableData,\n                boardGameName: this.currentlySelectedBoardGame.name,\n                timer: this.currentScoreSheet.timer,\n                sheetLayoutOptions: null,\n                timerGoing: this.currentScoreSheet.timerGoing,\n                isFinished: false\n            }\n        }\n        return scoreSheet;\n    }\n\n    public sendScoreSheetState(scoreSheet:ScoreSheet,isFinished:boolean = false):void {\n        if (this.currentScoreRoom && this.isLoggedIn()) {\n            const created = parseInt(moment().format('YYYYMMDDHHmmss'));\n            // @ts-ignore\n            socketManager.sendMessage(\n                this.getCurrentUser(),\n                this.currentScoreRoom,\n                'data',\n                created,\n                InviteType.ScoreSheet,\n                Priority.Normal,\n                scoreSheet);\n        }\n    }\n\n    protected addUserToScoreSheet(username:string):void {\n        // TO DO\n    }\n\n    protected removeUserFromScoreSheet(username:string):void {\n        // TO DO\n    }\n\n\n    public startTimer() {\n        sscLogger(`Handling pause timer`);\n        if (!this.currentScoreSheet) return;\n\n        this.currentScoreSheet.timerGoing = true;\n        this.intervalTimer = setInterval(() => {\n            if (this.currentScoreSheet && this.currentScoreSheet.timerGoing) {\n                this.currentScoreSheet.timer ++;\n                ScoreSheetView.getInstance().updateTimer(this.currentScoreSheet.timer,!this.currentScoreSheet.timerGoing);\n            }\n            else {\n                if (this.currentScoreSheet) {\n                    this.currentScoreSheet.timerGoing = false;\n                    ScoreSheetView.getInstance().updateTimer(this.currentScoreSheet.timer,!this.currentScoreSheet.timerGoing);\n                }\n            }\n        },1000);\n        if (this.currentScoreSheet) {\n            this.saveCurrentScoreSheet(this.currentScoreSheet);\n        }\n        if (this.isLoggedIn() && this.currentScoreSheet) {\n            // start the timer for everyone\n            sscLogger(`Handling pause timer - sending score sheet`);\n            this.sendScoreSheetState(this.currentScoreSheet,false);\n        }\n    }\n\n    private stopTimerStoppedByAnotherUser() {\n        sscLogger(`Handling timer stopped by another user`);\n        if (this.intervalTimer > 0) {\n            clearInterval(this.intervalTimer);\n        }\n        this.intervalTimer = -1;\n    }\n\n    public pauseTimer() {\n        sscLogger(`Handling pause timer`);\n        if (this.intervalTimer > 0) {\n            clearInterval(this.intervalTimer);\n            this.intervalTimer = -1;\n\n            if (this.currentScoreSheet) {\n                this.currentScoreSheet.timerGoing = false;\n                this.saveCurrentScoreSheet(this.currentScoreSheet);\n                ScoreSheetView.getInstance().updateTimer(this.currentScoreSheet.timer, !this.currentScoreSheet.timerGoing)\n            }\n\n\n            // ask everyone to pause their timers\n            if (this.isLoggedIn() && this.currentScoreSheet) {\n                sscLogger(`Handling pause timer - updating all users`);\n                this.sendScoreSheetState(this.currentScoreSheet,false);\n            }\n        }\n    }\n\n    public userChangedValue(value:any,source:string) {\n        sscLogger(`Handling user changed value ${source}`)\n        if (source === ScoreSheetController.SOURCE_View) return;\n\n        // is the source an edit?\n        if (source !== 'edit') return;\n\n        let scoreSheet:ScoreSheet|null = this.createScoreSheetFromTable();\n        sscLogger(`Handling user changed Value`);\n        sscLogger(value);\n        sscLogger(scoreSheet);\n        if (scoreSheet) {\n            this.saveCurrentScoreSheet(scoreSheet,false);\n            if (this.isLoggedIn()) {\n                sscLogger(`Handling user change - updating all users`);\n                this.sendScoreSheetState(scoreSheet,false);\n            }\n        }\n    }\n\n    public leave() {\n        sscLogger(`Handling user leaving`);\n        if (this.currentScoreSheet && this.currentScoreRoom) {\n            if (this.isLoggedIn()) {\n                socketManager.leaveChat(this.getCurrentUser(),this.currentScoreRoom,InviteType.ScoreSheet);\n            }\n            this.reset();\n            this.applicationView.switchBetweenCollectionAndScoreSheet(true);\n        }\n    }\n}\n","import debug from 'debug';\nimport MemoryBufferStateManager from \"./state/MemoryBufferStateManager\";\nimport StateChangeListener from \"./state/StateChangeListener\";\nimport {StateManager} from \"./state/StateManager\";\nimport {RESTApiStateManager} from \"./state/RESTApiStateManager\";\nimport socketManager from \"./socket/SocketManager\";\nimport AsyncStateManagerWrapper from \"./state/AsyncStateManagerWrapper\";\nimport {AggregateStateManager} from \"./state/AggregateStateManager\";\nimport SocketListenerDelegate from \"./SocketListenerDelegate\";\nimport {ChatManager} from \"./socket/ChatManager\";\nimport {NotificationController} from \"./socket/NotificationController\";\nimport {GraphQLApiStateManager} from \"./state/GraphQLApiStateManager\";\nimport {Decorator} from \"./AppTypes\";\nimport downloader from \"./network/DownloadManager\";\nimport BrowserStorageStateManager from \"./state/BrowserStorageStateManager\";\nimport {Invitation, Message} from \"./socket/Types\";\nimport {ScoreSheetController} from \"./component/ScoreSheetController\";\nimport {isSameGame} from \"./util/EqualityFunctions\";\n\nconst cLogger = debug('controller-ts');\nconst cLoggerDetail = debug('controller-ts-detail');\n\nclass Controller implements StateChangeListener {\n    protected applicationView: any;\n    protected clientSideStorage: any;\n    protected config: any;\n    // @ts-ignore\n    protected stateManager: StateManager;\n    // @ts-ignore\n    protected displayedBoardGamesStateManager: StateManager;\n\n\n\n    constructor() {\n    }\n\n    connectToApplication(applicationView: any, clientSideStorage: any) {\n        this.applicationView = applicationView;\n        this.clientSideStorage = clientSideStorage;\n        this.config = this.applicationView.state;\n        // setup the API calls\n        let apiStateManager = RESTApiStateManager.getInstance();\n        apiStateManager.initialise([\n            {\n                stateName: this.config.stateNames.boardGames,\n                serverURL: this.getServerAPIURL(),\n                api: this.config.apis.entries,\n                isActive: true\n            },\n            {\n                stateName: this.config.stateNames.scores,\n                serverURL: this.getServerAPIURL(),\n                api: this.config.apis.comments,\n                isActive: true\n            }\n        ]);\n\n        let graphSM = new GraphQLApiStateManager();\n        graphSM.initialise([\n            {\n                stateName: this.config.stateNames.users,\n                apiURL: this.getServerAPIURL() + this.config.apis.graphQL,\n                apis: {\n                    find: '',\n                    create: '',\n                    destroy: '',\n                    update: '',\n                    findAll: this.config.apis.findUsers.queryString,\n                },\n                data: {\n                    find: '',\n                    create: '',\n                    destroy: '',\n                    update: '',\n                    findAll: this.config.apis.findUsers.resultName,\n                },\n                isActive: true\n\n            }\n\n        ]);\n\n\n        let aggregateSM = AggregateStateManager.getInstance();\n        let memorySM = MemoryBufferStateManager.getInstance();\n\n        let asyncDBSM = new AsyncStateManagerWrapper(aggregateSM, apiStateManager);\n        let asyncQLSM = new AsyncStateManagerWrapper(aggregateSM, graphSM);\n\n\n        aggregateSM.addStateManager(memorySM, [], false);\n        aggregateSM.addStateManager(asyncQLSM, [this.config.stateNames.selectedEntry, this.config.stateNames.recentUserSearches, this.config.stateNames.boardGames, this.config.stateNames.scores], false);\n        aggregateSM.addStateManager(asyncDBSM, [this.config.stateNames.users, this.config.stateNames.boardGames, this.config.stateNames.scores, this.config.stateNames.selectedEntry, this.config.stateNames.recentUserSearches], false);\n\n        this.stateManager = aggregateSM;\n\n        // state listener\n        this.stateChanged = this.stateChanged.bind(this);\n        this.stateChangedItemAdded = this.stateChangedItemAdded.bind(this);\n        this.stateChangedItemRemoved = this.stateChangedItemRemoved.bind(this);\n        this.stateChangedItemUpdated = this.stateChangedItemUpdated.bind(this);\n\n        // call backs\n        this.callbackBoardGameDetails = this.callbackBoardGameDetails.bind(this);\n        this.callbackAddToCollection = this.callbackAddToCollection.bind(this);\n        this.callbackRemoveFromCollection = this.callbackRemoveFromCollection.bind(this);\n        this.callbackGetCollection = this.callbackGetCollection.bind(this);\n\n        //event handlers\n        this.addBoardGameToCollection = this.addBoardGameToCollection.bind(this);\n        this.removeBoardGameFromCollection = this.removeBoardGameFromCollection.bind(this);\n        this.removeBoardGameFromDisplay = this.removeBoardGameFromDisplay.bind(this);\n\n        // further state management\n        this.displayedBoardGamesStateManager = new BrowserStorageStateManager(true);\n\n        return this;\n    }\n\n    /*\n        Get the base data for the application (users, entries)\n    */\n    public initialise(): void {\n        cLogger('Initialising data state');\n        // listen for socket events\n        let socketListerDelegate = new SocketListenerDelegate(this.config);\n        socketManager.setListener(socketListerDelegate);\n\n        // now that we have all the user we can setup the chat system but only if we are logged in\n        cLogger(`Setting up chat system for user ${this.getLoggedInUserId()}: ${this.getLoggedInUsername()}`);\n        if (this.getLoggedInUserId() > 0) {\n            // setup the chat system\n            let chatManager = ChatManager.getInstance(); // this connects the manager to the socket system\n\n            // setup the chat notification system\n            NotificationController.getInstance();\n            chatManager.setCurrentUser(this.getLoggedInUsername());\n            ScoreSheetController.getInstance().setCurrentUser(this.getLoggedInUsername());\n\n            chatManager.login();\n\n\n            // load the users\n            this.getStateManager().getStateByName(this.config.stateNames.users);\n        }\n\n        // load board games from local storage if any\n        this.applicationView.setState({boardGames: this.displayedBoardGamesStateManager.getStateByName(this.config.stateNames.boardGames)});\n\n        // download the current board game collection\n        this.downloadAndSyncSavedBoardGameCollection();\n    }\n\n    private downloadAndSyncSavedBoardGameCollection() {\n        if (this.isLoggedIn()) {\n            // start the call to retrieve the saved collection of board games\n            downloader.addQLApiRequest(this.config.apis.graphQL, this.config.apis.getMyBoardGameCollection.queryString, {userId:this.getLoggedInUserId()}, this.callbackGetCollection, this.config.stateNames.boardGames, false);\n        }\n    }\n\n    public getStateManager(): StateManager {\n        return this.stateManager;\n    }\n\n    /*\n    *\n    * Simple Application state (URL, logged in user)\n    *\n     */\n    private getServerAPIURL(): string {\n        let result = \"\";\n        // @ts-ignore\n        if ((window.ENV) && (window.ENV.serverURL)) {\n            // @ts-ignore\n            result = window.ENV.serverURL;\n        }\n        return result;\n    }\n\n    public isLoggedIn(): boolean {\n        let isLoggedIn = false;\n        try {\n            // @ts-ignore\n            if (loggedInUserId) {\n                isLoggedIn = true;\n            }\n        } catch (error) {\n        }\n        return isLoggedIn;\n    }\n\n    public getLoggedInUserId(): number {\n        let result = -1;\n        try {\n            // @ts-ignore\n            if (loggedInUserId) {\n                // @ts-ignore\n                result = loggedInUserId;\n            }\n        } catch (error) {\n        }\n        cLoggerDetail(`Logged in user id is ${result}`);\n        return result;\n    }\n\n    public getLoggedInUsername(): string {\n        let result = '';\n        try {\n            // @ts-ignore\n            if (loggedInUsername) {\n                // @ts-ignore\n                result = loggedInUsername;\n            }\n        } catch (error) {\n        }\n        cLoggerDetail(`Logged in user is ${result}`);\n        return result;\n    }\n\n\n    /*\n    *  sockets -\n    *  Handling data changes by other users\n    *\n     */\n\n    public handleMessage(message: string): void {\n        cLogger(message);\n    }\n\n    public getCurrentUser(): number {\n        return this.getLoggedInUserId();\n    }\n\n    //  State Management listening\n    stateChangedItemAdded(managerName: string, name: string, itemAdded: any): void {\n        cLogger(`State changed ${name} from ${managerName} - item Added`);\n        cLogger(itemAdded);\n        switch (managerName) {\n            case 'aggregate':\n            case 'memory': {\n                cLogger(`received state from ${managerName} for state ${name} - updating application view`);\n                switch (name) {\n                    case this.config.stateNames.entries: {\n                        break;\n                    }\n                }\n                break;\n            }\n        }\n    }\n\n    stateChangedItemRemoved(managerName: string, name: string, itemRemoved: any): void {\n        cLogger(`State changed ${name} from ${managerName}  - item Removed`);\n        cLogger(itemRemoved);\n        switch (managerName) {\n            case 'aggregate':\n            case 'memory': {\n                cLogger(`received state from ${managerName} for state ${name} - updating application view`);\n                switch (name) {\n                    case this.config.stateNames.comments: {\n                        break;\n                    }\n                }\n                break;\n            }\n        }\n    }\n\n    stateChangedItemUpdated(managerName: string, name: string, itemUpdated: any, itemNewValue: any): void {\n        cLogger(`State changed ${name} from ${managerName} - item updated`);\n        cLogger(itemUpdated);\n        switch (managerName) {\n            case 'aggregate':\n            case 'memory': {\n                cLogger(`received state from ${managerName} for state ${name} - updating application view`);\n                switch (name) {\n                    case this.config.stateNames.entries: {\n                        break;\n                    }\n                }\n                break;\n            }\n        }\n\n    }\n\n    stateChanged(managerName: string, name: string, values: any) {\n        cLogger(`State changed ${name} from ${managerName} `);\n        cLogger(values);\n        // what has changed and by whom?\n        switch (managerName) {\n            case 'aggregate':\n            case 'memory': {\n                cLogger(`received state from ${managerName} for state ${name} - sending to application view`);\n                switch (name) {\n                    case this.config.stateNames.entries: {\n                        break;\n                    }\n                    case this.config.stateNames.comments: {\n                        break;\n                    }\n                    case this.config.stateNames.users: {\n                        break;\n                    }\n                }\n                break;\n            }\n        }\n    }\n\n    // Data logic\n    public addBoardGameToDisplay(boardGame: any): void {\n        // this will just the basics of a board game from the search then click/dragged over\n        cLogger(`Handling addition of board game`);\n        cLogger(boardGame);\n\n        // don't add if already in the users display\n        let currentListOfGames: any[] = this.applicationView.state.boardGames;\n        let index = currentListOfGames.findIndex((value) => value.gameId === boardGame.gameId);\n        if (index >= 0) {\n            cLogger(`Board game in display already`);\n            return;\n        }\n\n        // start with what we have and let the main view know, but mark it incomplete for partial rendering with user information\n        boardGame.decorator = Decorator.Incomplete;\n        currentListOfGames.push(boardGame);\n        cLogger(`Adding received board game to application`);\n        cLogger(boardGame);\n\n        this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,currentListOfGames,false);\n        this.applicationView.setState({boardGames: currentListOfGames});\n\n        // now we need an API call to fill in the details\n        downloader.addQLApiRequest(this.config.apis.graphQL, this.config.apis.bggSearchCallById.queryString, {gameId:boardGame.gameId}, this.callbackBoardGameDetails, this.config.stateNames.boardGames, false);\n    }\n\n    public callbackBoardGameDetails(data: any, status: number, associatedStateName: string): void {\n        cLogger(`callback for bgg search for single board game ${associatedStateName} with status ${status}`);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            cLogger(data);\n            const boardGameDetails = data.data[this.config.apis.bggSearchCallById.resultName];\n            cLogger(boardGameDetails);\n            let regex = /&#10;/g;\n            boardGameDetails.description = boardGameDetails.description.replace(regex, '\\r\\n');\n            regex = /&ldquo;/g\n            boardGameDetails.description = boardGameDetails.description.replace(regex, '\"');\n            regex = /&rdquo;/g\n            boardGameDetails.description = boardGameDetails.description.replace(regex, '\"');\n            regex = /&quot;/g\n            boardGameDetails.description = boardGameDetails.description.replace(regex, '\"');\n            regex = /&mdash;/g\n            boardGameDetails.description = boardGameDetails.description.replace(regex, '\"');\n\n\n            //this.getStateManager().addNewItemToState(this.config.stateNames.boardGames,data.data[this.config.apis.bggSearchCallById.resultName],true);\n            let currentListOfGames: any[] = this.applicationView.state.boardGames;\n            let index = currentListOfGames.findIndex((value) => value.gameId === boardGameDetails.gameId);\n            if (index >= 0) {\n                cLogger(`Updating application state`);\n                currentListOfGames.splice(index, 1, boardGameDetails);\n                cLogger(currentListOfGames);\n                boardGameDetails.decorator = Decorator.PersistedLocally;\n                this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,currentListOfGames,false);\n                this.applicationView.setState({boardGames: currentListOfGames});\n            } else {\n                cLogger(`Board game ${boardGameDetails.id} not found in current state`);\n            }\n\n        }\n\n    }\n\n    private removeBoardGameFromState(boardGame:any) {\n        const currentBoardGamesOnDisplay = this.applicationView.state.boardGames;\n        let index = currentBoardGamesOnDisplay.findIndex((game: any) => game.gameId === boardGame.gameId);\n        if (index >= 0) {\n            currentBoardGamesOnDisplay.splice(index,1);\n            this.applicationView.setState({boardGames:currentBoardGamesOnDisplay});\n        }\n        // save locally\n        this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,currentBoardGamesOnDisplay,false);\n    }\n\n    private findBoardGameInStateFromEvent(event: Event) {\n        let boardGame: any | null = null;\n        cLoggerDetail(`Finding board game id in event`);\n        // @ts-ignore\n        let id = event.target.getAttribute(this.config.controller.events.boardGames.eventDataKeyId);\n        cLoggerDetail(id);\n        if (id) {\n            // find the entry from the state manager\n            id = parseInt(id);\n            // @ts-ignore\n            const currentBoardGamesOnDisplay = this.applicationView.state.boardGames;\n            let index = currentBoardGamesOnDisplay.findIndex((game: any) => game.gameId === id);\n            cLoggerDetail(index);\n            if (index >= 0) {\n                boardGame = currentBoardGamesOnDisplay[index];\n            }\n        }\n        cLoggerDetail(boardGame);\n        return boardGame;\n    }\n\n\n\n\n\n    public callbackAddToCollection(data: any, status: number, associatedStateName: string): void {\n        cLogger(`callback for add single board game ${associatedStateName} to my collection with status ${status}`);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            cLogger(data);\n            const id = data.data[this.config.apis.addToMyCollection.resultName];\n            cLogger(id);\n\n            // Find and update the board game in the state\n            let currentGameList = this.applicationView.state.boardGames;\n            let index = currentGameList.findIndex((game:any) => game.gameId === id.gameId);\n            if (index >= 0) {\n                let updatingBoardGame = currentGameList[index];\n                cLogger(`Updating board game ${updatingBoardGame.gameId} with database id ${id.id} and new Persisted state`);\n                updatingBoardGame.decorator = Decorator.Persisted;\n                updatingBoardGame.id = id.id;\n                this.applicationView.setState({boardGames:currentGameList});\n                this.displayedBoardGamesStateManager.updateItemInState(this.config.stateNames.boardGames,updatingBoardGame,isSameGame,false);\n            }\n        }\n    }\n\n    public callbackRemoveFromCollection(data: any, status: number, associatedStateName: string): void {\n        cLogger(`callback for remove single board game ${associatedStateName} from my collection with status ${status}`);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            cLogger(data);\n            const id = data.data[this.config.apis.removeFromMyCollection.resultName];\n            cLogger(id);\n        }\n    }\n\n    public callbackGetCollection(data: any, status: number, associatedStateName: string): void {\n        cLogger(`callback for getting my collection of board games ${associatedStateName} to my collection with status ${status}`);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            cLogger(data);\n            const collectionData = data.data[this.config.apis.getMyBoardGameCollection.resultName];\n\n            // loop through the collection data and see if it already exists in the state\n            let currentGameList = this.applicationView.state.boardGames;\n            cLoggerDetail(`Starting with local state of ${currentGameList.length}`);\n            collectionData.forEach((boardGame:any) => {\n                boardGame.decorator = Decorator.Persisted;\n                cLoggerDetail(`Loading board game from collection `);\n                cLoggerDetail(boardGame);\n                let index = currentGameList.findIndex((game:any) => game.gameId === boardGame.gameId);\n                cLoggerDetail(`have found the board game locally? ${index >=0}`);\n                if (index >= 0) {\n                    cLoggerDetail(`in current state, replacing`);\n                    // replace the current entry\n                    currentGameList.splice(index,1,boardGame);\n                }\n                else {\n                    cLoggerDetail(`not in current state, adding`);\n                    currentGameList.push(boardGame);\n                }\n            });\n            cLoggerDetail(`Ending with local state of ${currentGameList.length}`);\n            this.applicationView.setState({boardGames:currentGameList});\n            this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,currentGameList,false);\n        }\n    }\n\n    scoreSheetAddedToBoardGame(boardGame:any,scoreSheet:any) {\n        const cb = (data: any, status: number, associatedStateName: string) => {};\n\n            if (this.isLoggedIn() && (boardGame.decorator && (boardGame.decorator === Decorator.Persisted))) {\n            //mutation addScore($userId: Int!, $boardGameId: Int!, $sheet: ScoreSheetInput) {addScoreSheetToBoardGame(userId: $userId, boardGameId: $boardGameId, sheet: $sheet){id}\n                downloader.addQLApiRequest(this.config.apis.graphQL, this.config.apis.addScoreSheetToBoardGame.queryString,\n                    {userId: this.getCurrentUser(), boardGameId: boardGame.id,sheet:scoreSheet},\n                    cb,\n                    this.config.stateNames.scoreSheet,\n                    false);\n        }\n        let currentListOfGames: any[] = this.applicationView.state.boardGames;\n        let index = currentListOfGames.findIndex((value) => value.gameId === boardGame.gameId);\n        if (index >= 0) {\n            const oldBoardGame = currentListOfGames[index];\n            boardGame.decorator = oldBoardGame.decorator;\n\n            cLogger(`Updating application state`);\n            currentListOfGames.splice(index, 1, boardGame);\n            cLogger(currentListOfGames);\n            this.displayedBoardGamesStateManager.setStateByName(this.config.stateNames.boardGames,currentListOfGames,false);\n            this.applicationView.setState({boardGames: currentListOfGames});\n        } else {\n            cLogger(`Board game ${boardGame.id} not found in current state`);\n        }\n\n    }\n\n    addBoardGameToCollection(event: MouseEvent) {\n        cLogger(`Handling Add Board Game to collection`);\n        const boardGame: any | null = this.findBoardGameInStateFromEvent(event);\n        if (boardGame) {\n            if (boardGame.decorator) {\n                switch (boardGame.decorator) {\n                    case (Decorator.Persisted): {\n                        // already in collection, nothing to do\n                        break;\n                    }\n                    case (Decorator.Incomplete): {\n                        // not ready to add to collection yet, do nothing\n                        break;\n                    }\n                    case (Decorator.PersistedLocally):\n                    case (Decorator.Complete): {\n                        // loaded and ready to save\n                        this.displayedBoardGamesStateManager.addNewItemToState(this.config.stateNames.boardGames,boardGame,true);\n                        // add the board game to my collection\n                        // now we need an API call to fill in the details\n                        delete boardGame.decorator;\n                        delete boardGame.id;\n                        if (this.isLoggedIn()) {\n                            downloader.addQLApiRequest(this.config.apis.graphQL, this.config.apis.addToMyCollection.queryString,\n                                {userId: this.getCurrentUser(), boardGame: boardGame},\n                                this.callbackAddToCollection,\n                                this.config.stateNames.boardGames,\n                                true);\n                            boardGame.decorator = Decorator.Complete;\n                        }\n                        else {\n                            boardGame.decorator = Decorator.PersistedLocally;\n                        }\n                        break;\n                    }\n                }\n            }\n        }\n    }\n\n    removeBoardGameFromCollection(boardGame: any) { // should be persisted\n        cLogger(`Handling Remove Board Game from collection with id ${boardGame.gameId}`);\n        if (boardGame) {\n            if (boardGame.decorator) {\n                switch (boardGame.decorator) {\n                    case (Decorator.PersistedLocally):\n                    case (Decorator.Persisted): {\n                        // already in collection,\n                        this.removeBoardGameFromState(boardGame);\n                        if (this.isLoggedIn()) {\n                            downloader.addQLApiRequest(this.config.apis.graphQL, this.config.apis.removeFromMyCollection.queryString,\n                                {userId: this.getCurrentUser(), boardGameId: boardGame.gameId},\n                                this.callbackRemoveFromCollection,\n                                this.config.stateNames.boardGames,\n                                false);\n                        }\n                        break;\n                    }\n                    case (Decorator.Incomplete): {\n                        // not ready to add to collection yet, do nothing\n                        break;\n                    }\n                    case (Decorator.Complete): {\n                        // loaded and ready to save, but not yet saved, nothing to delete\n                        break;\n                    }\n                }\n            }\n        }\n    }\n\n    removeBoardGameFromDisplay(boardGame: any) { // shouldn't be persisted yet\n        cLogger(`Handling Remove Board Game from display ${boardGame.gameId}`);\n        if (boardGame) {\n            if (boardGame.decorator) {\n                switch (boardGame.decorator) {\n                    case (Decorator.Incomplete): {\n                        // not ready to add to collection yet, do nothing\n                        break;\n                    }\n                    case (Decorator.Persisted):\n                    case (Decorator.PersistedLocally):\n                    case (Decorator.Complete): {\n                        // loaded and ready to save\n                        this.removeBoardGameFromState(boardGame);\n                        break;\n                    }\n                }\n            }\n        }\n    }\n\n\n}\n\nconst controller = new Controller();\n\nexport default controller;\n","import debug from 'debug';\nimport browserUtil from '../util/BrowserUtil';\nimport StateChangeListener from \"../state/StateChangeListener\";\nimport {StateManager} from \"../state/StateManager\";\n\nconst avLogger = debug('view-ts')\n\nexport default abstract class AbstractView implements StateChangeListener {\n    protected applicationView: any;\n    protected document: HTMLDocument;\n    protected uiConfig: any;\n    protected uiPrefs: any;\n\n    protected config: any;\n\n    protected stateManager: StateManager;\n\n    protected constructor(applicationView: any, htmlDocument: HTMLDocument, uiConfig: any, uiPrefs: any, stateManager: StateManager) {\n        this.applicationView = applicationView;\n        this.document = document;\n        this.uiConfig = uiConfig;\n        this.uiPrefs = uiPrefs;\n        this.config = applicationView.state;\n        this.stateManager = stateManager;\n\n        // state change listening\n        this.stateChanged = this.stateChanged.bind(this);\n\n        // event handlers\n        this.eventStartDrag = this.eventStartDrag.bind(this);\n        this.eventClickItem = this.eventClickItem.bind(this);\n        this.eventDeleteClickItem = this.eventDeleteClickItem.bind(this);\n    }\n\n    public abstract onDocumentLoaded(): void;\n\n\n    /* abstract */\n    protected abstract eventClickItem(event: MouseEvent): void;\n    protected abstract eventDeleteClickItem(event: MouseEvent): void;\n\n    protected abstract getDragData(event: DragEvent): any;\n    protected abstract getIdForStateItem(name: string, item: any): string;\n    protected abstract getLegacyIdForStateItem(name: string, item: any): string;\n    protected abstract getDisplayValueForStateItem(name: string, item: any): string;\n    protected abstract getModifierForStateItem(name: string, item: any): string;\n    protected abstract getSecondaryModifierForStateItem(name: string, item: any): string;\n    protected abstract getBadgeValue(name:string, item:any): number;\n    protected abstract getBackgroundImage(name:string,item:any) :string;\n\n    protected abstract updateView(name: string, newState: any): void;\n\n\n    protected eventStartDrag(event: DragEvent) {\n        avLogger('Abstract View : drag start', 10);\n        const data = JSON.stringify(this.getDragData(event));\n        avLogger(data, 10);\n        // @ts-ignore\n        event.dataTransfer.setData(this.applicationView.state.ui.draggable.draggableDataKeyId, data);\n    }\n\n    protected createResultForItem(name: string, item: any, dataSource:any = null): HTMLElement {\n        avLogger('Abstract View : creating Result');\n        avLogger(item);\n        const domConfig = this.uiConfig.dom;\n\n        const resultDataKeyId = this.getIdForStateItem(name, item);\n        const legacyDataKeyId = this.getLegacyIdForStateItem(name, item);\n        if (!dataSource) {\n            dataSource = domConfig.resultDataSourceValue;\n        }\n\n\n        let childEl:HTMLElement = this.document.createElement(domConfig.resultsElementType);\n        browserUtil.addRemoveClasses(childEl, domConfig.resultsClasses);\n        browserUtil.addAttributes(childEl, domConfig.resultsElementAttributes);\n        // the content may be structured\n        let textEl = childEl;\n        if (domConfig.resultContentDivClasses) {\n            let contentEl:HTMLElement = this.document.createElement('div');\n            browserUtil.addRemoveClasses(contentEl, domConfig.resultContentDivClasses);\n            contentEl.setAttribute(domConfig.resultDataKeyId, resultDataKeyId);\n            contentEl.setAttribute(domConfig.resultLegacyDataKeyId, legacyDataKeyId);\n            contentEl.setAttribute(domConfig.resultDataSourceId, dataSource);\n\n\n            textEl = this.document.createElement(domConfig.resultContentTextElementType);\n            browserUtil.addRemoveClasses(textEl, domConfig.resultContentTextClasses);\n            textEl.setAttribute(domConfig.resultDataKeyId, resultDataKeyId);\n            textEl.setAttribute(domConfig.resultLegacyDataKeyId, legacyDataKeyId);\n            textEl.setAttribute(domConfig.resultDataSourceId, dataSource);\n\n            contentEl.appendChild(textEl);\n\n            if (domConfig.hasBackgroundImage) {\n                let imgEl = this.document.createElement(domConfig.imgElementType);\n                browserUtil.addRemoveClasses(imgEl,domConfig.imgClasses);\n                imgEl.setAttribute('src',this.getBackgroundImage(name,item));\n            }\n\n            if (domConfig.hasBadge) {\n                const badgeValue = this.getBadgeValue(name,item);\n                if (badgeValue > 0) {\n                    let badgeEl: HTMLElement = this.document.createElement(domConfig.badgeElementType);\n                    browserUtil.addRemoveClasses(badgeEl, domConfig.badgeClasses);\n                    badgeEl.setAttribute(domConfig.resultDataKeyId, resultDataKeyId);\n                    badgeEl.setAttribute(domConfig.resultLegacyDataKeyId, legacyDataKeyId);\n                    badgeEl.setAttribute(domConfig.resultDataSourceId, dataSource);\n                    contentEl.appendChild(badgeEl);\n                    badgeEl.innerHTML = `&nbsp;&nbsp;&nbsp;${badgeValue}&nbsp;&nbsp;&nbsp;`;\n                    browserUtil.addAttributes(badgeEl, domConfig.badgeElementAttributes);\n                }\n            }\n\n            if (domConfig.isDeleteable) {\n                let deleteButtonEl:HTMLElement = this.document.createElement('button');\n                deleteButtonEl.setAttribute('type','button');\n                browserUtil.addRemoveClasses(deleteButtonEl,domConfig.deleteButtonClasses);\n                if (domConfig.deleteButtonText) {\n                    if (domConfig.deleteButtonText.trim().length() > 0) {\n                        domConfig.innerText = domConfig.deleteButtonText;\n                    }\n                }\n                if (domConfig.deleteButtonIconClasses) {\n                    let iconEl = document.createElement('i');\n                    browserUtil.addRemoveClasses(iconEl,domConfig.deleteButtonIconClasses);\n                    iconEl.setAttribute(domConfig.resultDataKeyId, resultDataKeyId);\n                    iconEl.setAttribute(domConfig.resultLegacyDataKeyId, legacyDataKeyId);\n                    iconEl.setAttribute(domConfig.resultDataSourceId, dataSource);\n                    deleteButtonEl.appendChild(iconEl);\n                }\n                deleteButtonEl.setAttribute(domConfig.resultDataKeyId, resultDataKeyId);\n                deleteButtonEl.setAttribute(domConfig.resultLegacyDataKeyId, legacyDataKeyId);\n                deleteButtonEl.setAttribute(domConfig.resultDataSourceId, dataSource);\n                deleteButtonEl.addEventListener('click',(event) => {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    this.eventDeleteClickItem(event);\n                });\n                contentEl.appendChild(deleteButtonEl);\n            }\n            childEl.appendChild(contentEl);\n        }\n\n\n        // add the key ids for selection\n        childEl.setAttribute(domConfig.resultDataKeyId, resultDataKeyId);\n        childEl.setAttribute(domConfig.resultLegacyDataKeyId, legacyDataKeyId);\n        childEl.setAttribute(domConfig.resultDataSourceId, dataSource);\n        const displayText = this.getDisplayValueForStateItem(name, item);\n        // add modifiers for patient state\n        const modifier = this.getModifierForStateItem(name, item);\n        const secondModifier = this.getSecondaryModifierForStateItem(name, item);\n        switch (modifier) {\n            case 'normal': {\n                avLogger('Abstract View: normal item');\n                browserUtil.addRemoveClasses(childEl, domConfig.modifierClassNormal);\n                if (domConfig.iconNormal !== '') {\n                    textEl.innerHTML = displayText + '  ' + domConfig.iconNormal;\n                } else {\n                    textEl.innerText = displayText;\n                }\n\n                switch (secondModifier) {\n                    case 'warning': {\n                        browserUtil.addRemoveClasses(childEl, domConfig.modifierClassNormal, false);\n                        browserUtil.addRemoveClasses(childEl, domConfig.modifierClassWarning, true);\n                        if (domConfig.iconWarning !== '') {\n                            textEl.innerHTML += '  ' + domConfig.iconWarning;\n                        }\n                        break;\n                    }\n                    case 'normal': {\n                        break;\n                    }\n                    case 'active': {\n                        if (domConfig.iconActive !== '') {\n                            textEl.innerHTML += '  ' + domConfig.iconActive;\n                        }\n\n                    }\n                }\n\n                break;\n            }\n            case 'active': {\n                avLogger('Abstract View: active item', 10);\n                browserUtil.addRemoveClasses(childEl, domConfig.modifierClassActive);\n                if (domConfig.iconActive !== '') {\n                    textEl.innerHTML = displayText + '  ' + domConfig.iconActive;\n                } else {\n                    textEl.innerText = displayText;\n                }\n                switch (secondModifier) {\n                    case 'warning': {\n                        browserUtil.addRemoveClasses(childEl, domConfig.modifierClassActive, false);\n                        browserUtil.addRemoveClasses(childEl, domConfig.modifierClassWarning, true);\n                        if (domConfig.iconWarning !== '') {\n                            textEl.innerHTML += '  ' + domConfig.iconWarning;\n                        }\n                        break;\n                    }\n                    case 'normal': {\n                        break;\n                    }\n                }\n                break;\n            }\n            case 'inactive': {\n                avLogger('Abstract View: inactive item', 10);\n                browserUtil.addRemoveClasses(childEl, domConfig.modifierClassInactive);\n                if (domConfig.iconInactive !== '') {\n                    textEl.innerHTML = displayText + '  ' + domConfig.iconInactive;\n                } else {\n                    textEl.innerText = displayText;\n                }\n                switch (secondModifier) {\n                    case 'warning': {\n                        if (domConfig.iconWarning !== '') {\n                            browserUtil.addRemoveClasses(childEl, domConfig.modifierClassInactive, false);\n                            browserUtil.addRemoveClasses(childEl, domConfig.modifierClassWarning, true);\n                            textEl.innerHTML += '  ' + domConfig.iconWarning;\n                        }\n                        break;\n                    }\n                    case 'normal': {\n                        break;\n                    }\n                    case 'active': {\n                        if (domConfig.iconActive !== '') {\n                            textEl.innerHTML += '  ' + domConfig.iconActive;\n                        }\n                        break;\n                    }\n                }\n                break;\n            }\n        }\n        return childEl;\n    }\n\n\n    protected createResultsForState(name: string, newState: any): void {\n        avLogger('Abstract View : creating Results', 10);\n        avLogger(newState);\n        const domConfig = this.uiConfig.dom;\n        // remove the previous items from list\n        const viewEl = document.getElementById(domConfig.resultsId);\n        if (viewEl) browserUtil.removeAllChildren(viewEl);\n\n        // add the new children\n        newState.map((item: any, index: number) => {\n            const childEl = this.createResultForItem(name,item);\n            // add draggable actions\n            if (domConfig.isDraggable) {\n                childEl.setAttribute('draggable', 'true');\n                childEl.addEventListener('dragstart', this.eventStartDrag);\n            }\n            // add selection actions\n            if (domConfig.isClickable) {\n                childEl.addEventListener('click', this.eventClickItem);\n            }\n            avLogger(`Abstract View: Adding child ${item.id}`);\n            if (viewEl) viewEl.appendChild(childEl);\n        });\n    }\n\n    public stateChanged(managerName: string, name: string, newValue: any): void {\n        this.updateView(name, newValue);\n    }\n\n    stateChangedItemAdded(managerName: string, name: string, itemAdded: any): void {\n        this.updateView(name, this.stateManager.getStateByName(name));\n    }\n\n    stateChangedItemRemoved(managerName: string, name: string, itemRemoved: any): void {\n        this.updateView(name, this.stateManager.getStateByName(name));\n    }\n\n    stateChangedItemUpdated(managerName: string, name: string, itemUpdated: any, itemNewValue: any): void {\n        this.updateView(name, this.stateManager.getStateByName(name));\n    }\n\n}\n","import AbstractView from './AbstractView';\nimport {StateManager} from \"../state/StateManager\";\n\nabstract class SidebarView extends AbstractView {\n  protected constructor(applicationView:any, htmlDocument:HTMLDocument, uiConfig:any, uiPrefs:any,stateManager:StateManager) {\n    super(applicationView, htmlDocument, uiConfig, uiPrefs,stateManager);\n    // event handlers\n    this.eventHide = this.eventHide.bind(this);\n    this.eventShow = this.eventShow.bind(this);\n  }\n\n  onDocumentLoaded() { // this should be called once at startup\n    // hide the side bar panel\n    this.eventHide(null);\n\n    // add the event listener for the close button\n    const sidePanelEl = this.document.getElementById(this.uiConfig.dom.sideBarId);\n    if (sidePanelEl === null) return;\n\n    const closeButtonEl = sidePanelEl.querySelector('.close');\n    if (closeButtonEl) {\n      closeButtonEl.addEventListener('click', this.eventHide);\n    }\n  }\n\n  private showHide(newStyleValue:string):void {\n    const sidePanelEl = this.document.getElementById(this.uiConfig.dom.sideBarId);\n    if (sidePanelEl === null) return;\n\n    switch (this.uiPrefs.view.location) {\n      case 'left': {\n        sidePanelEl.style.width = newStyleValue;\n        break;\n      }\n      case 'right': {\n        sidePanelEl.style.width = newStyleValue;\n        break;\n      }\n      case 'bottom': {\n        sidePanelEl.style.height = newStyleValue;\n        break;\n      }\n      case 'top': {\n        sidePanelEl.style.height = newStyleValue;\n        break;\n      }\n    }\n  }\n\n  eventHide(event:Event|null) {\n    if (event) event.preventDefault();\n    this.showHide('0%');\n  }\n\n  eventShow(event:Event|null) {//414,768,1024\n    let size = this.uiPrefs.view.expandedSize;\n    if (window.innerWidth < 769) {\n      size = '50%';\n    }\n    if (window.innerWidth < 415) {\n      size = '100%';\n    }\n    this.showHide(size);\n  }\n}\n\nexport default SidebarView;\n","import debug from 'debug';\nimport SidebarView from './SidebarView';\nimport {StateManager} from '../state/StateManager';\nimport {isSame, isSameUsername} from '../util/EqualityFunctions';\nimport {ChatUserEventListener} from \"../socket/ChatUserEventListener\";\nimport {NotificationController} from \"../socket/NotificationController\";\nimport controller from \"../Controller\";\nimport BrowserStorageStateManager from \"../state/BrowserStorageStateManager\";\nimport {ChatManager} from \"../socket/ChatManager\";\nimport browserUtil from \"../util/BrowserUtil\";\n\nconst vLogger = debug('user-search-sidebar');\nconst vLoggerDetail = debug('user-search-sidebar:detail');\n\nclass UserSearchSidebarView extends SidebarView implements ChatUserEventListener {\n    protected loggedInUsers: string[];\n    protected localisedSM: StateManager;\n    // @ts-ignore\n    protected favUsersDiv:HTMLElement;\n    // @ts-ignore\n    protected favUsersDropZone:HTMLElement;\n    // @ts-ignore\n    protected blockedUsersDiv:HTMLElement;\n    // @ts-ignore\n    protected blockedUsersDropZone:HTMLElement;\n\n    constructor(applicationView: any, htmlDocument: HTMLDocument, stateManager: StateManager) {\n        super(applicationView, htmlDocument, applicationView.state.ui.userSearchSideBar, applicationView.state.uiPrefs.userSearchSideBar, stateManager);\n\n        this.config = applicationView.state;\n        this.loggedInUsers = [];\n\n        // handler binding\n        this.updateView = this.updateView.bind(this);\n        this.eventClickItem = this.eventClickItem.bind(this);\n        this.eventUserSelected = this.eventUserSelected.bind(this);\n        this.handleLoggedInUsersUpdated = this.handleLoggedInUsersUpdated.bind(this);\n        this.handleFavouriteUserLoggedIn = this.handleFavouriteUserLoggedIn.bind(this);\n        this.handleFavouriteUserLoggedOut = this.handleFavouriteUserLoggedOut.bind(this);\n        this.handleFavouriteUsersChanged = this.handleFavouriteUsersChanged.bind(this);\n        this.handleBlockedUsersChanged = this.handleBlockedUsersChanged.bind(this);\n        this.handleLoggedInUsersUpdated = this.handleLoggedInUsersUpdated.bind(this);\n\n        this.handleFavouriteUserDrop = this.handleFavouriteUserDrop.bind(this);\n        this.handleBlockedUserDrop = this.handleBlockedUserDrop.bind(this);\n\n        // register state change listening\n        stateManager.addChangeListenerForName(this.config.stateNames.users, this);\n        this.localisedSM = new BrowserStorageStateManager(true);\n        this.localisedSM.addChangeListenerForName(this.config.stateNames.recentUserSearches, this);\n        NotificationController.getInstance().addUserListener(this);\n\n        vLogger(this.localisedSM.getStateByName(this.config.stateNames.recentUserSearches));\n\n    }\n\n    handleFavouriteUserDrop(event:Event) {\n        vLogger('drop event on favourites');\n        // @ts-ignore\n        const draggedObjectJSON = event.dataTransfer.getData(this.config.ui.draggable.draggableDataKeyId);\n        const draggedObject = JSON.parse(draggedObjectJSON);\n        vLogger(draggedObject);\n\n        if (draggedObject[this.config.ui.draggable.draggedType] === this.config.ui.draggable.draggedTypeUser) {\n             switch (draggedObject[this.config.ui.draggable.draggedFrom]) {\n                case this.config.ui.draggable.draggedFromUserSearch: {\n                    // we know we have dragged a user from the user search to our favorites and dropped it\n                    // is this user already in the favourites?\n                    if (ChatManager.getInstance().isUserInFavouriteList(draggedObject.username)) {\n                        vLogger(`${draggedObject.username} already in favourite list, ignoring`);\n                        return;\n                    }\n                    // ok, so we have a new user to add to the favourite list\n                    // add the user to the Chat Manager and we should get an event about it\n                    ChatManager.getInstance().addUserToFavouriteList(draggedObject.username);\n                    break;\n                }\n            }\n        }\n    }\n\n    handleBlockedUserDrop(event:Event) {\n        vLogger('drop event on blocked users');\n        // @ts-ignore\n        const draggedObjectJSON = event.dataTransfer.getData(this.config.ui.draggable.draggableDataKeyId);\n        const draggedObject = JSON.parse(draggedObjectJSON);\n        vLogger(draggedObject);\n\n        if (draggedObject[this.config.ui.draggable.draggedType] === this.config.ui.draggable.draggedTypeUser) {\n            switch (draggedObject[this.config.ui.draggable.draggedFrom]) {\n                case this.config.ui.draggable.draggedFromUserSearch: {\n                    // we know we have dragged a user from the user search to our blocked users and dropped it\n                    // is this user already in the favourites?\n                    if (ChatManager.getInstance().isUserInBlockedList(draggedObject.username)) {\n                        vLogger(`${draggedObject.username} already in blocked list, ignoring`);\n                        return;\n                    }\n                    // ok, so we have a new user to add to the favourite list\n                    // add the user to the Chat Manager and we should get an event about it\n                    ChatManager.getInstance().addUserToBlockedList(draggedObject.username);\n                    break;\n                }\n            }\n        }\n    }\n\n\n    handleLoggedInUsersUpdated(usernames: string[]): void {\n        vLogger(`Received new list of users who are logged in `);\n        vLogger(usernames);\n        this.loggedInUsers = usernames;\n        this.reRenderView();\n    }\n\n    handleFavouriteUserLoggedIn(username: string): void {\n        vLogger(`Handle Favourite User ${username} logged in`);\n        this.reRenderView();\n    }\n\n    handleFavouriteUserLoggedOut(username: string): void {\n        vLogger(`Handle Favourite User ${username} logged in`);\n        this.reRenderView();\n    }\n\n    handleFavouriteUsersChanged(usernames: string[]): void {\n        vLogger(`Handle Favourite Users changed to ${usernames}`);\n        this.reRenderView();\n    }\n\n    handleBlockedUsersChanged(usernames: string[]): void {\n        vLogger(`Handle Blocked Users changed to ${usernames}`);\n        this.reRenderView();\n    }\n\n    private renderFavouriteUsers() {\n        const usernames: string[] = ChatManager.getInstance().getFavouriteUserList();\n        if (this.favUsersDiv) browserUtil.removeAllChildren(this.favUsersDiv);\n\n        usernames.forEach((username) => {\n            // find the user in the state manager\n            let user:any = this.stateManager.findItemInState(this.config.stateNames.users, {username}, isSameUsername);\n            if (user) {\n                let childElement = this.createResultForItem(this.config.stateNames.users,user,this.uiConfig.dom.resultDataSourceFavUsers);\n                childElement.addEventListener('click', this.eventClickItem);\n                childElement.setAttribute('draggable', 'true');\n                childElement.addEventListener('dragstart', this.eventStartDrag);\n\n\n                this.favUsersDiv.appendChild(childElement);\n            }\n        });\n    }\n\n    private renderBlockedUsers() {\n        const usernames: string[] = ChatManager.getInstance().getBlockedUserList();\n        if (this.blockedUsersDiv) browserUtil.removeAllChildren(this.blockedUsersDiv);\n\n        usernames.forEach((username) => {\n            // find the user in the state manager\n            let user:any = this.stateManager.findItemInState(this.config.stateNames.users, {username}, isSameUsername);\n            if (user) {\n                let childElement = this.createResultForItem(this.config.stateNames.users,user,this.uiConfig.dom.resultDataSourceBlockedUsers);\n                childElement.setAttribute('draggable', 'false');\n                childElement.addEventListener('dragstart', (event) => {event.preventDefault();});\n                this.blockedUsersDiv.appendChild(childElement);\n            }\n        });\n    }\n\n\n    onDocumentLoaded() {\n        super.onDocumentLoaded();\n        // @ts-ignore\n        const fastSearchEl = $(`#${this.uiConfig.dom.extra.fastSearchInputId}`);\n        fastSearchEl.on('autocompleteselect', this.eventUserSelected);\n\n        // ok lets add the favourite users area and event handling for that now\n        // @ts-ignore\n        this.favUsersDropZone = document.getElementById(this.uiConfig.dom.favouriteUsersDropZone);\n        this.favUsersDropZone.addEventListener('dragover', (event) => {vLogger('Dragged over'); event.preventDefault();});\n        this.favUsersDropZone.addEventListener('drop', this.handleFavouriteUserDrop);\n\n        // @ts-ignore\n        this.favUsersDiv = document.getElementById(this.uiConfig.dom.favouriteUsersId);\n\n        // ok lets add the favourite users area and event handling for that now\n        // @ts-ignore\n        this.blockedUsersDropZone = document.getElementById(this.uiConfig.dom.blockedUsersDropZone);\n        this.blockedUsersDropZone.addEventListener('dragover', (event) => {vLogger('Dragged over'); event.preventDefault();});\n        this.blockedUsersDropZone.addEventListener('drop', this.handleBlockedUserDrop);\n\n        // @ts-ignore\n        this.blockedUsersDiv = document.getElementById(this.uiConfig.dom.blockedUsersId);\n\n        this.renderFavouriteUsers();\n        this.renderBlockedUsers();\n\n\n    }\n\n    getIdForStateItem(name: string, item: any) {\n        return item.id;\n    }\n\n    getLegacyIdForStateItem(name: string, item: any) {\n        return item.id;\n    }\n\n    getDisplayValueForStateItem(name: string, item: any) {\n        return item.username;\n    }\n\n    getModifierForStateItem(name: string, item: any) {\n        let result = 'normal';\n        vLoggerDetail(`Checking for item modifiers`);\n        vLoggerDetail(item);\n        // if the user is currently logged out make the item inactive\n        if (!ChatManager.getInstance().isUserLoggedIn(item.username)) {\n            result = 'inactive';\n        }\n        return result;\n    }\n\n    getSecondaryModifierForStateItem(name: string, item: any) {\n        let result = 'normal';\n        vLoggerDetail(`Checking for item secondary modifiers ${item.username}`);\n        // if the user is in the black list then show warning and a favourite user is highlighted\n        if (NotificationController.getInstance().isFavouriteUser(item.username)) {\n            vLoggerDetail(`is favourite`);\n            result = 'active';\n        }\n        if (NotificationController.getInstance().isBlockedUser(item.username)) {\n            vLoggerDetail(`is blocked`);\n            result = 'warning';\n        }\n        return result;\n    }\n\n    eventClickItem(event: MouseEvent) {\n        event.preventDefault();\n        event.stopPropagation();\n        console.log(event.target);\n        // @ts-ignore\n        const userId = event.target.getAttribute(this.uiConfig.dom.resultDataKeyId);\n        // @ts-ignore\n        const dataSource = event.target.getAttribute(this.uiConfig.dom.resultDataSourceId);\n\n        if (dataSource === this.uiConfig.dom.resultDataSourceBlockedUsers) {\n            vLoggerDetail(`Blocked user clicked - not activating`);\n            return;\n        }\n        // @ts-ignore\n        vLoggerDetail(`User ${event.target} with id ${userId} clicked from ${dataSource}`);\n\n        let user: any = this.stateManager.findItemInState(this.config.stateNames.users, {id: parseInt(userId)}, isSame);\n        vLogger(user);\n        NotificationController.getInstance().startChatWithUser(user.username);\n        this.applicationView.handleShowChat(event);\n    }\n\n\n    eventUserSelected(event: Event, ui: any) {\n        event.preventDefault();\n        event.stopPropagation();\n        vLogger(`User ${ui.item.label} with id ${ui.item.value} selected`);\n        // @ts-ignore\n        event.target.innerText = '';\n\n        // add the selected user to the recent user searches\n        if (this.localisedSM.isItemInState(this.config.stateNames.recentUserSearches, {id: ui.item.value}, isSame)) return;\n\n        const recentUserSearches = this.localisedSM.getStateByName(this.config.stateNames.recentUserSearches);\n        vLogger(`saved searches too long? ${this.config.controller.dataLimit.recentUserSearches}`);\n        if (recentUserSearches.length >= this.config.controller.dataLimit.recentUserSearches) {\n            vLogger('saved searches too long - removing first');\n            // remove the first item from recent searches\n            const item = recentUserSearches.shift();\n            this.localisedSM.removeItemFromState(this.config.stateNames.recentUserSearches, item, isSame, true);\n        }\n        // save the searches\n        this.localisedSM.addNewItemToState(this.config.stateNames.recentUserSearches, {\n            id: ui.item.value,\n            username: ui.item.label\n        }, true);\n    }\n\n    reRenderView() {\n        this.updateView(this.config.stateNames.recentUserSearches, this.localisedSM.getStateByName(this.config.stateNames.recentUserSearches));\n        this.renderFavouriteUsers();\n        this.renderBlockedUsers();\n    }\n\n    updateView(name: string, newState: any) {\n        if (name === this.config.stateNames.recentUserSearches) {\n            vLogger(`Updating for recent searches`);\n            newState = this.localisedSM.getStateByName(this.config.stateNames.recentUserSearches);\n            vLogger(newState);\n            this.createResultsForState(name, newState);\n        }\n        if (name === this.config.stateNames.users) {\n            // load the search names into the search field\n            // what is my username?\n            let myUsername = controller.getLoggedInUsername();\n            // @ts-ignore\n            const fastSearchEl = $(`#${this.uiConfig.dom.extra.fastSearchInputId}`);\n            // for each name, construct the patient details to display and the id referenced\n            const fastSearchValues: any = [];\n            newState.forEach((item: any) => {\n                const searchValue = {\n                    label: item.username,\n                    value: item.id,\n                };\n                if (myUsername !== item.username) fastSearchValues.push(searchValue); // don't search for ourselves\n            });\n            fastSearchEl.autocomplete({source: fastSearchValues});\n            fastSearchEl.autocomplete('option', {disabled: false, minLength: 1});\n        }\n    }\n\n    getDragData(event: DragEvent) {\n        // use the actual id to pass the user to the droppable target\n        // @ts-ignore\n        const userId = event.target.getAttribute(this.uiConfig.dom.resultDataKeyId);\n        // @ts-ignore\n        vLoggerDetail(`User ${event.target.innerText} with id ${userId} dragging`);\n        let user = this.stateManager.findItemInState(this.config.stateNames.users, {id: parseInt(userId)}, isSame);\n        vLoggerDetail(user);\n        user[this.config.ui.draggable.draggedType] = this.config.ui.draggable.draggedTypeUser;\n        user[this.config.ui.draggable.draggedFrom] = this.config.ui.draggable.draggedFromUserSearch;\n        return user;\n    }\n\n    protected eventDeleteClickItem(event: MouseEvent): void {\n        event.preventDefault();\n        event.stopPropagation();\n        // @ts-ignore\n        const userId = event.target.getAttribute(this.uiConfig.dom.resultDataKeyId);\n        // @ts-ignore\n        const dataSource = event.target.getAttribute(this.uiConfig.dom.resultDataSourceId)\n        // @ts-ignore\n        vLoggerDetail(`User ${event.target} with id ${userId} delete clicked from ${dataSource}`);\n\n        let user: any = this.stateManager.findItemInState(this.config.stateNames.users, {id: parseInt(userId)}, isSame);\n        vLogger(user);\n        if (user) {\n\n\n            switch (dataSource) {\n                case (this.uiConfig.dom.resultDataSourceFavUsers) : {\n                    this.deleteFavouriteUser(user);\n                    break;\n                }\n                case (this.uiConfig.dom.resultDataSourceBlockedUsers) : {\n                    this.deleteBlockedUser(user);\n                    break;\n                }\n                case (this.uiConfig.dom.resultDataSourceValue) : {\n                    this.deleteRecentSearchUser(user);\n                    break;\n                }\n            }\n        }\n    }\n\n    deleteFavouriteUser(user:any) {\n        // @ts-ignore\n        vLogger(`Favourite user ${user.username} with id ${user.id} deleted - removing`);\n        ChatManager.getInstance().removeUserFromFavouriteList(user.username);\n    }\n\n    deleteBlockedUser(user:any) {\n        // @ts-ignore\n        vLogger(`Blocked user ${user.username} with id ${user.id} deleted - removing`);\n        ChatManager.getInstance().removeUserFromBlockedList(user.username);\n    }\n\n    deleteRecentSearchUser(user:any) {\n        // @ts-ignore\n        vLogger(`Recent search user ${user.username} with id ${user.id} deleted - removing`);\n        this.localisedSM.removeItemFromState(this.config.stateNames.recentUserSearches,user,isSame,true);\n    }\n\n    protected getBadgeValue(name: string, item: any): number {\n        return 0;\n    }\n\n    protected getBackgroundImage(name: string, item: any): string {\n        return \"\";\n    }\n\n\n}\n\nexport default UserSearchSidebarView;\n","import debug from 'debug';\nimport SidebarView from './SidebarView';\nimport {StateManager} from '../state/StateManager';\nimport {ChatEventListener} from \"../socket/ChatEventListener\";\nimport {NotificationController} from \"../socket/NotificationController\";\nimport {ChatManager} from \"../socket/ChatManager\";\nimport browserUtil from \"../util/BrowserUtil\";\nimport moment from \"moment\";\nimport {ChatLog, Invitation, Message, Priority} from \"../socket/Types\";\n\n\nconst csLogger = debug('chat-sidebar');\nconst csLoggerDetail = debug('chat-sidebar:detail');\n\nclass ChatSidebarView extends SidebarView implements ChatEventListener {\n    // @ts-ignore\n    protected chatRoomDiv: HTMLElement;\n    // @ts-ignore\n    protected chatLogDiv: HTMLElement;\n    // @ts-ignore\n    protected chatForm: HTMLElement;\n    // @ts-ignore\n    protected commentEl: HTMLElement;\n    // @ts-ignore\n    protected sendMessageButton: HTMLElement;\n    // @ts-ignore\n    protected leaveChatButton: HTMLElement;\n\n    protected selectedChatLog: ChatLog | null = null;\n\n    constructor(applicationView: any, htmlDocument: HTMLDocument, stateManager: StateManager) {\n        super(applicationView, htmlDocument, applicationView.state.ui.chatSideBar, applicationView.state.uiPrefs.chatSideBar, stateManager);\n\n        this.config = applicationView.state;\n\n        // handler binding\n        this.updateView = this.updateView.bind(this);\n        this.eventClickItem = this.eventClickItem.bind(this);\n        this.handleAddMessage = this.handleAddMessage.bind(this);\n        this.handleChatLogsUpdated = this.handleChatLogsUpdated.bind(this);\n        this.handleChatLogUpdated = this.handleChatLogUpdated.bind(this);\n        this.handleChatStarted = this.handleChatStarted.bind(this);\n        this.handleUserDrop = this.handleUserDrop.bind(this);\n        this.leaveChat = this.leaveChat.bind(this);\n\n        NotificationController.getInstance().addListener(this);\n    }\n\n    handleNewInviteReceived(invite: Invitation): boolean {\n        throw new Error('Method not implemented.');\n    }\n\n    private leaveChat(event:Event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (this.selectedChatLog) {\n            ChatManager.getInstance().leaveChat(this.selectedChatLog.roomName);\n            this.selectedChatLog = null;\n            this.clearChatLog();\n            this.checkCanComment();\n        }\n        this.updateView('',{});\n    }\n\n    handleUserDrop(event:Event) {\n        csLogger('drop event on current chat room');\n        if (this.selectedChatLog) {\n            // @ts-ignore\n            const draggedObjectJSON = event.dataTransfer.getData(this.config.ui.draggable.draggableDataKeyId);\n            const draggedObject = JSON.parse(draggedObjectJSON);\n            csLogger(draggedObject);\n\n            if (draggedObject[this.config.ui.draggable.draggedType] === this.config.ui.draggable.draggedTypeUser) {\n                //add the user to the current chat if not already there\n                ChatManager.getInstance().sendInvite(draggedObject.username,this.selectedChatLog.roomName);\n            }\n        }\n\n    }\n\n\n    handleChatLogUpdated(log: ChatLog): void {\n        csLogger(`Handling chat log updates`);\n        this.checkCanComment();\n        this.renderChatLog(log);\n        this.updateView('',{})\n    }\n\n    handleAddMessage(event: Event): void {\n        event.preventDefault();\n        event.stopPropagation();\n        csLogger(`Handling message event`);\n        if (this.selectedChatLog) {\n            // @ts-ignore\n            if (this.commentEl && this.commentEl.value.trim().length === 0) return;\n            // @ts-ignore\n            const messageContent = this.commentEl.value.trim();\n            // @ts-ignore\n            this.commentEl.value = '';\n\n            let sentMessage:Message|null = ChatManager.getInstance().sendMessage(this.selectedChatLog.roomName, messageContent,Priority.Normal, {});\n            if (sentMessage) {\n                // add the message to our display\n                let messageEl = this.addChatMessage(sentMessage);\n                // scroll to bottom\n                browserUtil.scrollSmoothTo(messageEl);\n            }\n        }\n    }\n\n    private checkCanComment() {\n        if (this.selectedChatLog) {\n            if (this.commentEl) this.commentEl.removeAttribute(\"readonly\");\n            if (this.sendMessageButton) this.sendMessageButton.removeAttribute(\"disabled\");\n            if (this.leaveChatButton) this.leaveChatButton.removeAttribute(\"disabled\");\n        } else {\n            if (this.commentEl) this.commentEl.setAttribute(\"readonly\", \"true\");\n            if (this.sendMessageButton) this.sendMessageButton.setAttribute(\"disabled\", \"true\");\n            if (this.leaveChatButton) this.leaveChatButton.setAttribute(\"disabled\", \"true\");\n        }\n\n    }\n\n\n    onDocumentLoaded() {\n        super.onDocumentLoaded();\n        // @ts-ignore\n        this.chatLogDiv = document.getElementById(this.uiConfig.dom.chatLogId);\n        // @ts-ignore\n        this.commentEl = document.getElementById(this.uiConfig.dom.commentId);\n        // @ts-ignore\n        this.chatForm = document.getElementById(this.uiConfig.dom.newFormId);\n        // @ts-ignore\n        this.sendMessageButton = document.getElementById(this.uiConfig.dom.submitCommentId);\n        // @ts-ignore\n        this.leaveChatButton = document.getElementById(this.uiConfig.dom.leaveChatId);\n        // @ts-ignore\n        this.chatRoomDiv = document.getElementById(this.uiConfig.dom.chatLogRoomId);\n\n        this.chatRoomDiv.addEventListener('dragover', (event) => {csLoggerDetail('Dragged over'); if (this.selectedChatLog) event.preventDefault();});\n        this.chatRoomDiv.addEventListener('drop', this.handleUserDrop);\n\n\n        this.chatForm.addEventListener('submit', this.handleAddMessage);\n        this.leaveChatButton.addEventListener('click',this.leaveChat);\n\n        this.checkCanComment();\n\n        this.updateView('', {});\n    }\n\n    getIdForStateItem(name: string, item: any) {\n        return item.roomName;\n    }\n\n    getLegacyIdForStateItem(name: string, item: any) {\n        return item.roomName;\n    }\n\n    getDisplayValueForStateItem(name: string, item: any) {\n        return item.users.join(',');\n    }\n\n    getModifierForStateItem(name: string, item: any) {\n        let result = 'inactive';\n        if (this.selectedChatLog) {\n            if (this.selectedChatLog.roomName === item.roomName) {\n                result = 'active';\n            }\n\n        }\n        return result;\n    }\n\n    getSecondaryModifierForStateItem(name: string, item: any) {\n        return this.getModifierForStateItem(name, item);\n    }\n\n    protected getBadgeValue(name: string, item: any): number {\n        return item.numOfNewMessages;\n    }\n\n    addChatMessage(message: Message): HTMLElement {\n        let chatMessageEl = document.createElement('div');\n        browserUtil.addRemoveClasses(chatMessageEl, \"message\");\n        // are we dealing with an \"join\"/\"exit\" message?\n        if (message.from.trim().length === 0) {\n            let messageSenderEl = document.createElement('div');\n            browserUtil.addRemoveClasses(messageSenderEl, 'message-sender');\n            messageSenderEl.innerText = message.message;\n            chatMessageEl.appendChild(messageSenderEl);\n        }\n        else {\n\n            if (message.from === ChatManager.getInstance().getCurrentUser()) {\n                browserUtil.addRemoveClasses(chatMessageEl, \"my-message\");\n            } else {\n                let messageSenderEl = document.createElement('div');\n                browserUtil.addRemoveClasses(messageSenderEl, 'message-sender');\n                messageSenderEl.innerText = message.from + '   ' + moment(message.created, 'YYYYMMDDHHmmss').format('DD/MM/YYYY ');\n                chatMessageEl.appendChild(messageSenderEl);\n            }\n\n            let contentEl = document.createElement('div');\n            if (message.from === ChatManager.getInstance().getCurrentUser()) {\n                browserUtil.addRemoveClasses(contentEl, \"my-message-content\");\n            } else {\n                browserUtil.addRemoveClasses(contentEl, 'message-content');\n            }\n            contentEl.innerText = message.message;\n            chatMessageEl.appendChild(contentEl);\n        }\n\n        this.chatLogDiv.appendChild(chatMessageEl);\n        return chatMessageEl;\n    }\n\n    private clearChatLog() {\n        browserUtil.removeAllChildren(this.chatLogDiv);\n    }\n\n    reRenderChatMessages(chatLog: ChatLog) {\n        browserUtil.removeAllChildren(this.chatLogDiv);\n        let messageEl:HTMLElement|null = null;\n        chatLog.messages.forEach((message: Message) => {\n            messageEl = this.addChatMessage(message);\n        });\n        // scroll to the last message (if any)\n        if (messageEl) browserUtil.scrollTo(messageEl);\n    }\n\n\n    renderChatLog(chatLog: ChatLog) {\n        csLoggerDetail(`Chat Log ${chatLog.roomName} rendering`);\n        if (this.selectedChatLog) {\n            if (this.selectedChatLog.roomName === chatLog.roomName) {\n                this.selectedChatLog = chatLog;\n                ChatManager.getInstance().touchChatLog(chatLog.roomName);\n                // render the chat conversation\n                this.reRenderChatMessages(chatLog);\n            }\n        }\n        this.updateView('', {});\n    }\n\n    eventClickItem(event: MouseEvent) {\n        event.preventDefault();\n        event.stopPropagation();\n        console.log(event.target);\n        // @ts-ignore\n        const room = event.target.getAttribute(this.uiConfig.dom.resultDataKeyId);\n        // @ts-ignore\n        const dataSource = event.target.getAttribute(this.uiConfig.dom.resultDataSourceId);\n\n        // @ts-ignore\n        csLoggerDetail(`Chat Log ${event.target} with id ${room} clicked from ${dataSource}`);\n        this.selectedChatLog = ChatManager.getInstance().getChatLog(room);\n        if (this.selectedChatLog) {\n            this.checkCanComment();\n            this.renderChatLog(this.selectedChatLog);\n        }\n    }\n\n\n    updateView(name: string, newState: any) {\n        csLoggerDetail(`Updating state with chat manager`);\n        newState = ChatManager.getInstance().getChatLogs();\n        csLoggerDetail(newState);\n        this.createResultsForState(name, newState);\n        this.checkCanComment();\n    }\n\n    getDragData(event: DragEvent) {}\n    protected eventDeleteClickItem(event: MouseEvent): void {\n        event.preventDefault();\n        event.stopPropagation();\n        console.log(event.target);\n        // @ts-ignore\n        const room = event.target.getAttribute(this.uiConfig.dom.resultDataKeyId);\n        // @ts-ignore\n        const dataSource = event.target.getAttribute(this.uiConfig.dom.resultDataSourceId);\n\n        // @ts-ignore\n        csLoggerDetail(`Chat Log ${event.target} with id ${room} deleted from ${dataSource}`);\n\n        if (room) {\n            let log: ChatLog|null = ChatManager.getInstance().getChatLog(room);\n            if (log) {\n                ChatManager.getInstance().leaveChat(room);\n                if (this.selectedChatLog && (this.selectedChatLog.roomName === room)) {\n                    this.selectedChatLog = null;\n                    this.clearChatLog();\n                    this.checkCanComment();\n                }\n                this.updateView('', {});\n            }\n        }\n\n\n    }\n\n    handleChatLogsUpdated(): void {\n        if (this.selectedChatLog) {\n            ChatManager.getInstance().touchChatLog(this.selectedChatLog.roomName);\n            // render the chat conversation\n            this.reRenderChatMessages(this.selectedChatLog);\n        }\n        this.updateView('', {});\n        this.checkCanComment();\n    }\n\n    handleChatStarted(log: ChatLog): void {\n        this.selectedChatLog = log;\n        this.renderChatLog(log);\n        this.updateView('',{});\n    }\n\n    handleOfflineMessagesReceived(messages: Message[]): void {\n    }\n\n    protected getBackgroundImage(name: string, item: any): string {\n        return \"\";\n    }\n\n    handleInvitationDeclined(room: string, username: string): void {\n    }\n\n\n}\n\nexport default ChatSidebarView;\n","import debug from 'debug';\nimport SidebarView from './SidebarView';\nimport {StateManager} from '../state/StateManager';\nimport {isSame, isSameGame} from '../util/EqualityFunctions';\nimport browserUtil from \"../util/BrowserUtil\";\nimport downloader from \"../network/DownloadManager\";\nimport MemoryBufferStateManager from \"../state/MemoryBufferStateManager\";\n\nconst vLogger = debug('board-game-search-sidebar');\nconst vLoggerDetail = debug('board-game-search-sidebar:detail');\n\nclass BoardGameSearchSidebarView extends SidebarView {\n    protected localisedSM: StateManager;\n\n    constructor(applicationView: any, htmlDocument: HTMLDocument, stateManager: StateManager) {\n        super(applicationView, htmlDocument, applicationView.state.ui.boardGameSearchSideBar, applicationView.state.uiPrefs.boardGameSearchSideBar, stateManager);\n\n        this.config = applicationView.state;\n\n        // handler binding\n        this.updateView = this.updateView.bind(this);\n        this.eventClickItem = this.eventClickItem.bind(this);\n        this.handleSearch = this.handleSearch.bind(this);\n        this.handleSearchResultsCB = this.handleSearchResultsCB.bind(this);\n\n        // register state change listening\n        this.localisedSM = new MemoryBufferStateManager();\n        this.localisedSM.addChangeListenerForName(this.config.stateNames.bggSearchResults, this);\n\n        vLogger(this.localisedSM.getStateByName(this.config.stateNames.bggSearchResults));\n    }\n\n    // @ts-ignore\n    private formEl:HTMLElement;\n    // @ts-ignore\n    private queryEl:HTMLInputElement;\n    // @ts-ignore\n    private buttonEl:HTMLButtonElement;\n\n\n    private changeSearchButton(enable:boolean = false) {\n        browserUtil.removeAllChildren(this.buttonEl);\n        if (enable) {\n            if (this.buttonEl) this.buttonEl.removeAttribute(\"disabled\");\n            if (this.buttonEl) this.buttonEl.innerHTML = 'Search';\n        }\n        else {\n            if (this.buttonEl) this.buttonEl.setAttribute(\"disabled\",\"true\");\n            if (this.buttonEl) this.buttonEl.innerHTML = '<span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span>  Loading...';\n        }\n    }\n\n    private handleSearch(event:Event) {\n        vLogger(`Handling search`);\n        event.preventDefault();\n        event.stopPropagation();\n        // do we have anything to search for?\n        let queryText = this.queryEl.value.trim();\n        if (queryText.length == 0) return;\n\n        // ok, have a search term, lets start a search\n        this.changeSearchButton(false);\n\n        // get the query string from state obj\n        let query = this.config.apis.bggSearchCall;\n\n\n        downloader.addQLApiRequest(this.config.apis.graphQL, query, {queryString:queryText}, this.handleSearchResultsCB, this.config.stateNames.bggSearchResults);\n    }\n\n    public handleSearchResultsCB(data:any,status:number,associatedStateName:string):void {\n        this.changeSearchButton(true);\n        vLogger(`callback for bgg search ${associatedStateName} with status ${status} - `);\n        if (status >= 200 && status <= 299) { // do we have any data?\n            vLoggerDetail(data);\n            vLoggerDetail(data.data.findBoardGames);\n            this.localisedSM.setStateByName(this.config.stateNames.bggSearchResults,data.data.findBoardGames,true);\n        }\n    }\n\n\n    onDocumentLoaded() {\n        super.onDocumentLoaded();\n        // get a link to the search button and search field and form\n        // @ts-ignore\n        this.formEl = this.document.getElementById(this.uiConfig.dom.formId);\n        // @ts-ignore\n        this.buttonEl = this.document.getElementById(this.uiConfig.dom.buttonId);\n        // @ts-ignore\n        this.queryEl = this.document.getElementById(this.uiConfig.dom.queryId);\n\n        this.formEl.addEventListener('submit',this.handleSearch);\n    }\n\n    getIdForStateItem(name: string, item: any) {\n        return item.gameId;\n    }\n\n    getLegacyIdForStateItem(name: string, item: any) {\n        return item.gameId;\n    }\n\n    getDisplayValueForStateItem(name: string, item: any) {\n        return `${item.name} (${item.year})     `;\n    }\n\n    getModifierForStateItem(name: string, item: any) {\n        return 'normal';\n    }\n\n    getSecondaryModifierForStateItem(name: string, item: any) {\n    return 'normal';\n    }\n\n    eventClickItem(event: MouseEvent) {\n        event.preventDefault();\n        event.stopPropagation();\n        console.log(event.target);\n        // @ts-ignore\n        const boardGameId = event.target.getAttribute(this.uiConfig.dom.resultDataKeyId);\n        // @ts-ignore\n        const dataSource = event.target.getAttribute(this.uiConfig.dom.resultDataSourceId);\n\n        // @ts-ignore\n        vLoggerDetail(`Board Game ${event.target} with id ${boardGameId} clicked from ${dataSource}`);\n\n        let boardGame = this.localisedSM.findItemInState(this.config.stateNames.bggSearchResults,{gameId:parseInt(boardGameId)},isSameGame);\n        if (boardGame) {\n            this.applicationView.addBoardGameToDisplay(boardGame);\n        }\n        this.eventHide(null);\n\n    }\n\n\n\n\n    updateView(name: string, newState: any) {\n        if (name === this.config.stateNames.bggSearchResults) {\n            vLogger(`Updating for recent searches`);\n            newState = this.localisedSM.getStateByName(this.config.stateNames.bggSearchResults);\n            vLogger(newState);\n            this.createResultsForState(name, newState);\n        }\n    }\n\n    getDragData(event: DragEvent) {\n        // use the actual id to pass the user to the droppable target\n        // @ts-ignore\n        const boardGameId = event.target.getAttribute(this.uiConfig.dom.resultDataKeyId);\n        // @ts-ignore\n        vLoggerDetail(`Board Game ${event.target.innerText} with id ${boardGameId} dragging`);\n        let boardGame = this.localisedSM.findItemInState(this.config.stateNames.bggSearchResults, {gameId: parseInt(boardGameId)}, isSameGame);\n        vLoggerDetail(boardGame);\n        boardGame[this.config.ui.draggable.draggedType] = this.config.ui.draggable.draggedTypeBoardGame;\n        boardGame[this.config.ui.draggable.draggedFrom] = this.config.ui.draggable.draggedFromBoardGameSearch;\n        return boardGame;\n    }\n\n    protected eventDeleteClickItem(event: MouseEvent): void {\n        // @ts-ignore\n        const boardGameId = event.target.getAttribute(this.uiConfig.dom.resultDataKeyId);\n        // @ts-ignore\n        const dataSource = event.target.getAttribute(this.uiConfig.dom.resultDataSourceId)\n        // @ts-ignore\n        vLoggerDetail(`Board Game ${event.target} with id ${boardGameId} delete clicked from ${dataSource}`);\n\n        let boardGame:any = this.localisedSM.findItemInState(this.config.stateNames.bggSearchResults, {id: parseInt(boardGameId)}, isSameGame);\n        vLogger(boardGameId);\n        if (boardGame) {\n            this.localisedSM.removeItemFromState(this.config.stateNames.bggSearchResults, boardGame, isSameGame,true);\n        }\n    }\n\n    protected getBadgeValue(name: string, item: any): number {\n        return 0;\n    }\n\n    protected getBackgroundImage(name: string, item: any): string {\n        return \"\";\n    }\n\n\n}\n\nexport default BoardGameSearchSidebarView;\n","import React from \"react\";\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport debug from 'debug';\n\nimport controller from \"../Controller\";\nimport {Decorator} from \"../AppTypes\";\n\nconst beLogger = debug('view-ts:boardgameview');\n\n\n// @ts-ignore\nexport default function BoardGameView({boardGame, showScoresHandler, addToCollectionHandler, removeFromCollectionHandler,startScoreSheetHandler}) {\n    if (boardGame) {\n        beLogger(`Board Game ${boardGame.gameId}`);\n\n        let addButton = <div>\n            <button type=\"button\"\n                    className=\"btn-primary btn-sm rounded p-1 mr-2 mt-1\"\n                    board-game-id={boardGame.gameId} onClick={addToCollectionHandler}>\n                &nbsp;&nbsp;Add to {!controller.isLoggedIn()?'Browser':''} Collection &nbsp;\n                <i className=\"fas fa-star\"></i>&nbsp;&nbsp;\n            </button>\n            <button type=\"button\"\n                    className=\"btn-primary btn-sm rounded p-1 ml-2 mt-1\"\n                    board-game-id={boardGame.gameId} onClick={removeFromCollectionHandler}>\n                &nbsp;&nbsp;Remove from Display&nbsp;<i className=\"fas fa-trash-alt\"></i>\n            </button>\n            </div>\n\n        let deleteButton =\n            <button type=\"button\"\n                    className=\"btn-warning btn-sm rounded p-1 mr-2 mt-1\"\n                    board-game-id={boardGame.gameId} onClick={removeFromCollectionHandler}>\n                &nbsp;&nbsp;Remove from {!controller.isLoggedIn()?'Browser':''} Collection &nbsp;\n                <i className=\"far fa-star\"></i>&nbsp;&nbsp;\n            </button>\n\n        let startScoreSheetButton =\n            <button type=\"button\"\n                    className=\"btn-secondary btn-sm rounded p-1 mr-2 mt-1\"\n                    board-game-id={boardGame.gameId} onClick={startScoreSheetHandler}>\n                &nbsp;&nbsp;Start Score Sheet &nbsp;\n                <i className=\"far fa-star\"></i>&nbsp;&nbsp;\n            </button>\n\n        // do we have any scores?\n        let scoreCount = 0;\n        if (boardGame.scores) {\n            scoreCount = boardGame.scores.length;\n        }\n\n//        let overlay = <div className=\"card-img-overlay\">\n        let favouriteIcon = <i className=\"fas fa-star text-black\"></i>\n        let scoreBadge = <span board-game-id={boardGame.gameId} className='badge badge-pill badge-primary' onClick={showScoresHandler}>{scoreCount}</span>\n\n        if ((boardGame.decorator) && (boardGame.decorator !== Decorator.Incomplete)) {\n\n            return (\n                <div className=\"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2\">\n                    <div className=\"card\">\n                        <img className=\"card-img-top\" src={boardGame.image} alt=\"Card image cap\"></img>\n                        <div className=\"card-body scroll\">\n                            <h5 className=\"card-title\">{boardGame.name} ({boardGame.year}) {((boardGame.decorator === Decorator.Persisted) || (boardGame.decorator === Decorator.PersistedLocally))?favouriteIcon:''} {((boardGame.decorator === Decorator.Persisted) || (boardGame.decorator === Decorator.PersistedLocally))?scoreBadge:''}<br/>  {(controller.isLoggedIn())?((boardGame.decorator === Decorator.Persisted)?deleteButton:addButton):deleteButton}</h5>\n                            <p className=\"card-text\">{boardGame.description}</p>\n\n                            <p className=\"card-text\">\n                                <small className=\"text-muted\">\n                                    Play Time: {boardGame.minPlayTime} - {boardGame.maxPlayTime} min<br/>\n                                    Players: {boardGame.minPlayers} - {boardGame.maxPlayers} Min Age:\n                                    {boardGame.minAge}<br/>\n                                    Categories: {boardGame.categories}\n                                </small>\n                            </p>\n                        </div>\n                        <div className=\"card-footer text-right text-muted\">\n                            Rank: {boardGame.rank} Score: {boardGame.averageScore} from {boardGame.numOfRaters} raters<br/>\n                            {startScoreSheetButton}\n                        </div>\n                    </div>\n                </div>\n            );\n        }\n        else {\n            return (\n            <div className=\"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2\">\n                <div className=\"card\">\n                    <img className=\"card-img-top\" src=\"/img/spinner.gif\" alt=\"Card image cap\"></img>\n                    <div className=\"card-body\">\n                        <h5 className=\"card-title\">{boardGame.name} ({boardGame.year}) </h5>\n                        <p className=\"card-text\">Loading...</p>\n                        <p className=\"card-text\">\n                            <small className=\"text-muted\">\n                                Loading...\n                            </small>\n                        </p>\n                    </div>\n                    <div className={\"card-footer text-right text-muted\"}>\n                        Loading...\n                    </div>\n                </div>\n            </div>);\n        }\n    } else {\n        return (\n            <div className=\"col-sm-12 col-md-6 col-lg-4 col-xl-3 p-2\">\n                <div className=\"card\">\n                </div>\n            </div>\n        );\n    }\n}\n\n\n","/* eslint \"react/react-in-jsx-scope\":\"off\" */\n/* eslint \"react/jsx-no-undef\":\"off\" */\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport debug from 'debug';\n\nimport controller from './Controller';\nimport UserSearchSidebarView from \"./component/UserSearchSidebarView\";\nimport ChatSidebarView from \"./component/ChatSidebarView\";\nimport BoardGameSearchSidebarView from \"./component/BoardGameSearchSidebarView\";\nimport BoardGameView from \"./component/BoardGameView\";\nimport {Decorator} from \"./AppTypes\";\nimport browserUtil from \"./util/BrowserUtil\";\nimport {ScoreSheetController} from \"./component/ScoreSheetController\";\nimport {ScoreSheetView} from \"./component/ScoreSheetView\";\n\n\nconst logger = debug('app');\n\nclass Root extends React.Component{\n    private titleEl: any;\n    private contentEl: any;\n    private modalEl: any;\n    // @ts-ignore\n    private commentView: CommentSidebarView;\n    // @ts-ignore\n    private detailsView: DetailsSidebarView;\n\n    // @ts-ignore\n    private userSearchView: UserSearchSidebarView;\n    // @ts-ignore\n    private bggSearchView: BoardGameSearchSidebarView;\n    // @ts-ignore\n    private chatView: ChatSidebarView;\n    // @ts-ignore\n    private scoreSheetView: ScoreSheetView;\n\n    // @ts-ignore\n    private cancelBtnEl: HTMLElement | null;\n    // @ts-ignore\n    private confirmBtnEl: HTMLElement | null;\n    // @ts-ignore\n    private closeBtnEl: HTMLElement | null;\n\n    // @ts-ignore\n    private thisEl: HTMLDivElement | null;\n    // @ts-ignore\n    private scoreSheetEl: HTMLDivElement | null;\n\n    constructor() {\n        // @ts-ignore\n        super();\n        this.state = {\n            isLoggedIn: false,\n            loggedInUserId: -1,\n            boardGames: [],\n            scoreSheet: {\n                room: '',\n                boardGameName: '',\n                sheetLayoutOptions: {},\n                timer: 0,\n                sheetData: {}\n            },\n            stateNames: {\n                users: 'users',\n                boardGames: 'boardGames',\n                scores: 'scores',\n                selectedEntry: 'selectedEntry',\n                recentUserSearches: 'recentUserSearches',\n                bggSearchResults: 'bggSearchResults',\n                scoreSheet: 'scoreSheet'\n            },\n            apis: {\n                login: '/login',\n                graphQL: '/graphql',\n                bggSearchCall: 'query search($queryString: String!) {findBoardGames(query: $queryString) {gameId, name, year}}',\n                bggSearchCallById: {\n                    queryString: 'query getDetails($gameId:Int!) {getBoardGameDetails(gameId:$gameId) {gameId,thumb,image,name,description,year, minPlayers, maxPlayers, minPlayTime, maxPlayTime, minAge, designers, artists, publisher, numOfRaters, averageScore, rank, categories}}',\n                    resultName:'getBoardGameDetails',\n                },\n                findUsers: {\n                    queryString: 'query {findUsers {id, username}}',\n                    resultName: 'findUsers',\n                },\n                addToMyCollection: {\n                    queryString: 'mutation addBoardGame($userId: Int!, $boardGame: BoardGameDetailInput!){addToMyCollection(userId: $userId, boardGame: $boardGame) {id,gameId}}',\n                    resultName: 'addToMyCollection',\n                },\n                removeFromMyCollection: {\n                    queryString: 'mutation removeBoardGame($userId: Int!, $boardGameId: Int!) {removeFromMyCollection(userId: $userId, boardGameId: $boardGameId) {result}}',\n                    resultName: 'removeFromMyCollection'\n                },\n                getMyBoardGameCollection: {\n                    queryString: 'query myCollection($userId: Int!) {getMyBoardGameCollection(userId: $userId) {id,gameId,thumb,image,name,description,year, minPlayers, maxPlayers, minPlayTime, maxPlayTime, minAge, designers, artists, publisher, numOfRaters, averageScore, rank, categories,scores {id, players, scores, jsonData, createdOn}}}',\n                    resultName: 'getMyBoardGameCollection',\n                },\n                addScoreSheetToBoardGame: {\n                    queryString: 'mutation addScore($userId: Int!, $boardGameId: Int!, $sheet: ScoreSheetInput) {addScoreSheetToBoardGame(userId: $userId, boardGameId: $boardGameId, sheet: $sheet){id}}',\n                    resultName: 'addScoreSheetToBoardGame'\n                }\n\n\n\n            },\n            ui: {\n                draggable: {\n                    draggableDataKeyId: 'text/plain',\n                    draggedType: 'draggedType',\n                    draggedFrom: 'draggedFrom',\n                    draggedTypeUser: 'user',\n                    draggedTypeBoardGame: 'boardGame',\n                    draggedFromUserSearch: 'userSearch',\n                    draggedFromBoardGameSearch: 'boardGameSearch',\n                },\n                alert: {\n                    modalId: \"alert\",\n                    titleId: \"alert-title\",\n                    contentId: \"alert-content\",\n                    cancelButtonId: \"alert-cancel\",\n                    confirmButtonId: \"alert-confirm\",\n                    closeButtonId: \"alert-close\",\n                    hideClass: \"d-none\",\n                    showClass: \"d-block\",\n                },\n                navigation: {\n                    showMyCollection: 'navigationItemMyCollection',\n                    boardGameSearchId: 'navigationItemBoardGameSearch',\n                    userSearchId: 'navigationItemUserSearch',\n                    chatId: 'navigationItemChat',\n                    showScoreSheet: 'navigationItemScoreSheet',\n\n                },\n                chatSideBar: {\n                    dom: {\n                        sideBarId: 'chatSideBar',\n                        resultsId: 'chatLogs',\n                        resultsElementType: 'a',\n                        resultsElementAttributes: [\n                            ['href', '#'],\n                        ],\n                        resultsClasses: 'list-group-item my-list-item truncate-comment list-group-item-action',\n                        resultDataKeyId: 'room',\n                        resultLegacyDataKeyId: 'room',\n                        resultDataSourceId: 'chatLogs',\n                        modifierClassNormal: '',\n                        modifierClassInactive: 'list-group-item-dark',\n                        modifierClassActive: 'list-group-item-primary',\n                        modifierClassWarning: '',\n                        iconNormal: '',\n                        iconInactive: '',\n                        iconActive: '',\n                        iconWarning: '',\n                        isDraggable: false,\n                        isClickable: true,\n                        isDeleteable: true,\n                        deleteButtonClasses: 'btn btn-circle btn-xsm',\n                        deleteButtonText: '',\n                        deleteButtonIconClasses:'fas fa-trash-alt',\n                        hasBadge: true,\n                        resultContentDivClasses: 'd-flex w-100 justify-content-between',\n                        resultContentTextElementType: 'span',\n                        resultContentTextClasses: 'mb-1',\n                        badgeElementType: 'span',\n                        badgeElementAttributes: [\n                            ['style', 'font-size:12pt'],\n                        ],\n                        badgeClasses: 'badge badge-pill badge-primary',\n                        newFormId: \"newMessage\",\n                        commentId: \"message\",\n                        submitCommentId: \"submitMessage\",\n                        chatLogId: 'chatLog',\n                        chatLogRoomId: 'chatLogRoom',\n                        leaveChatId: 'leaveChat'\n                    },\n                },\n                userSearchSideBar: {\n                    dom: {\n                        sideBarId: 'userSearchSideBar',\n                        resultsId: 'recentUserSearches',\n                        favouriteUsersId: 'favouriteUsers',\n                        blockedUsersId: 'blockedUsers',\n                        favouriteUsersDropZone: 'favouriteUsersDropZone',\n                        blockedUsersDropZone: 'blockedUsersDropZone',\n                        resultsElementType: 'a',\n                        resultsElementAttributes: [\n                            ['href', '#'],\n                        ],\n                        resultsClasses: 'list-group-item my-list-item truncate-notification list-group-item-action',\n                        resultDataKeyId: 'user-id',\n                        resultLegacyDataKeyId: 'legacy-user-id',\n                        resultDataSourceId: 'data-source',\n                        resultDataSourceValue: 'recentUserSearches',\n                        resultDataSourceFavUsers: 'favouriteUsers',\n                        resultDataSourceBlockedUsers: 'blockedUsers',\n                        modifierClassNormal: 'list-group-item-primary',\n                        modifierClassInactive: 'list-group-item-light',\n                        modifierClassActive: 'list-group-item-info',\n                        modifierClassWarning: 'list-group-item-danger',\n                        iconNormal: '   <i class=\"fas fa-comment\"></i>',\n                        iconInactive: '   <i class=\"fas fa-comment\"></i>',\n                        iconActive: '   <i class=\"fas fa-heart\"></i>',\n                        iconWarning: '  <i class=\"fas fa-exclamation-circle\"></i>',\n                        resultContentDivClasses: 'd-flex w-100 justify-content-between',\n                        resultContentTextElementType: 'span',\n                        resultContentTextClasses: 'mb-1',\n                        isDraggable: true,\n                        isClickable: true,\n                        isDeleteable: true,\n                        deleteButtonClasses: 'btn btn-circle btn-xsm',\n                        deleteButtonText: '',\n                        deleteButtonIconClasses:'fas fa-trash-alt',\n                        extra: {\n                            fastSearchInputId: 'fastSearchUserNames',\n                        },\n                    },\n                },\n                boardGameSearchSideBar: {\n                    dom: {\n                        sideBarId: 'boardGameSearchSidebar',\n                        resultsId: 'bggSearchResults',\n                        resultsElementType: 'a',\n                        resultsElementAttributes: [\n                            ['href', '#'],\n                        ],\n                        resultsClasses: 'list-group-item my-list-item truncate-notification list-group-item-action',\n                        resultDataKeyId: 'bgg-id',\n                        resultLegacyDataKeyId: 'bgg-id',\n                        resultDataSourceId: 'data-source',\n                        resultDataSourceValue: 'bggSearch',\n                        modifierClassNormal: 'list-group-item-primary',\n                        modifierClassInactive: 'list-group-item-light',\n                        modifierClassActive: 'list-group-item-info',\n                        modifierClassWarning: 'list-group-item-danger',\n                        iconNormal: '   <i class=\"fas fa-dice\"></i>',\n                        iconInactive: '   <i class=\"fas fa-dice\"></i>',\n                        iconActive: '   <i class=\"fas fa-dice\"></i>',\n                        iconWarning: '  <i class=\"fas fa-dice\"></i>',\n                        resultContentDivClasses: 'd-flex w-100 justify-content-between',\n                        resultContentTextElementType: 'span',\n                        resultContentTextClasses: 'mb-1',\n                        isDraggable: true,\n                        isClickable: true,\n                        isDeleteable: true,\n                        deleteButtonClasses: 'btn btn-circle btn-xsm',\n                        deleteButtonText: '',\n                        deleteButtonIconClasses:'fas fa-trash-alt',\n                        formId: 'bggSearch',\n                        queryId: 'queryText',\n                        buttonId: 'bggSearchButton'\n                    },\n                },\n                scoreSheetSideBar: {\n                    dom: {\n                        sideBarId: 'scoreSheetSidebar',\n                        resultsId: 'scoreSheets',\n                        resultsElementType: 'div',\n                        resultsElementAttributes: [\n                        ],\n                        resultsClasses: 'card text-white',\n                        resultDataKeyId: 'bgg-id',\n                        resultLegacyDataKeyId: 'bgg-id',\n                        resultDataSourceId: 'data-source',\n                        resultDataSourceValue: 'scoreSheet',\n                        modifierClassNormal: '',\n                        modifierClassInactive: '',\n                        modifierClassActive: '',\n                        modifierClassWarning: '',\n                        iconNormal: ' ',\n                        iconInactive: ' ',\n                        iconActive: ' ',\n                        iconWarning: ' ',\n                        isDraggable: false,\n                        isClickable: false,\n                        isDeleteable: false,\n                        resultContentDivClasses: 'card-img-overlay',\n                        resultContentTextElementType: 'div',\n                        resultContentTextClasses: 'ml-2',\n                        hasBackgroundImage: true,\n                        imgElementType: 'img',\n                        imgClasses: 'card-img',\n                    },\n                },\n                scoreSheet: {\n                    dom: {\n                        dropZone: \"scoreSheetZone\",\n                        boardGame: \"selectedBoardGame\",\n                        startStopTimer: \"startStopTimer\",\n                        timer: \"timerDisplay\",\n                        end: \"leaveScoreSheet\",\n                        scoreSheet: \"scoreSheet\",\n                        iconStart: \"<i class='fas fa-hourglass-start'></i>\",\n                        iconInProgress: \"<i class='fas fa-hourglass-half'></i>\",\n                        iconEnd: \"<i class='fas fa-hourglass-end'></i>\",\n                        iconLeave: \"<i class='fas fa-sign-out-alt'></i>\",\n\n\n                    }\n                }\n            },\n            uiPrefs: {\n                navigation: {},\n                blogEntry: {},\n                userSearchSideBar: {\n                    view: {\n                        location: 'left',\n                        expandedSize: '35%',\n                    },\n                },\n                boardGameSearchSideBar: {\n                    view: {\n                        location: 'left',\n                        expandedSize: '35%',\n                    },\n                },\n                chatSideBar: {\n                    view: {\n                        location: 'right',\n                        expandedSize: '50%',\n                    },\n                },\n                scoreSheetSideBar: {\n                    view: {\n                        location: 'bottom',\n                        expandedSize: '25%',\n                    },\n                },\n            },\n            controller: {\n                events: {\n                    boardGames: {\n                        eventDataKeyId: 'board-game-id',\n                    },\n                },\n                dataLimit: {\n                    recentUserSearches: 10,\n                },\n            },\n        };\n        // event handlers\n        this.cancelDelete = this.cancelDelete.bind(this);\n        this.confirmDelete = this.confirmDelete.bind(this);\n        this.handleDeleteBoardGame = this.handleDeleteBoardGame.bind(this);\n\n        this.handleShowUserSearch = this.handleShowUserSearch.bind(this);\n        this.handleShowChat = this.handleShowChat.bind(this);\n        this.handleShowBGGSearch = this.handleShowBGGSearch.bind(this);\n\n        this.handleDragOver = this.handleDragOver.bind(this);\n        this.handleDrop = this.handleDrop.bind(this);\n\n        this.handleShowCollection = this.handleShowCollection.bind(this);\n        this.handleShowScoreSheet = this.handleShowScoreSheet.bind(this);\n        this.handleStartScoreSheet = this.handleStartScoreSheet.bind(this);\n\n        controller.connectToApplication(this, window.localStorage);\n    }\n\n    private handleDragOver(event:DragEvent) {\n        event.preventDefault();\n    }\n\n    private handleDrop(event:Event) {\n        // @ts-ignore\n        const draggedObjectJSON = event.dataTransfer.getData(this.state.ui.draggable.draggableDataKeyId);\n        logger(draggedObjectJSON);\n        const draggedObject = JSON.parse(draggedObjectJSON);\n        logger(draggedObject);\n        // @ts-ignore\n        if (draggedObject[this.state.ui.draggable.draggedType] === this.state.ui.draggable.draggedTypeBoardGame) {\n            this.addBoardGameToDisplay(draggedObject);\n        }\n\n    }\n\n    public addBoardGameToDisplay(draggedObject:any) {\n        // ok, we are just the dumb view, pass this onto the controller to work out the logic for us\n        controller.addBoardGameToDisplay(draggedObject);\n    }\n\n    getCurrentUser() {\n        return controller.getLoggedInUserId();\n    }\n\n    alert(title:string,content:string) {\n        this.titleEl.textContent = title;\n        this.contentEl.textContent = content;\n        // @ts-ignore\n        this.modalEl.classList.remove(this.state.ui.alert.hideClass);\n        // @ts-ignore\n        this.modalEl.classList.add(this.state.ui.alert.showClass);\n    }\n\n\n    render() {\n        logger(\"Rendering App\");\n        // @ts-ignore\n        let boardGames:any[] = this.state.boardGames;\n        logger(boardGames);\n\n        const games = boardGames.map((entry, index:number) =>\n            <BoardGameView\n                key={index}\n                boardGame={entry}\n                showScoresHandler={() => {}}\n                addToCollectionHandler={controller.addBoardGameToCollection}\n                removeFromCollectionHandler={this.handleDeleteBoardGame}\n                startScoreSheetHandler={this.handleStartScoreSheet}\n            />\n        );\n\n        return (\n            <div className=\"root container-fluid\">\n                <div className=\"card-group\">\n                    {games}\n                </div>\n            </div>\n        );\n    }\n\n    cancelDelete(event:MouseEvent) {\n        // @ts-ignore\n        this.modalEl.classList.remove(this.state.ui.alert.showClass);\n        // @ts-ignore\n        this.modalEl.classList.add(this.state.ui.alert.hideClass);\n        event.preventDefault();\n    }\n\n    confirmDelete(event:MouseEvent) {\n        // @ts-ignore\n        this.modalEl.classList.remove(this.state.ui.alert.showClass);\n        // @ts-ignore\n        this.modalEl.classList.add(this.state.ui.alert.hideClass);\n        event.preventDefault();\n        // @ts-ignore\n        let id = this.modalEl.getAttribute(this.state.controller.events.boardGames.eventDataKeyId);\n        id = parseInt(id);\n        logger(`Handling Delete with id ${id}`);\n        // @ts-ignore\n        const currentBoardGamesOnDisplay = this.state.boardGames;\n        let index = currentBoardGamesOnDisplay.findIndex((game:any) => game.gameId === id);\n        if (index >= 0) {\n            const boardGame = currentBoardGamesOnDisplay[index];\n            controller.removeBoardGameFromCollection(boardGame);\n        }\n    }\n\n    handleStartScoreSheet(event:MouseEvent) {\n        event.preventDefault();\n        // do we already have an active score sheet?\n        if (ScoreSheetController.getInstance().hasActiveScoreSheet()) {\n            if (confirm(\"You already have an active score sheet, do you want to finish that one and start a new one?\")) {\n                ScoreSheetController.getInstance().endScoreSheet();\n            }\n            else {\n                // user cancelled, finish\n                return;\n            }\n        }\n\n        this.hideAllSideBars();\n        // @ts-ignore\n        let id = event.target.getAttribute(this.state.controller.events.boardGames.eventDataKeyId);\n        logger(`Handling starting score sheet for ${id}`)\n        if (id) {\n            // find the entry from the state manager\n            id = parseInt(id);\n            // @ts-ignore\n            const currentBoardGamesOnDisplay = this.state.boardGames;\n            let index = currentBoardGamesOnDisplay.findIndex((game: any) => game.gameId === id);\n            if (index >= 0) {\n                const boardGame = currentBoardGamesOnDisplay[index];\n                logger(boardGame);\n                ScoreSheetController.getInstance().startScoreSheet(boardGame);\n                this.switchBetweenCollectionAndScoreSheet(false);\n            }\n        }\n    }\n\n\n    handleDeleteBoardGame(event:MouseEvent) {\n        event.preventDefault();\n        //this.hideAllSideBars();\n        // @ts-ignore\n        let id = event.target.getAttribute(this.state.controller.events.boardGames.eventDataKeyId);\n        logger(`Handling Delete Board Game ${id}`);\n        if (id) {\n            // find the entry from the state manager\n            id = parseInt(id);\n            // @ts-ignore\n            const currentBoardGamesOnDisplay = this.state.boardGames;\n            let index = currentBoardGamesOnDisplay.findIndex((game:any) => game.gameId === id);\n            if (index >= 0) {\n                const boardGame = currentBoardGamesOnDisplay[index];\n                if (boardGame.decorator && (boardGame.decorator === Decorator.Persisted)) {\n                    logger(`Handling Delete Board Game ${id} - persisted, confirming with user, but only if logged in`);\n                    if (controller.isLoggedIn()) {\n                        // @ts-ignore\n                        this.modalEl.setAttribute(this.state.controller.events.boardGames.eventDataKeyId,id);\n                        this.alert(`${boardGame.name} (${boardGame.year})`, \"Are you sure you want to delete this board game from your collection?\");\n                    }\n                    else {\n                        logger(`Handling Delete Board Game ${id} - IS persisted but not logged in, just deleting from local storage  asking controller to remove`);\n                        // not persisted yet, let the controller manage this one\n                        controller.removeBoardGameFromDisplay(boardGame);\n\n                    }\n                }\n                else {\n                    logger(`Handling Delete Board Game ${id} - NOT persisted, asking controller to remove`);\n                    // not persisted yet, let the controller manage this one\n                    controller.removeBoardGameFromDisplay(boardGame);\n                }\n            }\n        }\n    }\n\n\n    async componentDidMount() {\n        logger('component Did Mount');\n\n\n        this.chatView = new ChatSidebarView(this,document,controller.getStateManager());\n        this.chatView.onDocumentLoaded();\n\n        this.userSearchView = new UserSearchSidebarView(this,document,controller.getStateManager());\n        this.userSearchView.onDocumentLoaded();\n\n\n        this.bggSearchView = new BoardGameSearchSidebarView(this,document,controller.getStateManager());\n        this.bggSearchView.onDocumentLoaded();\n\n        this.scoreSheetView = ScoreSheetView.getInstance();\n        this.scoreSheetView.onDocumentLoaded(this);\n\n        // navigation item handlers\n        if (document) {\n            // @ts-ignore\n            document.getElementById(this.state.ui.navigation.boardGameSearchId).addEventListener('click', this.handleShowBGGSearch);\n            // @ts-ignore\n            document.getElementById(this.state.ui.navigation.userSearchId).addEventListener('click', this.handleShowUserSearch);\n            // @ts-ignore\n            document.getElementById(this.state.ui.navigation.chatId).addEventListener('click', this.handleShowChat);\n            // @ts-ignore\n            document.getElementById(this.state.ui.navigation.showMyCollection).addEventListener('click', this.handleShowCollection);\n            // @ts-ignore\n            document.getElementById(this.state.ui.navigation.showScoreSheet).addEventListener('click', this.handleShowScoreSheet);\n        }\n\n        // alert modal dialog setup\n        // @ts-ignore\n        this.modalEl = document.getElementById(this.state.ui.alert.modalId);\n        // @ts-ignore\n        this.titleEl = document.getElementById(this.state.ui.alert.titleId);\n        // @ts-ignore\n        this.contentEl = document.getElementById(this.state.ui.alert.contentId);\n        // @ts-ignore\n        this.cancelBtnEl = document.getElementById(this.state.ui.alert.cancelButtonId);\n        // @ts-ignore\n        this.confirmBtnEl = document.getElementById(this.state.ui.alert.confirmButtonId);\n        // @ts-ignore\n        this.closeBtnEl = document.getElementById(this.state.ui.alert.closeButtonId);\n\n        // event listeners for the confirm delete of entry\n        if (this.cancelBtnEl) this.cancelBtnEl.addEventListener('click',this.cancelDelete);\n        if (this.confirmBtnEl) this.confirmBtnEl.addEventListener('click',this.confirmDelete);\n        if (this.closeBtnEl) this.closeBtnEl.addEventListener('click',this.cancelDelete);\n\n        // a reference to the div containing ourselves\n        // @ts-ignore\n        this.thisEl = document.getElementById('root');\n        // @ts-ignore\n        this.scoreSheetEl = document.getElementById('scoreSheetZone');\n        if (this.thisEl) {\n            this.thisEl.addEventListener('dragover', this.handleDragOver);\n            this.thisEl.addEventListener('drop', this.handleDrop);\n        }\n\n        // ok lets try get things done\n        ScoreSheetController.getInstance().initialise(this);\n        controller.initialise();\n    }\n\n    hideAllSideBars() {\n        this.chatView.eventHide(null);\n        this.userSearchView.eventHide(null);\n        this.bggSearchView.eventHide(null);\n    }\n\n    private switchBetweenCollectionAndScoreSheet(showCollection:boolean) {\n        if (showCollection) {\n            if (this.thisEl) browserUtil.addRemoveClasses(this.thisEl,'d-none',false);\n            if (this.thisEl) browserUtil.addRemoveClasses(this.thisEl,'d-block', true);\n            if (this.scoreSheetEl) browserUtil.addRemoveClasses(this.scoreSheetEl,'d-none', true);\n            if (this.scoreSheetEl) browserUtil.addRemoveClasses(this.scoreSheetEl,'d-block', false);\n        }\n        else {\n            if (ScoreSheetController.getInstance().hasActiveScoreSheet()) {\n                if (this.thisEl) browserUtil.addRemoveClasses(this.thisEl, 'd-none', true);\n                if (this.thisEl) browserUtil.addRemoveClasses(this.thisEl, 'd-block', false);\n                if (this.scoreSheetEl) browserUtil.addRemoveClasses(this.scoreSheetEl, 'd-none', false);\n                if (this.scoreSheetEl) browserUtil.addRemoveClasses(this.scoreSheetEl, 'd-block', true);\n            }\n        }\n    }\n\n    handleShowCollection(event:MouseEvent) {\n        this.switchBetweenCollectionAndScoreSheet(true);\n    }\n\n    handleShowScoreSheet(event:MouseEvent) {\n        this.switchBetweenCollectionAndScoreSheet(false);\n    }\n\n    handleShowUserSearch(event:Event) {\n        logger('Handling Show User Search');\n        event.preventDefault();\n        //this.hideAllSideBars();\n        // prevent anything from happening if we are not logged in\n        if (!controller.isLoggedIn()) {\n            // @ts-ignore\n            window.location.href = this.state.apis.login;\n            return;\n        }\n        this.userSearchView.eventShow(event);\n    }\n\n    handleShowChat(event:Event) {\n        logger('Handling Show Chat');\n        event.preventDefault();\n        //this.hideAllSideBars();\n        // prevent anything from happening if we are not logged in\n        if (!controller.isLoggedIn()) {\n            // @ts-ignore\n            window.location.href = this.state.apis.login;\n            return;\n        }\n        this.chatView.eventShow(event);\n    }\n\n    handleShowBGGSearch(event:Event) {\n        logger('Handling Show BGG Search View');\n        event.preventDefault();\n        // prevent anything from happening if we are not logged in\n        if (!controller.isLoggedIn()) {\n            this.hideAllSideBars();\n            // @ts-ignore\n        }\n        this.bggSearchView.eventShow(event);\n    }\n\n}\n\n//localStorage.debug = 'app view-ts controller-ts socket-ts api-ts local-storage-ts state-manager-ts view-ts:blogentry view-ts:comments view-ts:details';\n//localStorage.debug = 'app controller-ts socket-ts api-ts local-storage-ts state-manager-ts indexeddb-ts user-search-sidebar user-search-sidebar:detail state-manager-ms state-manager-api state-manager-aggregate state-manager-async';\n//localStorage.debug = 'app controller-ts  chat-sidebar chat-sidebar:detail board-game-search-sidebar board-game-search-sidebar:detail ';\nlocalStorage.debug = 'app controller-ts controller-ts-detail api-ts socket-ts socket-listener notification-controller chat-manager board-game-search-sidebar board-game-search-sidebar:detail score-sheet-controller score-sheet-view';\ndebug.log = console.info.bind(console);\n\n// @ts-ignore\nconst element = <Root className=\"container-fluid justify-content-around\"/>;\n\nReactDOM.render(element, document.getElementById('root'));\n"],"sourceRoot":""}